namespace Terraria
{
    using Microsoft.Xna.Framework;
    using System;
    using System.Diagnostics;
    using System.IO;
    using System.Runtime.InteropServices;
    using System.Threading;

    internal class WorldGen
    {
        public static int a = 0;
        public static int altarCount = 0;
        public static int bestX = 0;
        public static int bestY = 0;
        public static int c = 0;
        public static bool canSpawn;
        public static int co = 0;
        private static int[] DDoorPos = new int[300];
        private static int[] DDoorX = new int[300];
        private static int[] DDoorY = new int[300];
        public static int dEnteranceX = 0;
        public static bool destroyObject = false;
        private static int dMaxX;
        private static int dMaxY;
        private static int dMinX;
        private static int dMinY;
        private static int[] DPlatX = new int[300];
        private static int[] DPlatY = new int[300];
        public static int maxDRooms = 100;
        public static int maxMech = 0x3e8;
        public static int maxPump = 20;
        public static int maxRoomTiles = 0x76c;
        public static int maxWire = 0x3e8;
        private static int[] dRoomB = new int[maxDRooms];
        private static int[] dRoomL = new int[maxDRooms];
        private static int[] dRoomR = new int[maxDRooms];
        public static int[] dRoomSize = new int[maxDRooms];
        private static int[] dRoomT = new int[maxDRooms];
        private static bool[] dRoomTreasure = new bool[maxDRooms];
        public static int[] dRoomX = new int[maxDRooms];
        public static int[] dRoomY = new int[maxDRooms];
        public static bool dSurface = false;
        public static int dungeonX;
        public static int dungeonY;
        private static double dxStrength1;
        private static double dxStrength2;
        private static double dyStrength1;
        private static double dyStrength2;
        private static int[] fihX = new int[300];
        private static int[] fihY = new int[300];
        public static bool gen = false;
        [ThreadStatic]
        public static Random genRand = new Random();
        public static int go = 0;
        private static int grassSpread = 0;
        public static bool hardLock = false;
        private static int hellChest = 0;
        public static int hiScore = 0;
        private static int houseCount = 0;
        public static bool[] houseTile = new bool[0x91];
        public static int[] inPumpX = new int[maxPump];
        public static int[] inPumpY = new int[maxPump];
        public static int ir = 0;
        private static int[] JChestX = new int[100];
        private static int[] JChestY = new int[100];
        private static int JungleX = 0;
        public static Vector2 lastDungeonHall = new Vector2();
        private static int lastMaxTilesX = 0;
        private static int lastMaxTilesY = 0;
        public static int lavaLine;
        public static bool loadBackup = false;
        public static bool loadFailed = false;
        public static bool loadSuccess = false;
        public static int m = 0;
        private static int[] mCaveX = new int[300];
        private static int[] mCaveY = new int[300];
        public static int[] mechTime = new int[maxMech];
        public static int[] mechX = new int[maxMech];
        public static int[] mechY = new int[maxMech];
        private static bool mergeDown = false;
        private static bool mergeLeft = false;
        private static bool mergeRight = false;
        private static bool mergeUp = false;
        private static bool mudWall = false;
        public static bool noLiquidCheck = false;
        public static bool noTileActions = false;
        public static int[] noWireX = new int[maxWire];
        public static int[] noWireY = new int[maxWire];
        private static int numDDoors;
        private static int numDPlats;
        public static int numDRooms = 0;
        public static int numInPump = 0;
        private static int numIslandHouses = 0;
        private static int numJChests = 0;
        private static int numMCaves = 0;
        public static int numMechs = 0;
        public static int numNoWire = 0;
        public static int numOutPump = 0;
        public static int numRoomTiles;
        public static int numWire = 0;
        public static int[] outPumpX = new int[maxPump];
        public static int[] outPumpY = new int[maxPump];
        private static object padlock = new object();
        private static bool roomChair;
        private static bool roomDoor;
        private static bool roomEvil;
        private static bool roomOccupied;
        private static bool roomTable;
        private static bool roomTorch;
        public static int[] roomX = new int[maxRoomTiles];
        public static int roomX1;
        public static int roomX2;
        public static int[] roomY = new int[maxRoomTiles];
        public static int roomY1;
        public static int roomY2;
        public static bool saveLock = false;
        public static int shadowOrbCount = 0;
        public static bool shadowOrbSmashed = false;
        public static int si = 0;
        public static int spawnDelay = 0;
        public static bool spawnEye = false;
        public static bool spawnMeteor = false;
        public static int spawnNPC = 0;
        public static string statusText = "";
        private static bool stopDrops = false;
        private static bool tempBloodMoon = Main.bloodMoon;
        private static bool tempDayTime = Main.dayTime;
        private static int tempMoonPhase = Main.moonPhase;
        private static double tempTime = Main.time;
        public static byte tEvil = 0;
        public static byte tGood = 0;
        public static int totalD = 0;
        public static int totalEvil = 0;
        public static int totalEvil2 = 0;
        public static int totalGood = 0;
        public static int totalGood2 = 0;
        public static int totalSolid = 0;
        public static int totalSolid2 = 0;
        public static int totalX = 0;
        public static int waterLine;
        public static int[] wireX = new int[maxWire];
        public static int[] wireY = new int[maxWire];
        public static bool worldBackup = false;
        public static bool worldCleared = false;

        public static bool AddBuriedChest(int i, int j, int contain = 0, bool notNearOtherChests = false, int Style = -1)
        {
            if (genRand == null)
            {
                genRand = new Random((int) DateTime.Now.Ticks);
            }
            for (int k = j; k < Main.maxTilesY; k++)
            {
                if (!Main.tile[i, k].active || !Main.tileSolid[Main.tile[i, k].type])
                {
                    continue;
                }
                bool flag = false;
                int num2 = i;
                int num3 = k;
                int index = -1;
                int style = 0;
                if ((num3 >= (Main.worldSurface + 25.0)) || (contain > 0))
                {
                    style = 1;
                }
                if (Style >= 0)
                {
                    style = Style;
                }
                if ((num3 > (Main.maxTilesY - 0xcd)) && (contain == 0))
                {
                    if (hellChest == 0)
                    {
                        contain = 0x112;
                        style = 4;
                        flag = true;
                    }
                    else if (hellChest == 1)
                    {
                        contain = 220;
                        style = 4;
                        flag = true;
                    }
                    else if (hellChest == 2)
                    {
                        contain = 0x70;
                        style = 4;
                        flag = true;
                    }
                    else if (hellChest == 3)
                    {
                        contain = 0xda;
                        style = 4;
                        flag = true;
                        hellChest = 0;
                    }
                }
                index = PlaceChest(num2 - 1, num3 - 1, 0x15, notNearOtherChests, style);
                if (index < 0)
                {
                    return false;
                }
                if (flag)
                {
                    hellChest++;
                }
                int num6 = 0;
                while (num6 == 0)
                {
                    if (num3 < (Main.worldSurface + 25.0))
                    {
                        if (contain > 0)
                        {
                            Main.chest[index].item[num6].SetDefaults(contain, false);
                            Main.chest[index].item[num6].Prefix(-1);
                            num6++;
                        }
                        else
                        {
                            switch (genRand.Next(6))
                            {
                                case 0:
                                    Main.chest[index].item[num6].SetDefaults(280, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                    break;

                                case 1:
                                    Main.chest[index].item[num6].SetDefaults(0x119, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                    break;

                                case 2:
                                    Main.chest[index].item[num6].SetDefaults(0x11c, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                    break;

                                case 3:
                                    Main.chest[index].item[num6].SetDefaults(0x11a, false);
                                    Main.chest[index].item[num6].stack = genRand.Next(50, 0x4b);
                                    break;

                                case 4:
                                    Main.chest[index].item[num6].SetDefaults(0x117, false);
                                    Main.chest[index].item[num6].stack = genRand.Next(0x19, 50);
                                    break;

                                case 5:
                                    Main.chest[index].item[num6].SetDefaults(0x11d, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                    break;
                            }
                            num6++;
                        }
                        if (genRand.Next(3) == 0)
                        {
                            Main.chest[index].item[num6].SetDefaults(0xa8, false);
                            Main.chest[index].item[num6].stack = genRand.Next(3, 6);
                            num6++;
                        }
                        if (genRand.Next(2) == 0)
                        {
                            int num8 = genRand.Next(2);
                            int num9 = genRand.Next(8) + 3;
                            switch (num8)
                            {
                                case 0:
                                    Main.chest[index].item[num6].SetDefaults(20, false);
                                    break;

                                case 1:
                                    Main.chest[index].item[num6].SetDefaults(0x16, false);
                                    break;
                            }
                            Main.chest[index].item[num6].stack = num9;
                            num6++;
                        }
                        if (genRand.Next(2) == 0)
                        {
                            int num10 = genRand.Next(2);
                            int num11 = genRand.Next(0x1a) + 0x19;
                            switch (num10)
                            {
                                case 0:
                                    Main.chest[index].item[num6].SetDefaults(40, false);
                                    break;

                                case 1:
                                    Main.chest[index].item[num6].SetDefaults(0x2a, false);
                                    break;
                            }
                            Main.chest[index].item[num6].stack = num11;
                            num6++;
                        }
                        if (genRand.Next(2) == 0)
                        {
                            int num12 = genRand.Next(1);
                            int num13 = genRand.Next(3) + 3;
                            if (num12 == 0)
                            {
                                Main.chest[index].item[num6].SetDefaults(0x1c, false);
                            }
                            Main.chest[index].item[num6].stack = num13;
                            num6++;
                        }
                        if (genRand.Next(3) > 0)
                        {
                            int num14 = genRand.Next(4);
                            int num15 = genRand.Next(1, 3);
                            switch (num14)
                            {
                                case 0:
                                    Main.chest[index].item[num6].SetDefaults(0x124, false);
                                    break;

                                case 1:
                                    Main.chest[index].item[num6].SetDefaults(0x12a, false);
                                    break;

                                case 2:
                                    Main.chest[index].item[num6].SetDefaults(0x12b, false);
                                    break;

                                case 3:
                                    Main.chest[index].item[num6].SetDefaults(290, false);
                                    break;
                            }
                            Main.chest[index].item[num6].stack = num15;
                            num6++;
                        }
                        if (genRand.Next(2) == 0)
                        {
                            int num16 = genRand.Next(2);
                            int num17 = genRand.Next(11) + 10;
                            switch (num16)
                            {
                                case 0:
                                    Main.chest[index].item[num6].SetDefaults(8, false);
                                    break;

                                case 1:
                                    Main.chest[index].item[num6].SetDefaults(0x1f, false);
                                    break;
                            }
                            Main.chest[index].item[num6].stack = num17;
                            num6++;
                        }
                        if (genRand.Next(2) == 0)
                        {
                            Main.chest[index].item[num6].SetDefaults(0x48, false);
                            Main.chest[index].item[num6].stack = genRand.Next(10, 30);
                            num6++;
                        }
                    }
                    else
                    {
                        if (num3 < Main.rockLayer)
                        {
                            if (contain > 0)
                            {
                                Main.chest[index].item[num6].SetDefaults(contain, false);
                                Main.chest[index].item[num6].Prefix(-1);
                                num6++;
                            }
                            else
                            {
                                switch (genRand.Next(7))
                                {
                                    case 0:
                                        Main.chest[index].item[num6].SetDefaults(0x31, false);
                                        Main.chest[index].item[num6].Prefix(-1);
                                        break;

                                    case 1:
                                        Main.chest[index].item[num6].SetDefaults(50, false);
                                        Main.chest[index].item[num6].Prefix(-1);
                                        break;

                                    case 2:
                                        Main.chest[index].item[num6].SetDefaults(0x34, false);
                                        break;

                                    case 3:
                                        Main.chest[index].item[num6].SetDefaults(0x35, false);
                                        Main.chest[index].item[num6].Prefix(-1);
                                        break;

                                    case 4:
                                        Main.chest[index].item[num6].SetDefaults(0x36, false);
                                        Main.chest[index].item[num6].Prefix(-1);
                                        break;

                                    case 5:
                                        Main.chest[index].item[num6].SetDefaults(0x37, false);
                                        Main.chest[index].item[num6].Prefix(-1);
                                        break;

                                    case 6:
                                        Main.chest[index].item[num6].SetDefaults(0x33, false);
                                        Main.chest[index].item[num6].stack = genRand.Next(0x1a) + 0x19;
                                        break;
                                }
                                num6++;
                            }
                            if (genRand.Next(3) == 0)
                            {
                                Main.chest[index].item[num6].SetDefaults(0xa6, false);
                                Main.chest[index].item[num6].stack = genRand.Next(10, 20);
                                num6++;
                            }
                            if (genRand.Next(2) == 0)
                            {
                                int num19 = genRand.Next(2);
                                int num20 = genRand.Next(10) + 5;
                                switch (num19)
                                {
                                    case 0:
                                        Main.chest[index].item[num6].SetDefaults(0x16, false);
                                        break;

                                    case 1:
                                        Main.chest[index].item[num6].SetDefaults(0x15, false);
                                        break;
                                }
                                Main.chest[index].item[num6].stack = num20;
                                num6++;
                            }
                            if (genRand.Next(2) == 0)
                            {
                                int num21 = genRand.Next(2);
                                int num22 = genRand.Next(0x19) + 0x19;
                                switch (num21)
                                {
                                    case 0:
                                        Main.chest[index].item[num6].SetDefaults(40, false);
                                        break;

                                    case 1:
                                        Main.chest[index].item[num6].SetDefaults(0x2a, false);
                                        break;
                                }
                                Main.chest[index].item[num6].stack = num22;
                                num6++;
                            }
                            if (genRand.Next(2) == 0)
                            {
                                int num23 = genRand.Next(1);
                                int num24 = genRand.Next(3) + 3;
                                if (num23 == 0)
                                {
                                    Main.chest[index].item[num6].SetDefaults(0x1c, false);
                                }
                                Main.chest[index].item[num6].stack = num24;
                                num6++;
                            }
                            if (genRand.Next(3) > 0)
                            {
                                int num25 = genRand.Next(7);
                                int num26 = genRand.Next(1, 3);
                                switch (num25)
                                {
                                    case 0:
                                        Main.chest[index].item[num6].SetDefaults(0x121, false);
                                        break;

                                    case 1:
                                        Main.chest[index].item[num6].SetDefaults(0x12a, false);
                                        break;

                                    case 2:
                                        Main.chest[index].item[num6].SetDefaults(0x12b, false);
                                        break;

                                    case 3:
                                        Main.chest[index].item[num6].SetDefaults(290, false);
                                        break;

                                    case 4:
                                        Main.chest[index].item[num6].SetDefaults(0x12f, false);
                                        break;

                                    case 5:
                                        Main.chest[index].item[num6].SetDefaults(0x123, false);
                                        break;

                                    case 6:
                                        Main.chest[index].item[num6].SetDefaults(0x130, false);
                                        break;
                                }
                                Main.chest[index].item[num6].stack = num26;
                                num6++;
                            }
                            if (genRand.Next(2) == 0)
                            {
                                int num27 = genRand.Next(11) + 10;
                                Main.chest[index].item[num6].SetDefaults(8, false);
                                Main.chest[index].item[num6].stack = num27;
                                num6++;
                            }
                            if (genRand.Next(2) == 0)
                            {
                                Main.chest[index].item[num6].SetDefaults(0x48, false);
                                Main.chest[index].item[num6].stack = genRand.Next(50, 90);
                                num6++;
                            }
                            continue;
                        }
                        if (num3 < (Main.maxTilesY - 250))
                        {
                            if (contain > 0)
                            {
                                Main.chest[index].item[num6].SetDefaults(contain, false);
                                Main.chest[index].item[num6].Prefix(-1);
                                num6++;
                            }
                            else
                            {
                                int num28 = genRand.Next(7);
                                if ((num28 == 2) && (genRand.Next(2) == 0))
                                {
                                    num28 = genRand.Next(7);
                                }
                                if (num28 == 0)
                                {
                                    Main.chest[index].item[num6].SetDefaults(0x31, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                }
                                if (num28 == 1)
                                {
                                    Main.chest[index].item[num6].SetDefaults(50, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                }
                                if (num28 == 2)
                                {
                                    Main.chest[index].item[num6].SetDefaults(0x34, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                }
                                if (num28 == 3)
                                {
                                    Main.chest[index].item[num6].SetDefaults(0x35, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                }
                                if (num28 == 4)
                                {
                                    Main.chest[index].item[num6].SetDefaults(0x36, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                }
                                if (num28 == 5)
                                {
                                    Main.chest[index].item[num6].SetDefaults(0x37, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                }
                                if (num28 == 6)
                                {
                                    Main.chest[index].item[num6].SetDefaults(0x33, false);
                                    Main.chest[index].item[num6].stack = genRand.Next(0x1a) + 0x19;
                                }
                                num6++;
                            }
                            if (genRand.Next(5) == 0)
                            {
                                Main.chest[index].item[num6].SetDefaults(0x2b, false);
                                num6++;
                            }
                            if (genRand.Next(3) == 0)
                            {
                                Main.chest[index].item[num6].SetDefaults(0xa7, false);
                                num6++;
                            }
                            if (genRand.Next(2) == 0)
                            {
                                int num29 = genRand.Next(2);
                                int num30 = genRand.Next(8) + 3;
                                switch (num29)
                                {
                                    case 0:
                                        Main.chest[index].item[num6].SetDefaults(0x13, false);
                                        break;

                                    case 1:
                                        Main.chest[index].item[num6].SetDefaults(0x15, false);
                                        break;
                                }
                                Main.chest[index].item[num6].stack = num30;
                                num6++;
                            }
                            if (genRand.Next(2) == 0)
                            {
                                int num31 = genRand.Next(2);
                                int num32 = genRand.Next(0x1a) + 0x19;
                                switch (num31)
                                {
                                    case 0:
                                        Main.chest[index].item[num6].SetDefaults(0x29, false);
                                        break;

                                    case 1:
                                        Main.chest[index].item[num6].SetDefaults(0x117, false);
                                        break;
                                }
                                Main.chest[index].item[num6].stack = num32;
                                num6++;
                            }
                            if (genRand.Next(2) == 0)
                            {
                                int num33 = genRand.Next(1);
                                int num34 = genRand.Next(3) + 3;
                                if (num33 == 0)
                                {
                                    Main.chest[index].item[num6].SetDefaults(0xbc, false);
                                }
                                Main.chest[index].item[num6].stack = num34;
                                num6++;
                            }
                            if (genRand.Next(3) > 0)
                            {
                                int num35 = genRand.Next(6);
                                int num36 = genRand.Next(1, 3);
                                switch (num35)
                                {
                                    case 0:
                                        Main.chest[index].item[num6].SetDefaults(0x128, false);
                                        break;

                                    case 1:
                                        Main.chest[index].item[num6].SetDefaults(0x127, false);
                                        break;

                                    case 2:
                                        Main.chest[index].item[num6].SetDefaults(0x12b, false);
                                        break;

                                    case 3:
                                        Main.chest[index].item[num6].SetDefaults(0x12e, false);
                                        break;

                                    case 4:
                                        Main.chest[index].item[num6].SetDefaults(0x12f, false);
                                        break;

                                    case 5:
                                        Main.chest[index].item[num6].SetDefaults(0x131, false);
                                        break;
                                }
                                Main.chest[index].item[num6].stack = num36;
                                num6++;
                            }
                            if (genRand.Next(3) > 1)
                            {
                                int num37 = genRand.Next(4);
                                int num38 = genRand.Next(1, 3);
                                switch (num37)
                                {
                                    case 0:
                                        Main.chest[index].item[num6].SetDefaults(0x12d, false);
                                        break;

                                    case 1:
                                        Main.chest[index].item[num6].SetDefaults(0x12e, false);
                                        break;

                                    case 2:
                                        Main.chest[index].item[num6].SetDefaults(0x129, false);
                                        break;

                                    case 3:
                                        Main.chest[index].item[num6].SetDefaults(0x130, false);
                                        break;
                                }
                                Main.chest[index].item[num6].stack = num38;
                                num6++;
                            }
                            if (genRand.Next(2) == 0)
                            {
                                int num39 = genRand.Next(2);
                                int num40 = genRand.Next(15) + 15;
                                switch (num39)
                                {
                                    case 0:
                                        Main.chest[index].item[num6].SetDefaults(8, false);
                                        break;

                                    case 1:
                                        Main.chest[index].item[num6].SetDefaults(0x11a, false);
                                        break;
                                }
                                Main.chest[index].item[num6].stack = num40;
                                num6++;
                            }
                            if (genRand.Next(2) == 0)
                            {
                                Main.chest[index].item[num6].SetDefaults(0x49, false);
                                Main.chest[index].item[num6].stack = genRand.Next(1, 3);
                                num6++;
                            }
                            continue;
                        }
                        if (contain > 0)
                        {
                            Main.chest[index].item[num6].SetDefaults(contain, false);
                            Main.chest[index].item[num6].Prefix(-1);
                            num6++;
                        }
                        else
                        {
                            switch (genRand.Next(4))
                            {
                                case 0:
                                    Main.chest[index].item[num6].SetDefaults(0x31, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                    break;

                                case 1:
                                    Main.chest[index].item[num6].SetDefaults(50, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                    break;

                                case 2:
                                    Main.chest[index].item[num6].SetDefaults(0x35, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                    break;

                                case 3:
                                    Main.chest[index].item[num6].SetDefaults(0x36, false);
                                    Main.chest[index].item[num6].Prefix(-1);
                                    break;
                            }
                            num6++;
                        }
                        if (genRand.Next(3) == 0)
                        {
                            Main.chest[index].item[num6].SetDefaults(0xa7, false);
                            num6++;
                        }
                        if (genRand.Next(2) == 0)
                        {
                            int num42 = genRand.Next(2);
                            int num43 = genRand.Next(15) + 15;
                            switch (num42)
                            {
                                case 0:
                                    Main.chest[index].item[num6].SetDefaults(0x75, false);
                                    break;

                                case 1:
                                    Main.chest[index].item[num6].SetDefaults(0x13, false);
                                    break;
                            }
                            Main.chest[index].item[num6].stack = num43;
                            num6++;
                        }
                        if (genRand.Next(2) == 0)
                        {
                            int num44 = genRand.Next(2);
                            int num45 = genRand.Next(0x19) + 50;
                            switch (num44)
                            {
                                case 0:
                                    Main.chest[index].item[num6].SetDefaults(0x109, false);
                                    break;

                                case 1:
                                    Main.chest[index].item[num6].SetDefaults(0x116, false);
                                    break;
                            }
                            Main.chest[index].item[num6].stack = num45;
                            num6++;
                        }
                        if (genRand.Next(2) == 0)
                        {
                            int num46 = genRand.Next(2);
                            int num47 = genRand.Next(15) + 15;
                            switch (num46)
                            {
                                case 0:
                                    Main.chest[index].item[num6].SetDefaults(0xe2, false);
                                    break;

                                case 1:
                                    Main.chest[index].item[num6].SetDefaults(0xe3, false);
                                    break;
                            }
                            Main.chest[index].item[num6].stack = num47;
                            num6++;
                        }
                        if (genRand.Next(4) > 0)
                        {
                            int num48 = genRand.Next(7);
                            int num49 = genRand.Next(1, 3);
                            switch (num48)
                            {
                                case 0:
                                    Main.chest[index].item[num6].SetDefaults(0x128, false);
                                    break;

                                case 1:
                                    Main.chest[index].item[num6].SetDefaults(0x127, false);
                                    break;

                                case 2:
                                    Main.chest[index].item[num6].SetDefaults(0x125, false);
                                    break;

                                case 3:
                                    Main.chest[index].item[num6].SetDefaults(0x120, false);
                                    break;

                                case 4:
                                    Main.chest[index].item[num6].SetDefaults(0x126, false);
                                    break;

                                case 5:
                                    Main.chest[index].item[num6].SetDefaults(0x129, false);
                                    break;

                                case 6:
                                    Main.chest[index].item[num6].SetDefaults(0x130, false);
                                    break;
                            }
                            Main.chest[index].item[num6].stack = num49;
                            num6++;
                        }
                        if (genRand.Next(3) > 0)
                        {
                            int num50 = genRand.Next(5);
                            int num51 = genRand.Next(1, 3);
                            switch (num50)
                            {
                                case 0:
                                    Main.chest[index].item[num6].SetDefaults(0x131, false);
                                    break;

                                case 1:
                                    Main.chest[index].item[num6].SetDefaults(0x12d, false);
                                    break;

                                case 2:
                                    Main.chest[index].item[num6].SetDefaults(0x12e, false);
                                    break;

                                case 3:
                                    Main.chest[index].item[num6].SetDefaults(0x120, false);
                                    break;

                                case 4:
                                    Main.chest[index].item[num6].SetDefaults(300, false);
                                    break;
                            }
                            Main.chest[index].item[num6].stack = num51;
                            num6++;
                        }
                        if (genRand.Next(2) == 0)
                        {
                            int num52 = genRand.Next(2);
                            int num53 = genRand.Next(15) + 15;
                            switch (num52)
                            {
                                case 0:
                                    Main.chest[index].item[num6].SetDefaults(8, false);
                                    break;

                                case 1:
                                    Main.chest[index].item[num6].SetDefaults(0x11a, false);
                                    break;
                            }
                            Main.chest[index].item[num6].stack = num53;
                            num6++;
                        }
                        if (genRand.Next(2) == 0)
                        {
                            Main.chest[index].item[num6].SetDefaults(0x49, false);
                            Main.chest[index].item[num6].stack = genRand.Next(2, 5);
                            num6++;
                        }
                    }
                }
                return true;
            }
            return false;
        }

        public static void AddHellHouses()
        {
            int num = (int) (Main.maxTilesX * 0.25);
            for (int i = num; i < (Main.maxTilesX - num); i++)
            {
                int num3 = Main.maxTilesY - 40;
                while (Main.tile[i, num3].active || (Main.tile[i, num3].liquid > 0))
                {
                    num3--;
                }
                if (Main.tile[i, num3 + 1].active)
                {
                    byte type = (byte) genRand.Next(0x4b, 0x4d);
                    byte wall = 13;
                    if (genRand.Next(5) > 0)
                    {
                        type = 0x4b;
                    }
                    if (type == 0x4b)
                    {
                        wall = 14;
                    }
                    HellHouse(i, num3, type, wall);
                    i += genRand.Next(15, 80);
                }
            }
            float num6 = Main.maxTilesX / 0x1068;
            for (int j = 0; j < (200f * num6); j++)
            {
                int num8 = 0;
                bool flag = false;
                while (!flag)
                {
                    num8++;
                    int num9 = genRand.Next((int) (Main.maxTilesX * 0.2), (int) (Main.maxTilesX * 0.8));
                    int num10 = genRand.Next(Main.maxTilesY - 300, Main.maxTilesY - 20);
                    if (Main.tile[num9, num10].active && ((Main.tile[num9, num10].type == 0x4b) || (Main.tile[num9, num10].type == 0x4c)))
                    {
                        int num11 = 0;
                        if (Main.tile[num9 - 1, num10].wall > 0)
                        {
                            num11 = -1;
                        }
                        else if (Main.tile[num9 + 1, num10].wall > 0)
                        {
                            num11 = 1;
                        }
                        if (!Main.tile[num9 + num11, num10].active && !Main.tile[num9 + num11, num10 + 1].active)
                        {
                            bool flag2 = false;
                            for (int k = num9 - 8; k < (num9 + 8); k++)
                            {
                                for (int m = num10 - 8; m < (num10 + 8); m++)
                                {
                                    if (Main.tile[k, m].active && (Main.tile[k, m].type == 4))
                                    {
                                        flag2 = true;
                                        break;
                                    }
                                }
                            }
                            if (!flag2)
                            {
                                PlaceTile(num9 + num11, num10, 4, true, true, -1, 7);
                                flag = true;
                            }
                        }
                    }
                    if (num8 > 0x3e8)
                    {
                        flag = true;
                    }
                }
            }
        }

        public static bool AddLifeCrystal(int i, int j)
        {
            for (int k = j; k < Main.maxTilesY; k++)
            {
                if (Main.tile[i, k].active && Main.tileSolid[Main.tile[i, k].type])
                {
                    int endX = i;
                    int endY = k - 1;
                    if (Main.tile[endX, endY - 1].lava || Main.tile[endX - 1, endY - 1].lava)
                    {
                        return false;
                    }
                    if (!EmptyTileCheck(endX - 1, endX, endY - 1, endY, -1))
                    {
                        return false;
                    }
                    Main.tile[endX - 1, endY - 1].active = true;
                    Main.tile[endX - 1, endY - 1].type = 12;
                    Main.tile[endX - 1, endY - 1].frameX = 0;
                    Main.tile[endX - 1, endY - 1].frameY = 0;
                    Main.tile[endX, endY - 1].active = true;
                    Main.tile[endX, endY - 1].type = 12;
                    Main.tile[endX, endY - 1].frameX = 0x12;
                    Main.tile[endX, endY - 1].frameY = 0;
                    Main.tile[endX - 1, endY].active = true;
                    Main.tile[endX - 1, endY].type = 12;
                    Main.tile[endX - 1, endY].frameX = 0;
                    Main.tile[endX - 1, endY].frameY = 0x12;
                    Main.tile[endX, endY].active = true;
                    Main.tile[endX, endY].type = 12;
                    Main.tile[endX, endY].frameX = 0x12;
                    Main.tile[endX, endY].frameY = 0x12;
                    return true;
                }
            }
            return false;
        }

        public static void AddPlants()
        {
            for (int i = 0; i < Main.maxTilesX; i++)
            {
                for (int j = 1; j < Main.maxTilesY; j++)
                {
                    if ((Main.tile[i, j].type == 2) && Main.tile[i, j].active)
                    {
                        if (!Main.tile[i, j - 1].active)
                        {
                            PlaceTile(i, j - 1, 3, true, false, -1, 0);
                        }
                    }
                    else if (((Main.tile[i, j].type == 0x17) && Main.tile[i, j].active) && !Main.tile[i, j - 1].active)
                    {
                        PlaceTile(i, j - 1, 0x18, true, false, -1, 0);
                    }
                }
            }
        }

        public static void AddShadowOrb(int x, int y)
        {
            if (((x >= 10) && (x <= (Main.maxTilesX - 10))) && ((y >= 10) && (y <= (Main.maxTilesY - 10))))
            {
                for (int i = x - 1; i < (x + 1); i++)
                {
                    for (int j = y - 1; j < (y + 1); j++)
                    {
                        if (Main.tile[i, j].active && (Main.tile[i, j].type == 0x1f))
                        {
                            return;
                        }
                    }
                }
                Main.tile[x - 1, y - 1].active = true;
                Main.tile[x - 1, y - 1].type = 0x1f;
                Main.tile[x - 1, y - 1].frameX = 0;
                Main.tile[x - 1, y - 1].frameY = 0;
                Main.tile[x, y - 1].active = true;
                Main.tile[x, y - 1].type = 0x1f;
                Main.tile[x, y - 1].frameX = 0x12;
                Main.tile[x, y - 1].frameY = 0;
                Main.tile[x - 1, y].active = true;
                Main.tile[x - 1, y].type = 0x1f;
                Main.tile[x - 1, y].frameX = 0;
                Main.tile[x - 1, y].frameY = 0x12;
                Main.tile[x, y].active = true;
                Main.tile[x, y].type = 0x1f;
                Main.tile[x, y].frameX = 0x12;
                Main.tile[x, y].frameY = 0x12;
            }
        }

        public static void AddTrees()
        {
            for (int i = 1; i < (Main.maxTilesX - 1); i++)
            {
                for (int j = 20; j < Main.worldSurface; j++)
                {
                    GrowTree(i, j);
                }
                if (genRand.Next(3) == 0)
                {
                    i++;
                }
                if (genRand.Next(4) == 0)
                {
                    i++;
                }
            }
        }

        public static void CactusFrame(int i, int j)
        {
            try
            {
                int num = j;
                int num2 = i;
                if (!CheckCactus(i, j))
                {
                    goto Label_010C;
                }
                return;
            Label_0015:
                num++;
                if (!Main.tile[num2, num].active || (Main.tile[num2, num].type != 80))
                {
                    if (((Main.tile[num2 - 1, num].active && (Main.tile[num2 - 1, num].type == 80)) && (Main.tile[num2 - 1, num - 1].active && (Main.tile[num2 - 1, num - 1].type == 80))) && (num2 >= i))
                    {
                        num2--;
                    }
                    if (((Main.tile[num2 + 1, num].active && (Main.tile[num2 + 1, num].type == 80)) && (Main.tile[num2 + 1, num - 1].active && (Main.tile[num2 + 1, num - 1].type == 80))) && (num2 <= i))
                    {
                        num2++;
                    }
                }
            Label_010C:
                if (Main.tile[num2, num].active && (Main.tile[num2, num].type == 80))
                {
                    goto Label_0015;
                }
                num--;
                int num3 = i - num2;
                num2 = i;
                num = j;
                int type = Main.tile[i - 2, j].type;
                int num5 = Main.tile[i - 1, j].type;
                int num6 = Main.tile[i + 1, j].type;
                int num7 = Main.tile[i, j - 1].type;
                int index = Main.tile[i, j + 1].type;
                int num9 = Main.tile[i - 1, j + 1].type;
                int num10 = Main.tile[i + 1, j + 1].type;
                if (!Main.tile[i - 1, j].active)
                {
                    num5 = -1;
                }
                if (!Main.tile[i + 1, j].active)
                {
                    num6 = -1;
                }
                if (!Main.tile[i, j - 1].active)
                {
                    num7 = -1;
                }
                if (!Main.tile[i, j + 1].active)
                {
                    index = -1;
                }
                if (!Main.tile[i - 1, j + 1].active)
                {
                    num9 = -1;
                }
                if (!Main.tile[i + 1, j + 1].active)
                {
                    num10 = -1;
                }
                short frameX = Main.tile[i, j].frameX;
                short frameY = Main.tile[i, j].frameY;
                switch (num3)
                {
                    case 0:
                        if (num7 == 80)
                        {
                            if ((((num5 == 80) && (num6 == 80)) && ((num9 != 80) && (num10 != 80))) && (type != 80))
                            {
                                frameX = 90;
                                frameY = 0x24;
                            }
                            else if (((num5 == 80) && (num9 != 80)) && (type != 80))
                            {
                                frameX = 0x48;
                                frameY = 0x24;
                            }
                            else if ((num6 == 80) && (num10 != 80))
                            {
                                frameX = 0x12;
                                frameY = 0x24;
                            }
                            else if ((index >= 0) && Main.tileSolid[index])
                            {
                                frameX = 0;
                                frameY = 0x24;
                            }
                            else
                            {
                                frameX = 0;
                                frameY = 0x12;
                            }
                        }
                        else if ((((num5 == 80) && (num6 == 80)) && ((num9 != 80) && (num10 != 80))) && (type != 80))
                        {
                            frameX = 90;
                            frameY = 0;
                        }
                        else if (((num5 == 80) && (num9 != 80)) && (type != 80))
                        {
                            frameX = 0x48;
                            frameY = 0;
                        }
                        else if ((num6 == 80) && (num10 != 80))
                        {
                            frameX = 0x12;
                            frameY = 0;
                        }
                        else
                        {
                            frameX = 0;
                            frameY = 0;
                        }
                        break;

                    case -1:
                        if (num6 == 80)
                        {
                            if ((num7 != 80) && (index != 80))
                            {
                                frameX = 0x6c;
                                frameY = 0x24;
                            }
                            else if (index != 80)
                            {
                                frameX = 0x36;
                                frameY = 0x24;
                            }
                            else if (num7 != 80)
                            {
                                frameX = 0x36;
                                frameY = 0;
                            }
                            else
                            {
                                frameX = 0x36;
                                frameY = 0x12;
                            }
                        }
                        else if (num7 != 80)
                        {
                            frameX = 0x36;
                            frameY = 0;
                        }
                        else
                        {
                            frameX = 0x36;
                            frameY = 0x12;
                        }
                        break;

                    case 1:
                        if (num5 == 80)
                        {
                            if ((num7 != 80) && (index != 80))
                            {
                                frameX = 0x6c;
                                frameY = 0x10;
                            }
                            else if (index != 80)
                            {
                                frameX = 0x24;
                                frameY = 0x24;
                            }
                            else if (num7 != 80)
                            {
                                frameX = 0x24;
                                frameY = 0;
                            }
                            else
                            {
                                frameX = 0x24;
                                frameY = 0x12;
                            }
                        }
                        else if (num7 != 80)
                        {
                            frameX = 0x24;
                            frameY = 0;
                        }
                        else
                        {
                            frameX = 0x24;
                            frameY = 0x12;
                        }
                        break;
                }
                if ((frameX != Main.tile[i, j].frameX) || (frameY != Main.tile[i, j].frameY))
                {
                    Main.tile[i, j].frameX = frameX;
                    Main.tile[i, j].frameY = frameY;
                    SquareTileFrame(i, j, true);
                }
            }
            catch
            {
                Main.tile[i, j].frameX = 0;
                Main.tile[i, j].frameY = 0;
            }
        }

        public static void CaveOpenater(int i, int j)
        {
            Vector2 vector;
            Vector2 vector2;
            double num5 = genRand.Next(7, 12);
            double num6 = num5;
            int num7 = 1;
            if (genRand.Next(2) == 0)
            {
                num7 = -1;
            }
            vector.X = i;
            vector.Y = j;
            int num8 = 100;
            vector2.Y = 0f;
            vector2.X = num7;
            while (num8 > 0)
            {
                if (Main.tile[(int) vector.X, (int) vector.Y].wall == 0)
                {
                    num8 = 0;
                }
                num8--;
                int num = (int) (vector.X - (num5 * 0.5));
                int maxTilesX = (int) (vector.X + (num5 * 0.5));
                int num2 = (int) (vector.Y - (num5 * 0.5));
                int maxTilesY = (int) (vector.Y + (num5 * 0.5));
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                num6 = (num5 * genRand.Next(80, 120)) * 0.01;
                for (int k = num; k < maxTilesX; k++)
                {
                    for (int m = num2; m < maxTilesY; m++)
                    {
                        float num11 = Math.Abs((float) (k - vector.X));
                        float num12 = Math.Abs((float) (m - vector.Y));
                        if (Math.Sqrt((double) ((num11 * num11) + (num12 * num12))) < (num6 * 0.4))
                        {
                            Main.tile[k, m].active = false;
                        }
                    }
                }
                vector += vector2;
                vector2.X += genRand.Next(-10, 11) * 0.05f;
                vector2.Y += genRand.Next(-10, 11) * 0.05f;
                if (vector2.X > (num7 + 0.5f))
                {
                    vector2.X = num7 + 0.5f;
                }
                if (vector2.X < (num7 - 0.5f))
                {
                    vector2.X = num7 - 0.5f;
                }
                if (vector2.Y > 0f)
                {
                    vector2.Y = 0f;
                }
                if (vector2.Y < -0.5)
                {
                    vector2.Y = -0.5f;
                }
            }
        }

        public static void Caverer(int X, int Y)
        {
            switch (genRand.Next(2))
            {
                case 0:
                {
                    int num2 = genRand.Next(7, 9);
                    float xDir = genRand.Next(100) * 0.01f;
                    float yDir = 1f - xDir;
                    if (genRand.Next(2) == 0)
                    {
                        xDir = -xDir;
                    }
                    if (genRand.Next(2) == 0)
                    {
                        yDir = -yDir;
                    }
                    Vector2 vector = new Vector2((float) X, (float) Y);
                    for (int i = 0; i < num2; i++)
                    {
                        vector = digTunnel(vector.X, vector.Y, xDir, yDir, genRand.Next(6, 20), genRand.Next(4, 9), false);
                        xDir += genRand.Next(-20, 0x15) * 0.1f;
                        yDir += genRand.Next(-20, 0x15) * 0.1f;
                        if (xDir < -1.5)
                        {
                            xDir = -1.5f;
                        }
                        if (xDir > 1.5)
                        {
                            xDir = 1.5f;
                        }
                        if (yDir < -1.5)
                        {
                            yDir = -1.5f;
                        }
                        if (yDir > 1.5)
                        {
                            yDir = 1.5f;
                        }
                        float num6 = genRand.Next(100) * 0.01f;
                        float num7 = 1f - num6;
                        if (genRand.Next(2) == 0)
                        {
                            num6 = -num6;
                        }
                        if (genRand.Next(2) == 0)
                        {
                            num7 = -num7;
                        }
                        Vector2 vector2 = digTunnel(vector.X, vector.Y, num6, num7, genRand.Next(30, 50), genRand.Next(3, 6), false);
                        TileRunner((int) vector2.X, (int) vector2.Y, (double) genRand.Next(10, 20), genRand.Next(5, 10), -1, false, 0f, 0f, false, true);
                    }
                    return;
                }
                case 1:
                {
                    int num8 = genRand.Next(15, 30);
                    float num9 = genRand.Next(100) * 0.01f;
                    float num10 = 1f - num9;
                    if (genRand.Next(2) == 0)
                    {
                        num9 = -num9;
                    }
                    if (genRand.Next(2) == 0)
                    {
                        num10 = -num10;
                    }
                    Vector2 vector3 = new Vector2((float) X, (float) Y);
                    for (int j = 0; j < num8; j++)
                    {
                        vector3 = digTunnel(vector3.X, vector3.Y, num9, num10, genRand.Next(5, 15), genRand.Next(2, 6), true);
                        num9 += genRand.Next(-20, 0x15) * 0.1f;
                        num10 += genRand.Next(-20, 0x15) * 0.1f;
                        if (num9 < -1.5)
                        {
                            num9 = -1.5f;
                        }
                        if (num9 > 1.5)
                        {
                            num9 = 1.5f;
                        }
                        if (num10 < -1.5)
                        {
                            num10 = -1.5f;
                        }
                        if (num10 > 1.5)
                        {
                            num10 = 1.5f;
                        }
                    }
                    break;
                }
            }
        }

        public static void Cavinator(int i, int j, int steps)
        {
            Vector2 vector;
            Vector2 vector2;
            double num5 = genRand.Next(7, 15);
            double num6 = num5;
            int num7 = 1;
            if (genRand.Next(2) == 0)
            {
                num7 = -1;
            }
            vector.X = i;
            vector.Y = j;
            int num8 = genRand.Next(20, 40);
            vector2.Y = genRand.Next(10, 20) * 0.01f;
            vector2.X = num7;
            while (num8 > 0)
            {
                num8--;
                int num = (int) (vector.X - (num5 * 0.5));
                int maxTilesX = (int) (vector.X + (num5 * 0.5));
                int num2 = (int) (vector.Y - (num5 * 0.5));
                int maxTilesY = (int) (vector.Y + (num5 * 0.5));
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                num6 = (num5 * genRand.Next(80, 120)) * 0.01;
                for (int k = num; k < maxTilesX; k++)
                {
                    for (int m = num2; m < maxTilesY; m++)
                    {
                        float num11 = Math.Abs((float) (k - vector.X));
                        float num12 = Math.Abs((float) (m - vector.Y));
                        if (Math.Sqrt((double) ((num11 * num11) + (num12 * num12))) < (num6 * 0.4))
                        {
                            Main.tile[k, m].active = false;
                        }
                    }
                }
                vector += vector2;
                vector2.X += genRand.Next(-10, 11) * 0.05f;
                vector2.Y += genRand.Next(-10, 11) * 0.05f;
                if (vector2.X > (num7 + 0.5f))
                {
                    vector2.X = num7 + 0.5f;
                }
                if (vector2.X < (num7 - 0.5f))
                {
                    vector2.X = num7 - 0.5f;
                }
                if (vector2.Y > 2f)
                {
                    vector2.Y = 2f;
                }
                if (vector2.Y < 0f)
                {
                    vector2.Y = 0f;
                }
            }
            if ((steps > 0) && (((int) vector.Y) < (Main.rockLayer + 50.0)))
            {
                Cavinator((int) vector.X, (int) vector.Y, steps - 1);
            }
        }

        public static void ChasmRunner(int i, int j, int steps, bool makeOrb = false)
        {
            Vector2 vector;
            Vector2 vector2;
            bool flag = false;
            bool flag2 = false;
            bool flag3 = false;
            if (!makeOrb)
            {
                flag2 = true;
            }
            float num5 = steps;
            vector.X = i;
            vector.Y = j;
            vector2.X = genRand.Next(-10, 11) * 0.1f;
            vector2.Y = (genRand.Next(11) * 0.2f) + 0.5f;
            int num6 = 5;
            double num7 = genRand.Next(5) + 7;
            while (num7 > 0.0)
            {
                int num;
                int num2;
                int num3;
                int maxTilesY;
                if (num5 > 0f)
                {
                    num7 += genRand.Next(3);
                    num7 -= genRand.Next(3);
                    if (num7 < 7.0)
                    {
                        num7 = 7.0;
                    }
                    if (num7 > 20.0)
                    {
                        num7 = 20.0;
                    }
                    if ((num5 == 1f) && (num7 < 10.0))
                    {
                        num7 = 10.0;
                    }
                }
                else if (vector.Y > (Main.worldSurface + 45.0))
                {
                    num7 -= genRand.Next(4);
                }
                if ((vector.Y > Main.rockLayer) && (num5 > 0f))
                {
                    num5 = 0f;
                }
                num5--;
                if (!flag && (vector.Y > (Main.worldSurface + 20.0)))
                {
                    flag = true;
                    ChasmRunnerSideways((int) vector.X, (int) vector.Y, -1, genRand.Next(20, 40));
                    ChasmRunnerSideways((int) vector.X, (int) vector.Y, 1, genRand.Next(20, 40));
                }
                if (num5 > num6)
                {
                    num = (int) (vector.X - (num7 * 0.5));
                    num3 = (int) (vector.X + (num7 * 0.5));
                    num2 = (int) (vector.Y - (num7 * 0.5));
                    maxTilesY = (int) (vector.Y + (num7 * 0.5));
                    if (num < 0)
                    {
                        num = 0;
                    }
                    if (num3 > (Main.maxTilesX - 1))
                    {
                        num3 = Main.maxTilesX - 1;
                    }
                    if (num2 < 0)
                    {
                        num2 = 0;
                    }
                    if (maxTilesY > Main.maxTilesY)
                    {
                        maxTilesY = Main.maxTilesY;
                    }
                    for (int n = num; n < num3; n++)
                    {
                        for (int num9 = num2; num9 < maxTilesY; num9++)
                        {
                            if ((((Math.Abs((float) (n - vector.X)) + Math.Abs((float) (num9 - vector.Y))) < ((num7 * 0.5) * (1.0 + (genRand.Next(-10, 11) * 0.015)))) && (Main.tile[n, num9].type != 0x1f)) && (Main.tile[n, num9].type != 0x16))
                            {
                                Main.tile[n, num9].active = false;
                            }
                        }
                    }
                }
                if ((num5 <= 2f) && (vector.Y < (Main.worldSurface + 45.0)))
                {
                    num5 = 2f;
                }
                if (num5 <= 0f)
                {
                    if (!flag2)
                    {
                        flag2 = true;
                        AddShadowOrb((int) vector.X, (int) vector.Y);
                    }
                    else if (!flag3)
                    {
                        flag3 = false;
                        bool flag4 = false;
                        int num10 = 0;
                        while (!flag4)
                        {
                            int x = genRand.Next(((int) vector.X) - 0x19, ((int) vector.X) + 0x19);
                            int y = genRand.Next(((int) vector.Y) - 50, (int) vector.Y);
                            if (x < 5)
                            {
                                x = 5;
                            }
                            if (x > (Main.maxTilesX - 5))
                            {
                                x = Main.maxTilesX - 5;
                            }
                            if (y < 5)
                            {
                                y = 5;
                            }
                            if (y > (Main.maxTilesY - 5))
                            {
                                y = Main.maxTilesY - 5;
                            }
                            if (y > Main.worldSurface)
                            {
                                Place3x2(x, y, 0x1a);
                                if (Main.tile[x, y].type == 0x1a)
                                {
                                    flag4 = true;
                                }
                                else
                                {
                                    num10++;
                                    if (num10 >= 0x2710)
                                    {
                                        flag4 = true;
                                    }
                                }
                            }
                            else
                            {
                                flag4 = true;
                            }
                        }
                    }
                }
                vector += vector2;
                vector2.X += genRand.Next(-10, 11) * 0.01f;
                if (vector2.X > 0.3)
                {
                    vector2.X = 0.3f;
                }
                if (vector2.X < -0.3)
                {
                    vector2.X = -0.3f;
                }
                num = (int) (vector.X - (num7 * 1.1));
                num3 = (int) (vector.X + (num7 * 1.1));
                num2 = (int) (vector.Y - (num7 * 1.1));
                maxTilesY = (int) (vector.Y + (num7 * 1.1));
                if (num < 1)
                {
                    num = 1;
                }
                if (num3 > (Main.maxTilesX - 1))
                {
                    num3 = Main.maxTilesX - 1;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                for (int k = num; k < num3; k++)
                {
                    for (int num14 = num2; num14 < maxTilesY; num14++)
                    {
                        if ((Math.Abs((float) (k - vector.X)) + Math.Abs((float) (num14 - vector.Y))) < ((num7 * 1.1) * (1.0 + (genRand.Next(-10, 11) * 0.015))))
                        {
                            if ((Main.tile[k, num14].type != 0x19) && (num14 > (j + genRand.Next(3, 20))))
                            {
                                Main.tile[k, num14].active = true;
                            }
                            if (steps <= num6)
                            {
                                Main.tile[k, num14].active = true;
                            }
                            if (Main.tile[k, num14].type != 0x1f)
                            {
                                Main.tile[k, num14].type = 0x19;
                            }
                            if (Main.tile[k, num14].wall == 2)
                            {
                                Main.tile[k, num14].wall = 0;
                            }
                        }
                    }
                }
                for (int m = num; m < num3; m++)
                {
                    for (int num16 = num2; num16 < maxTilesY; num16++)
                    {
                        if ((Math.Abs((float) (m - vector.X)) + Math.Abs((float) (num16 - vector.Y))) < ((num7 * 1.1) * (1.0 + (genRand.Next(-10, 11) * 0.015))))
                        {
                            if (Main.tile[m, num16].type != 0x1f)
                            {
                                Main.tile[m, num16].type = 0x19;
                            }
                            if (steps <= num6)
                            {
                                Main.tile[m, num16].active = true;
                            }
                            if (num16 > (j + genRand.Next(3, 20)))
                            {
                                PlaceWall(m, num16, 3, true);
                            }
                        }
                    }
                }
            }
        }

        public static void ChasmRunnerSideways(int i, int j, int direction, int steps)
        {
            Vector2 vector;
            Vector2 vector2;
            float num5 = steps;
            vector.X = i;
            vector.Y = j;
            vector2.X = (genRand.Next(10, 0x15) * 0.1f) * direction;
            vector2.Y = genRand.Next(-10, 10) * 0.01f;
            double num6 = genRand.Next(5) + 7;
            while (num6 > 0.0)
            {
                if (num5 > 0f)
                {
                    num6 += genRand.Next(3);
                    num6 -= genRand.Next(3);
                    if (num6 < 7.0)
                    {
                        num6 = 7.0;
                    }
                    if (num6 > 20.0)
                    {
                        num6 = 20.0;
                    }
                    if ((num5 == 1f) && (num6 < 10.0))
                    {
                        num6 = 10.0;
                    }
                }
                else
                {
                    num6 -= genRand.Next(4);
                }
                if ((vector.Y > Main.rockLayer) && (num5 > 0f))
                {
                    num5 = 0f;
                }
                num5--;
                int num = (int) (vector.X - (num6 * 0.5));
                int num3 = (int) (vector.X + (num6 * 0.5));
                int num2 = (int) (vector.Y - (num6 * 0.5));
                int maxTilesY = (int) (vector.Y + (num6 * 0.5));
                if (num < 0)
                {
                    num = 0;
                }
                if (num3 > (Main.maxTilesX - 1))
                {
                    num3 = Main.maxTilesX - 1;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                for (int k = num; k < num3; k++)
                {
                    for (int num8 = num2; num8 < maxTilesY; num8++)
                    {
                        if ((((Math.Abs((float) (k - vector.X)) + Math.Abs((float) (num8 - vector.Y))) < ((num6 * 0.5) * (1.0 + (genRand.Next(-10, 11) * 0.015)))) && (Main.tile[k, num8].type != 0x1f)) && (Main.tile[k, num8].type != 0x16))
                        {
                            Main.tile[k, num8].active = false;
                        }
                    }
                }
                vector += vector2;
                vector2.Y += genRand.Next(-10, 10) * 0.1f;
                if (vector.Y < (j - 20))
                {
                    vector2.Y += genRand.Next(20) * 0.01f;
                }
                if (vector.Y > (j + 20))
                {
                    vector2.Y -= genRand.Next(20) * 0.01f;
                }
                if (vector2.Y < -0.5)
                {
                    vector2.Y = -0.5f;
                }
                if (vector2.Y > 0.5)
                {
                    vector2.Y = 0.5f;
                }
                vector2.X += genRand.Next(-10, 11) * 0.01f;
                if (direction == -1)
                {
                    if (vector2.X > -0.5)
                    {
                        vector2.X = -0.5f;
                    }
                    if (vector2.X < -2f)
                    {
                        vector2.X = -2f;
                    }
                }
                else if (direction == 1)
                {
                    if (vector2.X < 0.5)
                    {
                        vector2.X = 0.5f;
                    }
                    if (vector2.X > 2f)
                    {
                        vector2.X = 2f;
                    }
                }
                num = (int) (vector.X - (num6 * 1.1));
                num3 = (int) (vector.X + (num6 * 1.1));
                num2 = (int) (vector.Y - (num6 * 1.1));
                maxTilesY = (int) (vector.Y + (num6 * 1.1));
                if (num < 1)
                {
                    num = 1;
                }
                if (num3 > (Main.maxTilesX - 1))
                {
                    num3 = Main.maxTilesX - 1;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                for (int m = num; m < num3; m++)
                {
                    for (int num10 = num2; num10 < maxTilesY; num10++)
                    {
                        if (((Math.Abs((float) (m - vector.X)) + Math.Abs((float) (num10 - vector.Y))) < ((num6 * 1.1) * (1.0 + (genRand.Next(-10, 11) * 0.015)))) && (Main.tile[m, num10].wall != 3))
                        {
                            if ((Main.tile[m, num10].type != 0x19) && (num10 > (j + genRand.Next(3, 20))))
                            {
                                Main.tile[m, num10].active = true;
                            }
                            Main.tile[m, num10].active = true;
                            if ((Main.tile[m, num10].type != 0x1f) && (Main.tile[m, num10].type != 0x16))
                            {
                                Main.tile[m, num10].type = 0x19;
                            }
                            if (Main.tile[m, num10].wall == 2)
                            {
                                Main.tile[m, num10].wall = 0;
                            }
                        }
                    }
                }
                for (int n = num; n < num3; n++)
                {
                    for (int num12 = num2; num12 < maxTilesY; num12++)
                    {
                        if (((Math.Abs((float) (n - vector.X)) + Math.Abs((float) (num12 - vector.Y))) < ((num6 * 1.1) * (1.0 + (genRand.Next(-10, 11) * 0.015)))) && (Main.tile[n, num12].wall != 3))
                        {
                            if ((Main.tile[n, num12].type != 0x1f) && (Main.tile[n, num12].type != 0x16))
                            {
                                Main.tile[n, num12].type = 0x19;
                            }
                            Main.tile[n, num12].active = true;
                            PlaceWall(n, num12, 3, true);
                        }
                    }
                }
            }
            if (genRand.Next(3) == 0)
            {
                int x = (int) vector.X;
                int y = (int) vector.Y;
                while (!Main.tile[x, y].active)
                {
                    y++;
                }
                TileRunner(x, y, (double) genRand.Next(2, 6), genRand.Next(3, 7), 0x16, false, 0f, 0f, false, true);
            }
        }

        public static void Check1x1(int x, int y, int type)
        {
            if ((Main.tile[x, y + 1] != null) && (!Main.tile[x, y + 1].active || !Main.tileSolid[Main.tile[x, y + 1].type]))
            {
                KillTile(x, y, false, false, false);
            }
        }

        public static void Check1x2(int x, int j, byte type)
        {
            if (!destroyObject)
            {
                int num = j;
                bool flag = true;
                if (Main.tile[x, num] == null)
                {
                    Main.tile[x, num] = new Tile();
                }
                if (Main.tile[x, num + 1] == null)
                {
                    Main.tile[x, num + 1] = new Tile();
                }
                int frameY = Main.tile[x, num].frameY;
                int num3 = 0;
                while (frameY >= 40)
                {
                    frameY -= 40;
                    num3++;
                }
                if (frameY == 0x12)
                {
                    num--;
                }
                if (Main.tile[x, num] == null)
                {
                    Main.tile[x, num] = new Tile();
                }
                if (((Main.tile[x, num].frameY == (40 * num3)) && (Main.tile[x, num + 1].frameY == ((40 * num3) + 0x12))) && ((Main.tile[x, num].type == type) && (Main.tile[x, num + 1].type == type)))
                {
                    flag = false;
                }
                if (Main.tile[x, num + 2] == null)
                {
                    Main.tile[x, num + 2] = new Tile();
                }
                if (!Main.tile[x, num + 2].active || !Main.tileSolid[Main.tile[x, num + 2].type])
                {
                    flag = true;
                }
                if (((Main.tile[x, num + 2].type != 2) && (Main.tile[x, num + 2].type != 0x6d)) && (Main.tile[x, num].type == 20))
                {
                    flag = true;
                }
                if (flag)
                {
                    destroyObject = true;
                    if (Main.tile[x, num].type == type)
                    {
                        KillTile(x, num, false, false, false);
                    }
                    if (Main.tile[x, num + 1].type == type)
                    {
                        KillTile(x, num + 1, false, false, false);
                    }
                    if (type == 15)
                    {
                        if (num3 == 1)
                        {
                            Item.NewItem(x * 0x10, num * 0x10, 0x20, 0x20, 0x166, 1, false, 0);
                        }
                        else
                        {
                            Item.NewItem(x * 0x10, num * 0x10, 0x20, 0x20, 0x22, 1, false, 0);
                        }
                    }
                    else if (type == 0x86)
                    {
                        Item.NewItem(x * 0x10, num * 0x10, 0x20, 0x20, 0x20d, 1, false, 0);
                    }
                    destroyObject = false;
                }
            }
        }

        public static void Check1x2Top(int x, int j, byte type)
        {
            if (!destroyObject)
            {
                int num = j;
                bool flag = true;
                if (Main.tile[x, num] == null)
                {
                    Main.tile[x, num] = new Tile();
                }
                if (Main.tile[x, num + 1] == null)
                {
                    Main.tile[x, num + 1] = new Tile();
                }
                if (Main.tile[x, num].frameY == 0x12)
                {
                    num--;
                }
                if (Main.tile[x, num] == null)
                {
                    Main.tile[x, num] = new Tile();
                }
                if (((Main.tile[x, num].frameY == 0) && (Main.tile[x, num + 1].frameY == 0x12)) && ((Main.tile[x, num].type == type) && (Main.tile[x, num + 1].type == type)))
                {
                    flag = false;
                }
                if (Main.tile[x, num - 1] == null)
                {
                    Main.tile[x, num - 1] = new Tile();
                }
                if ((!Main.tile[x, num - 1].active || !Main.tileSolid[Main.tile[x, num - 1].type]) || Main.tileSolidTop[Main.tile[x, num - 1].type])
                {
                    flag = true;
                }
                if (flag)
                {
                    destroyObject = true;
                    if (Main.tile[x, num].type == type)
                    {
                        KillTile(x, num, false, false, false);
                    }
                    if (Main.tile[x, num + 1].type == type)
                    {
                        KillTile(x, num + 1, false, false, false);
                    }
                    if (type == 0x2a)
                    {
                        Item.NewItem(x * 0x10, num * 0x10, 0x20, 0x20, 0x88, 1, false, 0);
                    }
                    destroyObject = false;
                }
            }
        }

        public static void Check1xX(int x, int j, byte type)
        {
            if (!destroyObject)
            {
                int num = j - (Main.tile[x, j].frameY / 0x12);
                int frameX = Main.tile[x, j].frameX;
                int num3 = 3;
                if (type == 0x5c)
                {
                    num3 = 6;
                }
                bool flag = false;
                for (int i = 0; i < num3; i++)
                {
                    if (Main.tile[x, num + i] == null)
                    {
                        Main.tile[x, num + i] = new Tile();
                    }
                    if (!Main.tile[x, num + i].active)
                    {
                        flag = true;
                    }
                    else if (Main.tile[x, num + i].type != type)
                    {
                        flag = true;
                    }
                    else if (Main.tile[x, num + i].frameY != (i * 0x12))
                    {
                        flag = true;
                    }
                    else if (Main.tile[x, num + i].frameX != frameX)
                    {
                        flag = true;
                    }
                }
                if (Main.tile[x, num + num3] == null)
                {
                    Main.tile[x, num + num3] = new Tile();
                }
                if (!Main.tile[x, num + num3].active)
                {
                    flag = true;
                }
                if (!Main.tileSolid[Main.tile[x, num + num3].type])
                {
                    flag = true;
                }
                if (flag)
                {
                    destroyObject = true;
                    for (int k = 0; k < num3; k++)
                    {
                        if (Main.tile[x, num + k].type == type)
                        {
                            KillTile(x, num + k, false, false, false);
                        }
                    }
                    if (type == 0x5c)
                    {
                        Item.NewItem(x * 0x10, j * 0x10, 0x20, 0x20, 0x155, 1, false, 0);
                    }
                    if (type == 0x5d)
                    {
                        Item.NewItem(x * 0x10, j * 0x10, 0x20, 0x20, 0x156, 1, false, 0);
                    }
                    destroyObject = false;
                }
            }
        }

        public static void Check2x1(int i, int y, byte type)
        {
            if (!destroyObject)
            {
                int num = i;
                bool flag = true;
                if (Main.tile[num, y] == null)
                {
                    Main.tile[num, y] = new Tile();
                }
                if (Main.tile[num + 1, y] == null)
                {
                    Main.tile[num + 1, y] = new Tile();
                }
                if (Main.tile[num, y + 1] == null)
                {
                    Main.tile[num, y + 1] = new Tile();
                }
                if (Main.tile[num + 1, y + 1] == null)
                {
                    Main.tile[num + 1, y + 1] = new Tile();
                }
                if (Main.tile[num, y].frameX == 0x12)
                {
                    num--;
                }
                if (((Main.tile[num, y].frameX == 0) && (Main.tile[num + 1, y].frameX == 0x12)) && ((Main.tile[num, y].type == type) && (Main.tile[num + 1, y].type == type)))
                {
                    flag = false;
                }
                if ((type == 0x1d) || (type == 0x67))
                {
                    if (!Main.tile[num, y + 1].active || !Main.tileTable[Main.tile[num, y + 1].type])
                    {
                        flag = true;
                    }
                    if (!Main.tile[num + 1, y + 1].active || !Main.tileTable[Main.tile[num + 1, y + 1].type])
                    {
                        flag = true;
                    }
                }
                else
                {
                    if (!Main.tile[num, y + 1].active || !Main.tileSolid[Main.tile[num, y + 1].type])
                    {
                        flag = true;
                    }
                    if (!Main.tile[num + 1, y + 1].active || !Main.tileSolid[Main.tile[num + 1, y + 1].type])
                    {
                        flag = true;
                    }
                }
                if (flag)
                {
                    destroyObject = true;
                    if (Main.tile[num, y].type == type)
                    {
                        KillTile(num, y, false, false, false);
                    }
                    if (Main.tile[num + 1, y].type == type)
                    {
                        KillTile(num + 1, y, false, false, false);
                    }
                    if (type == 0x10)
                    {
                        Item.NewItem(num * 0x10, y * 0x10, 0x20, 0x20, 0x23, 1, false, 0);
                    }
                    if (type == 0x12)
                    {
                        Item.NewItem(num * 0x10, y * 0x10, 0x20, 0x20, 0x24, 1, false, 0);
                    }
                    if (type == 0x1d)
                    {
                        Item.NewItem(num * 0x10, y * 0x10, 0x20, 0x20, 0x57, 1, false, 0);
                        Main.PlaySound(13, i * 0x10, y * 0x10, 1);
                    }
                    if (type == 0x67)
                    {
                        Item.NewItem(num * 0x10, y * 0x10, 0x20, 0x20, 0x164, 1, false, 0);
                        Main.PlaySound(13, i * 0x10, y * 0x10, 1);
                    }
                    if (type == 0x86)
                    {
                        Item.NewItem(num * 0x10, y * 0x10, 0x20, 0x20, 0x20d, 1, false, 0);
                    }
                    destroyObject = false;
                    SquareTileFrame(num, y, true);
                    SquareTileFrame(num + 1, y, true);
                }
            }
        }

        public static void Check2x2(int i, int j, int type)
        {
            if (!destroyObject)
            {
                bool flag = false;
                int num = i;
                int num2 = j;
                int num3 = 0;
                num = (Main.tile[i, j].frameX / 0x12) * -1;
                num2 = (Main.tile[i, j].frameY / 0x12) * -1;
                if (num < -1)
                {
                    num += 2;
                    num3 = 0x24;
                }
                num += i;
                num2 += j;
                for (int k = num; k < (num + 2); k++)
                {
                    for (int m = num2; m < (num2 + 2); m++)
                    {
                        if (Main.tile[k, m] == null)
                        {
                            Main.tile[k, m] = new Tile();
                        }
                        if ((!Main.tile[k, m].active || (Main.tile[k, m].type != type)) || ((Main.tile[k, m].frameX != (((k - num) * 0x12) + num3)) || (Main.tile[k, m].frameY != ((m - num2) * 0x12))))
                        {
                            flag = true;
                        }
                    }
                    if ((type == 0x5f) || (type == 0x7e))
                    {
                        if (Main.tile[k, num2 - 1] == null)
                        {
                            Main.tile[k, num2 - 1] = new Tile();
                        }
                        if ((!Main.tile[k, num2 - 1].active || !Main.tileSolid[Main.tile[k, num2 - 1].type]) || Main.tileSolidTop[Main.tile[k, num2 - 1].type])
                        {
                            flag = true;
                        }
                    }
                    else if (type != 0x8a)
                    {
                        if (Main.tile[k, num2 + 2] == null)
                        {
                            Main.tile[k, num2 + 2] = new Tile();
                        }
                        if (!Main.tile[k, num2 + 2].active || (!Main.tileSolid[Main.tile[k, num2 + 2].type] && !Main.tileTable[Main.tile[k, num2 + 2].type]))
                        {
                            flag = true;
                        }
                    }
                }
                if (((type == 0x8a) && !SolidTile(num, num2 + 2)) && !SolidTile(num + 1, num2 + 2))
                {
                    flag = true;
                }
                if (flag)
                {
                    destroyObject = true;
                    for (int n = num; n < (num + 2); n++)
                    {
                        for (int num7 = num2; num7 < (num2 + 2); num7++)
                        {
                            if ((Main.tile[n, num7].type == type) && Main.tile[n, num7].active)
                            {
                                KillTile(n, num7, false, false, false);
                            }
                        }
                    }
                    if (type == 0x55)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x141, 1, false, 0);
                    }
                    if (type == 0x5e)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x160, 1, false, 0);
                    }
                    if (type == 0x5f)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x158, 1, false, 0);
                    }
                    if (type == 0x60)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x159, 1, false, 0);
                    }
                    if (type == 0x61)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x15a, 1, false, 0);
                    }
                    if (type == 0x62)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x15b, 1, false, 0);
                    }
                    if (type == 0x63)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x15c, 1, false, 0);
                    }
                    if (type == 100)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x15d, 1, false, 0);
                    }
                    if (type == 0x7d)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x1e7, 1, false, 0);
                    }
                    if (type == 0x7e)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x1e8, 1, false, 0);
                    }
                    if (type == 0x84)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x201, 1, false, 0);
                    }
                    if (type == 0x8e)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x245, 1, false, 0);
                    }
                    if (type == 0x8f)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x246, 1, false, 0);
                    }
                    if (((type == 0x8a) && !gen) && (Main.netMode != 1))
                    {
                        Projectile.NewProjectile((num * 0x10) + 15.5f, (float) ((num2 * 0x10) + 0x10), 0f, 0f, 0x63, 70, 10f, Main.myPlayer);
                    }
                    destroyObject = false;
                    for (int num8 = num - 1; num8 < (num + 3); num8++)
                    {
                        for (int num9 = num2 - 1; num9 < (num2 + 3); num9++)
                        {
                            TileFrame(num8, num9, false, false);
                        }
                    }
                }
            }
        }

        public static void Check2xX(int i, int j, byte type)
        {
            if (!destroyObject)
            {
                int num = i;
                int frameX = Main.tile[i, j].frameX;
                while (frameX >= 0x24)
                {
                    frameX -= 0x24;
                }
                if (frameX == 0x12)
                {
                    num--;
                }
                if (Main.tile[num, j] == null)
                {
                    Main.tile[num, j] = new Tile();
                }
                int num3 = j - (Main.tile[num, j].frameY / 0x12);
                if (Main.tile[num, num3] == null)
                {
                    Main.tile[num, num3] = new Tile();
                }
                int num4 = Main.tile[num, num3].frameX;
                int num5 = 3;
                if (type == 0x68)
                {
                    num5 = 5;
                }
                bool flag = false;
                for (int k = 0; k < num5; k++)
                {
                    if (Main.tile[num, num3 + k] == null)
                    {
                        Main.tile[num, num3 + k] = new Tile();
                    }
                    if (!Main.tile[num, num3 + k].active)
                    {
                        flag = true;
                    }
                    else if (Main.tile[num, num3 + k].type != type)
                    {
                        flag = true;
                    }
                    else if (Main.tile[num, num3 + k].frameY != (k * 0x12))
                    {
                        flag = true;
                    }
                    else if (Main.tile[num, num3 + k].frameX != num4)
                    {
                        flag = true;
                    }
                    if (Main.tile[num + 1, num3 + k] == null)
                    {
                        Main.tile[num + 1, num3 + k] = new Tile();
                    }
                    if (!Main.tile[num + 1, num3 + k].active)
                    {
                        flag = true;
                    }
                    else if (Main.tile[num + 1, num3 + k].type != type)
                    {
                        flag = true;
                    }
                    else if (Main.tile[num + 1, num3 + k].frameY != (k * 0x12))
                    {
                        flag = true;
                    }
                    else if (Main.tile[num + 1, num3 + k].frameX != (num4 + 0x12))
                    {
                        flag = true;
                    }
                }
                if (Main.tile[num, num3 + num5] == null)
                {
                    Main.tile[num, num3 + num5] = new Tile();
                }
                if (!Main.tile[num, num3 + num5].active)
                {
                    flag = true;
                }
                if (!Main.tileSolid[Main.tile[num, num3 + num5].type])
                {
                    flag = true;
                }
                if (Main.tile[num + 1, num3 + num5] == null)
                {
                    Main.tile[num + 1, num3 + num5] = new Tile();
                }
                if (!Main.tile[num + 1, num3 + num5].active)
                {
                    flag = true;
                }
                if (!Main.tileSolid[Main.tile[num + 1, num3 + num5].type])
                {
                    flag = true;
                }
                if (flag)
                {
                    destroyObject = true;
                    for (int m = 0; m < num5; m++)
                    {
                        if (Main.tile[num, num3 + m].type == type)
                        {
                            KillTile(num, num3 + m, false, false, false);
                        }
                        if (Main.tile[num + 1, num3 + m].type == type)
                        {
                            KillTile(num + 1, num3 + m, false, false, false);
                        }
                    }
                    if (type == 0x68)
                    {
                        Item.NewItem(num * 0x10, j * 0x10, 0x20, 0x20, 0x167, 1, false, 0);
                    }
                    if (type == 0x69)
                    {
                        int num8 = num4 / 0x24;
                        switch (num8)
                        {
                            case 0:
                                num8 = 360;
                                break;

                            case 1:
                                num8 = 0x34;
                                break;

                            default:
                                num8 = (0x1b6 + num8) - 2;
                                break;
                        }
                        Item.NewItem(num * 0x10, j * 0x10, 0x20, 0x20, num8, 1, false, 0);
                    }
                    destroyObject = false;
                }
            }
        }

        public static void Check3x2(int i, int j, int type)
        {
            if (!destroyObject)
            {
                bool flag = false;
                int num = i;
                int num2 = j;
                num += (Main.tile[i, j].frameX / 0x12) * -1;
                num2 += (Main.tile[i, j].frameY / 0x12) * -1;
                for (int k = num; k < (num + 3); k++)
                {
                    for (int m = num2; m < (num2 + 2); m++)
                    {
                        if (Main.tile[k, m] == null)
                        {
                            Main.tile[k, m] = new Tile();
                        }
                        if ((!Main.tile[k, m].active || (Main.tile[k, m].type != type)) || ((Main.tile[k, m].frameX != ((k - num) * 0x12)) || (Main.tile[k, m].frameY != ((m - num2) * 0x12))))
                        {
                            flag = true;
                        }
                    }
                    if (Main.tile[k, num2 + 2] == null)
                    {
                        Main.tile[k, num2 + 2] = new Tile();
                    }
                    if (!Main.tile[k, num2 + 2].active || !Main.tileSolid[Main.tile[k, num2 + 2].type])
                    {
                        flag = true;
                    }
                }
                if (flag)
                {
                    destroyObject = true;
                    for (int n = num; n < (num + 3); n++)
                    {
                        for (int num6 = num2; num6 < (num2 + 3); num6++)
                        {
                            if ((Main.tile[n, num6].type == type) && Main.tile[n, num6].active)
                            {
                                KillTile(n, num6, false, false, false);
                            }
                        }
                    }
                    if (type == 14)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x20, 1, false, 0);
                    }
                    else if (type == 0x72)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x18e, 1, false, 0);
                    }
                    else if (type == 0x1a)
                    {
                        if (!noTileActions)
                        {
                            SmashAltar(i, j);
                        }
                    }
                    else if (type == 0x11)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x21, 1, false, 0);
                    }
                    else if (type == 0x4d)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0xdd, 1, false, 0);
                    }
                    else if (type == 0x56)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x14c, 1, false, 0);
                    }
                    else if (type == 0x57)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x14d, 1, false, 0);
                    }
                    else if (type == 0x58)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x14e, 1, false, 0);
                    }
                    else if (type == 0x59)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x14f, 1, false, 0);
                    }
                    else if (type == 0x85)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x20c, 1, false, 0);
                    }
                    destroyObject = false;
                    for (int num7 = num - 1; num7 < (num + 4); num7++)
                    {
                        for (int num8 = num2 - 1; num8 < (num2 + 4); num8++)
                        {
                            TileFrame(num7, num8, false, false);
                        }
                    }
                }
            }
        }

        public static void Check3x3(int i, int j, int type)
        {
            if (!destroyObject)
            {
                bool flag = false;
                int num = i;
                int num2 = j;
                num = Main.tile[i, j].frameX / 0x12;
                int num3 = i - num;
                if (num >= 3)
                {
                    num -= 3;
                }
                num = i - num;
                num2 += (Main.tile[i, j].frameY / 0x12) * -1;
                for (int k = num; k < (num + 3); k++)
                {
                    for (int m = num2; m < (num2 + 3); m++)
                    {
                        if (Main.tile[k, m] == null)
                        {
                            Main.tile[k, m] = new Tile();
                        }
                        if ((!Main.tile[k, m].active || (Main.tile[k, m].type != type)) || ((Main.tile[k, m].frameX != ((k - num3) * 0x12)) || (Main.tile[k, m].frameY != ((m - num2) * 0x12))))
                        {
                            flag = true;
                        }
                    }
                }
                if (type == 0x6a)
                {
                    for (int n = num; n < (num + 3); n++)
                    {
                        if (Main.tile[n, num2 + 3] == null)
                        {
                            Main.tile[n, num2 + 3] = new Tile();
                        }
                        if (!Main.tile[n, num2 + 3].active || !Main.tileSolid[Main.tile[n, num2 + 3].type])
                        {
                            flag = true;
                            break;
                        }
                    }
                }
                else
                {
                    if (Main.tile[num + 1, num2 - 1] == null)
                    {
                        Main.tile[num + 1, num2 - 1] = new Tile();
                    }
                    if ((!Main.tile[num + 1, num2 - 1].active || !Main.tileSolid[Main.tile[num + 1, num2 - 1].type]) || Main.tileSolidTop[Main.tile[num + 1, num2 - 1].type])
                    {
                        flag = true;
                    }
                }
                if (flag)
                {
                    destroyObject = true;
                    for (int num7 = num; num7 < (num + 3); num7++)
                    {
                        for (int num8 = num2; num8 < (num2 + 3); num8++)
                        {
                            if ((Main.tile[num7, num8].type == type) && Main.tile[num7, num8].active)
                            {
                                KillTile(num7, num8, false, false, false);
                            }
                        }
                    }
                    if (type == 0x22)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x6a, 1, false, 0);
                    }
                    else if (type == 0x23)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x6b, 1, false, 0);
                    }
                    else if (type == 0x24)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x6c, 1, false, 0);
                    }
                    else if (type == 0x6a)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x16b, 1, false, 0);
                    }
                    destroyObject = false;
                    for (int num9 = num - 1; num9 < (num + 4); num9++)
                    {
                        for (int num10 = num2 - 1; num10 < (num2 + 4); num10++)
                        {
                            TileFrame(num9, num10, false, false);
                        }
                    }
                }
            }
        }

        public static void Check3x4(int i, int j, int type)
        {
            if (!destroyObject)
            {
                bool flag = false;
                int num = i;
                int num2 = j;
                num += (Main.tile[i, j].frameX / 0x12) * -1;
                num2 += (Main.tile[i, j].frameY / 0x12) * -1;
                for (int k = num; k < (num + 3); k++)
                {
                    for (int m = num2; m < (num2 + 4); m++)
                    {
                        if (Main.tile[k, m] == null)
                        {
                            Main.tile[k, m] = new Tile();
                        }
                        if ((!Main.tile[k, m].active || (Main.tile[k, m].type != type)) || ((Main.tile[k, m].frameX != ((k - num) * 0x12)) || (Main.tile[k, m].frameY != ((m - num2) * 0x12))))
                        {
                            flag = true;
                        }
                    }
                    if (Main.tile[k, num2 + 4] == null)
                    {
                        Main.tile[k, num2 + 4] = new Tile();
                    }
                    if (!Main.tile[k, num2 + 4].active || !Main.tileSolid[Main.tile[k, num2 + 4].type])
                    {
                        flag = true;
                    }
                }
                if (flag)
                {
                    destroyObject = true;
                    for (int n = num; n < (num + 3); n++)
                    {
                        for (int num6 = num2; num6 < (num2 + 4); num6++)
                        {
                            if ((Main.tile[n, num6].type == type) && Main.tile[n, num6].active)
                            {
                                KillTile(n, num6, false, false, false);
                            }
                        }
                    }
                    if (type == 0x65)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x162, 1, false, 0);
                    }
                    else if (type == 0x66)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x163, 1, false, 0);
                    }
                    destroyObject = false;
                    for (int num7 = num - 1; num7 < (num + 4); num7++)
                    {
                        for (int num8 = num2 - 1; num8 < (num2 + 4); num8++)
                        {
                            TileFrame(num7, num8, false, false);
                        }
                    }
                }
            }
        }

        public static void Check4x2(int i, int j, int type)
        {
            if (!destroyObject)
            {
                bool flag = false;
                int num = i;
                int num2 = j;
                num += (Main.tile[i, j].frameX / 0x12) * -1;
                if (((type == 0x4f) || (type == 90)) && (Main.tile[i, j].frameX >= 0x48))
                {
                    num += 4;
                }
                num2 += (Main.tile[i, j].frameY / 0x12) * -1;
                for (int k = num; k < (num + 4); k++)
                {
                    for (int m = num2; m < (num2 + 2); m++)
                    {
                        int num5 = (k - num) * 0x12;
                        if (((type == 0x4f) || (type == 90)) && (Main.tile[i, j].frameX >= 0x48))
                        {
                            num5 = ((k - num) + 4) * 0x12;
                        }
                        if (Main.tile[k, m] == null)
                        {
                            Main.tile[k, m] = new Tile();
                        }
                        if ((!Main.tile[k, m].active || (Main.tile[k, m].type != type)) || ((Main.tile[k, m].frameX != num5) || (Main.tile[k, m].frameY != ((m - num2) * 0x12))))
                        {
                            flag = true;
                        }
                    }
                    if (Main.tile[k, num2 + 2] == null)
                    {
                        Main.tile[k, num2 + 2] = new Tile();
                    }
                    if (!Main.tile[k, num2 + 2].active || !Main.tileSolid[Main.tile[k, num2 + 2].type])
                    {
                        flag = true;
                    }
                }
                if (flag)
                {
                    destroyObject = true;
                    for (int n = num; n < (num + 4); n++)
                    {
                        for (int num7 = num2; num7 < (num2 + 3); num7++)
                        {
                            if ((Main.tile[n, num7].type == type) && Main.tile[n, num7].active)
                            {
                                KillTile(n, num7, false, false, false);
                            }
                        }
                    }
                    if (type == 0x4f)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0xe0, 1, false, 0);
                    }
                    if (type == 90)
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x150, 1, false, 0);
                    }
                    destroyObject = false;
                    for (int num8 = num - 1; num8 < (num + 4); num8++)
                    {
                        for (int num9 = num2 - 1; num9 < (num2 + 4); num9++)
                        {
                            TileFrame(num8, num9, false, false);
                        }
                    }
                }
            }
        }

        public static void CheckAlch(int x, int y)
        {
            if (Main.tile[x, y] == null)
            {
                Main.tile[x, y] = new Tile();
            }
            if (Main.tile[x, y + 1] == null)
            {
                Main.tile[x, y + 1] = new Tile();
            }
            bool flag = false;
            if (!Main.tile[x, y + 1].active)
            {
                flag = true;
            }
            int num = Main.tile[x, y].frameX / 0x12;
            Main.tile[x, y].frameY = 0;
            if (!flag)
            {
                switch (num)
                {
                    case 0:
                        if (((Main.tile[x, y + 1].type != 0x6d) && (Main.tile[x, y + 1].type != 2)) && (Main.tile[x, y + 1].type != 0x4e))
                        {
                            flag = true;
                        }
                        if ((Main.tile[x, y].liquid > 0) && Main.tile[x, y].lava)
                        {
                            flag = true;
                        }
                        break;

                    case 1:
                        if ((Main.tile[x, y + 1].type != 60) && (Main.tile[x, y + 1].type != 0x4e))
                        {
                            flag = true;
                        }
                        if ((Main.tile[x, y].liquid > 0) && Main.tile[x, y].lava)
                        {
                            flag = true;
                        }
                        break;

                    case 2:
                        if (((Main.tile[x, y + 1].type != 0) && (Main.tile[x, y + 1].type != 0x3b)) && (Main.tile[x, y + 1].type != 0x4e))
                        {
                            flag = true;
                        }
                        if ((Main.tile[x, y].liquid > 0) && Main.tile[x, y].lava)
                        {
                            flag = true;
                        }
                        break;

                    case 3:
                        if (((Main.tile[x, y + 1].type != 0x17) && (Main.tile[x, y + 1].type != 0x19)) && (Main.tile[x, y + 1].type != 0x4e))
                        {
                            flag = true;
                        }
                        if ((Main.tile[x, y].liquid > 0) && Main.tile[x, y].lava)
                        {
                            flag = true;
                        }
                        break;

                    case 4:
                        if (((Main.tile[x, y + 1].type != 0x35) && (Main.tile[x, y + 1].type != 0x4e)) && (Main.tile[x, y + 1].type != 0x74))
                        {
                            flag = true;
                        }
                        if ((Main.tile[x, y].liquid > 0) && Main.tile[x, y].lava)
                        {
                            flag = true;
                        }
                        if (((Main.tile[x, y].type != 0x52) && !Main.tile[x, y].lava) && (Main.netMode != 1))
                        {
                            if (Main.tile[x, y].liquid > 0x10)
                            {
                                if (Main.tile[x, y].type == 0x53)
                                {
                                    Main.tile[x, y].type = 0x54;
                                    if (Main.netMode == 2)
                                    {
                                        NetMessage.SendTileSquare(-1, x, y, 1);
                                    }
                                }
                            }
                            else if (Main.tile[x, y].type == 0x54)
                            {
                                Main.tile[x, y].type = 0x53;
                                if (Main.netMode == 2)
                                {
                                    NetMessage.SendTileSquare(-1, x, y, 1);
                                }
                            }
                        }
                        break;

                    case 5:
                        if ((Main.tile[x, y + 1].type != 0x39) && (Main.tile[x, y + 1].type != 0x4e))
                        {
                            flag = true;
                        }
                        if ((Main.tile[x, y].liquid > 0) && !Main.tile[x, y].lava)
                        {
                            flag = true;
                        }
                        if ((((Main.tile[x, y].type != 0x52) && Main.tile[x, y].lava) && ((Main.tile[x, y].type != 0x52) && Main.tile[x, y].lava)) && (Main.netMode != 1))
                        {
                            if (Main.tile[x, y].liquid > 0x10)
                            {
                                if (Main.tile[x, y].type == 0x53)
                                {
                                    Main.tile[x, y].type = 0x54;
                                    if (Main.netMode == 2)
                                    {
                                        NetMessage.SendTileSquare(-1, x, y, 1);
                                    }
                                }
                            }
                            else if (Main.tile[x, y].type == 0x54)
                            {
                                Main.tile[x, y].type = 0x53;
                                if (Main.netMode == 2)
                                {
                                    NetMessage.SendTileSquare(-1, x, y, 1);
                                }
                            }
                        }
                        break;
                }
            }
            if (flag)
            {
                KillTile(x, y, false, false, false);
            }
        }

        public static void CheckBanner(int x, int j, byte type)
        {
            if (!destroyObject)
            {
                int num = j - (Main.tile[x, j].frameY / 0x12);
                int frameX = Main.tile[x, j].frameX;
                bool flag = false;
                for (int i = 0; i < 3; i++)
                {
                    if (Main.tile[x, num + i] == null)
                    {
                        Main.tile[x, num + i] = new Tile();
                    }
                    if (!Main.tile[x, num + i].active)
                    {
                        flag = true;
                    }
                    else if (Main.tile[x, num + i].type != type)
                    {
                        flag = true;
                    }
                    else if (Main.tile[x, num + i].frameY != (i * 0x12))
                    {
                        flag = true;
                    }
                    else if (Main.tile[x, num + i].frameX != frameX)
                    {
                        flag = true;
                    }
                }
                if (Main.tile[x, num - 1] == null)
                {
                    Main.tile[x, num - 1] = new Tile();
                }
                if (!Main.tile[x, num - 1].active)
                {
                    flag = true;
                }
                if (!Main.tileSolid[Main.tile[x, num - 1].type])
                {
                    flag = true;
                }
                if (Main.tileSolidTop[Main.tile[x, num - 1].type])
                {
                    flag = true;
                }
                if (flag)
                {
                    destroyObject = true;
                    for (int k = 0; k < 3; k++)
                    {
                        if (Main.tile[x, num + k].type == type)
                        {
                            KillTile(x, num + k, false, false, false);
                        }
                    }
                    if (type == 0x5b)
                    {
                        int num5 = frameX / 0x12;
                        Item.NewItem(x * 0x10, (num + 1) * 0x10, 0x20, 0x20, 0x151 + num5, 1, false, 0);
                    }
                    destroyObject = false;
                }
            }
        }

        public static bool CheckCactus(int i, int j)
        {
            int num = j;
            int num2 = i;
            while (Main.tile[num2, num].active && (Main.tile[num2, num].type == 80))
            {
                num++;
                if (!Main.tile[num2, num].active || (Main.tile[num2, num].type != 80))
                {
                    if (((Main.tile[num2 - 1, num].active && (Main.tile[num2 - 1, num].type == 80)) && (Main.tile[num2 - 1, num - 1].active && (Main.tile[num2 - 1, num - 1].type == 80))) && (num2 >= i))
                    {
                        num2--;
                    }
                    if (((Main.tile[num2 + 1, num].active && (Main.tile[num2 + 1, num].type == 80)) && (Main.tile[num2 + 1, num - 1].active && (Main.tile[num2 + 1, num - 1].type == 80))) && (num2 <= i))
                    {
                        num2++;
                    }
                }
            }
            if (!Main.tile[num2, num].active || (((Main.tile[num2, num].type != 0x35) && (Main.tile[num2, num].type != 0x70)) && (Main.tile[num2, num].type != 0x74)))
            {
                KillTile(i, j, false, false, false);
                return true;
            }
            if (i != num2)
            {
                if (((!Main.tile[i, j + 1].active || (Main.tile[i, j + 1].type != 80)) && (!Main.tile[i - 1, j].active || (Main.tile[i - 1, j].type != 80))) && (!Main.tile[i + 1, j].active || (Main.tile[i + 1, j].type != 80)))
                {
                    KillTile(i, j, false, false, false);
                    return true;
                }
            }
            else if ((i == num2) && (!Main.tile[i, j + 1].active || (((Main.tile[i, j + 1].type != 80) && (Main.tile[i, j + 1].type != 0x35)) && ((Main.tile[i, j + 1].type != 0x70) && (Main.tile[i, j + 1].type != 0x74)))))
            {
                KillTile(i, j, false, false, false);
                return true;
            }
            return false;
        }

        public static void CheckChest(int i, int j, int type)
        {
            if (!destroyObject)
            {
                bool flag = false;
                int num = 0;
                int num2 = j;
                num += Main.tile[i, j].frameX / 0x12;
                num2 += (Main.tile[i, j].frameY / 0x12) * -1;
                while (num > 1)
                {
                    num -= 2;
                }
                num *= -1;
                num += i;
                for (int k = num; k < (num + 2); k++)
                {
                    for (int m = num2; m < (num2 + 2); m++)
                    {
                        if (Main.tile[k, m] == null)
                        {
                            Main.tile[k, m] = new Tile();
                        }
                        int num5 = Main.tile[k, m].frameX / 0x12;
                        while (num5 > 1)
                        {
                            num5 -= 2;
                        }
                        if ((!Main.tile[k, m].active || (Main.tile[k, m].type != type)) || ((num5 != (k - num)) || (Main.tile[k, m].frameY != ((m - num2) * 0x12))))
                        {
                            flag = true;
                        }
                    }
                    if (Main.tile[k, num2 + 2] == null)
                    {
                        Main.tile[k, num2 + 2] = new Tile();
                    }
                    if (!Main.tile[k, num2 + 2].active || !Main.tileSolid[Main.tile[k, num2 + 2].type])
                    {
                        flag = true;
                    }
                }
                if (flag)
                {
                    int num6 = 0x30;
                    if (Main.tile[i, j].frameX >= 0xd8)
                    {
                        num6 = 0x15c;
                    }
                    else if (Main.tile[i, j].frameX >= 180)
                    {
                        num6 = 0x157;
                    }
                    else if (Main.tile[i, j].frameX >= 0x6c)
                    {
                        num6 = 0x148;
                    }
                    else if (Main.tile[i, j].frameX >= 0x24)
                    {
                        num6 = 0x132;
                    }
                    destroyObject = true;
                    for (int n = num; n < (num + 2); n++)
                    {
                        for (int num8 = num2; num8 < (num2 + 3); num8++)
                        {
                            if ((Main.tile[n, num8].type == type) && Main.tile[n, num8].active)
                            {
                                Chest.DestroyChest(n, num8);
                                KillTile(n, num8, false, false, false);
                            }
                        }
                    }
                    Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, num6, 1, false, 0);
                    destroyObject = false;
                }
            }
        }

        public static void CheckMan(int i, int j)
        {
            if (!destroyObject)
            {
                int num = i;
                int num2 = j - (Main.tile[i, j].frameY / 0x12);
                int frameX = Main.tile[i, j].frameX;
                while (frameX >= 100)
                {
                    frameX -= 100;
                }
                while (frameX >= 0x24)
                {
                    frameX -= 0x24;
                }
                num -= frameX / 0x12;
                bool flag = false;
                for (int k = 0; k <= 1; k++)
                {
                    for (int m = 0; m <= 2; m++)
                    {
                        int num6 = num + k;
                        int num7 = num2 + m;
                        int num8 = Main.tile[num6, num7].frameX;
                        while (num8 >= 100)
                        {
                            num8 -= 100;
                        }
                        if (num8 >= 0x24)
                        {
                            num8 -= 0x24;
                        }
                        if ((!Main.tile[num6, num7].active || (Main.tile[num6, num7].type != 0x80)) || ((Main.tile[num6, num7].frameY != (m * 0x12)) || (num8 != (k * 0x12))))
                        {
                            flag = true;
                        }
                    }
                }
                if (!SolidTile(num, num2 + 3) || !SolidTile(num + 1, num2 + 3))
                {
                    flag = true;
                }
                if (flag)
                {
                    destroyObject = true;
                    Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x1f2, 1, false, 0);
                    for (int n = 0; n <= 1; n++)
                    {
                        for (int num10 = 0; num10 <= 2; num10++)
                        {
                            int num11 = num + n;
                            int num12 = num2 + num10;
                            if (Main.tile[num11, num12].active && (Main.tile[num11, num12].type == 0x80))
                            {
                                KillTile(num11, num12, false, false, false);
                            }
                        }
                    }
                    destroyObject = false;
                }
            }
        }

        public static void CheckMB(int i, int j, int type)
        {
            if (!destroyObject)
            {
                bool flag = false;
                int num = i;
                int num2 = j;
                int num3 = 0;
                int num4 = Main.tile[i, j].frameY / 0x12;
                while (num4 >= 2)
                {
                    num3++;
                    num4 -= 2;
                }
                int num5 = Main.tile[i, j].frameX / 0x12;
                int num6 = 0;
                if (num5 >= 2)
                {
                    num5 -= 2;
                    num6++;
                }
                num = i - num5;
                num2 = j - num4;
                for (int k = num; k < (num + 2); k++)
                {
                    for (int m = num2; m < (num2 + 2); m++)
                    {
                        if (Main.tile[k, m] == null)
                        {
                            Main.tile[k, m] = new Tile();
                        }
                        if ((!Main.tile[k, m].active || (Main.tile[k, m].type != type)) || ((Main.tile[k, m].frameX != (((k - num) * 0x12) + (num6 * 0x24))) || (Main.tile[k, m].frameY != (((m - num2) * 0x12) + (num3 * 0x24)))))
                        {
                            flag = true;
                        }
                    }
                    if (!SolidTile(k, num2 + 2))
                    {
                        flag = true;
                    }
                }
                if (flag)
                {
                    destroyObject = true;
                    for (int n = num; n < (num + 2); n++)
                    {
                        for (int num10 = num2; num10 < (num2 + 3); num10++)
                        {
                            if ((Main.tile[n, num10].type == type) && Main.tile[n, num10].active)
                            {
                                KillTile(n, num10, false, false, false);
                            }
                        }
                    }
                    Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x232 + num3, 1, false, 0);
                    for (int num11 = num - 1; num11 < (num + 3); num11++)
                    {
                        for (int num12 = num2 - 1; num12 < (num2 + 3); num12++)
                        {
                            TileFrame(num11, num12, false, false);
                        }
                    }
                    destroyObject = false;
                }
            }
        }

        public static bool checkMech(int i, int j, int time)
        {
            for (int k = 0; k < numMechs; k++)
            {
                if ((mechX[k] == i) && (mechY[k] == j))
                {
                    return false;
                }
            }
            if (numMechs < (maxMech - 1))
            {
                mechX[numMechs] = i;
                mechY[numMechs] = j;
                mechTime[numMechs] = time;
                numMechs++;
                return true;
            }
            return false;
        }

        public static void CheckOnTable1x1(int x, int y, int type)
        {
            if ((Main.tile[x, y + 1] != null) && (!Main.tile[x, y + 1].active || !Main.tileTable[Main.tile[x, y + 1].type]))
            {
                if (type == 0x4e)
                {
                    if (!Main.tile[x, y + 1].active || !Main.tileSolid[Main.tile[x, y + 1].type])
                    {
                        KillTile(x, y, false, false, false);
                    }
                }
                else
                {
                    KillTile(x, y, false, false, false);
                }
            }
        }

        public static void CheckOrb(int i, int j, int type)
        {
            if (!destroyObject)
            {
                int num = i;
                int num2 = j;
                if (Main.tile[i, j].frameX == 0)
                {
                    num = i;
                }
                else
                {
                    num = i - 1;
                }
                if (Main.tile[i, j].frameY == 0)
                {
                    num2 = j;
                }
                else
                {
                    num2 = j - 1;
                }
                if ((((Main.tile[num, num2] != null) && (Main.tile[num + 1, num2] != null)) && ((Main.tile[num, num2 + 1] != null) && (Main.tile[num + 1, num2 + 1] != null))) && (((!Main.tile[num, num2].active || (Main.tile[num, num2].type != type)) || (!Main.tile[num + 1, num2].active || (Main.tile[num + 1, num2].type != type))) || ((!Main.tile[num, num2 + 1].active || (Main.tile[num, num2 + 1].type != type)) || (!Main.tile[num + 1, num2 + 1].active || (Main.tile[num + 1, num2 + 1].type != type)))))
                {
                    destroyObject = true;
                    if (Main.tile[num, num2].type == type)
                    {
                        KillTile(num, num2, false, false, false);
                    }
                    if (Main.tile[num + 1, num2].type == type)
                    {
                        KillTile(num + 1, num2, false, false, false);
                    }
                    if (Main.tile[num, num2 + 1].type == type)
                    {
                        KillTile(num, num2 + 1, false, false, false);
                    }
                    if (Main.tile[num + 1, num2 + 1].type == type)
                    {
                        KillTile(num + 1, num2 + 1, false, false, false);
                    }
                    if ((Main.netMode != 1) && !noTileActions)
                    {
                        if (type == 12)
                        {
                            Item.NewItem(num * 0x10, num2 * 0x10, 0x20, 0x20, 0x1d, 1, false, 0);
                        }
                        else if (type == 0x1f)
                        {
                            if (genRand.Next(2) == 0)
                            {
                                spawnMeteor = true;
                            }
                            int num3 = Main.rand.Next(5);
                            if (!shadowOrbSmashed)
                            {
                                num3 = 0;
                            }
                            if (num3 == 0)
                            {
                                Item.NewItem(num * 0x10, num2 * 0x10, 0x20, 0x20, 0x60, 1, false, -1);
                                int stack = genRand.Next(0x19, 0x33);
                                Item.NewItem(num * 0x10, num2 * 0x10, 0x20, 0x20, 0x61, stack, false, 0);
                            }
                            else if (num3 == 1)
                            {
                                Item.NewItem(num * 0x10, num2 * 0x10, 0x20, 0x20, 0x40, 1, false, -1);
                            }
                            else if (num3 == 2)
                            {
                                Item.NewItem(num * 0x10, num2 * 0x10, 0x20, 0x20, 0xa2, 1, false, -1);
                            }
                            else if (num3 == 3)
                            {
                                Item.NewItem(num * 0x10, num2 * 0x10, 0x20, 0x20, 0x73, 1, false, -1);
                            }
                            else if (num3 == 4)
                            {
                                Item.NewItem(num * 0x10, num2 * 0x10, 0x20, 0x20, 0x6f, 1, false, -1);
                            }
                            shadowOrbSmashed = true;
                            shadowOrbCount++;
                            if (shadowOrbCount >= 3)
                            {
                                shadowOrbCount = 0;
                                float num5 = num * 0x10;
                                float num6 = num2 * 0x10;
                                float num7 = -1f;
                                int index = 0;
                                for (int k = 0; k < 0xff; k++)
                                {
                                    float num10 = Math.Abs((float) (Main.player[k].position.X - num5)) + Math.Abs((float) (Main.player[k].position.Y - num6));
                                    if ((num10 < num7) || (num7 == -1f))
                                    {
                                        index = 0;
                                        num7 = num10;
                                    }
                                }
                                if (Main.player[index].zoneEvil)
                                {
                                    NPC.SpawnOnPlayer(index, 13);
                                }
                            }
                            else
                            {
                                string newText = "A horrible chill goes down your spine...";
                                if (shadowOrbCount == 2)
                                {
                                    newText = "Screams echo around you...";
                                }
                                if (Main.netMode == 0)
                                {
                                    Main.NewText(newText, 50, 0xff, 130);
                                }
                                else if (Main.netMode == 2)
                                {
                                    NetMessage.SendData(0x19, -1, -1, newText, 0xff, 50f, 255f, 130f, 0);
                                }
                            }
                        }
                    }
                    Main.PlaySound(13, i * 0x10, j * 0x10, 1);
                    destroyObject = false;
                }
            }
        }

        public static void CheckPot(int i, int j, int type = 0x1c)
        {
            if (!destroyObject)
            {
                bool flag = false;
                int num = 0;
                int num2 = j;
                num += Main.tile[i, j].frameX / 0x12;
                num2 += (Main.tile[i, j].frameY / 0x12) * -1;
                while (num > 1)
                {
                    num -= 2;
                }
                num *= -1;
                num += i;
                for (int k = num; k < (num + 2); k++)
                {
                    for (int m = num2; m < (num2 + 2); m++)
                    {
                        if (Main.tile[k, m] == null)
                        {
                            Main.tile[k, m] = new Tile();
                        }
                        int num5 = Main.tile[k, m].frameX / 0x12;
                        while (num5 > 1)
                        {
                            num5 -= 2;
                        }
                        if ((!Main.tile[k, m].active || (Main.tile[k, m].type != type)) || ((num5 != (k - num)) || (Main.tile[k, m].frameY != ((m - num2) * 0x12))))
                        {
                            flag = true;
                        }
                    }
                    if (Main.tile[k, num2 + 2] == null)
                    {
                        Main.tile[k, num2 + 2] = new Tile();
                    }
                    if (!Main.tile[k, num2 + 2].active || !Main.tileSolid[Main.tile[k, num2 + 2].type])
                    {
                        flag = true;
                    }
                }
                if (flag)
                {
                    destroyObject = true;
                    Main.PlaySound(13, i * 0x10, j * 0x10, 1);
                    for (int n = num; n < (num + 2); n++)
                    {
                        for (int num7 = num2; num7 < (num2 + 2); num7++)
                        {
                            if ((Main.tile[n, num7].type == type) && Main.tile[n, num7].active)
                            {
                                KillTile(n, num7, false, false, false);
                            }
                        }
                    }
                    Gore.NewGore(new Vector2((float) (i * 0x10), (float) (j * 0x10)), new Vector2(), 0x33, 1f);
                    Gore.NewGore(new Vector2((float) (i * 0x10), (float) (j * 0x10)), new Vector2(), 0x34, 1f);
                    Gore.NewGore(new Vector2((float) (i * 0x10), (float) (j * 0x10)), new Vector2(), 0x35, 1f);
                    if ((genRand.Next(40) == 0) && (((Main.tile[num, num2].wall == 7) || (Main.tile[num, num2].wall == 8)) || (Main.tile[num, num2].wall == 9)))
                    {
                        Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x147, 1, false, 0);
                    }
                    else if (genRand.Next(0x2d) == 0)
                    {
                        if (j < Main.worldSurface)
                        {
                            switch (genRand.Next(4))
                            {
                                case 0:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x124, 1, false, 0);
                                    break;

                                case 1:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x12a, 1, false, 0);
                                    break;

                                case 2:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x12b, 1, false, 0);
                                    break;

                                case 3:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 290, 1, false, 0);
                                    break;
                            }
                        }
                        else if (j < Main.rockLayer)
                        {
                            switch (genRand.Next(7))
                            {
                                case 0:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x121, 1, false, 0);
                                    break;

                                case 1:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x12a, 1, false, 0);
                                    break;

                                case 2:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x12b, 1, false, 0);
                                    break;

                                case 3:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 290, 1, false, 0);
                                    break;

                                case 4:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x12f, 1, false, 0);
                                    break;

                                case 5:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x123, 1, false, 0);
                                    break;

                                case 6:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x130, 1, false, 0);
                                    break;
                            }
                        }
                        else if (j < (Main.maxTilesY - 200))
                        {
                            switch (genRand.Next(10))
                            {
                                case 0:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x128, 1, false, 0);
                                    break;

                                case 1:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x127, 1, false, 0);
                                    break;

                                case 2:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x12b, 1, false, 0);
                                    break;

                                case 3:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x12e, 1, false, 0);
                                    break;

                                case 4:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x12f, 1, false, 0);
                                    break;

                                case 5:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x131, 1, false, 0);
                                    break;

                                case 6:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x12d, 1, false, 0);
                                    break;

                                case 7:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x12e, 1, false, 0);
                                    break;

                                case 8:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x129, 1, false, 0);
                                    break;

                                case 9:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x130, 1, false, 0);
                                    break;
                            }
                        }
                        else
                        {
                            switch (genRand.Next(12))
                            {
                                case 0:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x128, 1, false, 0);
                                    break;

                                case 1:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x127, 1, false, 0);
                                    break;

                                case 2:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x125, 1, false, 0);
                                    break;

                                case 3:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x120, 1, false, 0);
                                    break;

                                case 4:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x126, 1, false, 0);
                                    break;

                                case 5:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x129, 1, false, 0);
                                    break;

                                case 6:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x130, 1, false, 0);
                                    break;

                                case 7:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x131, 1, false, 0);
                                    break;

                                case 8:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x12d, 1, false, 0);
                                    break;

                                case 9:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x12e, 1, false, 0);
                                    break;

                                case 10:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x120, 1, false, 0);
                                    break;

                                case 11:
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 300, 1, false, 0);
                                    break;
                            }
                        }
                    }
                    else
                    {
                        int num12 = Main.rand.Next(8);
                        if ((num12 == 0) && (Main.player[Player.FindClosest(new Vector2((float) (i * 0x10), (float) (j * 0x10)), 0x10, 0x10)].statLife < Main.player[Player.FindClosest(new Vector2((float) (i * 0x10), (float) (j * 0x10)), 0x10, 0x10)].statLifeMax))
                        {
                            Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x3a, 1, false, 0);
                        }
                        else if ((num12 == 1) && (Main.player[Player.FindClosest(new Vector2((float) (i * 0x10), (float) (j * 0x10)), 0x10, 0x10)].statMana < Main.player[Player.FindClosest(new Vector2((float) (i * 0x10), (float) (j * 0x10)), 0x10, 0x10)].statManaMax))
                        {
                            Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0xb8, 1, false, 0);
                        }
                        else if (num12 == 2)
                        {
                            int stack = Main.rand.Next(1, 6);
                            if (Main.tile[i, j].liquid > 0)
                            {
                                Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x11a, stack, false, 0);
                            }
                            else
                            {
                                Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 8, stack, false, 0);
                            }
                        }
                        else if (num12 == 3)
                        {
                            int num14 = Main.rand.Next(8) + 3;
                            int num15 = 40;
                            if ((j < Main.rockLayer) && (genRand.Next(2) == 0))
                            {
                                if (Main.hardMode)
                                {
                                    num15 = 0xa8;
                                }
                                else
                                {
                                    num15 = 0x2a;
                                }
                            }
                            if (j > (Main.maxTilesY - 200))
                            {
                                num15 = 0x109;
                            }
                            else if (Main.hardMode)
                            {
                                if (Main.rand.Next(2) == 0)
                                {
                                    num15 = 0x116;
                                }
                                else
                                {
                                    num15 = 0x2f;
                                }
                            }
                            Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, num15, num14, false, 0);
                        }
                        else if (num12 == 4)
                        {
                            int num16 = 0x1c;
                            if ((j > (Main.maxTilesY - 200)) || Main.hardMode)
                            {
                                num16 = 0xbc;
                            }
                            Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, num16, 1, false, 0);
                        }
                        else if ((num12 == 5) && (j > Main.rockLayer))
                        {
                            int num17 = Main.rand.Next(4) + 1;
                            Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0xa6, num17, false, 0);
                        }
                        else
                        {
                            float num18 = 200 + genRand.Next(-100, 0x65);
                            if (j < Main.worldSurface)
                            {
                                num18 *= 0.5f;
                            }
                            else if (j < Main.rockLayer)
                            {
                                num18 *= 0.75f;
                            }
                            else if (j > (Main.maxTilesY - 250))
                            {
                                num18 *= 1.25f;
                            }
                            num18 *= 1f + (Main.rand.Next(-20, 0x15) * 0.01f);
                            if (Main.rand.Next(5) == 0)
                            {
                                num18 *= 1f + (Main.rand.Next(5, 11) * 0.01f);
                            }
                            if (Main.rand.Next(10) == 0)
                            {
                                num18 *= 1f + (Main.rand.Next(10, 0x15) * 0.01f);
                            }
                            if (Main.rand.Next(15) == 0)
                            {
                                num18 *= 1f + (Main.rand.Next(20, 0x29) * 0.01f);
                            }
                            if (Main.rand.Next(20) == 0)
                            {
                                num18 *= 1f + (Main.rand.Next(40, 0x51) * 0.01f);
                            }
                            if (Main.rand.Next(0x19) == 0)
                            {
                                num18 *= 1f + (Main.rand.Next(50, 0x65) * 0.01f);
                            }
                            while (((int) num18) > 0)
                            {
                                if (num18 > 1000000f)
                                {
                                    int num19 = (int) (num18 / 1000000f);
                                    if ((num19 > 50) && (Main.rand.Next(2) == 0))
                                    {
                                        num19 /= Main.rand.Next(3) + 1;
                                    }
                                    if (Main.rand.Next(2) == 0)
                                    {
                                        num19 /= Main.rand.Next(3) + 1;
                                    }
                                    num18 -= 0xf4240 * num19;
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x4a, num19, false, 0);
                                }
                                else
                                {
                                    if (num18 > 10000f)
                                    {
                                        int num20 = (int) (num18 / 10000f);
                                        if ((num20 > 50) && (Main.rand.Next(2) == 0))
                                        {
                                            num20 /= Main.rand.Next(3) + 1;
                                        }
                                        if (Main.rand.Next(2) == 0)
                                        {
                                            num20 /= Main.rand.Next(3) + 1;
                                        }
                                        num18 -= 0x2710 * num20;
                                        Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x49, num20, false, 0);
                                        continue;
                                    }
                                    if (num18 > 100f)
                                    {
                                        int num21 = (int) (num18 / 100f);
                                        if ((num21 > 50) && (Main.rand.Next(2) == 0))
                                        {
                                            num21 /= Main.rand.Next(3) + 1;
                                        }
                                        if (Main.rand.Next(2) == 0)
                                        {
                                            num21 /= Main.rand.Next(3) + 1;
                                        }
                                        num18 -= 100 * num21;
                                        Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x48, num21, false, 0);
                                        continue;
                                    }
                                    int num22 = (int) num18;
                                    if ((num22 > 50) && (Main.rand.Next(2) == 0))
                                    {
                                        num22 /= Main.rand.Next(3) + 1;
                                    }
                                    if (Main.rand.Next(2) == 0)
                                    {
                                        num22 /= Main.rand.Next(4) + 1;
                                    }
                                    if (num22 < 1)
                                    {
                                        num22 = 1;
                                    }
                                    num18 -= num22;
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x47, num22, false, 0);
                                }
                            }
                        }
                    }
                    destroyObject = false;
                }
            }
        }

        public static void CheckRoom(int x, int y)
        {
            if (canSpawn)
            {
                if (((x < 10) || (y < 10)) || ((x >= (Main.maxTilesX - 10)) || (y >= (lastMaxTilesY - 10))))
                {
                    canSpawn = false;
                }
                else
                {
                    for (int i = 0; i < numRoomTiles; i++)
                    {
                        if ((roomX[i] == x) && (roomY[i] == y))
                        {
                            return;
                        }
                    }
                    roomX[numRoomTiles] = x;
                    roomY[numRoomTiles] = y;
                    numRoomTiles++;
                    if (numRoomTiles >= maxRoomTiles)
                    {
                        canSpawn = false;
                    }
                    else
                    {
                        if (Main.tile[x, y].active)
                        {
                            houseTile[Main.tile[x, y].type] = true;
                            if (Main.tileSolid[Main.tile[x, y].type] || (Main.tile[x, y].type == 11))
                            {
                                return;
                            }
                        }
                        if (x < roomX1)
                        {
                            roomX1 = x;
                        }
                        if (x > roomX2)
                        {
                            roomX2 = x;
                        }
                        if (y < roomY1)
                        {
                            roomY1 = y;
                        }
                        if (y > roomY2)
                        {
                            roomY2 = y;
                        }
                        bool flag = false;
                        bool flag2 = false;
                        for (int j = -2; j < 3; j++)
                        {
                            if (Main.wallHouse[Main.tile[x + j, y].wall])
                            {
                                flag = true;
                            }
                            if (Main.tile[x + j, y].active && (Main.tileSolid[Main.tile[x + j, y].type] || (Main.tile[x + j, y].type == 11)))
                            {
                                flag = true;
                            }
                            if (Main.wallHouse[Main.tile[x, y + j].wall])
                            {
                                flag2 = true;
                            }
                            if (Main.tile[x, y + j].active && (Main.tileSolid[Main.tile[x, y + j].type] || (Main.tile[x, y + j].type == 11)))
                            {
                                flag2 = true;
                            }
                        }
                        if (!flag || !flag2)
                        {
                            canSpawn = false;
                        }
                        else
                        {
                            for (int k = x - 1; k < (x + 2); k++)
                            {
                                for (int m = y - 1; m < (y + 2); m++)
                                {
                                    if (((k != x) || (m != y)) && canSpawn)
                                    {
                                        CheckRoom(k, m);
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        public static void CheckSign(int x, int y, int type)
        {
            if (!destroyObject)
            {
                int num = x - 2;
                int num2 = x + 3;
                int num3 = y - 2;
                int num4 = y + 3;
                if ((((num >= 0) && (num2 <= Main.maxTilesX)) && (num3 >= 0)) && (num4 <= Main.maxTilesY))
                {
                    bool flag = false;
                    for (int i = num; i < num2; i++)
                    {
                        for (int k = num3; k < num4; k++)
                        {
                            if (Main.tile[i, k] == null)
                            {
                                Main.tile[i, k] = new Tile();
                            }
                        }
                    }
                    int num7 = Main.tile[x, y].frameX / 0x12;
                    int num8 = Main.tile[x, y].frameY / 0x12;
                    while (num7 > 1)
                    {
                        num7 -= 2;
                    }
                    int num9 = x - num7;
                    int num10 = y - num8;
                    int num11 = (Main.tile[num9, num10].frameX / 0x12) / 2;
                    num = num9;
                    num2 = num9 + 2;
                    num3 = num10;
                    num4 = num10 + 2;
                    num7 = 0;
                    for (int j = num; j < num2; j++)
                    {
                        num8 = 0;
                        for (int m = num3; m < num4; m++)
                        {
                            if (!Main.tile[j, m].active || (Main.tile[j, m].type != type))
                            {
                                flag = true;
                                goto Label_017B;
                            }
                            if (((Main.tile[j, m].frameX / 0x12) != (num7 + (num11 * 2))) || ((Main.tile[j, m].frameY / 0x12) != num8))
                            {
                                flag = true;
                                goto Label_017B;
                            }
                            num8++;
                        }
                    Label_017B:
                        num7++;
                    }
                    if (!flag)
                    {
                        if (type == 0x55)
                        {
                            if ((Main.tile[num9, num10 + 2].active && Main.tileSolid[Main.tile[num9, num10 + 2].type]) && (Main.tile[num9 + 1, num10 + 2].active && Main.tileSolid[Main.tile[num9 + 1, num10 + 2].type]))
                            {
                                num11 = 0;
                            }
                            else
                            {
                                flag = true;
                            }
                        }
                        else if ((Main.tile[num9, num10 + 2].active && Main.tileSolid[Main.tile[num9, num10 + 2].type]) && (Main.tile[num9 + 1, num10 + 2].active && Main.tileSolid[Main.tile[num9 + 1, num10 + 2].type]))
                        {
                            num11 = 0;
                        }
                        else if (((Main.tile[num9, num10 - 1].active && Main.tileSolid[Main.tile[num9, num10 - 1].type]) && (!Main.tileSolidTop[Main.tile[num9, num10 - 1].type] && Main.tile[num9 + 1, num10 - 1].active)) && (Main.tileSolid[Main.tile[num9 + 1, num10 - 1].type] && !Main.tileSolidTop[Main.tile[num9 + 1, num10 - 1].type]))
                        {
                            num11 = 1;
                        }
                        else if (((Main.tile[num9 - 1, num10].active && Main.tileSolid[Main.tile[num9 - 1, num10].type]) && (!Main.tileSolidTop[Main.tile[num9 - 1, num10].type] && Main.tile[num9 - 1, num10 + 1].active)) && (Main.tileSolid[Main.tile[num9 - 1, num10 + 1].type] && !Main.tileSolidTop[Main.tile[num9 - 1, num10 + 1].type]))
                        {
                            num11 = 2;
                        }
                        else if (((Main.tile[num9 + 2, num10].active && Main.tileSolid[Main.tile[num9 + 2, num10].type]) && (!Main.tileSolidTop[Main.tile[num9 + 2, num10].type] && Main.tile[num9 + 2, num10 + 1].active)) && (Main.tileSolid[Main.tile[num9 + 2, num10 + 1].type] && !Main.tileSolidTop[Main.tile[num9 + 2, num10 + 1].type]))
                        {
                            num11 = 3;
                        }
                        else
                        {
                            flag = true;
                        }
                    }
                    if (flag)
                    {
                        destroyObject = true;
                        for (int n = num; n < num2; n++)
                        {
                            for (int num15 = num3; num15 < num4; num15++)
                            {
                                if (Main.tile[n, num15].type == type)
                                {
                                    KillTile(n, num15, false, false, false);
                                }
                            }
                        }
                        Sign.KillSign(num9, num10);
                        if (type == 0x55)
                        {
                            Item.NewItem(x * 0x10, y * 0x10, 0x20, 0x20, 0x141, 1, false, 0);
                        }
                        else
                        {
                            Item.NewItem(x * 0x10, y * 0x10, 0x20, 0x20, 0xab, 1, false, 0);
                        }
                        destroyObject = false;
                    }
                    else
                    {
                        int num16 = 0x24 * num11;
                        for (int num17 = 0; num17 < 2; num17++)
                        {
                            for (int num18 = 0; num18 < 2; num18++)
                            {
                                Main.tile[num9 + num17, num10 + num18].active = true;
                                Main.tile[num9 + num17, num10 + num18].type = (byte) type;
                                Main.tile[num9 + num17, num10 + num18].frameX = (short) (num16 + (0x12 * num17));
                                Main.tile[num9 + num17, num10 + num18].frameY = (short) (0x12 * num18);
                            }
                        }
                    }
                }
            }
        }

        public static void CheckSunflower(int i, int j, int type = 0x1b)
        {
            if (!destroyObject)
            {
                bool flag = false;
                int num = 0;
                int num2 = j;
                num += Main.tile[i, j].frameX / 0x12;
                num2 += (Main.tile[i, j].frameY / 0x12) * -1;
                while (num > 1)
                {
                    num -= 2;
                }
                num *= -1;
                num += i;
                for (int k = num; k < (num + 2); k++)
                {
                    for (int m = num2; m < (num2 + 4); m++)
                    {
                        if (Main.tile[k, m] == null)
                        {
                            Main.tile[k, m] = new Tile();
                        }
                        int num5 = Main.tile[k, m].frameX / 0x12;
                        while (num5 > 1)
                        {
                            num5 -= 2;
                        }
                        if ((!Main.tile[k, m].active || (Main.tile[k, m].type != type)) || ((num5 != (k - num)) || (Main.tile[k, m].frameY != ((m - num2) * 0x12))))
                        {
                            flag = true;
                        }
                    }
                    if (Main.tile[k, num2 + 4] == null)
                    {
                        Main.tile[k, num2 + 4] = new Tile();
                    }
                    if (!Main.tile[k, num2 + 4].active || ((Main.tile[k, num2 + 4].type != 2) && (Main.tile[k, num2 + 4].type != 0x6d)))
                    {
                        flag = true;
                    }
                }
                if (flag)
                {
                    destroyObject = true;
                    for (int n = num; n < (num + 2); n++)
                    {
                        for (int num7 = num2; num7 < (num2 + 4); num7++)
                        {
                            if ((Main.tile[n, num7].type == type) && Main.tile[n, num7].active)
                            {
                                KillTile(n, num7, false, false, false);
                            }
                        }
                    }
                    Item.NewItem(i * 0x10, j * 0x10, 0x20, 0x20, 0x3f, 1, false, 0);
                    destroyObject = false;
                }
            }
        }

        public static void CheckTree(int i, int j)
        {
            int index = -1;
            int num2 = -1;
            int num3 = -1;
            int num4 = -1;
            int num5 = -1;
            int num6 = -1;
            int num7 = -1;
            int num8 = -1;
            int type = Main.tile[i, j].type;
            int frameX = Main.tile[i, j].frameX;
            int frameY = Main.tile[i, j].frameY;
            if ((Main.tile[i - 1, j] != null) && Main.tile[i - 1, j].active)
            {
                num4 = Main.tile[i - 1, j].type;
            }
            if ((Main.tile[i + 1, j] != null) && Main.tile[i + 1, j].active)
            {
                num5 = Main.tile[i + 1, j].type;
            }
            if ((Main.tile[i, j - 1] != null) && Main.tile[i, j - 1].active)
            {
                num2 = Main.tile[i, j - 1].type;
            }
            if ((Main.tile[i, j + 1] != null) && Main.tile[i, j + 1].active)
            {
                num7 = Main.tile[i, j + 1].type;
            }
            if ((Main.tile[i - 1, j - 1] != null) && Main.tile[i - 1, j - 1].active)
            {
                index = Main.tile[i - 1, j - 1].type;
            }
            if ((Main.tile[i + 1, j - 1] != null) && Main.tile[i + 1, j - 1].active)
            {
                num3 = Main.tile[i + 1, j - 1].type;
            }
            if ((Main.tile[i - 1, j + 1] != null) && Main.tile[i - 1, j + 1].active)
            {
                num6 = Main.tile[i - 1, j + 1].type;
            }
            if ((Main.tile[i + 1, j + 1] != null) && Main.tile[i + 1, j + 1].active)
            {
                num8 = Main.tile[i + 1, j + 1].type;
            }
            if ((num4 >= 0) && Main.tileStone[num4])
            {
                num4 = 1;
            }
            if ((num5 >= 0) && Main.tileStone[num5])
            {
                num5 = 1;
            }
            if ((num2 >= 0) && Main.tileStone[num2])
            {
                num2 = 1;
            }
            if ((num7 >= 0) && Main.tileStone[num7])
            {
                num7 = 1;
            }
            if ((index >= 0) && Main.tileStone[index])
            {
                index = 1;
            }
            if ((num3 >= 0) && Main.tileStone[num3])
            {
                num3 = 1;
            }
            if ((num6 >= 0) && Main.tileStone[num6])
            {
                num6 = 1;
            }
            if ((num8 >= 0) && Main.tileStone[num8])
            {
                num8 = 1;
            }
            switch (num7)
            {
                case 0x17:
                    num7 = 2;
                    break;

                case 60:
                    num7 = 2;
                    break;

                case 0x6d:
                    num7 = 2;
                    break;
            }
            if (((Main.tile[i, j].frameX >= 0x16) && (Main.tile[i, j].frameX <= 0x2c)) && ((Main.tile[i, j].frameY >= 0x84) && (Main.tile[i, j].frameY <= 0xb0)))
            {
                if (num7 != 2)
                {
                    KillTile(i, j, false, false, false);
                }
                else if (((Main.tile[i, j].frameX != 0x16) || (num4 != type)) && ((Main.tile[i, j].frameX != 0x2c) || (num5 != type)))
                {
                    KillTile(i, j, false, false, false);
                }
            }
            else if (((((Main.tile[i, j].frameX == 0x58) && (Main.tile[i, j].frameY >= 0)) && (Main.tile[i, j].frameY <= 0x2c)) || (((Main.tile[i, j].frameX == 0x42) && (Main.tile[i, j].frameY >= 0x42)) && (Main.tile[i, j].frameY <= 130))) || ((((Main.tile[i, j].frameX == 110) && (Main.tile[i, j].frameY >= 0x42)) && (Main.tile[i, j].frameY <= 110)) || (((Main.tile[i, j].frameX == 0x84) && (Main.tile[i, j].frameY >= 0)) && (Main.tile[i, j].frameY <= 0xb0))))
            {
                if ((num4 == type) && (num5 == type))
                {
                    if (Main.tile[i, j].frameNumber == 0)
                    {
                        Main.tile[i, j].frameX = 110;
                        Main.tile[i, j].frameY = 0x42;
                    }
                    if (Main.tile[i, j].frameNumber == 1)
                    {
                        Main.tile[i, j].frameX = 110;
                        Main.tile[i, j].frameY = 0x58;
                    }
                    if (Main.tile[i, j].frameNumber == 2)
                    {
                        Main.tile[i, j].frameX = 110;
                        Main.tile[i, j].frameY = 110;
                    }
                }
                else if (num4 == type)
                {
                    if (Main.tile[i, j].frameNumber == 0)
                    {
                        Main.tile[i, j].frameX = 0x58;
                        Main.tile[i, j].frameY = 0;
                    }
                    if (Main.tile[i, j].frameNumber == 1)
                    {
                        Main.tile[i, j].frameX = 0x58;
                        Main.tile[i, j].frameY = 0x16;
                    }
                    if (Main.tile[i, j].frameNumber == 2)
                    {
                        Main.tile[i, j].frameX = 0x58;
                        Main.tile[i, j].frameY = 0x2c;
                    }
                }
                else if (num5 == type)
                {
                    if (Main.tile[i, j].frameNumber == 0)
                    {
                        Main.tile[i, j].frameX = 0x42;
                        Main.tile[i, j].frameY = 0x42;
                    }
                    if (Main.tile[i, j].frameNumber == 1)
                    {
                        Main.tile[i, j].frameX = 0x42;
                        Main.tile[i, j].frameY = 0x58;
                    }
                    if (Main.tile[i, j].frameNumber == 2)
                    {
                        Main.tile[i, j].frameX = 0x42;
                        Main.tile[i, j].frameY = 110;
                    }
                }
                else
                {
                    if (Main.tile[i, j].frameNumber == 0)
                    {
                        Main.tile[i, j].frameX = 0;
                        Main.tile[i, j].frameY = 0;
                    }
                    if (Main.tile[i, j].frameNumber == 1)
                    {
                        Main.tile[i, j].frameX = 0;
                        Main.tile[i, j].frameY = 0x16;
                    }
                    if (Main.tile[i, j].frameNumber == 2)
                    {
                        Main.tile[i, j].frameX = 0;
                        Main.tile[i, j].frameY = 0x2c;
                    }
                }
            }
            if (((Main.tile[i, j].frameY >= 0x84) && (Main.tile[i, j].frameY <= 0xb0)) && (((Main.tile[i, j].frameX == 0) || (Main.tile[i, j].frameX == 0x42)) || (Main.tile[i, j].frameX == 0x58)))
            {
                if (num7 != 2)
                {
                    KillTile(i, j, false, false, false);
                }
                if ((num4 != type) && (num5 != type))
                {
                    if (Main.tile[i, j].frameNumber == 0)
                    {
                        Main.tile[i, j].frameX = 0;
                        Main.tile[i, j].frameY = 0;
                    }
                    if (Main.tile[i, j].frameNumber == 1)
                    {
                        Main.tile[i, j].frameX = 0;
                        Main.tile[i, j].frameY = 0x16;
                    }
                    if (Main.tile[i, j].frameNumber == 2)
                    {
                        Main.tile[i, j].frameX = 0;
                        Main.tile[i, j].frameY = 0x2c;
                    }
                }
                else if (num4 != type)
                {
                    if (Main.tile[i, j].frameNumber == 0)
                    {
                        Main.tile[i, j].frameX = 0;
                        Main.tile[i, j].frameY = 0x84;
                    }
                    if (Main.tile[i, j].frameNumber == 1)
                    {
                        Main.tile[i, j].frameX = 0;
                        Main.tile[i, j].frameY = 0x9a;
                    }
                    if (Main.tile[i, j].frameNumber == 2)
                    {
                        Main.tile[i, j].frameX = 0;
                        Main.tile[i, j].frameY = 0xb0;
                    }
                }
                else if (num5 != type)
                {
                    if (Main.tile[i, j].frameNumber == 0)
                    {
                        Main.tile[i, j].frameX = 0x42;
                        Main.tile[i, j].frameY = 0x84;
                    }
                    if (Main.tile[i, j].frameNumber == 1)
                    {
                        Main.tile[i, j].frameX = 0x42;
                        Main.tile[i, j].frameY = 0x9a;
                    }
                    if (Main.tile[i, j].frameNumber == 2)
                    {
                        Main.tile[i, j].frameX = 0x42;
                        Main.tile[i, j].frameY = 0xb0;
                    }
                }
                else
                {
                    if (Main.tile[i, j].frameNumber == 0)
                    {
                        Main.tile[i, j].frameX = 0x58;
                        Main.tile[i, j].frameY = 0x84;
                    }
                    if (Main.tile[i, j].frameNumber == 1)
                    {
                        Main.tile[i, j].frameX = 0x58;
                        Main.tile[i, j].frameY = 0x9a;
                    }
                    if (Main.tile[i, j].frameNumber == 2)
                    {
                        Main.tile[i, j].frameX = 0x58;
                        Main.tile[i, j].frameY = 0xb0;
                    }
                }
            }
            if (((Main.tile[i, j].frameX == 0x42) && (((Main.tile[i, j].frameY == 0) || (Main.tile[i, j].frameY == 0x16)) || (Main.tile[i, j].frameY == 0x2c))) || ((Main.tile[i, j].frameX == 0x2c) && (((Main.tile[i, j].frameY == 0xc6) || (Main.tile[i, j].frameY == 220)) || (Main.tile[i, j].frameY == 0xf2))))
            {
                if (num5 != type)
                {
                    KillTile(i, j, false, false, false);
                }
            }
            else if (((Main.tile[i, j].frameX == 0x58) && (((Main.tile[i, j].frameY == 0x42) || (Main.tile[i, j].frameY == 0x58)) || (Main.tile[i, j].frameY == 110))) || ((Main.tile[i, j].frameX == 0x42) && (((Main.tile[i, j].frameY == 0xc6) || (Main.tile[i, j].frameY == 220)) || (Main.tile[i, j].frameY == 0xf2))))
            {
                if (num4 != type)
                {
                    KillTile(i, j, false, false, false);
                }
            }
            else if ((num7 == -1) || (num7 == 0x17))
            {
                KillTile(i, j, false, false, false);
            }
            else if (((num2 != type) && (Main.tile[i, j].frameY < 0xc6)) && (((Main.tile[i, j].frameX != 0x16) && (Main.tile[i, j].frameX != 0x2c)) || (Main.tile[i, j].frameY < 0x84)))
            {
                if ((num4 == type) || (num5 == type))
                {
                    if (num7 == type)
                    {
                        if ((num4 == type) && (num5 == type))
                        {
                            if (Main.tile[i, j].frameNumber == 0)
                            {
                                Main.tile[i, j].frameX = 0x84;
                                Main.tile[i, j].frameY = 0x84;
                            }
                            if (Main.tile[i, j].frameNumber == 1)
                            {
                                Main.tile[i, j].frameX = 0x84;
                                Main.tile[i, j].frameY = 0x9a;
                            }
                            if (Main.tile[i, j].frameNumber == 2)
                            {
                                Main.tile[i, j].frameX = 0x84;
                                Main.tile[i, j].frameY = 0xb0;
                            }
                        }
                        else if (num4 == type)
                        {
                            if (Main.tile[i, j].frameNumber == 0)
                            {
                                Main.tile[i, j].frameX = 0x84;
                                Main.tile[i, j].frameY = 0;
                            }
                            if (Main.tile[i, j].frameNumber == 1)
                            {
                                Main.tile[i, j].frameX = 0x84;
                                Main.tile[i, j].frameY = 0x16;
                            }
                            if (Main.tile[i, j].frameNumber == 2)
                            {
                                Main.tile[i, j].frameX = 0x84;
                                Main.tile[i, j].frameY = 0x2c;
                            }
                        }
                        else if (num5 == type)
                        {
                            if (Main.tile[i, j].frameNumber == 0)
                            {
                                Main.tile[i, j].frameX = 0x84;
                                Main.tile[i, j].frameY = 0x42;
                            }
                            if (Main.tile[i, j].frameNumber == 1)
                            {
                                Main.tile[i, j].frameX = 0x84;
                                Main.tile[i, j].frameY = 0x58;
                            }
                            if (Main.tile[i, j].frameNumber == 2)
                            {
                                Main.tile[i, j].frameX = 0x84;
                                Main.tile[i, j].frameY = 110;
                            }
                        }
                    }
                    else if ((num4 == type) && (num5 == type))
                    {
                        if (Main.tile[i, j].frameNumber == 0)
                        {
                            Main.tile[i, j].frameX = 0x9a;
                            Main.tile[i, j].frameY = 0x84;
                        }
                        if (Main.tile[i, j].frameNumber == 1)
                        {
                            Main.tile[i, j].frameX = 0x9a;
                            Main.tile[i, j].frameY = 0x9a;
                        }
                        if (Main.tile[i, j].frameNumber == 2)
                        {
                            Main.tile[i, j].frameX = 0x9a;
                            Main.tile[i, j].frameY = 0xb0;
                        }
                    }
                    else if (num4 == type)
                    {
                        if (Main.tile[i, j].frameNumber == 0)
                        {
                            Main.tile[i, j].frameX = 0x9a;
                            Main.tile[i, j].frameY = 0;
                        }
                        if (Main.tile[i, j].frameNumber == 1)
                        {
                            Main.tile[i, j].frameX = 0x9a;
                            Main.tile[i, j].frameY = 0x16;
                        }
                        if (Main.tile[i, j].frameNumber == 2)
                        {
                            Main.tile[i, j].frameX = 0x9a;
                            Main.tile[i, j].frameY = 0x2c;
                        }
                    }
                    else if (num5 == type)
                    {
                        if (Main.tile[i, j].frameNumber == 0)
                        {
                            Main.tile[i, j].frameX = 0x9a;
                            Main.tile[i, j].frameY = 0x42;
                        }
                        if (Main.tile[i, j].frameNumber == 1)
                        {
                            Main.tile[i, j].frameX = 0x9a;
                            Main.tile[i, j].frameY = 0x58;
                        }
                        if (Main.tile[i, j].frameNumber == 2)
                        {
                            Main.tile[i, j].frameX = 0x9a;
                            Main.tile[i, j].frameY = 110;
                        }
                    }
                }
                else
                {
                    if (Main.tile[i, j].frameNumber == 0)
                    {
                        Main.tile[i, j].frameX = 110;
                        Main.tile[i, j].frameY = 0;
                    }
                    if (Main.tile[i, j].frameNumber == 1)
                    {
                        Main.tile[i, j].frameX = 110;
                        Main.tile[i, j].frameY = 0x16;
                    }
                    if (Main.tile[i, j].frameNumber == 2)
                    {
                        Main.tile[i, j].frameX = 110;
                        Main.tile[i, j].frameY = 0x2c;
                    }
                }
            }
            if (((Main.tile[i, j].frameX != frameX) && (Main.tile[i, j].frameY != frameY)) && ((frameX >= 0) && (frameY >= 0)))
            {
                TileFrame(i - 1, j, false, false);
                TileFrame(i + 1, j, false, false);
                TileFrame(i, j - 1, false, false);
                TileFrame(i, j + 1, false, false);
            }
        }

        public static void clearWorld()
        {
            totalSolid2 = 0;
            totalGood2 = 0;
            totalEvil2 = 0;
            totalSolid = 0;
            totalGood = 0;
            totalEvil = 0;
            totalX = 0;
            totalD = 0;
            tEvil = 0;
            tGood = 0;
            NPC.clrNames();
            Main.trashItem = new Item();
            spawnEye = false;
            spawnNPC = 0;
            shadowOrbCount = 0;
            altarCount = 0;
            Main.hardMode = false;
            Main.helpText = 0;
            Main.dungeonX = 0;
            Main.dungeonY = 0;
            NPC.downedBoss1 = false;
            NPC.downedBoss2 = false;
            NPC.downedBoss3 = false;
            NPC.savedGoblin = false;
            NPC.savedWizard = false;
            NPC.savedMech = false;
            NPC.downedGoblins = false;
            NPC.downedClown = false;
            shadowOrbSmashed = false;
            spawnMeteor = false;
            stopDrops = false;
            Main.invasionDelay = 0;
            Main.invasionType = 0;
            Main.invasionSize = 0;
            Main.invasionWarn = 0;
            Main.invasionX = 0.0;
            Main.invasionDefeat = false;
            noLiquidCheck = false;
            Liquid.numLiquid = 0;
            LiquidBuffer.numLiquidBuffer = 0;
            if (((Main.netMode == 1) || (lastMaxTilesX > Main.maxTilesX)) || (lastMaxTilesY > Main.maxTilesY))
            {
                for (int num = 0; num < lastMaxTilesX; num++)
                {
                    float num2 = ((float) num) / ((float) lastMaxTilesX);
                    Main.statusText = "Freeing unused resources: " + ((int) ((num2 * 100f) + 1f)) + "%";
                    for (int num3 = 0; num3 < lastMaxTilesY; num3++)
                    {
                        Main.tile[num, num3] = null;
                    }
                }
            }
            lastMaxTilesX = Main.maxTilesX;
            lastMaxTilesY = Main.maxTilesY;
            if (Main.netMode != 1)
            {
                for (int num4 = 0; num4 < Main.maxTilesX; num4++)
                {
                    float num5 = ((float) num4) / ((float) Main.maxTilesX);
                    Main.statusText = "Resetting game objects: " + ((int) ((num5 * 100f) + 1f)) + "%";
                    for (int num6 = 0; num6 < Main.maxTilesY; num6++)
                    {
                        Main.tile[num4, num6] = new Tile();
                    }
                }
            }
            for (int i = 0; i < 0x7d0; i++)
            {
                Main.dust[i] = new Dust();
            }
            for (int j = 0; j < 200; j++)
            {
                Main.gore[j] = new Gore();
            }
            for (int k = 0; k < 200; k++)
            {
                Main.item[k] = new Item();
            }
            for (int m = 0; m < 200; m++)
            {
                Main.npc[m] = new NPC();
            }
            for (int n = 0; n < 0x3e8; n++)
            {
                Main.projectile[n] = new Projectile();
            }
            for (int num12 = 0; num12 < 0x3e8; num12++)
            {
                Main.chest[num12] = null;
            }
            for (int num13 = 0; num13 < 0x3e8; num13++)
            {
                Main.sign[num13] = null;
            }
            for (int num14 = 0; num14 < Liquid.resLiquid; num14++)
            {
                Main.liquid[num14] = new Liquid();
            }
            for (int num15 = 0; num15 < 0x2710; num15++)
            {
                Main.liquidBuffer[num15] = new LiquidBuffer();
            }
            setWorldSize();
            worldCleared = true;
        }

        public static bool CloseDoor(int i, int j, bool forced = false)
        {
            int num = 0;
            int num2 = i;
            int num3 = j;
            if (Main.tile[i, j] == null)
            {
                Main.tile[i, j] = new Tile();
            }
            int frameX = Main.tile[i, j].frameX;
            int frameY = Main.tile[i, j].frameY;
            switch (frameX)
            {
                case 0:
                    num2 = i;
                    num = 1;
                    break;

                case 0x12:
                    num2 = i - 1;
                    num = 1;
                    break;

                case 0x24:
                    num2 = i + 1;
                    num = -1;
                    break;

                case 0x36:
                    num2 = i;
                    num = -1;
                    break;
            }
            switch (frameY)
            {
                case 0:
                    num3 = j;
                    break;

                case 0x12:
                    num3 = j - 1;
                    break;

                case 0x24:
                    num3 = j - 2;
                    break;
            }
            int num6 = num2;
            if (num == -1)
            {
                num6 = num2 - 1;
            }
            if (!forced)
            {
                for (int n = num3; n < (num3 + 3); n++)
                {
                    if (!Collision.EmptyTile(num2, n, true))
                    {
                        return false;
                    }
                }
            }
            for (int k = num6; k < (num6 + 2); k++)
            {
                for (int num9 = num3; num9 < (num3 + 3); num9++)
                {
                    if (k == num2)
                    {
                        if (Main.tile[k, num9] == null)
                        {
                            Main.tile[k, num9] = new Tile();
                        }
                        Main.tile[k, num9].type = 10;
                        Main.tile[k, num9].frameX = (short) (genRand.Next(3) * 0x12);
                    }
                    else
                    {
                        if (Main.tile[k, num9] == null)
                        {
                            Main.tile[k, num9] = new Tile();
                        }
                        Main.tile[k, num9].active = false;
                    }
                }
            }
            if (Main.netMode != 1)
            {
                int num10 = num2;
                for (int num11 = num3; num11 <= (num3 + 2); num11++)
                {
                    if (numNoWire < (maxWire - 1))
                    {
                        noWireX[numNoWire] = num10;
                        noWireY[numNoWire] = num11;
                        numNoWire++;
                    }
                }
            }
            for (int m = num2 - 1; m <= (num2 + 1); m++)
            {
                for (int num13 = num3 - 1; num13 <= (num3 + 2); num13++)
                {
                    TileFrame(m, num13, false, false);
                }
            }
            Main.PlaySound(9, i * 0x10, j * 0x10, 1);
            return true;
        }

        public static void CountTiles(int X)
        {
            if (X == 0)
            {
                totalEvil = totalEvil2;
                totalSolid = totalSolid2;
                totalGood = totalGood2;
                float num = ((float) totalGood) / ((float) totalSolid);
                num = (float) Math.Round((double) (num * 100f));
                float num2 = ((float) totalEvil) / ((float) totalSolid);
                num2 = (float) Math.Round((double) (num2 * 100f));
                tGood = (byte) num;
                tEvil = (byte) num2;
                if (Main.netMode == 2)
                {
                    NetMessage.SendData(0x39, -1, -1, "", 0, 0f, 0f, 0f, 0);
                }
            }
            for (int i = 0; i < Main.maxTilesY; i++)
            {
                int num4 = 1;
                if (i <= Main.worldSurface)
                {
                    num4 *= 5;
                }
                if (SolidTile(X, i))
                {
                    if (((Main.tile[X, i].type == 0x6d) || (Main.tile[X, i].type == 0x74)) || (Main.tile[X, i].type == 0x75))
                    {
                        totalGood2 += num4;
                    }
                    else if (((Main.tile[X, i].type == 0x17) || (Main.tile[X, i].type == 0x19)) || (Main.tile[X, i].type == 0x70))
                    {
                        totalEvil2 += num4;
                    }
                    totalSolid2 += num4;
                }
            }
        }

        public static void CreateNewWorld()
        {
            ThreadPool.QueueUserWorkItem(new WaitCallback(WorldGen.worldGenCallBack), 1);
        }

        public static Vector2 digTunnel(float X, float Y, float xDir, float yDir, int Steps, int Size, bool Wet = false)
        {
            float x = X;
            float y = Y;
            try
            {
                float num3 = 0f;
                float num4 = 0f;
                int num5 = Steps;
                float num6 = Size;
                for (int i = 0; i < num5; i++)
                {
                    for (int j = (int) (x - num6); j <= (x + num6); j++)
                    {
                        for (int k = (int) (y - num6); k <= (y + num6); k++)
                        {
                            if ((Math.Abs((float) (j - x)) + Math.Abs((float) (k - y))) < (num6 * (1.0 + (genRand.Next(-10, 11) * 0.005))))
                            {
                                Main.tile[j, k].active = false;
                                if (Wet)
                                {
                                    Main.tile[j, k].liquid = 0xff;
                                }
                            }
                        }
                    }
                    num6 += genRand.Next(-50, 0x33) * 0.03f;
                    if (num6 < (Size * 0.6))
                    {
                        num6 = Size * 0.6f;
                    }
                    if (num6 > (Size * 2))
                    {
                        num6 = Size * 2f;
                    }
                    num3 += genRand.Next(-20, 0x15) * 0.01f;
                    num4 += genRand.Next(-20, 0x15) * 0.01f;
                    if (num3 < -1f)
                    {
                        num3 = -1f;
                    }
                    if (num3 > 1f)
                    {
                        num3 = 1f;
                    }
                    if (num4 < -1f)
                    {
                        num4 = -1f;
                    }
                    if (num4 > 1f)
                    {
                        num4 = 1f;
                    }
                    x += (xDir + num3) * 0.6f;
                    y += (yDir + num4) * 0.6f;
                }
            }
            catch
            {
            }
            return new Vector2(x, y);
        }

        public static void dropMeteor()
        {
            bool flag = true;
            int num = 0;
            if (Main.netMode != 1)
            {
                for (int i = 0; i < 0xff; i++)
                {
                    if (Main.player[i].active)
                    {
                        flag = false;
                        break;
                    }
                }
                int num3 = 0;
                float num4 = Main.maxTilesX / 0x1068;
                int num5 = (int) (400f * num4);
                for (int j = 5; j < (Main.maxTilesX - 5); j++)
                {
                    for (int k = 5; k < Main.worldSurface; k++)
                    {
                        if (Main.tile[j, k].active && (Main.tile[j, k].type == 0x25))
                        {
                            num3++;
                            if (num3 > num5)
                            {
                                return;
                            }
                        }
                    }
                }
                while (!flag)
                {
                    float num8 = Main.maxTilesX * 0.08f;
                    int num9 = Main.rand.Next(50, Main.maxTilesX - 50);
                    while ((num9 > (Main.spawnTileX - num8)) && (num9 < (Main.spawnTileX + num8)))
                    {
                        num9 = Main.rand.Next(50, Main.maxTilesX - 50);
                    }
                    for (int m = Main.rand.Next(100); m < Main.maxTilesY; m++)
                    {
                        if (Main.tile[num9, m].active && Main.tileSolid[Main.tile[num9, m].type])
                        {
                            flag = meteor(num9, m);
                            break;
                        }
                    }
                    num++;
                    if (num >= 100)
                    {
                        return;
                    }
                }
            }
        }

        public static void DungeonEnt(int i, int j, int tileType, int wallType)
        {
            Vector2 vector;
            int num = 60;
            for (int k = i - num; k < (i + num); k++)
            {
                for (int num3 = j - num; num3 < (j + num); num3++)
                {
                    Main.tile[k, num3].liquid = 0;
                    Main.tile[k, num3].lava = false;
                }
            }
            double num8 = dxStrength1;
            double num9 = dyStrength1;
            vector.X = i;
            vector.Y = j - (((float) num9) / 2f);
            dMinY = (int) vector.Y;
            int num10 = 1;
            if (i > (Main.maxTilesX / 2))
            {
                num10 = -1;
            }
            int num4 = ((int) (vector.X - (num8 * 0.60000002384185791))) - genRand.Next(2, 5);
            int maxTilesX = ((int) (vector.X + (num8 * 0.60000002384185791))) + genRand.Next(2, 5);
            int num5 = ((int) (vector.Y - (num9 * 0.60000002384185791))) - genRand.Next(2, 5);
            int maxTilesY = ((int) (vector.Y + (num9 * 0.60000002384185791))) + genRand.Next(8, 0x10);
            if (num4 < 0)
            {
                num4 = 0;
            }
            if (maxTilesX > Main.maxTilesX)
            {
                maxTilesX = Main.maxTilesX;
            }
            if (num5 < 0)
            {
                num5 = 0;
            }
            if (maxTilesY > Main.maxTilesY)
            {
                maxTilesY = Main.maxTilesY;
            }
            for (int m = num4; m < maxTilesX; m++)
            {
                for (int num12 = num5; num12 < maxTilesY; num12++)
                {
                    Main.tile[m, num12].liquid = 0;
                    if (Main.tile[m, num12].wall != wallType)
                    {
                        Main.tile[m, num12].wall = 0;
                        if (((m > (num4 + 1)) && (m < (maxTilesX - 2))) && ((num12 > (num5 + 1)) && (num12 < (maxTilesY - 2))))
                        {
                            PlaceWall(m, num12, wallType, true);
                        }
                        Main.tile[m, num12].active = true;
                        Main.tile[m, num12].type = (byte) tileType;
                    }
                }
            }
            int num13 = num4;
            int num14 = (num4 + 5) + genRand.Next(4);
            int num15 = (num5 - 3) - genRand.Next(3);
            int num16 = num5;
            for (int n = num13; n < num14; n++)
            {
                for (int num18 = num15; num18 < num16; num18++)
                {
                    if (Main.tile[n, num18].wall != wallType)
                    {
                        Main.tile[n, num18].active = true;
                        Main.tile[n, num18].type = (byte) tileType;
                    }
                }
            }
            num13 = (maxTilesX - 5) - genRand.Next(4);
            num14 = maxTilesX;
            num15 = (num5 - 3) - genRand.Next(3);
            num16 = num5;
            for (int num19 = num13; num19 < num14; num19++)
            {
                for (int num20 = num15; num20 < num16; num20++)
                {
                    if (Main.tile[num19, num20].wall != wallType)
                    {
                        Main.tile[num19, num20].active = true;
                        Main.tile[num19, num20].type = (byte) tileType;
                    }
                }
            }
            int num21 = 1 + genRand.Next(2);
            int num22 = 2 + genRand.Next(4);
            int num23 = 0;
            for (int num24 = num4; num24 < maxTilesX; num24++)
            {
                for (int num25 = num5 - num21; num25 < num5; num25++)
                {
                    if (Main.tile[num24, num25].wall != wallType)
                    {
                        Main.tile[num24, num25].active = true;
                        Main.tile[num24, num25].type = (byte) tileType;
                    }
                }
                num23++;
                if (num23 >= num22)
                {
                    num24 += num22;
                    num23 = 0;
                }
            }
            for (int num26 = num4; num26 < maxTilesX; num26++)
            {
                for (int num27 = maxTilesY; num27 < (maxTilesY + 100); num27++)
                {
                    PlaceWall(num26, num27, 2, true);
                }
            }
            num4 = (int) (vector.X - (num8 * 0.60000002384185791));
            maxTilesX = (int) (vector.X + (num8 * 0.60000002384185791));
            num5 = (int) (vector.Y - (num9 * 0.60000002384185791));
            maxTilesY = (int) (vector.Y + (num9 * 0.60000002384185791));
            if (num4 < 0)
            {
                num4 = 0;
            }
            if (maxTilesX > Main.maxTilesX)
            {
                maxTilesX = Main.maxTilesX;
            }
            if (num5 < 0)
            {
                num5 = 0;
            }
            if (maxTilesY > Main.maxTilesY)
            {
                maxTilesY = Main.maxTilesY;
            }
            for (int num28 = num4; num28 < maxTilesX; num28++)
            {
                for (int num29 = num5; num29 < maxTilesY; num29++)
                {
                    PlaceWall(num28, num29, wallType, true);
                }
            }
            num4 = (int) ((vector.X - (num8 * 0.6)) - 1.0);
            maxTilesX = (int) ((vector.X + (num8 * 0.6)) + 1.0);
            num5 = (int) ((vector.Y - (num9 * 0.6)) - 1.0);
            maxTilesY = (int) ((vector.Y + (num9 * 0.6)) + 1.0);
            if (num4 < 0)
            {
                num4 = 0;
            }
            if (maxTilesX > Main.maxTilesX)
            {
                maxTilesX = Main.maxTilesX;
            }
            if (num5 < 0)
            {
                num5 = 0;
            }
            if (maxTilesY > Main.maxTilesY)
            {
                maxTilesY = Main.maxTilesY;
            }
            for (int num30 = num4; num30 < maxTilesX; num30++)
            {
                for (int num31 = num5; num31 < maxTilesY; num31++)
                {
                    Main.tile[num30, num31].wall = (byte) wallType;
                }
            }
            num4 = (int) (vector.X - (num8 * 0.5));
            maxTilesX = (int) (vector.X + (num8 * 0.5));
            num5 = (int) (vector.Y - (num9 * 0.5));
            maxTilesY = (int) (vector.Y + (num9 * 0.5));
            if (num4 < 0)
            {
                num4 = 0;
            }
            if (maxTilesX > Main.maxTilesX)
            {
                maxTilesX = Main.maxTilesX;
            }
            if (num5 < 0)
            {
                num5 = 0;
            }
            if (maxTilesY > Main.maxTilesY)
            {
                maxTilesY = Main.maxTilesY;
            }
            for (int num32 = num4; num32 < maxTilesX; num32++)
            {
                for (int num33 = num5; num33 < maxTilesY; num33++)
                {
                    Main.tile[num32, num33].active = false;
                    Main.tile[num32, num33].wall = (byte) wallType;
                }
            }
            DPlatX[numDPlats] = (int) vector.X;
            DPlatY[numDPlats] = maxTilesY;
            numDPlats++;
            vector.X += (((float) num8) * 0.6f) * num10;
            vector.Y += ((float) num9) * 0.5f;
            num8 = dxStrength2;
            num9 = dyStrength2;
            vector.X += (((float) num8) * 0.55f) * num10;
            vector.Y -= ((float) num9) * 0.5f;
            num4 = ((int) (vector.X - (num8 * 0.60000002384185791))) - genRand.Next(1, 3);
            maxTilesX = ((int) (vector.X + (num8 * 0.60000002384185791))) + genRand.Next(1, 3);
            num5 = ((int) (vector.Y - (num9 * 0.60000002384185791))) - genRand.Next(1, 3);
            maxTilesY = ((int) (vector.Y + (num9 * 0.60000002384185791))) + genRand.Next(6, 0x10);
            if (num4 < 0)
            {
                num4 = 0;
            }
            if (maxTilesX > Main.maxTilesX)
            {
                maxTilesX = Main.maxTilesX;
            }
            if (num5 < 0)
            {
                num5 = 0;
            }
            if (maxTilesY > Main.maxTilesY)
            {
                maxTilesY = Main.maxTilesY;
            }
            for (int num34 = num4; num34 < maxTilesX; num34++)
            {
                for (int num35 = num5; num35 < maxTilesY; num35++)
                {
                    if (Main.tile[num34, num35].wall != wallType)
                    {
                        bool flag = true;
                        if (num10 < 0)
                        {
                            if (num34 < (vector.X - (num8 * 0.5)))
                            {
                                flag = false;
                            }
                        }
                        else if (num34 > ((vector.X + (num8 * 0.5)) - 1.0))
                        {
                            flag = false;
                        }
                        if (flag)
                        {
                            Main.tile[num34, num35].wall = 0;
                            Main.tile[num34, num35].active = true;
                            Main.tile[num34, num35].type = (byte) tileType;
                        }
                    }
                }
            }
            for (int num36 = num4; num36 < maxTilesX; num36++)
            {
                for (int num37 = maxTilesY; num37 < (maxTilesY + 100); num37++)
                {
                    PlaceWall(num36, num37, 2, true);
                }
            }
            num4 = (int) (vector.X - (num8 * 0.5));
            maxTilesX = (int) (vector.X + (num8 * 0.5));
            num13 = num4;
            if (num10 < 0)
            {
                num13++;
            }
            num14 = (num13 + 5) + genRand.Next(4);
            num15 = (num5 - 3) - genRand.Next(3);
            num16 = num5;
            for (int num38 = num13; num38 < num14; num38++)
            {
                for (int num39 = num15; num39 < num16; num39++)
                {
                    if (Main.tile[num38, num39].wall != wallType)
                    {
                        Main.tile[num38, num39].active = true;
                        Main.tile[num38, num39].type = (byte) tileType;
                    }
                }
            }
            num13 = (maxTilesX - 5) - genRand.Next(4);
            num14 = maxTilesX;
            num15 = (num5 - 3) - genRand.Next(3);
            num16 = num5;
            for (int num40 = num13; num40 < num14; num40++)
            {
                for (int num41 = num15; num41 < num16; num41++)
                {
                    if (Main.tile[num40, num41].wall != wallType)
                    {
                        Main.tile[num40, num41].active = true;
                        Main.tile[num40, num41].type = (byte) tileType;
                    }
                }
            }
            num21 = 1 + genRand.Next(2);
            num22 = 2 + genRand.Next(4);
            num23 = 0;
            if (num10 < 0)
            {
                maxTilesX++;
            }
            for (int num42 = num4 + 1; num42 < (maxTilesX - 1); num42++)
            {
                for (int num43 = num5 - num21; num43 < num5; num43++)
                {
                    if (Main.tile[num42, num43].wall != wallType)
                    {
                        Main.tile[num42, num43].active = true;
                        Main.tile[num42, num43].type = (byte) tileType;
                    }
                }
                num23++;
                if (num23 >= num22)
                {
                    num42 += num22;
                    num23 = 0;
                }
            }
            num4 = (int) (vector.X - (num8 * 0.6));
            maxTilesX = (int) (vector.X + (num8 * 0.6));
            num5 = (int) (vector.Y - (num9 * 0.6));
            maxTilesY = (int) (vector.Y + (num9 * 0.6));
            if (num4 < 0)
            {
                num4 = 0;
            }
            if (maxTilesX > Main.maxTilesX)
            {
                maxTilesX = Main.maxTilesX;
            }
            if (num5 < 0)
            {
                num5 = 0;
            }
            if (maxTilesY > Main.maxTilesY)
            {
                maxTilesY = Main.maxTilesY;
            }
            for (int num44 = num4; num44 < maxTilesX; num44++)
            {
                for (int num45 = num5; num45 < maxTilesY; num45++)
                {
                    Main.tile[num44, num45].wall = 0;
                }
            }
            num4 = (int) (vector.X - (num8 * 0.5));
            maxTilesX = (int) (vector.X + (num8 * 0.5));
            num5 = (int) (vector.Y - (num9 * 0.5));
            maxTilesY = (int) (vector.Y + (num9 * 0.5));
            if (num4 < 0)
            {
                num4 = 0;
            }
            if (maxTilesX > Main.maxTilesX)
            {
                maxTilesX = Main.maxTilesX;
            }
            if (num5 < 0)
            {
                num5 = 0;
            }
            if (maxTilesY > Main.maxTilesY)
            {
                maxTilesY = Main.maxTilesY;
            }
            for (int num46 = num4; num46 < maxTilesX; num46++)
            {
                for (int num47 = num5; num47 < maxTilesY; num47++)
                {
                    Main.tile[num46, num47].active = false;
                    Main.tile[num46, num47].wall = 0;
                }
            }
            for (int num48 = num4; num48 < maxTilesX; num48++)
            {
                if (!Main.tile[num48, maxTilesY].active)
                {
                    Main.tile[num48, maxTilesY].active = true;
                    Main.tile[num48, maxTilesY].type = 0x13;
                }
            }
            Main.dungeonX = (int) vector.X;
            Main.dungeonY = maxTilesY;
            int index = NPC.NewNPC((Main.dungeonX * 0x10) + 8, Main.dungeonY * 0x10, 0x25, 0);
            Main.npc[index].homeless = false;
            Main.npc[index].homeTileX = Main.dungeonX;
            Main.npc[index].homeTileY = Main.dungeonY;
            if (num10 == 1)
            {
                int num50 = 0;
                for (int num51 = maxTilesX; num51 < (maxTilesX + 0x19); num51++)
                {
                    num50++;
                    for (int num52 = maxTilesY + num50; num52 < (maxTilesY + 0x19); num52++)
                    {
                        Main.tile[num51, num52].active = true;
                        Main.tile[num51, num52].type = (byte) tileType;
                    }
                }
            }
            else
            {
                int num53 = 0;
                for (int num54 = num4; num54 > (num4 - 0x19); num54--)
                {
                    num53++;
                    for (int num55 = maxTilesY + num53; num55 < (maxTilesY + 0x19); num55++)
                    {
                        Main.tile[num54, num55].active = true;
                        Main.tile[num54, num55].type = (byte) tileType;
                    }
                }
            }
            num21 = 1 + genRand.Next(2);
            num22 = 2 + genRand.Next(4);
            num23 = 0;
            num4 = (int) (vector.X - (num8 * 0.5));
            maxTilesX = (int) (vector.X + (num8 * 0.5));
            num4 += 2;
            maxTilesX -= 2;
            for (int num56 = num4; num56 < maxTilesX; num56++)
            {
                for (int num57 = num5; num57 < maxTilesY; num57++)
                {
                    PlaceWall(num56, num57, wallType, true);
                }
                num23++;
                if (num23 >= num22)
                {
                    num56 += num22 * 2;
                    num23 = 0;
                }
            }
            vector.X -= (((float) num8) * 0.6f) * num10;
            vector.Y += ((float) num9) * 0.5f;
            num8 = 15.0;
            num9 = 3.0;
            vector.Y -= ((float) num9) * 0.5f;
            num4 = (int) (vector.X - (num8 * 0.5));
            maxTilesX = (int) (vector.X + (num8 * 0.5));
            num5 = (int) (vector.Y - (num9 * 0.5));
            maxTilesY = (int) (vector.Y + (num9 * 0.5));
            if (num4 < 0)
            {
                num4 = 0;
            }
            if (maxTilesX > Main.maxTilesX)
            {
                maxTilesX = Main.maxTilesX;
            }
            if (num5 < 0)
            {
                num5 = 0;
            }
            if (maxTilesY > Main.maxTilesY)
            {
                maxTilesY = Main.maxTilesY;
            }
            for (int num58 = num4; num58 < maxTilesX; num58++)
            {
                for (int num59 = num5; num59 < maxTilesY; num59++)
                {
                    Main.tile[num58, num59].active = false;
                }
            }
            if (num10 < 0)
            {
                vector.X--;
            }
            PlaceTile((int) vector.X, ((int) vector.Y) + 1, 10, false, false, -1, 0);
        }

        public static void DungeonHalls(int i, int j, int tileType, int wallType, bool forceX = false)
        {
            Vector2 vector;
            Vector2 vector2 = new Vector2();
            double num5 = genRand.Next(4, 6);
            Vector2 vector3 = new Vector2();
            Vector2 vector4 = new Vector2();
            int num6 = 1;
            vector.X = i;
            vector.Y = j;
            int num7 = genRand.Next(0x23, 80);
            if (forceX)
            {
                num7 += 20;
                lastDungeonHall = new Vector2();
            }
            else if (genRand.Next(5) == 0)
            {
                num5 *= 2.0;
                num7 /= 2;
            }
            bool flag = false;
            while (!flag)
            {
                if (genRand.Next(2) == 0)
                {
                    num6 = -1;
                }
                else
                {
                    num6 = 1;
                }
                bool flag2 = false;
                if (genRand.Next(2) == 0)
                {
                    flag2 = true;
                }
                if (forceX)
                {
                    flag2 = true;
                }
                if (flag2)
                {
                    vector3.Y = 0f;
                    vector3.X = num6;
                    vector4.Y = 0f;
                    vector4.X = -num6;
                    vector2.Y = 0f;
                    vector2.X = num6;
                    if (genRand.Next(3) == 0)
                    {
                        if (genRand.Next(2) == 0)
                        {
                            vector2.Y = -0.2f;
                        }
                        else
                        {
                            vector2.Y = 0.2f;
                        }
                    }
                }
                else
                {
                    num5++;
                    vector2.Y = num6;
                    vector2.X = 0f;
                    vector3.X = 0f;
                    vector3.Y = num6;
                    vector4.X = 0f;
                    vector4.Y = -num6;
                    if (genRand.Next(2) == 0)
                    {
                        if (genRand.Next(2) == 0)
                        {
                            vector2.X = 0.3f;
                        }
                        else
                        {
                            vector2.X = -0.3f;
                        }
                    }
                    else
                    {
                        num7 /= 2;
                    }
                }
                if (lastDungeonHall != vector4)
                {
                    flag = true;
                }
            }
            if (!forceX)
            {
                if (vector.X > (lastMaxTilesX - 200))
                {
                    num6 = -1;
                    vector3.Y = 0f;
                    vector3.X = num6;
                    vector2.Y = 0f;
                    vector2.X = num6;
                    if (genRand.Next(3) == 0)
                    {
                        if (genRand.Next(2) == 0)
                        {
                            vector2.Y = -0.2f;
                        }
                        else
                        {
                            vector2.Y = 0.2f;
                        }
                    }
                }
                else if (vector.X < 200f)
                {
                    num6 = 1;
                    vector3.Y = 0f;
                    vector3.X = num6;
                    vector2.Y = 0f;
                    vector2.X = num6;
                    if (genRand.Next(3) == 0)
                    {
                        if (genRand.Next(2) == 0)
                        {
                            vector2.Y = -0.2f;
                        }
                        else
                        {
                            vector2.Y = 0.2f;
                        }
                    }
                }
                else if (vector.Y > (lastMaxTilesY - 300))
                {
                    num6 = -1;
                    num5++;
                    vector2.Y = num6;
                    vector2.X = 0f;
                    vector3.X = 0f;
                    vector3.Y = num6;
                    if (genRand.Next(2) == 0)
                    {
                        if (genRand.Next(2) == 0)
                        {
                            vector2.X = 0.3f;
                        }
                        else
                        {
                            vector2.X = -0.3f;
                        }
                    }
                }
                else if (vector.Y < Main.rockLayer)
                {
                    num6 = 1;
                    num5++;
                    vector2.Y = num6;
                    vector2.X = 0f;
                    vector3.X = 0f;
                    vector3.Y = num6;
                    if (genRand.Next(2) == 0)
                    {
                        if (genRand.Next(2) == 0)
                        {
                            vector2.X = 0.3f;
                        }
                        else
                        {
                            vector2.X = -0.3f;
                        }
                    }
                }
                else if ((vector.X < (Main.maxTilesX / 2)) && (vector.X > (Main.maxTilesX * 0.25)))
                {
                    num6 = -1;
                    vector3.Y = 0f;
                    vector3.X = num6;
                    vector2.Y = 0f;
                    vector2.X = num6;
                    if (genRand.Next(3) == 0)
                    {
                        if (genRand.Next(2) == 0)
                        {
                            vector2.Y = -0.2f;
                        }
                        else
                        {
                            vector2.Y = 0.2f;
                        }
                    }
                }
                else if ((vector.X > (Main.maxTilesX / 2)) && (vector.X < (Main.maxTilesX * 0.75)))
                {
                    num6 = 1;
                    vector3.Y = 0f;
                    vector3.X = num6;
                    vector2.Y = 0f;
                    vector2.X = num6;
                    if (genRand.Next(3) == 0)
                    {
                        if (genRand.Next(2) == 0)
                        {
                            vector2.Y = -0.2f;
                        }
                        else
                        {
                            vector2.Y = 0.2f;
                        }
                    }
                }
            }
            if (vector3.Y == 0f)
            {
                DDoorX[numDDoors] = (int) vector.X;
                DDoorY[numDDoors] = (int) vector.Y;
                DDoorPos[numDDoors] = 0;
                numDDoors++;
            }
            else
            {
                DPlatX[numDPlats] = (int) vector.X;
                DPlatY[numDPlats] = (int) vector.Y;
                numDPlats++;
            }
            lastDungeonHall = vector3;
            while (num7 > 0)
            {
                if ((vector3.X > 0f) && (vector.X > (Main.maxTilesX - 100)))
                {
                    num7 = 0;
                }
                else if ((vector3.X < 0f) && (vector.X < 100f))
                {
                    num7 = 0;
                }
                else if ((vector3.Y > 0f) && (vector.Y > (Main.maxTilesY - 100)))
                {
                    num7 = 0;
                }
                else if ((vector3.Y < 0f) && (vector.Y < (Main.rockLayer + 50.0)))
                {
                    num7 = 0;
                }
                num7--;
                int num = ((int) ((vector.X - num5) - 4.0)) - genRand.Next(6);
                int maxTilesX = ((int) ((vector.X + num5) + 4.0)) + genRand.Next(6);
                int num2 = ((int) ((vector.Y - num5) - 4.0)) - genRand.Next(6);
                int maxTilesY = ((int) ((vector.Y + num5) + 4.0)) + genRand.Next(6);
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                for (int k = num; k < maxTilesX; k++)
                {
                    for (int num9 = num2; num9 < maxTilesY; num9++)
                    {
                        Main.tile[k, num9].liquid = 0;
                        if (Main.tile[k, num9].wall == 0)
                        {
                            Main.tile[k, num9].active = true;
                            Main.tile[k, num9].type = (byte) tileType;
                        }
                    }
                }
                for (int m = num + 1; m < (maxTilesX - 1); m++)
                {
                    for (int num11 = num2 + 1; num11 < (maxTilesY - 1); num11++)
                    {
                        PlaceWall(m, num11, wallType, true);
                    }
                }
                int num12 = 0;
                if ((vector2.Y == 0f) && (genRand.Next(((int) num5) + 1) == 0))
                {
                    num12 = genRand.Next(1, 3);
                }
                else if ((vector2.X == 0f) && (genRand.Next(((int) num5) - 1) == 0))
                {
                    num12 = genRand.Next(1, 3);
                }
                else if (genRand.Next(((int) num5) * 3) == 0)
                {
                    num12 = genRand.Next(1, 3);
                }
                num = ((int) (vector.X - (num5 * 0.5))) - num12;
                maxTilesX = ((int) (vector.X + (num5 * 0.5))) + num12;
                num2 = ((int) (vector.Y - (num5 * 0.5))) - num12;
                maxTilesY = ((int) (vector.Y + (num5 * 0.5))) + num12;
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                for (int n = num; n < maxTilesX; n++)
                {
                    for (int num14 = num2; num14 < maxTilesY; num14++)
                    {
                        Main.tile[n, num14].active = false;
                        Main.tile[n, num14].wall = (byte) wallType;
                    }
                }
                vector += vector2;
            }
            dungeonX = (int) vector.X;
            dungeonY = (int) vector.Y;
            if (vector3.Y == 0f)
            {
                DDoorX[numDDoors] = (int) vector.X;
                DDoorY[numDDoors] = (int) vector.Y;
                DDoorPos[numDDoors] = 0;
                numDDoors++;
            }
            else
            {
                DPlatX[numDPlats] = (int) vector.X;
                DPlatY[numDPlats] = (int) vector.Y;
                numDPlats++;
            }
        }

        public static void DungeonRoom(int i, int j, int tileType, int wallType)
        {
            Vector2 vector;
            Vector2 vector2;
            double num5 = genRand.Next(15, 30);
            vector2.X = genRand.Next(-10, 11) * 0.1f;
            vector2.Y = genRand.Next(-10, 11) * 0.1f;
            vector.X = i;
            vector.Y = j - (((float) num5) / 2f);
            int num6 = genRand.Next(10, 20);
            double x = vector.X;
            double num8 = vector.X;
            double y = vector.Y;
            double num10 = vector.Y;
            while (num6 > 0)
            {
                num6--;
                int num = (int) ((vector.X - (num5 * 0.800000011920929)) - 5.0);
                int maxTilesX = (int) ((vector.X + (num5 * 0.800000011920929)) + 5.0);
                int num2 = (int) ((vector.Y - (num5 * 0.800000011920929)) - 5.0);
                int maxTilesY = (int) ((vector.Y + (num5 * 0.800000011920929)) + 5.0);
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                for (int k = num; k < maxTilesX; k++)
                {
                    for (int num12 = num2; num12 < maxTilesY; num12++)
                    {
                        Main.tile[k, num12].liquid = 0;
                        if (Main.tile[k, num12].wall == 0)
                        {
                            Main.tile[k, num12].active = true;
                            Main.tile[k, num12].type = (byte) tileType;
                        }
                    }
                }
                for (int m = num + 1; m < (maxTilesX - 1); m++)
                {
                    for (int num14 = num2 + 1; num14 < (maxTilesY - 1); num14++)
                    {
                        PlaceWall(m, num14, wallType, true);
                    }
                }
                num = (int) (vector.X - (num5 * 0.5));
                maxTilesX = (int) (vector.X + (num5 * 0.5));
                num2 = (int) (vector.Y - (num5 * 0.5));
                maxTilesY = (int) (vector.Y + (num5 * 0.5));
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                if (num < x)
                {
                    x = num;
                }
                if (maxTilesX > num8)
                {
                    num8 = maxTilesX;
                }
                if (num2 < y)
                {
                    y = num2;
                }
                if (maxTilesY > num10)
                {
                    num10 = maxTilesY;
                }
                for (int n = num; n < maxTilesX; n++)
                {
                    for (int num16 = num2; num16 < maxTilesY; num16++)
                    {
                        Main.tile[n, num16].active = false;
                        Main.tile[n, num16].wall = (byte) wallType;
                    }
                }
                vector += vector2;
                vector2.X += genRand.Next(-10, 11) * 0.05f;
                vector2.Y += genRand.Next(-10, 11) * 0.05f;
                if (vector2.X > 1f)
                {
                    vector2.X = 1f;
                }
                if (vector2.X < -1f)
                {
                    vector2.X = -1f;
                }
                if (vector2.Y > 1f)
                {
                    vector2.Y = 1f;
                }
                if (vector2.Y < -1f)
                {
                    vector2.Y = -1f;
                }
            }
            dRoomX[numDRooms] = (int) vector.X;
            dRoomY[numDRooms] = (int) vector.Y;
            dRoomSize[numDRooms] = (int) num5;
            dRoomL[numDRooms] = (int) x;
            dRoomR[numDRooms] = (int) num8;
            dRoomT[numDRooms] = (int) y;
            dRoomB[numDRooms] = (int) num10;
            dRoomTreasure[numDRooms] = false;
            numDRooms++;
        }

        public static void DungeonStairs(int i, int j, int tileType, int wallType)
        {
            Vector2 vector;
            Vector2 vector2 = new Vector2();
            double num5 = genRand.Next(5, 9);
            int num6 = 1;
            vector.X = i;
            vector.Y = j;
            int num7 = genRand.Next(10, 30);
            if (i > dEnteranceX)
            {
                num6 = -1;
            }
            else
            {
                num6 = 1;
            }
            if (i > (Main.maxTilesX - 400))
            {
                num6 = -1;
            }
            else if (i < 400)
            {
                num6 = 1;
            }
            vector2.Y = -1f;
            vector2.X = num6;
            if (genRand.Next(3) == 0)
            {
                vector2.X *= 0.5f;
            }
            else if (genRand.Next(3) == 0)
            {
                vector2.Y *= 2f;
            }
            while (num7 > 0)
            {
                num7--;
                int num = ((int) ((vector.X - num5) - 4.0)) - genRand.Next(6);
                int maxTilesX = ((int) ((vector.X + num5) + 4.0)) + genRand.Next(6);
                int num2 = (int) ((vector.Y - num5) - 4.0);
                int maxTilesY = ((int) ((vector.Y + num5) + 4.0)) + genRand.Next(6);
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                int num8 = 1;
                if (vector.X > (Main.maxTilesX / 2))
                {
                    num8 = -1;
                }
                int num9 = (int) ((vector.X + ((((float) dxStrength1) * 0.6f) * num8)) + (((float) dxStrength2) * num8));
                int num10 = (int) (dyStrength2 * 0.5);
                if (((vector.Y < (Main.worldSurface - 5.0)) && (Main.tile[num9, ((int) ((vector.Y - num5) - 6.0)) + num10].wall == 0)) && ((Main.tile[num9, ((int) ((vector.Y - num5) - 7.0)) + num10].wall == 0) && (Main.tile[num9, ((int) ((vector.Y - num5) - 8.0)) + num10].wall == 0)))
                {
                    dSurface = true;
                    TileRunner(num9, ((int) ((vector.Y - num5) - 6.0)) + num10, (double) genRand.Next(0x19, 0x23), genRand.Next(10, 20), -1, false, 0f, -1f, false, true);
                }
                for (int k = num; k < maxTilesX; k++)
                {
                    for (int num12 = num2; num12 < maxTilesY; num12++)
                    {
                        Main.tile[k, num12].liquid = 0;
                        if (Main.tile[k, num12].wall != wallType)
                        {
                            Main.tile[k, num12].wall = 0;
                            Main.tile[k, num12].active = true;
                            Main.tile[k, num12].type = (byte) tileType;
                        }
                    }
                }
                for (int m = num + 1; m < (maxTilesX - 1); m++)
                {
                    for (int num14 = num2 + 1; num14 < (maxTilesY - 1); num14++)
                    {
                        PlaceWall(m, num14, wallType, true);
                    }
                }
                int num15 = 0;
                if (genRand.Next((int) num5) == 0)
                {
                    num15 = genRand.Next(1, 3);
                }
                num = ((int) (vector.X - (num5 * 0.5))) - num15;
                maxTilesX = ((int) (vector.X + (num5 * 0.5))) + num15;
                num2 = ((int) (vector.Y - (num5 * 0.5))) - num15;
                maxTilesY = ((int) (vector.Y + (num5 * 0.5))) + num15;
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                for (int n = num; n < maxTilesX; n++)
                {
                    for (int num17 = num2; num17 < maxTilesY; num17++)
                    {
                        Main.tile[n, num17].active = false;
                        PlaceWall(n, num17, wallType, true);
                    }
                }
                if (dSurface)
                {
                    num7 = 0;
                }
                vector += vector2;
            }
            dungeonX = (int) vector.X;
            dungeonY = (int) vector.Y;
        }

        public static bool EmptyTileCheck(int startX, int endX, int startY, int endY, int ignoreStyle = -1)
        {
            if (startX < 0)
            {
                return false;
            }
            if (endX >= Main.maxTilesX)
            {
                return false;
            }
            if (startY < 0)
            {
                return false;
            }
            if (endY >= Main.maxTilesY)
            {
                return false;
            }
            for (int i = startX; i < (endX + 1); i++)
            {
                for (int j = startY; j < (endY + 1); j++)
                {
                    if (Main.tile[i, j].active)
                    {
                        if (ignoreStyle == -1)
                        {
                            return false;
                        }
                        if ((ignoreStyle == 11) && (Main.tile[i, j].type != 11))
                        {
                            return false;
                        }
                        if (((((ignoreStyle == 20) && (Main.tile[i, j].type != 20)) && ((Main.tile[i, j].type != 3) && (Main.tile[i, j].type != 0x18))) && (((Main.tile[i, j].type != 0x3d) && (Main.tile[i, j].type != 0x20)) && ((Main.tile[i, j].type != 0x45) && (Main.tile[i, j].type != 0x49)))) && (((Main.tile[i, j].type != 0x4a) && (Main.tile[i, j].type != 110)) && (Main.tile[i, j].type != 0x71)))
                        {
                            return false;
                        }
                        if ((ignoreStyle == 0x47) && (Main.tile[i, j].type != 0x47))
                        {
                            return false;
                        }
                    }
                }
            }
            return true;
        }

        public static void EveryTileFrame()
        {
            noLiquidCheck = true;
            noTileActions = true;
            for (int i = 0; i < Main.maxTilesX; i++)
            {
                float num2 = ((float) i) / ((float) Main.maxTilesX);
                Main.statusText = "Finding tile frames: " + ((int) ((num2 * 100f) + 1f)) + "%";
                for (int j = 0; j < Main.maxTilesY; j++)
                {
                    if (Main.tile[i, j].active)
                    {
                        TileFrame(i, j, true, false);
                    }
                    if (Main.tile[i, j].wall > 0)
                    {
                        WallFrame(i, j, true);
                    }
                }
            }
            noLiquidCheck = false;
            noTileActions = false;
        }

        public static void FloatingIsland(int i, int j)
        {
            Vector2 vector;
            Vector2 vector2;
            double num5 = genRand.Next(80, 120);
            double num6 = num5;
            float num7 = genRand.Next(20, 0x19);
            vector.X = i;
            vector.Y = j;
            vector2.X = genRand.Next(-20, 0x15) * 0.2f;
            while ((vector2.X > -2f) && (vector2.X < 2f))
            {
                vector2.X = genRand.Next(-20, 0x15) * 0.2f;
            }
            vector2.Y = genRand.Next(-20, -10) * 0.02f;
            while ((num5 > 0.0) && (num7 > 0f))
            {
                num5 -= genRand.Next(4);
                num7--;
                int num = (int) (vector.X - (num5 * 0.5));
                int maxTilesX = (int) (vector.X + (num5 * 0.5));
                int num2 = (int) (vector.Y - (num5 * 0.5));
                int maxTilesY = (int) (vector.Y + (num5 * 0.5));
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                num6 = (num5 * genRand.Next(80, 120)) * 0.01;
                float y = vector.Y + 1f;
                for (int k = num; k < maxTilesX; k++)
                {
                    if (genRand.Next(2) == 0)
                    {
                        y += genRand.Next(-1, 2);
                    }
                    if (y < vector.Y)
                    {
                        y = vector.Y;
                    }
                    if (y > (vector.Y + 2f))
                    {
                        y = vector.Y + 2f;
                    }
                    for (int n = num2; n < maxTilesY; n++)
                    {
                        if (n > y)
                        {
                            float num11 = Math.Abs((float) (k - vector.X));
                            float num12 = Math.Abs((float) (n - vector.Y)) * 2f;
                            if (Math.Sqrt((double) ((num11 * num11) + (num12 * num12))) < (num6 * 0.4))
                            {
                                Main.tile[k, n].active = true;
                                if (Main.tile[k, n].type == 0x3b)
                                {
                                    Main.tile[k, n].type = 0;
                                }
                            }
                        }
                    }
                }
                TileRunner(genRand.Next(num + 10, maxTilesX - 10), (int) ((vector.Y + (num6 * 0.1)) + 5.0), (double) genRand.Next(5, 10), genRand.Next(10, 15), 0, true, 0f, 2f, true, true);
                num = (int) (vector.X - (num5 * 0.4));
                maxTilesX = (int) (vector.X + (num5 * 0.4));
                num2 = (int) (vector.Y - (num5 * 0.4));
                maxTilesY = (int) (vector.Y + (num5 * 0.4));
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                num6 = (num5 * genRand.Next(80, 120)) * 0.01;
                for (int m = num; m < maxTilesX; m++)
                {
                    for (int num15 = num2; num15 < maxTilesY; num15++)
                    {
                        if (num15 > (vector.Y + 2f))
                        {
                            float num16 = Math.Abs((float) (m - vector.X));
                            float num17 = Math.Abs((float) (num15 - vector.Y)) * 2f;
                            if (Math.Sqrt((double) ((num16 * num16) + (num17 * num17))) < (num6 * 0.4))
                            {
                                Main.tile[m, num15].wall = 2;
                            }
                        }
                    }
                }
                vector += vector2;
                vector2.Y += genRand.Next(-10, 11) * 0.05f;
                if (vector2.X > 1f)
                {
                    vector2.X = 1f;
                }
                if (vector2.X < -1f)
                {
                    vector2.X = -1f;
                }
                if (vector2.Y > 0.2)
                {
                    vector2.Y = -0.2f;
                }
                if (vector2.Y < -0.2)
                {
                    vector2.Y = -0.2f;
                }
            }
        }

        public static void generateWorld(int seed = -1)
        {
            NPC.clrNames();
            NPC.setNames();
            gen = true;
            resetGen();
            if (seed > 0)
            {
                genRand = new Random(seed);
            }
            else
            {
                genRand = new Random((int) DateTime.Now.Ticks);
            }
            Main.worldID = genRand.Next(0x7fffffff);
            int num7 = 0;
            int num8 = 0;
            double num = Main.maxTilesY * 0.3;
            num *= genRand.Next(90, 110) * 0.005;
            double num4 = num + (Main.maxTilesY * 0.2);
            num4 *= genRand.Next(90, 110) * 0.01;
            double num2 = num;
            double num3 = num;
            double num5 = num4;
            double num6 = num4;
            int num9 = 0;
            if (genRand.Next(2) == 0)
            {
                num9 = -1;
            }
            else
            {
                num9 = 1;
            }
            for (int i = 0; i < Main.maxTilesX; i++)
            {
                float num11 = ((float) i) / ((float) Main.maxTilesX);
                Main.statusText = "Generating world terrain: " + ((int) ((num11 * 100f) + 1f)) + "%";
                if (num < num2)
                {
                    num2 = num;
                }
                if (num > num3)
                {
                    num3 = num;
                }
                if (num4 < num5)
                {
                    num5 = num4;
                }
                if (num4 > num6)
                {
                    num6 = num4;
                }
                if (num8 <= 0)
                {
                    num7 = genRand.Next(0, 5);
                    num8 = genRand.Next(5, 40);
                    if (num7 == 0)
                    {
                        num8 *= (int) (genRand.Next(5, 30) * 0.2);
                    }
                }
                num8--;
                switch (num7)
                {
                    case 0:
                        while (genRand.Next(0, 7) == 0)
                        {
                            num += genRand.Next(-1, 2);
                        }
                        break;

                    case 1:
                        while (genRand.Next(0, 4) == 0)
                        {
                            num--;
                        }
                        while (genRand.Next(0, 10) == 0)
                        {
                            num++;
                        }
                        break;

                    case 2:
                        while (genRand.Next(0, 4) == 0)
                        {
                            num++;
                        }
                        while (genRand.Next(0, 10) == 0)
                        {
                            num--;
                        }
                        break;

                    case 3:
                        while (genRand.Next(0, 2) == 0)
                        {
                            num--;
                        }
                        while (genRand.Next(0, 6) == 0)
                        {
                            num++;
                        }
                        break;

                    case 4:
                        while (genRand.Next(0, 2) == 0)
                        {
                            num++;
                        }
                        while (genRand.Next(0, 5) == 0)
                        {
                            num--;
                        }
                        break;
                }
                if (num < (Main.maxTilesY * 0.17))
                {
                    num = Main.maxTilesY * 0.17;
                    num8 = 0;
                }
                else if (num > (Main.maxTilesY * 0.3))
                {
                    num = Main.maxTilesY * 0.3;
                    num8 = 0;
                }
                if (((i < 0x113) || (i > (Main.maxTilesX - 0x113))) && (num > (Main.maxTilesY * 0.25)))
                {
                    num = Main.maxTilesY * 0.25;
                    num8 = 1;
                }
                while (genRand.Next(0, 3) == 0)
                {
                    num4 += genRand.Next(-2, 3);
                }
                if (num4 < (num + (Main.maxTilesY * 0.05)))
                {
                    num4++;
                }
                if (num4 > (num + (Main.maxTilesY * 0.35)))
                {
                    num4--;
                }
                for (int num12 = 0; num12 < num; num12++)
                {
                    Main.tile[i, num12].active = false;
                    Main.tile[i, num12].frameX = -1;
                    Main.tile[i, num12].frameY = -1;
                }
                for (int num13 = (int) num; num13 < Main.maxTilesY; num13++)
                {
                    if (num13 < num4)
                    {
                        Main.tile[i, num13].active = true;
                        Main.tile[i, num13].type = 0;
                        Main.tile[i, num13].frameX = -1;
                        Main.tile[i, num13].frameY = -1;
                    }
                    else
                    {
                        Main.tile[i, num13].active = true;
                        Main.tile[i, num13].type = 1;
                        Main.tile[i, num13].frameX = -1;
                        Main.tile[i, num13].frameY = -1;
                    }
                }
            }
            Main.worldSurface = num3 + 25.0;
            Main.rockLayer = num6;
            double num14 = ((int) ((Main.rockLayer - Main.worldSurface) / 6.0)) * 6;
            Main.rockLayer = Main.worldSurface + num14;
            waterLine = (((int) Main.rockLayer) + Main.maxTilesY) / 2;
            waterLine += genRand.Next(-100, 20);
            lavaLine = waterLine + genRand.Next(50, 80);
            int num15 = 0;
            for (int j = 0; j < ((int) (Main.maxTilesX * 0.0015)); j++)
            {
                int[] numArray = new int[10];
                int[] numArray2 = new int[10];
                int num17 = genRand.Next(450, Main.maxTilesX - 450);
                int num18 = 0;
                int num19 = 0;
                goto Label_05CF;
            Label_057F:
                num18++;
            Label_0585:
                if (!Main.tile[num17, num18].active)
                {
                    goto Label_057F;
                }
                numArray[num19] = num17;
                numArray2[num19] = num18 - genRand.Next(11, 0x10);
                num17 += genRand.Next(5, 11);
                num19++;
            Label_05CF:
                if (num19 < 10)
                {
                    goto Label_0585;
                }
                for (int num20 = 0; num20 < 10; num20++)
                {
                    TileRunner(numArray[num20], numArray2[num20], (double) genRand.Next(5, 8), genRand.Next(6, 9), 0, true, -2f, -0.3f, false, true);
                    TileRunner(numArray[num20], numArray2[num20], (double) genRand.Next(5, 8), genRand.Next(6, 9), 0, true, 2f, -0.3f, false, true);
                }
            }
            Main.statusText = "Adding sand...";
            int num21 = genRand.Next((int) (Main.maxTilesX * 0.0008), (int) (Main.maxTilesX * 0.0025)) + 2;
            for (int k = 0; k < num21; k++)
            {
                int num23 = genRand.Next(Main.maxTilesX);
                while ((num23 > (Main.maxTilesX * 0.4f)) && (num23 < (Main.maxTilesX * 0.6f)))
                {
                    num23 = genRand.Next(Main.maxTilesX);
                }
                int num24 = genRand.Next(0x23, 90);
                if (k == 1)
                {
                    float num25 = Main.maxTilesX / 0x1068;
                    num24 += (int) (genRand.Next(20, 40) * num25);
                }
                if (genRand.Next(3) == 0)
                {
                    num24 *= 2;
                }
                if (k == 1)
                {
                    num24 *= 2;
                }
                int num26 = num23 - num24;
                num24 = genRand.Next(0x23, 90);
                if (genRand.Next(3) == 0)
                {
                    num24 *= 2;
                }
                if (k == 1)
                {
                    num24 *= 2;
                }
                int maxTilesX = num23 + num24;
                if (num26 < 0)
                {
                    num26 = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                switch (k)
                {
                    case 0:
                        num26 = 0;
                        maxTilesX = genRand.Next(260, 300);
                        if (num9 == 1)
                        {
                            maxTilesX += 40;
                        }
                        break;

                    case 2:
                        num26 = Main.maxTilesX - genRand.Next(260, 300);
                        maxTilesX = Main.maxTilesX;
                        if (num9 == -1)
                        {
                            num26 -= 40;
                        }
                        break;
                }
                int num28 = genRand.Next(50, 100);
                for (int num29 = num26; num29 < maxTilesX; num29++)
                {
                    if (genRand.Next(2) == 0)
                    {
                        num28 += genRand.Next(-1, 2);
                        if (num28 < 50)
                        {
                            num28 = 50;
                        }
                        if (num28 > 100)
                        {
                            num28 = 100;
                        }
                    }
                    for (int num30 = 0; num30 < Main.worldSurface; num30++)
                    {
                        if (Main.tile[num29, num30].active)
                        {
                            int num31 = num28;
                            if ((num29 - num26) < num31)
                            {
                                num31 = num29 - num26;
                            }
                            if ((maxTilesX - num29) < num31)
                            {
                                num31 = maxTilesX - num29;
                            }
                            num31 += genRand.Next(5);
                            for (int num32 = num30; num32 < (num30 + num31); num32++)
                            {
                                if ((num29 > (num26 + genRand.Next(5))) && (num29 < (maxTilesX - genRand.Next(5))))
                                {
                                    Main.tile[num29, num32].type = 0x35;
                                }
                            }
                            break;
                        }
                    }
                }
            }
            for (int m = 0; m < ((int) ((Main.maxTilesX * Main.maxTilesY) * 8E-06)); m++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) Main.worldSurface, (int) Main.rockLayer), (double) genRand.Next(15, 70), genRand.Next(20, 130), 0x35, false, 0f, 0f, false, true);
            }
            numMCaves = 0;
            Main.statusText = "Generating hills...";
            for (int n = 0; n < ((int) (Main.maxTilesX * 0.0008)); n++)
            {
                int num35 = 0;
                bool flag = false;
                bool flag2 = false;
                int num36 = genRand.Next((int) (Main.maxTilesX * 0.25), (int) (Main.maxTilesX * 0.75));
                while (!flag2)
                {
                    flag2 = true;
                    while ((num36 > ((Main.maxTilesX / 2) - 100)) && (num36 < ((Main.maxTilesX / 2) + 100)))
                    {
                        num36 = genRand.Next((int) (Main.maxTilesX * 0.25), (int) (Main.maxTilesX * 0.75));
                    }
                    for (int num37 = 0; num37 < numMCaves; num37++)
                    {
                        if ((num36 > (mCaveX[num37] - 50)) && (num36 < (mCaveX[num37] + 50)))
                        {
                            num35++;
                            flag2 = false;
                            break;
                        }
                    }
                    if (num35 >= 200)
                    {
                        flag = true;
                        break;
                    }
                }
                if (!flag)
                {
                    for (int num38 = 0; num38 < Main.worldSurface; num38++)
                    {
                        if (Main.tile[num36, num38].active)
                        {
                            Mountinater(num36, num38);
                            mCaveX[numMCaves] = num36;
                            mCaveY[numMCaves] = num38;
                            numMCaves++;
                            break;
                        }
                    }
                }
            }
            for (int num39 = 1; num39 < (Main.maxTilesX - 1); num39++)
            {
                float num40 = ((float) num39) / ((float) Main.maxTilesX);
                Main.statusText = "Puttin dirt behind dirt: " + ((int) ((num40 * 100f) + 1f)) + "%";
                bool flag3 = false;
                num15 += genRand.Next(-1, 2);
                if (num15 < 0)
                {
                    num15 = 0;
                }
                if (num15 > 10)
                {
                    num15 = 10;
                }
                for (int num41 = 0; num41 < (Main.worldSurface + 10.0); num41++)
                {
                    if (num41 > (Main.worldSurface + num15))
                    {
                        break;
                    }
                    if (flag3)
                    {
                        Main.tile[num39, num41].wall = 2;
                    }
                    if (((Main.tile[num39, num41].active && Main.tile[num39 - 1, num41].active) && (Main.tile[num39 + 1, num41].active && Main.tile[num39, num41 + 1].active)) && (Main.tile[num39 - 1, num41 + 1].active && Main.tile[num39 + 1, num41 + 1].active))
                    {
                        flag3 = true;
                    }
                }
            }
            Main.statusText = "Placing rocks in the dirt...";
            for (int num42 = 0; num42 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.0002)); num42++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next(0, ((int) num2) + 1), (double) genRand.Next(4, 15), genRand.Next(5, 40), 1, false, 0f, 0f, false, true);
            }
            for (int num43 = 0; num43 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.0002)); num43++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num2, ((int) num3) + 1), (double) genRand.Next(4, 10), genRand.Next(5, 30), 1, false, 0f, 0f, false, true);
            }
            for (int num44 = 0; num44 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.0045)); num44++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num3, ((int) num6) + 1), (double) genRand.Next(2, 7), genRand.Next(2, 0x17), 1, false, 0f, 0f, false, true);
            }
            Main.statusText = "Placing dirt in the rocks...";
            for (int num45 = 0; num45 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.005)); num45++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num5, Main.maxTilesY), (double) genRand.Next(2, 6), genRand.Next(2, 40), 0, false, 0f, 0f, false, true);
            }
            Main.statusText = "Adding clay...";
            for (int num46 = 0; num46 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 2E-05)); num46++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next(0, (int) num2), (double) genRand.Next(4, 14), genRand.Next(10, 50), 40, false, 0f, 0f, false, true);
            }
            for (int num47 = 0; num47 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 5E-05)); num47++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num2, ((int) num3) + 1), (double) genRand.Next(8, 14), genRand.Next(15, 0x2d), 40, false, 0f, 0f, false, true);
            }
            for (int num48 = 0; num48 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 2E-05)); num48++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num3, ((int) num6) + 1), (double) genRand.Next(8, 15), genRand.Next(5, 50), 40, false, 0f, 0f, false, true);
            }
            for (int num49 = 5; num49 < (Main.maxTilesX - 5); num49++)
            {
                for (int num50 = 1; num50 < (Main.worldSurface - 1.0); num50++)
                {
                    if (Main.tile[num49, num50].active)
                    {
                        for (int num51 = num50; num51 < (num50 + 5); num51++)
                        {
                            if (Main.tile[num49, num51].type == 40)
                            {
                                Main.tile[num49, num51].type = 0;
                            }
                        }
                        break;
                    }
                }
            }
            int num52 = 0;
            for (int num53 = 0; num53 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.0015)); num53++)
            {
                float num54 = (float) (((double) num53) / ((Main.maxTilesX * Main.maxTilesY) * 0.0015));
                Main.statusText = "Making random holes: " + ((int) ((num54 * 100f) + 1f)) + "%";
                int type = -1;
                if (genRand.Next(5) == 0)
                {
                    type = -2;
                }
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num3, Main.maxTilesY), (double) genRand.Next(2, 5), genRand.Next(2, 20), type, false, 0f, 0f, false, true);
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num3, Main.maxTilesY), (double) genRand.Next(8, 15), genRand.Next(7, 30), type, false, 0f, 0f, false, true);
            }
            for (int num56 = 0; num56 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 3E-05)); num56++)
            {
                float num57 = (float) (((double) num56) / ((Main.maxTilesX * Main.maxTilesY) * 3E-05));
                Main.statusText = "Generating small caves: " + ((int) ((num57 * 100f) + 1f)) + "%";
                if (num6 <= Main.maxTilesY)
                {
                    int num58 = -1;
                    if (genRand.Next(6) == 0)
                    {
                        num58 = -2;
                    }
                    TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num2, ((int) num6) + 1), (double) genRand.Next(5, 15), genRand.Next(30, 200), num58, false, 0f, 0f, false, true);
                }
            }
            for (int num59 = 0; num59 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.00013)); num59++)
            {
                float num60 = (float) (((double) num59) / ((Main.maxTilesX * Main.maxTilesY) * 0.00013));
                Main.statusText = "Generating large caves: " + ((int) ((num60 * 100f) + 1f)) + "%";
                if (num6 <= Main.maxTilesY)
                {
                    int num61 = -1;
                    if (genRand.Next(10) == 0)
                    {
                        num61 = -2;
                    }
                    TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num6, Main.maxTilesY), (double) genRand.Next(6, 20), genRand.Next(50, 300), num61, false, 0f, 0f, false, true);
                }
            }
            Main.statusText = "Generating surface caves...";
            for (int num62 = 0; num62 < ((int) (Main.maxTilesX * 0.0025)); num62++)
            {
                num52 = genRand.Next(0, Main.maxTilesX);
                for (int num63 = 0; num63 < num3; num63++)
                {
                    if (Main.tile[num52, num63].active)
                    {
                        TileRunner(num52, num63, (double) genRand.Next(3, 6), genRand.Next(5, 50), -1, false, genRand.Next(-10, 11) * 0.1f, 1f, false, true);
                        break;
                    }
                }
            }
            for (int num64 = 0; num64 < ((int) (Main.maxTilesX * 0.0007)); num64++)
            {
                num52 = genRand.Next(0, Main.maxTilesX);
                for (int num65 = 0; num65 < num3; num65++)
                {
                    if (Main.tile[num52, num65].active)
                    {
                        TileRunner(num52, num65, (double) genRand.Next(10, 15), genRand.Next(50, 130), -1, false, genRand.Next(-10, 11) * 0.1f, 2f, false, true);
                        break;
                    }
                }
            }
            for (int num66 = 0; num66 < ((int) (Main.maxTilesX * 0.0003)); num66++)
            {
                num52 = genRand.Next(0, Main.maxTilesX);
                for (int num67 = 0; num67 < num3; num67++)
                {
                    if (Main.tile[num52, num67].active)
                    {
                        TileRunner(num52, num67, (double) genRand.Next(12, 0x19), genRand.Next(150, 500), -1, false, genRand.Next(-10, 11) * 0.1f, 4f, false, true);
                        TileRunner(num52, num67, (double) genRand.Next(8, 0x11), genRand.Next(60, 200), -1, false, genRand.Next(-10, 11) * 0.1f, 2f, false, true);
                        TileRunner(num52, num67, (double) genRand.Next(5, 13), genRand.Next(40, 170), -1, false, genRand.Next(-10, 11) * 0.1f, 2f, false, true);
                        break;
                    }
                }
            }
            for (int num68 = 0; num68 < ((int) (Main.maxTilesX * 0.0004)); num68++)
            {
                num52 = genRand.Next(0, Main.maxTilesX);
                for (int num69 = 0; num69 < num3; num69++)
                {
                    if (Main.tile[num52, num69].active)
                    {
                        TileRunner(num52, num69, (double) genRand.Next(7, 12), genRand.Next(150, 250), -1, false, 0f, 1f, true, true);
                        break;
                    }
                }
            }
            float num70 = Main.maxTilesX / 0x1068;
            for (int num71 = 0; num71 < (5f * num70); num71++)
            {
                try
                {
                    Caverer(genRand.Next(100, Main.maxTilesX - 100), genRand.Next((int) Main.rockLayer, Main.maxTilesY - 400));
                }
                catch
                {
                }
            }
            for (int num74 = 0; num74 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.002)); num74++)
            {
                int num72 = genRand.Next(1, Main.maxTilesX - 1);
                int num73 = genRand.Next((int) num2, (int) num3);
                if (num73 >= Main.maxTilesY)
                {
                    num73 = Main.maxTilesY - 2;
                }
                if (((Main.tile[num72 - 1, num73].active && (Main.tile[num72 - 1, num73].type == 0)) && (Main.tile[num72 + 1, num73].active && (Main.tile[num72 + 1, num73].type == 0))) && ((Main.tile[num72, num73 - 1].active && (Main.tile[num72, num73 - 1].type == 0)) && (Main.tile[num72, num73 + 1].active && (Main.tile[num72, num73 + 1].type == 0))))
                {
                    Main.tile[num72, num73].active = true;
                    Main.tile[num72, num73].type = 2;
                }
                num72 = genRand.Next(1, Main.maxTilesX - 1);
                num73 = genRand.Next(0, (int) num2);
                if (num73 >= Main.maxTilesY)
                {
                    num73 = Main.maxTilesY - 2;
                }
                if (((Main.tile[num72 - 1, num73].active && (Main.tile[num72 - 1, num73].type == 0)) && (Main.tile[num72 + 1, num73].active && (Main.tile[num72 + 1, num73].type == 0))) && ((Main.tile[num72, num73 - 1].active && (Main.tile[num72, num73 - 1].type == 0)) && (Main.tile[num72, num73 + 1].active && (Main.tile[num72, num73 + 1].type == 0))))
                {
                    Main.tile[num72, num73].active = true;
                    Main.tile[num72, num73].type = 2;
                }
            }
            Main.statusText = "Generating jungle: 0%";
            float num75 = Main.maxTilesX / 0x1068;
            num75 *= 1.5f;
            int num76 = 0;
            float num77 = genRand.Next(15, 30) * 0.01f;
            if (num9 == -1)
            {
                num77 = 1f - num77;
                num76 = (int) (Main.maxTilesX * num77);
            }
            else
            {
                num76 = (int) (Main.maxTilesX * num77);
            }
            int num78 = (Main.maxTilesY + ((int) Main.rockLayer)) / 2;
            num76 += genRand.Next((int) (-100f * num75), (int) (101f * num75));
            num78 += genRand.Next((int) (-100f * num75), (int) (101f * num75));
            int num79 = num76;
            int num82 = num78;
            TileRunner(num76, num78, (double) genRand.Next((int) (250f * num75), (int) (500f * num75)), genRand.Next(50, 150), 0x3b, false, (float) (num9 * 3), 0f, false, true);
            for (int num85 = 0; num85 < (6f * num75); num85++)
            {
                TileRunner(num76 + genRand.Next(-((int) (125f * num75)), (int) (125f * num75)), num78 + genRand.Next(-((int) (125f * num75)), (int) (125f * num75)), (double) genRand.Next(3, 7), genRand.Next(3, 8), genRand.Next(0x3f, 0x41), false, 0f, 0f, false, true);
            }
            mudWall = true;
            Main.statusText = "Generating jungle: 15%";
            num76 += genRand.Next((int) (-250f * num75), (int) (251f * num75));
            num78 += genRand.Next((int) (-150f * num75), (int) (151f * num75));
            int num80 = num76;
            int num83 = num78;
            int num86 = num76;
            int num87 = num78;
            TileRunner(num76, num78, (double) genRand.Next((int) (250f * num75), (int) (500f * num75)), genRand.Next(50, 150), 0x3b, false, 0f, 0f, false, true);
            mudWall = false;
            for (int num88 = 0; num88 < (6f * num75); num88++)
            {
                TileRunner(num76 + genRand.Next(-((int) (125f * num75)), (int) (125f * num75)), num78 + genRand.Next(-((int) (125f * num75)), (int) (125f * num75)), (double) genRand.Next(3, 7), genRand.Next(3, 8), genRand.Next(0x41, 0x43), false, 0f, 0f, false, true);
            }
            mudWall = true;
            Main.statusText = "Generating jungle: 30%";
            num76 += genRand.Next((int) (-400f * num75), (int) (401f * num75));
            num78 += genRand.Next((int) (-150f * num75), (int) (151f * num75));
            int num81 = num76;
            int num84 = num78;
            TileRunner(num76, num78, (double) genRand.Next((int) (250f * num75), (int) (500f * num75)), genRand.Next(50, 150), 0x3b, false, (float) (num9 * -3), 0f, false, true);
            mudWall = false;
            for (int num89 = 0; num89 < (6f * num75); num89++)
            {
                TileRunner(num76 + genRand.Next(-((int) (125f * num75)), (int) (125f * num75)), num78 + genRand.Next(-((int) (125f * num75)), (int) (125f * num75)), (double) genRand.Next(3, 7), genRand.Next(3, 8), genRand.Next(0x43, 0x45), false, 0f, 0f, false, true);
            }
            mudWall = true;
            Main.statusText = "Generating jungle: 45%";
            num76 = ((num79 + num80) + num81) / 3;
            num78 = ((num82 + num83) + num84) / 3;
            TileRunner(num76, num78, (double) genRand.Next((int) (400f * num75), (int) (600f * num75)), 0x2710, 0x3b, false, 0f, -20f, true, true);
            JungleRunner(num76, num78);
            Main.statusText = "Generating jungle: 60%";
            mudWall = false;
            for (int num90 = 0; num90 < (Main.maxTilesX / 10); num90++)
            {
                num76 = genRand.Next(20, Main.maxTilesX - 20);
                num78 = genRand.Next((int) Main.rockLayer, Main.maxTilesY - 200);
                while (Main.tile[num76, num78].wall != 15)
                {
                    num76 = genRand.Next(20, Main.maxTilesX - 20);
                    num78 = genRand.Next((int) Main.rockLayer, Main.maxTilesY - 200);
                }
                MudWallRunner(num76, num78);
            }
            num76 = num86;
            num78 = num87;
            for (int num91 = 0; num91 <= (20f * num75); num91++)
            {
                Main.statusText = "Generating jungle: " + ((int) (60f + (((float) num91) / num75))) + "%";
                num76 += genRand.Next((int) (-5f * num75), (int) (6f * num75));
                num78 += genRand.Next((int) (-5f * num75), (int) (6f * num75));
                TileRunner(num76, num78, (double) genRand.Next(40, 100), genRand.Next(300, 500), 0x3b, false, 0f, 0f, false, true);
            }
            for (int num92 = 0; num92 <= (10f * num75); num92++)
            {
                Main.statusText = "Generating jungle: " + ((int) (80f + ((((float) num92) / num75) * 2f))) + "%";
                num76 = num86 + genRand.Next((int) (-600f * num75), (int) (600f * num75));
                num78 = num87 + genRand.Next((int) (-200f * num75), (int) (200f * num75));
                while ((((num76 < 1) || (num76 >= (Main.maxTilesX - 1))) || ((num78 < 1) || (num78 >= (Main.maxTilesY - 1)))) || (Main.tile[num76, num78].type != 0x3b))
                {
                    num76 = num86 + genRand.Next((int) (-600f * num75), (int) (600f * num75));
                    num78 = num87 + genRand.Next((int) (-200f * num75), (int) (200f * num75));
                }
                for (int num93 = 0; num93 < (8f * num75); num93++)
                {
                    num76 += genRand.Next(-30, 0x1f);
                    num78 += genRand.Next(-30, 0x1f);
                    int num94 = -1;
                    if (genRand.Next(7) == 0)
                    {
                        num94 = -2;
                    }
                    TileRunner(num76, num78, (double) genRand.Next(10, 20), genRand.Next(30, 70), num94, false, 0f, 0f, false, true);
                }
            }
            for (int num95 = 0; num95 <= (300f * num75); num95++)
            {
                num76 = num86 + genRand.Next((int) (-600f * num75), (int) (600f * num75));
                num78 = num87 + genRand.Next((int) (-200f * num75), (int) (200f * num75));
                while ((((num76 < 1) || (num76 >= (Main.maxTilesX - 1))) || ((num78 < 1) || (num78 >= (Main.maxTilesY - 1)))) || (Main.tile[num76, num78].type != 0x3b))
                {
                    num76 = num86 + genRand.Next((int) (-600f * num75), (int) (600f * num75));
                    num78 = num87 + genRand.Next((int) (-200f * num75), (int) (200f * num75));
                }
                TileRunner(num76, num78, (double) genRand.Next(4, 10), genRand.Next(5, 30), 1, false, 0f, 0f, false, true);
                if (genRand.Next(4) == 0)
                {
                    int num96 = genRand.Next(0x3f, 0x45);
                    TileRunner(num76 + genRand.Next(-1, 2), num78 + genRand.Next(-1, 2), (double) genRand.Next(3, 7), genRand.Next(4, 8), num96, false, 0f, 0f, false, true);
                }
            }
            num76 = num86;
            num78 = num87;
            float num97 = genRand.Next(6, 10);
            float num98 = Main.maxTilesX / 0x1068;
            num97 *= num98;
            for (int num99 = 0; num99 < num97; num99++)
            {
                bool flag4 = true;
                while (flag4)
                {
                    num76 = genRand.Next(20, Main.maxTilesX - 20);
                    num78 = genRand.Next(((int) (Main.worldSurface + Main.rockLayer)) / 2, Main.maxTilesY - 300);
                    if (Main.tile[num76, num78].type == 0x3b)
                    {
                        flag4 = false;
                        int num100 = genRand.Next(2, 4);
                        int num101 = genRand.Next(2, 4);
                        for (int num102 = (num76 - num100) - 1; num102 <= ((num76 + num100) + 1); num102++)
                        {
                            for (int num103 = (num78 - num101) - 1; num103 <= ((num78 + num101) + 1); num103++)
                            {
                                Main.tile[num102, num103].active = true;
                                Main.tile[num102, num103].type = 0x2d;
                                Main.tile[num102, num103].liquid = 0;
                                Main.tile[num102, num103].lava = false;
                            }
                        }
                        for (int num104 = num76 - num100; num104 <= (num76 + num100); num104++)
                        {
                            for (int num105 = num78 - num101; num105 <= (num78 + num101); num105++)
                            {
                                Main.tile[num104, num105].active = false;
                            }
                        }
                        bool flag5 = false;
                        int num106 = 0;
                        while (!flag5 && (num106 < 100))
                        {
                            num106++;
                            int num107 = genRand.Next(num76 - num100, (num76 + num100) + 1);
                            int num108 = genRand.Next(num78 - num101, (num78 + num101) - 2);
                            PlaceTile(num107, num108, 4, true, false, -1, 0);
                            if (Main.tile[num107, num108].type == 4)
                            {
                                flag5 = true;
                            }
                        }
                        for (int num109 = (num76 - num100) - 1; num109 <= ((num76 + num100) + 1); num109++)
                        {
                            for (int num110 = (num78 + num101) - 2; num110 <= (num78 + num101); num110++)
                            {
                                Main.tile[num109, num110].active = false;
                            }
                        }
                        for (int num111 = (num76 - num100) - 1; num111 <= ((num76 + num100) + 1); num111++)
                        {
                            for (int num112 = (num78 + num101) - 2; num112 <= ((num78 + num101) - 1); num112++)
                            {
                                Main.tile[num111, num112].active = false;
                            }
                        }
                        for (int num113 = (num76 - num100) - 1; num113 <= ((num76 + num100) + 1); num113++)
                        {
                            int num114 = 4;
                            int num115 = (num78 + num101) + 2;
                            while ((!Main.tile[num113, num115].active && (num115 < Main.maxTilesY)) && (num114 > 0))
                            {
                                Main.tile[num113, num115].active = true;
                                Main.tile[num113, num115].type = 0x3b;
                                num115++;
                                num114--;
                            }
                        }
                        num100 -= genRand.Next(1, 3);
                        for (int num116 = (num78 - num101) - 2; num100 > -1; num116--)
                        {
                            for (int num117 = (num76 - num100) - 1; num117 <= ((num76 + num100) + 1); num117++)
                            {
                                Main.tile[num117, num116].active = true;
                                Main.tile[num117, num116].type = 0x2d;
                            }
                            num100 -= genRand.Next(1, 3);
                        }
                        JChestX[numJChests] = num76;
                        JChestY[numJChests] = num78;
                        numJChests++;
                    }
                }
            }
            for (int num118 = 0; num118 < Main.maxTilesX; num118++)
            {
                for (int num119 = 0; num119 < Main.maxTilesY; num119++)
                {
                    if (Main.tile[num118, num119].active)
                    {
                        try
                        {
                            grassSpread = 0;
                            SpreadGrass(num118, num119, 0x3b, 60, true);
                        }
                        catch
                        {
                            grassSpread = 0;
                            SpreadGrass(num118, num119, 0x3b, 60, false);
                        }
                    }
                }
            }
            numIslandHouses = 0;
            houseCount = 0;
            Main.statusText = "Generating floating islands...";
            for (int num120 = 0; num120 < ((int) (Main.maxTilesX * 0.0008)); num120++)
            {
                int num121 = 0;
                bool flag6 = false;
                int num122 = genRand.Next((int) (Main.maxTilesX * 0.1), (int) (Main.maxTilesX * 0.9));
                bool flag7 = false;
                while (!flag7)
                {
                    flag7 = true;
                    while ((num122 > ((Main.maxTilesX / 2) - 80)) && (num122 < ((Main.maxTilesX / 2) + 80)))
                    {
                        num122 = genRand.Next((int) (Main.maxTilesX * 0.1), (int) (Main.maxTilesX * 0.9));
                    }
                    for (int num123 = 0; num123 < numIslandHouses; num123++)
                    {
                        if ((num122 > (fihX[num123] - 80)) && (num122 < (fihX[num123] + 80)))
                        {
                            num121++;
                            flag7 = false;
                            break;
                        }
                    }
                    if (num121 >= 200)
                    {
                        flag6 = true;
                        break;
                    }
                }
                if (!flag6)
                {
                    for (int num124 = 200; num124 < Main.worldSurface; num124++)
                    {
                        if (Main.tile[num122, num124].active)
                        {
                            int num125 = num122;
                            int num126 = genRand.Next(90, num124 - 100);
                            while (num126 > (num2 - 50.0))
                            {
                                num126--;
                            }
                            FloatingIsland(num125, num126);
                            fihX[numIslandHouses] = num125;
                            fihY[numIslandHouses] = num126;
                            numIslandHouses++;
                            break;
                        }
                    }
                }
            }
            Main.statusText = "Adding mushroom patches...";
            for (int num127 = 0; num127 < (Main.maxTilesX / 500); num127++)
            {
                int num128 = genRand.Next((int) (Main.maxTilesX * 0.3), (int) (Main.maxTilesX * 0.7));
                int num129 = genRand.Next((int) Main.rockLayer, Main.maxTilesY - 350);
                ShroomPatch(num128, num129);
            }
            for (int num130 = 0; num130 < Main.maxTilesX; num130++)
            {
                for (int num131 = (int) Main.worldSurface; num131 < Main.maxTilesY; num131++)
                {
                    if (Main.tile[num130, num131].active)
                    {
                        grassSpread = 0;
                        SpreadGrass(num130, num131, 0x3b, 70, false);
                    }
                }
            }
            Main.statusText = "Placing mud in the dirt...";
            for (int num132 = 0; num132 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.001)); num132++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num5, Main.maxTilesY), (double) genRand.Next(2, 6), genRand.Next(2, 40), 0x3b, false, 0f, 0f, false, true);
            }
            Main.statusText = "Adding silt...";
            for (int num133 = 0; num133 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.0001)); num133++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num6, Main.maxTilesY), (double) genRand.Next(5, 12), genRand.Next(15, 50), 0x7b, false, 0f, 0f, false, true);
            }
            for (int num134 = 0; num134 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.0005)); num134++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num6, Main.maxTilesY), (double) genRand.Next(2, 5), genRand.Next(2, 5), 0x7b, false, 0f, 0f, false, true);
            }
            Main.statusText = "Adding shinies...";
            for (int num135 = 0; num135 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 6E-05)); num135++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num2, (int) num3), (double) genRand.Next(3, 6), genRand.Next(2, 6), 7, false, 0f, 0f, false, true);
            }
            for (int num136 = 0; num136 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 8E-05)); num136++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num3, (int) num6), (double) genRand.Next(3, 7), genRand.Next(3, 7), 7, false, 0f, 0f, false, true);
            }
            for (int num137 = 0; num137 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.0002)); num137++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num5, Main.maxTilesY), (double) genRand.Next(4, 9), genRand.Next(4, 8), 7, false, 0f, 0f, false, true);
            }
            for (int num138 = 0; num138 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 3E-05)); num138++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num2, (int) num3), (double) genRand.Next(3, 7), genRand.Next(2, 5), 6, false, 0f, 0f, false, true);
            }
            for (int num139 = 0; num139 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 8E-05)); num139++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num3, (int) num6), (double) genRand.Next(3, 6), genRand.Next(3, 6), 6, false, 0f, 0f, false, true);
            }
            for (int num140 = 0; num140 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.0002)); num140++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num5, Main.maxTilesY), (double) genRand.Next(4, 9), genRand.Next(4, 8), 6, false, 0f, 0f, false, true);
            }
            for (int num141 = 0; num141 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 2.6E-05)); num141++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num3, (int) num6), (double) genRand.Next(3, 6), genRand.Next(3, 6), 9, false, 0f, 0f, false, true);
            }
            for (int num142 = 0; num142 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.00015)); num142++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num5, Main.maxTilesY), (double) genRand.Next(4, 9), genRand.Next(4, 8), 9, false, 0f, 0f, false, true);
            }
            for (int num143 = 0; num143 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.00017)); num143++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next(0, (int) num2), (double) genRand.Next(4, 9), genRand.Next(4, 8), 9, false, 0f, 0f, false, true);
            }
            for (int num144 = 0; num144 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.00012)); num144++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num5, Main.maxTilesY), (double) genRand.Next(4, 8), genRand.Next(4, 8), 8, false, 0f, 0f, false, true);
            }
            for (int num145 = 0; num145 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.00012)); num145++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next(0, ((int) num2) - 20), (double) genRand.Next(4, 8), genRand.Next(4, 8), 8, false, 0f, 0f, false, true);
            }
            for (int num146 = 0; num146 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 2E-05)); num146++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next((int) num5, Main.maxTilesY), (double) genRand.Next(2, 4), genRand.Next(3, 6), 0x16, false, 0f, 0f, false, true);
            }
            Main.statusText = "Adding webs...";
            for (int num147 = 0; num147 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.0006)); num147++)
            {
                int num148 = genRand.Next(20, Main.maxTilesX - 20);
                int num149 = genRand.Next((int) num2, Main.maxTilesY - 20);
                if (num147 < numMCaves)
                {
                    num148 = mCaveX[num147];
                    num149 = mCaveY[num147];
                }
                if (!Main.tile[num148, num149].active && ((num149 > Main.worldSurface) || (Main.tile[num148, num149].wall > 0)))
                {
                    while (!Main.tile[num148, num149].active && (num149 > ((int) num2)))
                    {
                        num149--;
                    }
                    num149++;
                    int num150 = 1;
                    if (genRand.Next(2) == 0)
                    {
                        num150 = -1;
                    }
                    while ((!Main.tile[num148, num149].active && (num148 > 10)) && (num148 < (Main.maxTilesX - 10)))
                    {
                        num148 += num150;
                    }
                    num148 -= num150;
                    if ((num149 > Main.worldSurface) || (Main.tile[num148, num149].wall > 0))
                    {
                        TileRunner(num148, num149, (double) genRand.Next(4, 11), genRand.Next(2, 4), 0x33, true, (float) num150, -1f, false, false);
                    }
                }
            }
            Main.statusText = "Creating underworld: 0%";
            int num151 = Main.maxTilesY - genRand.Next(150, 190);
            for (int num152 = 0; num152 < Main.maxTilesX; num152++)
            {
                num151 += genRand.Next(-3, 4);
                if (num151 < (Main.maxTilesY - 190))
                {
                    num151 = Main.maxTilesY - 190;
                }
                if (num151 > (Main.maxTilesY - 160))
                {
                    num151 = Main.maxTilesY - 160;
                }
                for (int num153 = (num151 - 20) - genRand.Next(3); num153 < Main.maxTilesY; num153++)
                {
                    if (num153 >= num151)
                    {
                        Main.tile[num152, num153].active = false;
                        Main.tile[num152, num153].lava = false;
                        Main.tile[num152, num153].liquid = 0;
                    }
                    else
                    {
                        Main.tile[num152, num153].type = 0x39;
                    }
                }
            }
            int num154 = Main.maxTilesY - genRand.Next(40, 70);
            for (int num155 = 10; num155 < (Main.maxTilesX - 10); num155++)
            {
                num154 += genRand.Next(-10, 11);
                if (num154 > (Main.maxTilesY - 60))
                {
                    num154 = Main.maxTilesY - 60;
                }
                if (num154 < (Main.maxTilesY - 100))
                {
                    num154 = Main.maxTilesY - 120;
                }
                for (int num156 = num154; num156 < (Main.maxTilesY - 10); num156++)
                {
                    if (!Main.tile[num155, num156].active)
                    {
                        Main.tile[num155, num156].lava = true;
                        Main.tile[num155, num156].liquid = 0xff;
                    }
                }
            }
            for (int num157 = 0; num157 < Main.maxTilesX; num157++)
            {
                if (genRand.Next(50) == 0)
                {
                    int num158 = Main.maxTilesY - 0x41;
                    while (!Main.tile[num157, num158].active && (num158 > (Main.maxTilesY - 0x87)))
                    {
                        num158--;
                    }
                    TileRunner(genRand.Next(0, Main.maxTilesX), num158 + genRand.Next(20, 50), (double) genRand.Next(15, 20), 0x3e8, 0x39, true, 0f, (float) genRand.Next(1, 3), true, true);
                }
            }
            Liquid.QuickWater(-2, -1, -1);
            for (int num159 = 0; num159 < Main.maxTilesX; num159++)
            {
                float num160 = ((float) num159) / ((float) (Main.maxTilesX - 1));
                Main.statusText = "Creating underworld: " + ((int) (((num160 * 100f) / 2f) + 50f)) + "%";
                if (genRand.Next(13) == 0)
                {
                    int num161 = Main.maxTilesY - 0x41;
                    while (((Main.tile[num159, num161].liquid > 0) || Main.tile[num159, num161].active) && (num161 > (Main.maxTilesY - 140)))
                    {
                        num161--;
                    }
                    TileRunner(num159, num161 - genRand.Next(2, 5), (double) genRand.Next(5, 30), 0x3e8, 0x39, true, 0f, (float) genRand.Next(1, 3), true, true);
                    float num162 = genRand.Next(1, 3);
                    if (genRand.Next(3) == 0)
                    {
                        num162 *= 0.5f;
                    }
                    if (genRand.Next(2) == 0)
                    {
                        TileRunner(num159, num161 - genRand.Next(2, 5), (double) ((int) (genRand.Next(5, 15) * num162)), (int) (genRand.Next(10, 15) * num162), 0x39, true, 1f, 0.3f, false, true);
                    }
                    if (genRand.Next(2) == 0)
                    {
                        num162 = genRand.Next(1, 3);
                        TileRunner(num159, num161 - genRand.Next(2, 5), (double) ((int) (genRand.Next(5, 15) * num162)), (int) (genRand.Next(10, 15) * num162), 0x39, true, -1f, 0.3f, false, true);
                    }
                    TileRunner(num159 + genRand.Next(-10, 10), num161 + genRand.Next(-10, 10), (double) genRand.Next(5, 15), genRand.Next(5, 10), -2, false, (float) genRand.Next(-1, 3), (float) genRand.Next(-1, 3), false, true);
                    if (genRand.Next(3) == 0)
                    {
                        TileRunner(num159 + genRand.Next(-10, 10), num161 + genRand.Next(-10, 10), (double) genRand.Next(10, 30), genRand.Next(10, 20), -2, false, (float) genRand.Next(-1, 3), (float) genRand.Next(-1, 3), false, true);
                    }
                    if (genRand.Next(5) == 0)
                    {
                        TileRunner(num159 + genRand.Next(-15, 15), num161 + genRand.Next(-15, 10), (double) genRand.Next(15, 30), genRand.Next(5, 20), -2, false, (float) genRand.Next(-1, 3), (float) genRand.Next(-1, 3), false, true);
                    }
                }
            }
            for (int num163 = 0; num163 < Main.maxTilesX; num163++)
            {
                TileRunner(genRand.Next(20, Main.maxTilesX - 20), genRand.Next(Main.maxTilesY - 180, Main.maxTilesY - 10), (double) genRand.Next(2, 7), genRand.Next(2, 7), -2, false, 0f, 0f, false, true);
            }
            for (int num164 = 0; num164 < Main.maxTilesX; num164++)
            {
                if (!Main.tile[num164, Main.maxTilesY - 0x91].active)
                {
                    Main.tile[num164, Main.maxTilesY - 0x91].liquid = 0xff;
                    Main.tile[num164, Main.maxTilesY - 0x91].lava = true;
                }
                if (!Main.tile[num164, Main.maxTilesY - 0x90].active)
                {
                    Main.tile[num164, Main.maxTilesY - 0x90].liquid = 0xff;
                    Main.tile[num164, Main.maxTilesY - 0x90].lava = true;
                }
            }
            for (int num165 = 0; num165 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.0008)); num165++)
            {
                TileRunner(genRand.Next(0, Main.maxTilesX), genRand.Next(Main.maxTilesY - 140, Main.maxTilesY), (double) genRand.Next(2, 7), genRand.Next(3, 7), 0x3a, false, 0f, 0f, false, true);
            }
            AddHellHouses();
            int num166 = genRand.Next(2, (int) (Main.maxTilesX * 0.005));
            for (int num167 = 0; num167 < num166; num167++)
            {
                float num168 = ((float) num167) / ((float) num166);
                Main.statusText = "Adding water bodies: " + ((int) (num168 * 100f)) + "%";
                int num169 = genRand.Next(300, Main.maxTilesX - 300);
                while ((num169 > ((Main.maxTilesX / 2) - 50)) && (num169 < ((Main.maxTilesX / 2) + 50)))
                {
                    num169 = genRand.Next(300, Main.maxTilesX - 300);
                }
                int num170 = ((int) num2) - 20;
                while (!Main.tile[num169, num170].active)
                {
                    num170++;
                }
                Lakinater(num169, num170);
            }
            int x = 0;
            if (num9 == -1)
            {
                x = genRand.Next((int) (Main.maxTilesX * 0.05), (int) (Main.maxTilesX * 0.2));
                num9 = -1;
            }
            else
            {
                x = genRand.Next((int) (Main.maxTilesX * 0.8), (int) (Main.maxTilesX * 0.95));
                num9 = 1;
            }
            int y = ((int) ((Main.rockLayer + Main.maxTilesY) / 2.0)) + genRand.Next(-200, 200);
            MakeDungeon(x, y, 0x29, 7);
            for (int num173 = 0; num173 < (Main.maxTilesX * 0.00045); num173++)
            {
                float num174 = (float) (((double) num173) / (Main.maxTilesX * 0.00045));
                Main.statusText = "Making the world evil: " + ((int) (num174 * 100f)) + "%";
                bool flag8 = false;
                int num175 = 0;
                int num176 = 0;
                int num177 = 0;
                while (!flag8)
                {
                    int num178 = 0;
                    flag8 = true;
                    int num179 = Main.maxTilesX / 2;
                    int num180 = 200;
                    num175 = genRand.Next(320, Main.maxTilesX - 320);
                    num176 = (num175 - genRand.Next(200)) - 100;
                    num177 = (num175 + genRand.Next(200)) + 100;
                    if (num176 < 0x11d)
                    {
                        num176 = 0x11d;
                    }
                    if (num177 > (Main.maxTilesX - 0x11d))
                    {
                        num177 = Main.maxTilesX - 0x11d;
                    }
                    if ((num175 > (num179 - num180)) && (num175 < (num179 + num180)))
                    {
                        flag8 = false;
                    }
                    if ((num176 > (num179 - num180)) && (num176 < (num179 + num180)))
                    {
                        flag8 = false;
                    }
                    if ((num177 > (num179 - num180)) && (num177 < (num179 + num180)))
                    {
                        flag8 = false;
                    }
                    for (int num181 = num176; num181 < num177; num181++)
                    {
                        for (int num182 = 0; num182 < ((int) Main.worldSurface); num182 += 5)
                        {
                            if (Main.tile[num181, num182].active && Main.tileDungeon[Main.tile[num181, num182].type])
                            {
                                flag8 = false;
                                break;
                            }
                            if (!flag8)
                            {
                                break;
                            }
                        }
                    }
                    if (((num178 < 200) && (JungleX > num176)) && (JungleX < num177))
                    {
                        num178++;
                        flag8 = false;
                    }
                }
                int num183 = 0;
                for (int num184 = num176; num184 < num177; num184++)
                {
                    if (num183 > 0)
                    {
                        num183--;
                    }
                    if ((num184 == num175) || (num183 == 0))
                    {
                        for (int num185 = (int) num2; num185 < (Main.worldSurface - 1.0); num185++)
                        {
                            if (Main.tile[num184, num185].active || (Main.tile[num184, num185].wall > 0))
                            {
                                if (num184 == num175)
                                {
                                    num183 = 20;
                                    ChasmRunner(num184, num185, genRand.Next(150) + 150, true);
                                }
                                else if ((genRand.Next(0x23) == 0) && (num183 == 0))
                                {
                                    num183 = 30;
                                    bool makeOrb = true;
                                    ChasmRunner(num184, num185, genRand.Next(50) + 50, makeOrb);
                                }
                                break;
                            }
                        }
                    }
                    for (int num186 = (int) num2; num186 < (Main.worldSurface - 1.0); num186++)
                    {
                        if (Main.tile[num184, num186].active)
                        {
                            int num187 = num186 + genRand.Next(10, 14);
                            for (int num188 = num186; num188 < num187; num188++)
                            {
                                if (((Main.tile[num184, num188].type == 0x3b) || (Main.tile[num184, num188].type == 60)) && ((num184 >= (num176 + genRand.Next(5))) && (num184 < (num177 - genRand.Next(5)))))
                                {
                                    Main.tile[num184, num188].type = 0;
                                }
                            }
                            break;
                        }
                    }
                }
                double num189 = Main.worldSurface + 40.0;
                for (int num190 = num176; num190 < num177; num190++)
                {
                    num189 += genRand.Next(-2, 3);
                    if (num189 < (Main.worldSurface + 30.0))
                    {
                        num189 = Main.worldSurface + 30.0;
                    }
                    if (num189 > (Main.worldSurface + 50.0))
                    {
                        num189 = Main.worldSurface + 50.0;
                    }
                    num52 = num190;
                    bool flag10 = false;
                    for (int num191 = (int) num2; num191 < num189; num191++)
                    {
                        if (Main.tile[num52, num191].active)
                        {
                            if (((Main.tile[num52, num191].type == 0x35) && (num52 >= (num176 + genRand.Next(5)))) && (num52 <= (num177 - genRand.Next(5))))
                            {
                                Main.tile[num52, num191].type = 0;
                            }
                            if (((Main.tile[num52, num191].type == 0) && (num191 < (Main.worldSurface - 1.0))) && !flag10)
                            {
                                grassSpread = 0;
                                SpreadGrass(num52, num191, 0, 0x17, true);
                            }
                            flag10 = true;
                            if (((Main.tile[num52, num191].type == 1) && (num52 >= (num176 + genRand.Next(5)))) && (num52 <= (num177 - genRand.Next(5))))
                            {
                                Main.tile[num52, num191].type = 0x19;
                            }
                            if (Main.tile[num52, num191].type == 2)
                            {
                                Main.tile[num52, num191].type = 0x17;
                            }
                        }
                    }
                }
                for (int num192 = num176; num192 < num177; num192++)
                {
                    for (int num193 = 0; num193 < (Main.maxTilesY - 50); num193++)
                    {
                        if (Main.tile[num192, num193].active && (Main.tile[num192, num193].type == 0x1f))
                        {
                            int num194 = num192 - 13;
                            int num195 = num192 + 13;
                            int num196 = num193 - 13;
                            int num197 = num193 + 13;
                            for (int num198 = num194; num198 < num195; num198++)
                            {
                                if ((num198 > 10) && (num198 < (Main.maxTilesX - 10)))
                                {
                                    for (int num199 = num196; num199 < num197; num199++)
                                    {
                                        if ((((Math.Abs((int) (num198 - num192)) + Math.Abs((int) (num199 - num193))) < (9 + genRand.Next(11))) && (genRand.Next(3) != 0)) && (Main.tile[num198, num199].type != 0x1f))
                                        {
                                            Main.tile[num198, num199].active = true;
                                            Main.tile[num198, num199].type = 0x19;
                                            if ((Math.Abs((int) (num198 - num192)) <= 1) && (Math.Abs((int) (num199 - num193)) <= 1))
                                            {
                                                Main.tile[num198, num199].active = false;
                                            }
                                        }
                                        if (((Main.tile[num198, num199].type != 0x1f) && (Math.Abs((int) (num198 - num192)) <= (2 + genRand.Next(3)))) && (Math.Abs((int) (num199 - num193)) <= (2 + genRand.Next(3))))
                                        {
                                            Main.tile[num198, num199].active = false;
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            Main.statusText = "Generating mountain caves...";
            for (int num200 = 0; num200 < numMCaves; num200++)
            {
                int num201 = mCaveX[num200];
                int num202 = mCaveY[num200];
                CaveOpenater(num201, num202);
                Cavinator(num201, num202, genRand.Next(40, 50));
            }
            int num203 = 0;
            int num204 = 0;
            int num205 = 20;
            int num206 = Main.maxTilesX - 20;
            Main.statusText = "Creating beaches...";
            for (int num207 = 0; num207 < 2; num207++)
            {
                int num208 = 0;
                int num209 = 0;
                if (num207 == 0)
                {
                    num208 = 0;
                    num209 = genRand.Next(0x7d, 200) + 50;
                    if (num9 == 1)
                    {
                        num209 = 0x113;
                    }
                    int num210 = 0;
                    float num211 = 1f;
                    int num212 = 0;
                    while (!Main.tile[num209 - 1, num212].active)
                    {
                        num212++;
                    }
                    num203 = num212;
                    num212 += genRand.Next(1, 5);
                    for (int num213 = num209 - 1; num213 >= num208; num213--)
                    {
                        num210++;
                        if (num210 < 3)
                        {
                            num211 += genRand.Next(10, 20) * 0.2f;
                        }
                        else if (num210 < 6)
                        {
                            num211 += genRand.Next(10, 20) * 0.15f;
                        }
                        else if (num210 < 9)
                        {
                            num211 += genRand.Next(10, 20) * 0.1f;
                        }
                        else if (num210 < 15)
                        {
                            num211 += genRand.Next(10, 20) * 0.07f;
                        }
                        else if (num210 < 50)
                        {
                            num211 += genRand.Next(10, 20) * 0.05f;
                        }
                        else if (num210 < 0x4b)
                        {
                            num211 += genRand.Next(10, 20) * 0.04f;
                        }
                        else if (num210 < 100)
                        {
                            num211 += genRand.Next(10, 20) * 0.03f;
                        }
                        else if (num210 < 0x7d)
                        {
                            num211 += genRand.Next(10, 20) * 0.02f;
                        }
                        else if (num210 < 150)
                        {
                            num211 += genRand.Next(10, 20) * 0.01f;
                        }
                        else if (num210 < 0xaf)
                        {
                            num211 += genRand.Next(10, 20) * 0.005f;
                        }
                        else if (num210 < 200)
                        {
                            num211 += genRand.Next(10, 20) * 0.001f;
                        }
                        else if (num210 < 230)
                        {
                            num211 += genRand.Next(10, 20) * 0.01f;
                        }
                        else if (num210 < 0xeb)
                        {
                            num211 += genRand.Next(10, 20) * 0.05f;
                        }
                        else if (num210 < 240)
                        {
                            num211 += genRand.Next(10, 20) * 0.1f;
                        }
                        else if (num210 < 0xf5)
                        {
                            num211 += genRand.Next(10, 20) * 0.05f;
                        }
                        else if (num210 < 0xff)
                        {
                            num211 += genRand.Next(10, 20) * 0.01f;
                        }
                        if (num210 == 0xeb)
                        {
                            num206 = num213;
                        }
                        if (num210 == 0xeb)
                        {
                            num205 = num213;
                        }
                        int num214 = genRand.Next(15, 20);
                        for (int num215 = 0; num215 < ((num212 + num211) + num214); num215++)
                        {
                            if (num215 < ((num212 + (num211 * 0.75f)) - 3f))
                            {
                                Main.tile[num213, num215].active = false;
                                if (num215 > num212)
                                {
                                    Main.tile[num213, num215].liquid = 0xff;
                                }
                                else if (num215 == num212)
                                {
                                    Main.tile[num213, num215].liquid = 0x7f;
                                }
                            }
                            else if (num215 > num212)
                            {
                                Main.tile[num213, num215].type = 0x35;
                                Main.tile[num213, num215].active = true;
                            }
                            Main.tile[num213, num215].wall = 0;
                        }
                    }
                }
                else
                {
                    num208 = (Main.maxTilesX - genRand.Next(0x7d, 200)) - 50;
                    num209 = Main.maxTilesX;
                    if (num9 == -1)
                    {
                        num208 = Main.maxTilesX - 0x113;
                    }
                    float num216 = 1f;
                    int num217 = 0;
                    int num218 = 0;
                    while (!Main.tile[num208, num218].active)
                    {
                        num218++;
                    }
                    num204 = num218;
                    num218 += genRand.Next(1, 5);
                    for (int num219 = num208; num219 < num209; num219++)
                    {
                        num217++;
                        if (num217 < 3)
                        {
                            num216 += genRand.Next(10, 20) * 0.2f;
                        }
                        else if (num217 < 6)
                        {
                            num216 += genRand.Next(10, 20) * 0.15f;
                        }
                        else if (num217 < 9)
                        {
                            num216 += genRand.Next(10, 20) * 0.1f;
                        }
                        else if (num217 < 15)
                        {
                            num216 += genRand.Next(10, 20) * 0.07f;
                        }
                        else if (num217 < 50)
                        {
                            num216 += genRand.Next(10, 20) * 0.05f;
                        }
                        else if (num217 < 0x4b)
                        {
                            num216 += genRand.Next(10, 20) * 0.04f;
                        }
                        else if (num217 < 100)
                        {
                            num216 += genRand.Next(10, 20) * 0.03f;
                        }
                        else if (num217 < 0x7d)
                        {
                            num216 += genRand.Next(10, 20) * 0.02f;
                        }
                        else if (num217 < 150)
                        {
                            num216 += genRand.Next(10, 20) * 0.01f;
                        }
                        else if (num217 < 0xaf)
                        {
                            num216 += genRand.Next(10, 20) * 0.005f;
                        }
                        else if (num217 < 200)
                        {
                            num216 += genRand.Next(10, 20) * 0.001f;
                        }
                        else if (num217 < 230)
                        {
                            num216 += genRand.Next(10, 20) * 0.01f;
                        }
                        else if (num217 < 0xeb)
                        {
                            num216 += genRand.Next(10, 20) * 0.05f;
                        }
                        else if (num217 < 240)
                        {
                            num216 += genRand.Next(10, 20) * 0.1f;
                        }
                        else if (num217 < 0xf5)
                        {
                            num216 += genRand.Next(10, 20) * 0.05f;
                        }
                        else if (num217 < 0xff)
                        {
                            num216 += genRand.Next(10, 20) * 0.01f;
                        }
                        if (num217 == 0xeb)
                        {
                            num206 = num219;
                        }
                        int num220 = genRand.Next(15, 20);
                        for (int num221 = 0; num221 < ((num218 + num216) + num220); num221++)
                        {
                            if ((num221 < ((num218 + (num216 * 0.75f)) - 3f)) && (num221 < (Main.worldSurface - 2.0)))
                            {
                                Main.tile[num219, num221].active = false;
                                if (num221 > num218)
                                {
                                    Main.tile[num219, num221].liquid = 0xff;
                                }
                                else if (num221 == num218)
                                {
                                    Main.tile[num219, num221].liquid = 0x7f;
                                }
                            }
                            else if (num221 > num218)
                            {
                                Main.tile[num219, num221].type = 0x35;
                                Main.tile[num219, num221].active = true;
                            }
                            Main.tile[num219, num221].wall = 0;
                        }
                    }
                }
            }
            while (!Main.tile[num205, num203].active)
            {
                num203++;
            }
            num203++;
            while (!Main.tile[num206, num204].active)
            {
                num204++;
            }
            num204++;
            Main.statusText = "Adding gems...";
            for (int num222 = 0x3f; num222 <= 0x44; num222++)
            {
                float num223 = 0f;
                switch (num222)
                {
                    case 0x43:
                        num223 = Main.maxTilesX * 0.5f;
                        break;

                    case 0x42:
                        num223 = Main.maxTilesX * 0.45f;
                        break;

                    case 0x3f:
                        num223 = Main.maxTilesX * 0.3f;
                        break;

                    case 0x41:
                        num223 = Main.maxTilesX * 0.25f;
                        break;

                    case 0x40:
                        num223 = Main.maxTilesX * 0.1f;
                        break;

                    case 0x44:
                        num223 = Main.maxTilesX * 0.05f;
                        break;
                }
                num223 *= 0.2f;
                for (int num224 = 0; num224 < num223; num224++)
                {
                    int num225 = genRand.Next(0, Main.maxTilesX);
                    int num226 = genRand.Next((int) Main.worldSurface, Main.maxTilesY);
                    while (Main.tile[num225, num226].type != 1)
                    {
                        num225 = genRand.Next(0, Main.maxTilesX);
                        num226 = genRand.Next((int) Main.worldSurface, Main.maxTilesY);
                    }
                    TileRunner(num225, num226, (double) genRand.Next(2, 6), genRand.Next(3, 7), num222, false, 0f, 0f, false, true);
                }
            }
            for (int num227 = 0; num227 < 2; num227++)
            {
                int num228 = 1;
                int num229 = 5;
                int num230 = Main.maxTilesX - 5;
                if (num227 == 1)
                {
                    num228 = -1;
                    num229 = Main.maxTilesX - 5;
                    num230 = 5;
                }
                for (int num231 = num229; num231 != num230; num231 += num228)
                {
                    for (int num232 = 10; num232 < (Main.maxTilesY - 10); num232++)
                    {
                        if ((Main.tile[num231, num232].active && (Main.tile[num231, num232].type == 0x35)) && (Main.tile[num231, num232 + 1].active && (Main.tile[num231, num232 + 1].type == 0x35)))
                        {
                            int num233 = num231 + num228;
                            int num234 = num232 + 1;
                            if (!Main.tile[num233, num232].active && !Main.tile[num233, num232 + 1].active)
                            {
                                while (!Main.tile[num233, num234].active)
                                {
                                    num234++;
                                }
                                num234--;
                                Main.tile[num231, num232].active = false;
                                Main.tile[num233, num234].active = true;
                                Main.tile[num233, num234].type = 0x35;
                            }
                        }
                    }
                }
            }
            for (int num235 = 0; num235 < Main.maxTilesX; num235++)
            {
                float num236 = ((float) num235) / ((float) (Main.maxTilesX - 1));
                Main.statusText = "Gravitating sand: " + ((int) (num236 * 100f)) + "%";
                for (int num237 = Main.maxTilesY - 5; num237 > 0; num237--)
                {
                    if (Main.tile[num235, num237].active)
                    {
                        if (Main.tile[num235, num237].type == 0x35)
                        {
                            for (int num238 = num237; !Main.tile[num235, num238 + 1].active && (num238 < (Main.maxTilesY - 5)); num238++)
                            {
                                Main.tile[num235, num238 + 1].active = true;
                                Main.tile[num235, num238 + 1].type = 0x35;
                            }
                        }
                        else if (Main.tile[num235, num237].type == 0x7b)
                        {
                            for (int num239 = num237; !Main.tile[num235, num239 + 1].active && (num239 < (Main.maxTilesY - 5)); num239++)
                            {
                                Main.tile[num235, num239 + 1].active = true;
                                Main.tile[num235, num239 + 1].type = 0x7b;
                                Main.tile[num235, num239].active = false;
                            }
                        }
                    }
                }
            }
            for (int num240 = 3; num240 < (Main.maxTilesX - 3); num240++)
            {
                float num241 = ((float) num240) / ((float) Main.maxTilesX);
                Main.statusText = "Cleaning up dirt backgrounds: " + ((int) ((num241 * 100f) + 1f)) + "%";
                bool flag11 = true;
                for (int num242 = 0; num242 < Main.worldSurface; num242++)
                {
                    if (flag11)
                    {
                        if (Main.tile[num240, num242].wall == 2)
                        {
                            Main.tile[num240, num242].wall = 0;
                        }
                        if (Main.tile[num240, num242].type != 0x35)
                        {
                            if (Main.tile[num240 - 1, num242].wall == 2)
                            {
                                Main.tile[num240 - 1, num242].wall = 0;
                            }
                            if ((Main.tile[num240 - 2, num242].wall == 2) && (genRand.Next(2) == 0))
                            {
                                Main.tile[num240 - 2, num242].wall = 0;
                            }
                            if ((Main.tile[num240 - 3, num242].wall == 2) && (genRand.Next(2) == 0))
                            {
                                Main.tile[num240 - 3, num242].wall = 0;
                            }
                            if (Main.tile[num240 + 1, num242].wall == 2)
                            {
                                Main.tile[num240 + 1, num242].wall = 0;
                            }
                            if ((Main.tile[num240 + 2, num242].wall == 2) && (genRand.Next(2) == 0))
                            {
                                Main.tile[num240 + 2, num242].wall = 0;
                            }
                            if ((Main.tile[num240 + 3, num242].wall == 2) && (genRand.Next(2) == 0))
                            {
                                Main.tile[num240 + 3, num242].wall = 0;
                            }
                            if (Main.tile[num240, num242].active)
                            {
                                flag11 = false;
                            }
                        }
                    }
                    else if (((((Main.tile[num240, num242].wall == 0) && (Main.tile[num240, num242 + 1].wall == 0)) && ((Main.tile[num240, num242 + 2].wall == 0) && (Main.tile[num240, num242 + 3].wall == 0))) && (((Main.tile[num240, num242 + 4].wall == 0) && (Main.tile[num240 - 1, num242].wall == 0)) && ((Main.tile[num240 + 1, num242].wall == 0) && (Main.tile[num240 - 2, num242].wall == 0)))) && ((((Main.tile[num240 + 2, num242].wall == 0) && !Main.tile[num240, num242].active) && (!Main.tile[num240, num242 + 1].active && !Main.tile[num240, num242 + 2].active)) && !Main.tile[num240, num242 + 3].active))
                    {
                        flag11 = true;
                    }
                }
            }
            for (int num243 = 0; num243 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 2E-05)); num243++)
            {
                float num244 = (float) (((double) num243) / ((Main.maxTilesX * Main.maxTilesY) * 2E-05));
                Main.statusText = "Placing altars: " + ((int) ((num244 * 100f) + 1f)) + "%";
                bool flag12 = false;
                int num245 = 0;
                while (!flag12)
                {
                    int num246 = genRand.Next(1, Main.maxTilesX);
                    int num247 = (int) (num3 + 20.0);
                    Place3x2(num246, num247, 0x1a);
                    if (Main.tile[num246, num247].type == 0x1a)
                    {
                        flag12 = true;
                    }
                    else
                    {
                        num245++;
                        if (num245 >= 0x2710)
                        {
                            flag12 = true;
                        }
                    }
                }
            }
            for (int num248 = 0; num248 < Main.maxTilesX; num248++)
            {
                num52 = num248;
                for (int num249 = (int) num2; num249 < (Main.worldSurface - 1.0); num249++)
                {
                    if (Main.tile[num52, num249].active)
                    {
                        if (Main.tile[num52, num249].type == 60)
                        {
                            Main.tile[num52, num249 - 1].liquid = 0xff;
                            Main.tile[num52, num249 - 2].liquid = 0xff;
                        }
                        break;
                    }
                }
            }
            for (int num250 = 400; num250 < (Main.maxTilesX - 400); num250++)
            {
                num52 = num250;
                for (int num251 = (int) num2; num251 < (Main.worldSurface - 1.0); num251++)
                {
                    if (Main.tile[num52, num251].active)
                    {
                        if (Main.tile[num52, num251].type == 0x35)
                        {
                            int num252 = num251;
                            while (num252 > num2)
                            {
                                num252--;
                                Main.tile[num52, num252].liquid = 0;
                            }
                        }
                        break;
                    }
                }
            }
            Liquid.QuickWater(3, -1, -1);
            WaterCheck();
            int num253 = 0;
            Liquid.quickSettle = true;
            while (num253 < 10)
            {
                int num254 = Liquid.numLiquid + LiquidBuffer.numLiquidBuffer;
                num253++;
                float num255 = 0f;
                while (Liquid.numLiquid > 0)
                {
                    float num256 = ((float) (num254 - (Liquid.numLiquid + LiquidBuffer.numLiquidBuffer))) / ((float) num254);
                    if ((Liquid.numLiquid + LiquidBuffer.numLiquidBuffer) > num254)
                    {
                        num254 = Liquid.numLiquid + LiquidBuffer.numLiquidBuffer;
                    }
                    if (num256 > num255)
                    {
                        num255 = num256;
                    }
                    else
                    {
                        num256 = num255;
                    }
                    if (num253 == 1)
                    {
                        Main.statusText = "Settling liquids: " + ((int) (((num256 * 100f) / 3f) + 33f)) + "%";
                    }
                    int num257 = 10;
                    if (num253 > num257)
                    {
                        num257 = num253;
                    }
                    Liquid.UpdateLiquid();
                }
                WaterCheck();
                Main.statusText = "Settling liquids: " + ((int) (((num253 * 10f) / 3f) + 66f)) + "%";
            }
            Liquid.quickSettle = false;
            float num258 = Main.maxTilesX / 0x1068;
            for (int num259 = 0; num259 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 2E-05)); num259++)
            {
                float num260 = (float) (((double) num259) / ((Main.maxTilesX * Main.maxTilesY) * 2E-05));
                Main.statusText = "Placing life crystals: " + ((int) ((num260 * 100f) + 1f)) + "%";
                bool flag13 = false;
                int num261 = 0;
                while (!flag13)
                {
                    if (AddLifeCrystal(genRand.Next(1, Main.maxTilesX), genRand.Next((int) (num3 + 20.0), Main.maxTilesY)))
                    {
                        flag13 = true;
                    }
                    else
                    {
                        num261++;
                        if (num261 >= 0x2710)
                        {
                            flag13 = true;
                        }
                    }
                }
            }
            int style = 0;
            for (int num263 = 0; num263 < (82f * num258); num263++)
            {
                if (style > 0x29)
                {
                    style = 0;
                }
                float num264 = ((float) num263) / (200f * num258);
                Main.statusText = "Placing statues: " + ((int) ((num264 * 100f) + 1f)) + "%";
                bool flag14 = false;
                int num265 = 0;
                while (!flag14)
                {
                    int num266 = genRand.Next(20, Main.maxTilesX - 20);
                    int num267 = genRand.Next((int) (num3 + 20.0), Main.maxTilesY - 300);
                    while (!Main.tile[num266, num267].active)
                    {
                        num267++;
                    }
                    num267--;
                    PlaceTile(num266, num267, 0x69, true, true, -1, style);
                    if (Main.tile[num266, num267].active && (Main.tile[num266, num267].type == 0x69))
                    {
                        flag14 = true;
                        style++;
                    }
                    else
                    {
                        num265++;
                        if (num265 >= 0x2710)
                        {
                            flag14 = true;
                        }
                    }
                }
            }
            for (int num268 = 0; num268 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 1.6E-05)); num268++)
            {
                float num269 = (float) (((double) num268) / ((Main.maxTilesX * Main.maxTilesY) * 1.6E-05));
                Main.statusText = "Hiding treasure: " + ((int) ((num269 * 100f) + 1f)) + "%";
                bool flag15 = false;
                int num270 = 0;
                while (!flag15)
                {
                    int num271 = genRand.Next(20, Main.maxTilesX - 20);
                    int num272 = genRand.Next((int) (num3 + 20.0), Main.maxTilesY - 230);
                    if (num268 <= (3f * num258))
                    {
                        num272 = genRand.Next(Main.maxTilesY - 200, Main.maxTilesY - 50);
                    }
                    while (((Main.tile[num271, num272].wall == 7) || (Main.tile[num271, num272].wall == 8)) || (Main.tile[num271, num272].wall == 9))
                    {
                        num271 = genRand.Next(1, Main.maxTilesX);
                        num272 = genRand.Next((int) (num3 + 20.0), Main.maxTilesY - 230);
                        if (num268 <= 3)
                        {
                            num272 = genRand.Next(Main.maxTilesY - 200, Main.maxTilesY - 50);
                        }
                    }
                    if (AddBuriedChest(num271, num272, 0, false, -1))
                    {
                        flag15 = true;
                        if (genRand.Next(2) == 0)
                        {
                            int num273 = num272;
                            while ((Main.tile[num271, num273].type != 0x15) && (num273 < (Main.maxTilesY - 300)))
                            {
                                num273++;
                            }
                            if (num272 < (Main.maxTilesY - 300))
                            {
                                MineHouse(num271, num273);
                            }
                        }
                    }
                    else
                    {
                        num270++;
                        if (num270 >= 0x1388)
                        {
                            flag15 = true;
                        }
                    }
                }
            }
            for (int num274 = 0; num274 < ((int) (Main.maxTilesX * 0.005)); num274++)
            {
                float num275 = (float) (((double) num274) / (Main.maxTilesX * 0.005));
                Main.statusText = "Hiding more treasure: " + ((int) ((num275 * 100f) + 1f)) + "%";
                bool flag16 = false;
                int num276 = 0;
                while (!flag16)
                {
                    int num277 = genRand.Next(300, Main.maxTilesX - 300);
                    int num278 = genRand.Next((int) num2, (int) Main.worldSurface);
                    bool flag17 = false;
                    if ((Main.tile[num277, num278].wall == 2) && !Main.tile[num277, num278].active)
                    {
                        flag17 = true;
                    }
                    if (flag17 && AddBuriedChest(num277, num278, 0, true, -1))
                    {
                        flag16 = true;
                    }
                    else
                    {
                        num276++;
                        if (num276 >= 0x7d0)
                        {
                            flag16 = true;
                        }
                    }
                }
            }
            int num279 = 0;
            for (int num280 = 0; num280 < numJChests; num280++)
            {
                float num281 = num280 / numJChests;
                Main.statusText = "Hiding jungle treasure: " + ((int) ((num281 * 100f) + 1f)) + "%";
                num279++;
                int contain = 0xd3;
                switch (num279)
                {
                    case 1:
                        contain = 0xd3;
                        break;

                    case 2:
                        contain = 0xd4;
                        break;

                    case 3:
                        contain = 0xd5;
                        break;
                }
                if (num279 > 3)
                {
                    num279 = 0;
                }
                if (!AddBuriedChest(JChestX[num280] + genRand.Next(2), JChestY[num280], contain, false, -1))
                {
                    for (int num283 = JChestX[num280]; num283 <= (JChestX[num280] + 1); num283++)
                    {
                        for (int num284 = JChestY[num280]; num284 <= (JChestY[num280] + 1); num284++)
                        {
                            KillTile(num283, num284, false, false, false);
                        }
                    }
                    AddBuriedChest(JChestX[num280], JChestY[num280], contain, false, -1);
                }
            }
            int num285 = 0;
            for (int num286 = 0; num286 < (9f * num258); num286++)
            {
                int num289;
                int num290;
                float num287 = ((float) num286) / (9f * num258);
                Main.statusText = "Hiding water treasure: " + ((int) ((num287 * 100f) + 1f)) + "%";
                int num288 = 0;
                num285++;
                switch (num285)
                {
                    case 1:
                        num288 = 0xba;
                        break;

                    case 2:
                        num288 = 0x115;
                        break;

                    default:
                        num288 = 0xbb;
                        num285 = 0;
                        break;
                }
                for (bool flag18 = false; !flag18; flag18 = AddBuriedChest(num289, num290, num288, false, -1))
                {
                    num289 = genRand.Next(1, Main.maxTilesX);
                    for (num290 = genRand.Next(1, Main.maxTilesY - 200); (Main.tile[num289, num290].liquid < 200) || Main.tile[num289, num290].lava; num290 = genRand.Next(1, Main.maxTilesY - 200))
                    {
                        num289 = genRand.Next(1, Main.maxTilesX);
                    }
                }
            }
            for (int num291 = 0; num291 < numIslandHouses; num291++)
            {
                IslandHouse(fihX[num291], fihY[num291]);
            }
            for (int num292 = 0; num292 < ((int) (Main.maxTilesX * 0.05)); num292++)
            {
                float num293 = (float) (((double) num292) / (Main.maxTilesX * 0.05));
                Main.statusText = "Placing traps: " + ((int) ((num293 * 100f) + 1f)) + "%";
                for (int num294 = 0; num294 < 0x3e8; num294++)
                {
                    int num295 = Main.rand.Next(200, Main.maxTilesX - 200);
                    int num296 = Main.rand.Next((int) Main.worldSurface, Main.maxTilesY - 300);
                    if ((Main.tile[num295, num296].wall == 0) && placeTrap(num295, num296, -1))
                    {
                        break;
                    }
                }
            }
            for (int num297 = 0; num297 < ((int) ((Main.maxTilesX * Main.maxTilesY) * 0.0008)); num297++)
            {
                float num298 = (float) (((double) num297) / ((Main.maxTilesX * Main.maxTilesY) * 0.0008));
                Main.statusText = "Placing breakables: " + ((int) ((num298 * 100f) + 1f)) + "%";
                bool flag19 = false;
                int num299 = 0;
            Label_60BD:
                while (!flag19)
                {
                    int num300 = genRand.Next((int) num3, Main.maxTilesY - 10);
                    if (num298 > 0.93)
                    {
                        num300 = Main.maxTilesY - 150;
                    }
                    else if (num298 > 0.75)
                    {
                        num300 = (int) num2;
                    }
                    int num301 = genRand.Next(1, Main.maxTilesX);
                    bool flag20 = false;
                    for (int num302 = num300; num302 < Main.maxTilesY; num302++)
                    {
                        if (!flag20)
                        {
                            if ((Main.tile[num301, num302].active && Main.tileSolid[Main.tile[num301, num302].type]) && !Main.tile[num301, num302 - 1].lava)
                            {
                                flag20 = true;
                            }
                        }
                        else
                        {
                            if (PlacePot(num301, num302, 0x1c))
                            {
                                flag19 = true;
                                goto Label_60BD;
                            }
                            num299++;
                            if (num299 >= 0x2710)
                            {
                                flag19 = true;
                                goto Label_60BD;
                            }
                        }
                    }
                }
            }
            for (int num303 = 0; num303 < (Main.maxTilesX / 200); num303++)
            {
                float num304 = num303 / (Main.maxTilesX / 200);
                Main.statusText = "Placing hellforges: " + ((int) ((num304 * 100f) + 1f)) + "%";
                bool flag21 = false;
                int num305 = 0;
                while (!flag21)
                {
                    int num306 = genRand.Next(1, Main.maxTilesX);
                    int num307 = genRand.Next(Main.maxTilesY - 250, Main.maxTilesY - 5);
                    try
                    {
                        if ((Main.tile[num306, num307].wall == 13) || (Main.tile[num306, num307].wall == 14))
                        {
                            while (!Main.tile[num306, num307].active)
                            {
                                num307++;
                            }
                            num307--;
                            PlaceTile(num306, num307, 0x4d, false, false, -1, 0);
                            if (Main.tile[num306, num307].type == 0x4d)
                            {
                                flag21 = true;
                            }
                            else
                            {
                                num305++;
                                if (num305 >= 0x2710)
                                {
                                    flag21 = true;
                                }
                            }
                        }
                        continue;
                    }
                    catch
                    {
                        continue;
                    }
                }
            }
            Main.statusText = "Spreading grass...";
            for (int num308 = 0; num308 < Main.maxTilesX; num308++)
            {
                num52 = num308;
                bool flag22 = true;
                for (int num309 = 0; num309 < (Main.worldSurface - 1.0); num309++)
                {
                    if (Main.tile[num52, num309].active)
                    {
                        if (flag22 && (Main.tile[num52, num309].type == 0))
                        {
                            try
                            {
                                grassSpread = 0;
                                SpreadGrass(num52, num309, 0, 2, true);
                            }
                            catch
                            {
                                grassSpread = 0;
                                SpreadGrass(num52, num309, 0, 2, false);
                            }
                        }
                        if (num309 > num3)
                        {
                            break;
                        }
                        flag22 = false;
                    }
                    else if (Main.tile[num52, num309].wall == 0)
                    {
                        flag22 = true;
                    }
                }
            }
            Main.statusText = "Growing cacti...";
            for (int num310 = 5; num310 < (Main.maxTilesX - 5); num310++)
            {
                if (genRand.Next(8) == 0)
                {
                    for (int num311 = 0; num311 < (Main.worldSurface - 1.0); num311++)
                    {
                        if ((Main.tile[num310, num311].active && (Main.tile[num310, num311].type == 0x35)) && (!Main.tile[num310, num311 - 1].active && (Main.tile[num310, num311 - 1].wall == 0)))
                        {
                            if ((num310 < 250) || (num310 > (Main.maxTilesX - 250)))
                            {
                                if (((Main.tile[num310, num311 - 2].liquid == 0xff) && (Main.tile[num310, num311 - 3].liquid == 0xff)) && (Main.tile[num310, num311 - 4].liquid == 0xff))
                                {
                                    PlaceTile(num310, num311 - 1, 0x51, true, false, -1, 0);
                                }
                            }
                            else if ((num310 > 400) && (num310 < (Main.maxTilesX - 400)))
                            {
                                PlantCactus(num310, num311);
                            }
                        }
                    }
                }
            }
            int num312 = 5;
            bool flag23 = true;
            while (flag23)
            {
                int num313 = (Main.maxTilesX / 2) + genRand.Next(-num312, num312 + 1);
                for (int num314 = 0; num314 < Main.maxTilesY; num314++)
                {
                    if (Main.tile[num313, num314].active)
                    {
                        Main.spawnTileX = num313;
                        Main.spawnTileY = num314;
                        break;
                    }
                }
                flag23 = false;
                num312++;
                if (Main.spawnTileY > Main.worldSurface)
                {
                    flag23 = true;
                }
                if (Main.tile[Main.spawnTileX, Main.spawnTileY - 1].liquid > 0)
                {
                    flag23 = true;
                }
            }
            for (int num315 = 10; Main.spawnTileY > Main.worldSurface; num315++)
            {
                int num316 = genRand.Next((Main.maxTilesX / 2) - num315, (Main.maxTilesX / 2) + num315);
                for (int num317 = 0; num317 < Main.maxTilesY; num317++)
                {
                    if (Main.tile[num316, num317].active)
                    {
                        Main.spawnTileX = num316;
                        Main.spawnTileY = num317;
                        break;
                    }
                }
            }
            int index = NPC.NewNPC(Main.spawnTileX * 0x10, Main.spawnTileY * 0x10, 0x16, 0);
            Main.npc[index].homeTileX = Main.spawnTileX;
            Main.npc[index].homeTileY = Main.spawnTileY;
            Main.npc[index].direction = 1;
            Main.npc[index].homeless = true;
            Main.statusText = "Planting sunflowers...";
            for (int num319 = 0; num319 < (Main.maxTilesX * 0.002); num319++)
            {
                int num320 = 0;
                int num321 = 0;
                int num322 = 0;
                int num1 = Main.maxTilesX / 2;
                num320 = genRand.Next(Main.maxTilesX);
                num321 = (num320 - genRand.Next(10)) - 7;
                num322 = (num320 + genRand.Next(10)) + 7;
                if (num321 < 0)
                {
                    num321 = 0;
                }
                if (num322 > (Main.maxTilesX - 1))
                {
                    num322 = Main.maxTilesX - 1;
                }
                for (int num323 = num321; num323 < num322; num323++)
                {
                    for (int num324 = 1; num324 < (Main.worldSurface - 1.0); num324++)
                    {
                        if (((Main.tile[num323, num324].type == 2) && Main.tile[num323, num324].active) && !Main.tile[num323, num324 - 1].active)
                        {
                            PlaceTile(num323, num324 - 1, 0x1b, true, false, -1, 0);
                        }
                        if (Main.tile[num323, num324].active)
                        {
                            break;
                        }
                    }
                }
            }
            Main.statusText = "Planting trees...";
            for (int num325 = 0; num325 < (Main.maxTilesX * 0.003); num325++)
            {
                int num326 = genRand.Next(50, Main.maxTilesX - 50);
                int num327 = genRand.Next(0x19, 50);
                for (int num328 = num326 - num327; num328 < (num326 + num327); num328++)
                {
                    for (int num329 = 20; num329 < Main.worldSurface; num329++)
                    {
                        GrowEpicTree(num328, num329);
                    }
                }
            }
            AddTrees();
            Main.statusText = "Planting herbs...";
            for (int num330 = 0; num330 < (Main.maxTilesX * 1.7); num330++)
            {
                PlantAlch();
            }
            Main.statusText = "Planting weeds...";
            AddPlants();
            for (int num331 = 0; num331 < Main.maxTilesX; num331++)
            {
                for (int num332 = 0; num332 < Main.maxTilesY; num332++)
                {
                    if (Main.tile[num331, num332].active)
                    {
                        if (((num332 >= ((int) Main.worldSurface)) && (Main.tile[num331, num332].type == 70)) && !Main.tile[num331, num332 - 1].active)
                        {
                            GrowShroom(num331, num332);
                            if (!Main.tile[num331, num332 - 1].active)
                            {
                                PlaceTile(num331, num332 - 1, 0x47, true, false, -1, 0);
                            }
                        }
                        if ((Main.tile[num331, num332].type == 60) && !Main.tile[num331, num332 - 1].active)
                        {
                            PlaceTile(num331, num332 - 1, 0x3d, true, false, -1, 0);
                        }
                    }
                }
            }
            Main.statusText = "Growing vines...";
            for (int num333 = 0; num333 < Main.maxTilesX; num333++)
            {
                int num334 = 0;
                for (int num335 = 0; num335 < Main.worldSurface; num335++)
                {
                    if ((num334 > 0) && !Main.tile[num333, num335].active)
                    {
                        Main.tile[num333, num335].active = true;
                        Main.tile[num333, num335].type = 0x34;
                        num334--;
                    }
                    else
                    {
                        num334 = 0;
                    }
                    if ((Main.tile[num333, num335].active && (Main.tile[num333, num335].type == 2)) && (genRand.Next(5) < 3))
                    {
                        num334 = genRand.Next(1, 10);
                    }
                }
                num334 = 0;
                for (int num336 = 0; num336 < Main.maxTilesY; num336++)
                {
                    if ((num334 > 0) && !Main.tile[num333, num336].active)
                    {
                        Main.tile[num333, num336].active = true;
                        Main.tile[num333, num336].type = 0x3e;
                        num334--;
                    }
                    else
                    {
                        num334 = 0;
                    }
                    if ((Main.tile[num333, num336].active && (Main.tile[num333, num336].type == 60)) && (genRand.Next(5) < 3))
                    {
                        num334 = genRand.Next(1, 10);
                    }
                }
            }
            Main.statusText = "Planting flowers...";
            for (int num337 = 0; num337 < (Main.maxTilesX * 0.005); num337++)
            {
                int num338 = genRand.Next(20, Main.maxTilesX - 20);
                int num339 = genRand.Next(5, 15);
                int num340 = genRand.Next(15, 30);
                for (int num341 = 1; num341 < (Main.worldSurface - 1.0); num341++)
                {
                    if (Main.tile[num338, num341].active)
                    {
                        for (int num342 = num338 - num339; num342 < (num338 + num339); num342++)
                        {
                            for (int num343 = num341 - num340; num343 < (num341 + num340); num343++)
                            {
                                if ((Main.tile[num342, num343].type == 3) || (Main.tile[num342, num343].type == 0x18))
                                {
                                    Main.tile[num342, num343].frameX = (short) (genRand.Next(6, 8) * 0x12);
                                }
                            }
                        }
                        break;
                    }
                }
            }
            Main.statusText = "Planting mushrooms...";
            for (int num344 = 0; num344 < (Main.maxTilesX * 0.002); num344++)
            {
                int num345 = genRand.Next(20, Main.maxTilesX - 20);
                int num346 = genRand.Next(4, 10);
                int num347 = genRand.Next(15, 30);
                for (int num348 = 1; num348 < (Main.worldSurface - 1.0); num348++)
                {
                    if (Main.tile[num345, num348].active)
                    {
                        for (int num349 = num345 - num346; num349 < (num345 + num346); num349++)
                        {
                            for (int num350 = num348 - num347; num350 < (num348 + num347); num350++)
                            {
                                if ((Main.tile[num349, num350].type == 3) || (Main.tile[num349, num350].type == 0x18))
                                {
                                    Main.tile[num349, num350].frameX = 0x90;
                                }
                            }
                        }
                        break;
                    }
                }
            }
            gen = false;
        }

        public static void GERunner(int i, int j, float speedX = 0f, float speedY = 0f, bool good = true)
        {
            Vector2 vector;
            Vector2 vector2;
            int num5 = genRand.Next(200, 250);
            float num6 = Main.maxTilesX / 0x1068;
            num5 = (int) (num5 * num6);
            double num7 = num5;
            vector.X = i;
            vector.Y = j;
            vector2.X = genRand.Next(-10, 11) * 0.1f;
            vector2.Y = genRand.Next(-10, 11) * 0.1f;
            if ((speedX != 0f) || (speedY != 0f))
            {
                vector2.X = speedX;
                vector2.Y = speedY;
            }
            bool flag = true;
            while (flag)
            {
                int num = (int) (vector.X - (num7 * 0.5));
                int maxTilesX = (int) (vector.X + (num7 * 0.5));
                int num2 = (int) (vector.Y - (num7 * 0.5));
                int maxTilesY = (int) (vector.Y + (num7 * 0.5));
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                for (int k = num; k < maxTilesX; k++)
                {
                    for (int m = num2; m < maxTilesY; m++)
                    {
                        if ((Math.Abs((float) (k - vector.X)) + Math.Abs((float) (m - vector.Y))) < ((num5 * 0.5) * (1.0 + (genRand.Next(-10, 11) * 0.015))))
                        {
                            if (good)
                            {
                                if (Main.tile[k, m].wall == 3)
                                {
                                    Main.tile[k, m].wall = 0x1c;
                                }
                                if (Main.tile[k, m].type == 2)
                                {
                                    Main.tile[k, m].type = 0x6d;
                                    SquareTileFrame(k, m, true);
                                }
                                else if (Main.tile[k, m].type == 1)
                                {
                                    Main.tile[k, m].type = 0x75;
                                    SquareTileFrame(k, m, true);
                                }
                                else if ((Main.tile[k, m].type == 0x35) || (Main.tile[k, m].type == 0x7b))
                                {
                                    Main.tile[k, m].type = 0x74;
                                    SquareTileFrame(k, m, true);
                                }
                                else if (Main.tile[k, m].type == 0x17)
                                {
                                    Main.tile[k, m].type = 0x6d;
                                    SquareTileFrame(k, m, true);
                                }
                                else if (Main.tile[k, m].type == 0x19)
                                {
                                    Main.tile[k, m].type = 0x75;
                                    SquareTileFrame(k, m, true);
                                }
                                else if (Main.tile[k, m].type == 0x70)
                                {
                                    Main.tile[k, m].type = 0x74;
                                    SquareTileFrame(k, m, true);
                                }
                            }
                            else if (Main.tile[k, m].type == 2)
                            {
                                Main.tile[k, m].type = 0x17;
                                SquareTileFrame(k, m, true);
                            }
                            else if (Main.tile[k, m].type == 1)
                            {
                                Main.tile[k, m].type = 0x19;
                                SquareTileFrame(k, m, true);
                            }
                            else if ((Main.tile[k, m].type == 0x35) || (Main.tile[k, m].type == 0x7b))
                            {
                                Main.tile[k, m].type = 0x70;
                                SquareTileFrame(k, m, true);
                            }
                            else if (Main.tile[k, m].type == 0x6d)
                            {
                                Main.tile[k, m].type = 0x17;
                                SquareTileFrame(k, m, true);
                            }
                            else if (Main.tile[k, m].type == 0x75)
                            {
                                Main.tile[k, m].type = 0x19;
                                SquareTileFrame(k, m, true);
                            }
                            else if (Main.tile[k, m].type == 0x74)
                            {
                                Main.tile[k, m].type = 0x70;
                                SquareTileFrame(k, m, true);
                            }
                        }
                    }
                }
                vector += vector2;
                vector2.X += genRand.Next(-10, 11) * 0.05f;
                if (vector2.X > (speedX + 1f))
                {
                    vector2.X = speedX + 1f;
                }
                if (vector2.X < (speedX - 1f))
                {
                    vector2.X = speedX - 1f;
                }
                if (((vector.X < -num5) || (vector.Y < -num5)) || ((vector.X > (Main.maxTilesX + num5)) || (vector.Y > (Main.maxTilesX + num5))))
                {
                    flag = false;
                }
            }
        }

        public static void GrowAlch(int x, int y)
        {
            if (Main.tile[x, y].active)
            {
                if ((Main.tile[x, y].type == 0x52) && (genRand.Next(50) == 0))
                {
                    Main.tile[x, y].type = 0x53;
                    if (Main.netMode == 2)
                    {
                        NetMessage.SendTileSquare(-1, x, y, 1);
                    }
                    SquareTileFrame(x, y, true);
                }
                else if (Main.tile[x, y].frameX == 0x24)
                {
                    if (Main.tile[x, y].type == 0x53)
                    {
                        Main.tile[x, y].type = 0x54;
                    }
                    else
                    {
                        Main.tile[x, y].type = 0x53;
                    }
                    if (Main.netMode == 2)
                    {
                        NetMessage.SendTileSquare(-1, x, y, 1);
                    }
                }
            }
        }

        public static void GrowCactus(int i, int j)
        {
            int num = j;
            int num2 = i;
            if ((Main.tile[i, j].active && (Main.tile[i, j - 1].liquid <= 0)) && (((Main.tile[i, j].type == 0x35) || (Main.tile[i, j].type == 80)) || ((Main.tile[i, j].type == 0x70) || (Main.tile[i, j].type == 0x74))))
            {
                if (((Main.tile[i, j].type == 0x35) || (Main.tile[i, j].type == 0x70)) || (Main.tile[i, j].type == 0x74))
                {
                    if ((!Main.tile[i, j - 1].active && !Main.tile[i - 1, j - 1].active) && !Main.tile[i + 1, j - 1].active)
                    {
                        int num3 = 0;
                        int num4 = 0;
                        for (int k = i - 6; k <= (i + 6); k++)
                        {
                            for (int m = j - 3; m <= (j + 1); m++)
                            {
                                try
                                {
                                    if (Main.tile[k, m].active)
                                    {
                                        if (Main.tile[k, m].type == 80)
                                        {
                                            num3++;
                                            if (num3 >= 4)
                                            {
                                                return;
                                            }
                                        }
                                        if (((Main.tile[k, m].type == 0x35) || (Main.tile[k, m].type == 0x70)) || (Main.tile[k, m].type == 0x74))
                                        {
                                            num4++;
                                        }
                                    }
                                }
                                catch
                                {
                                }
                            }
                        }
                        if (num4 > 10)
                        {
                            Main.tile[i, j - 1].active = true;
                            Main.tile[i, j - 1].type = 80;
                            if (Main.netMode == 2)
                            {
                                NetMessage.SendTileSquare(-1, i, j - 1, 1);
                            }
                            SquareTileFrame(num2, num - 1, true);
                        }
                    }
                }
                else if (Main.tile[i, j].type == 80)
                {
                    while (Main.tile[num2, num].active && (Main.tile[num2, num].type == 80))
                    {
                        num++;
                        if (!Main.tile[num2, num].active || (Main.tile[num2, num].type != 80))
                        {
                            if (((Main.tile[num2 - 1, num].active && (Main.tile[num2 - 1, num].type == 80)) && (Main.tile[num2 - 1, num - 1].active && (Main.tile[num2 - 1, num - 1].type == 80))) && (num2 >= i))
                            {
                                num2--;
                            }
                            if (((Main.tile[num2 + 1, num].active && (Main.tile[num2 + 1, num].type == 80)) && (Main.tile[num2 + 1, num - 1].active && (Main.tile[num2 + 1, num - 1].type == 80))) && (num2 <= i))
                            {
                                num2++;
                            }
                        }
                    }
                    num--;
                    int num7 = num - j;
                    int num8 = i - num2;
                    num2 = i - num8;
                    num = j;
                    int num9 = 11 - num7;
                    int num10 = 0;
                    for (int n = num2 - 2; n <= (num2 + 2); n++)
                    {
                        for (int num12 = num - num9; num12 <= (num + num7); num12++)
                        {
                            if (Main.tile[n, num12].active && (Main.tile[n, num12].type == 80))
                            {
                                num10++;
                            }
                        }
                    }
                    if (num10 < genRand.Next(11, 13))
                    {
                        num2 = i;
                        num = j;
                        if (num8 == 0)
                        {
                            if (num7 != 0)
                            {
                                bool flag = false;
                                bool flag2 = false;
                                if (Main.tile[num2, num - 1].active && (Main.tile[num2, num - 1].type == 80))
                                {
                                    if (((!Main.tile[num2 - 1, num].active && !Main.tile[num2 - 2, num + 1].active) && (!Main.tile[num2 - 1, num - 1].active && !Main.tile[num2 - 1, num + 1].active)) && !Main.tile[num2 - 2, num].active)
                                    {
                                        flag = true;
                                    }
                                    if (((!Main.tile[num2 + 1, num].active && !Main.tile[num2 + 2, num + 1].active) && (!Main.tile[num2 + 1, num - 1].active && !Main.tile[num2 + 1, num + 1].active)) && !Main.tile[num2 + 2, num].active)
                                    {
                                        flag2 = true;
                                    }
                                }
                                int num13 = genRand.Next(3);
                                if ((num13 != 0) || !flag)
                                {
                                    if ((num13 != 1) || !flag2)
                                    {
                                        if (num7 < genRand.Next(2, 8))
                                        {
                                            if (Main.tile[num2 - 1, num - 1].active)
                                            {
                                                byte type = Main.tile[num2 - 1, num - 1].type;
                                            }
                                            if ((!Main.tile[num2 + 1, num - 1].active || (Main.tile[num2 + 1, num - 1].type != 80)) && !Main.tile[num2, num - 1].active)
                                            {
                                                Main.tile[num2, num - 1].active = true;
                                                Main.tile[num2, num - 1].type = 80;
                                                SquareTileFrame(num2, num - 1, true);
                                                if (Main.netMode == 2)
                                                {
                                                    NetMessage.SendTileSquare(-1, num2, num - 1, 1);
                                                }
                                            }
                                        }
                                    }
                                    else
                                    {
                                        Main.tile[num2 + 1, num].active = true;
                                        Main.tile[num2 + 1, num].type = 80;
                                        SquareTileFrame(num2 + 1, num, true);
                                        if (Main.netMode == 2)
                                        {
                                            NetMessage.SendTileSquare(-1, num2 + 1, num, 1);
                                        }
                                    }
                                }
                                else
                                {
                                    Main.tile[num2 - 1, num].active = true;
                                    Main.tile[num2 - 1, num].type = 80;
                                    SquareTileFrame(num2 - 1, num, true);
                                    if (Main.netMode == 2)
                                    {
                                        NetMessage.SendTileSquare(-1, num2 - 1, num, 1);
                                    }
                                }
                            }
                            else if (!Main.tile[num2, num - 1].active)
                            {
                                Main.tile[num2, num - 1].active = true;
                                Main.tile[num2, num - 1].type = 80;
                                SquareTileFrame(num2, num - 1, true);
                                if (Main.netMode == 2)
                                {
                                    NetMessage.SendTileSquare(-1, num2, num - 1, 1);
                                }
                            }
                        }
                        else if (((!Main.tile[num2, num - 1].active && !Main.tile[num2, num - 2].active) && (!Main.tile[num2 + num8, num - 1].active && Main.tile[num2 - num8, num - 1].active)) && (Main.tile[num2 - num8, num - 1].type == 80))
                        {
                            Main.tile[num2, num - 1].active = true;
                            Main.tile[num2, num - 1].type = 80;
                            SquareTileFrame(num2, num - 1, true);
                            if (Main.netMode == 2)
                            {
                                NetMessage.SendTileSquare(-1, num2, num - 1, 1);
                            }
                        }
                    }
                }
            }
        }

        public static bool GrowEpicTree(int i, int y)
        {
            int num3;
            int num = y;
            while (Main.tile[i, num].type == 20)
            {
                num++;
            }
            if (((!Main.tile[i, num].active || (Main.tile[i, num].type != 2)) || ((Main.tile[i, num - 1].wall != 0) || (Main.tile[i, num - 1].liquid != 0))) || ((!Main.tile[i - 1, num].active || (((Main.tile[i - 1, num].type != 2) && (Main.tile[i - 1, num].type != 0x17)) && ((Main.tile[i - 1, num].type != 60) && (Main.tile[i - 1, num].type != 0x6d)))) && (!Main.tile[i + 1, num].active || (((Main.tile[i + 1, num].type != 2) && (Main.tile[i + 1, num].type != 0x17)) && ((Main.tile[i + 1, num].type != 60) && (Main.tile[i + 1, num].type != 0x6d))))))
            {
                goto Label_1051;
            }
            int num2 = 1;
            if (!EmptyTileCheck(i - num2, i + num2, num - 0x37, num - 1, 20))
            {
                goto Label_1051;
            }
            bool flag = false;
            bool flag2 = false;
            int num5 = genRand.Next(20, 30);
            for (int j = num - num5; j < num; j++)
            {
                Main.tile[i, j].frameNumber = (byte) genRand.Next(3);
                Main.tile[i, j].active = true;
                Main.tile[i, j].type = 5;
                num3 = genRand.Next(3);
                int num4 = genRand.Next(10);
                if ((j == (num - 1)) || (j == (num - num5)))
                {
                    num4 = 0;
                }
                while ((((num4 == 5) || (num4 == 7)) && flag) || (((num4 == 6) || (num4 == 7)) && flag2))
                {
                    num4 = genRand.Next(10);
                }
                flag = false;
                flag2 = false;
                if ((num4 == 5) || (num4 == 7))
                {
                    flag = true;
                }
                if ((num4 == 6) || (num4 == 7))
                {
                    flag2 = true;
                }
                if (num4 == 1)
                {
                    switch (num3)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 0x42;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 0x58;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 110;
                            break;
                    }
                }
                else if (num4 == 2)
                {
                    switch (num3)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0x16;
                            Main.tile[i, j].frameY = 0;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0x16;
                            Main.tile[i, j].frameY = 0x16;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0x16;
                            Main.tile[i, j].frameY = 0x2c;
                            break;
                    }
                }
                else if (num4 == 3)
                {
                    switch (num3)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0x2c;
                            Main.tile[i, j].frameY = 0x42;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0x2c;
                            Main.tile[i, j].frameY = 0x58;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0x2c;
                            Main.tile[i, j].frameY = 110;
                            break;
                    }
                }
                else if (num4 == 4)
                {
                    switch (num3)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0x16;
                            Main.tile[i, j].frameY = 0x42;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0x16;
                            Main.tile[i, j].frameY = 0x58;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0x16;
                            Main.tile[i, j].frameY = 110;
                            break;
                    }
                }
                else if (num4 == 5)
                {
                    switch (num3)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0x58;
                            Main.tile[i, j].frameY = 0;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0x58;
                            Main.tile[i, j].frameY = 0x16;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0x58;
                            Main.tile[i, j].frameY = 0x2c;
                            break;
                    }
                }
                else if (num4 == 6)
                {
                    switch (num3)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0x42;
                            Main.tile[i, j].frameY = 0x42;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0x42;
                            Main.tile[i, j].frameY = 0x58;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0x42;
                            Main.tile[i, j].frameY = 110;
                            break;
                    }
                }
                else if (num4 == 7)
                {
                    switch (num3)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 110;
                            Main.tile[i, j].frameY = 0x42;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 110;
                            Main.tile[i, j].frameY = 0x58;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 110;
                            Main.tile[i, j].frameY = 110;
                            break;
                    }
                }
                else
                {
                    switch (num3)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 0;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 0x16;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 0x2c;
                            break;
                    }
                }
                if ((num4 == 5) || (num4 == 7))
                {
                    Main.tile[i - 1, j].active = true;
                    Main.tile[i - 1, j].type = 5;
                    num3 = genRand.Next(3);
                    if (genRand.Next(3) < 2)
                    {
                        switch (num3)
                        {
                            case 0:
                                Main.tile[i - 1, j].frameX = 0x2c;
                                Main.tile[i - 1, j].frameY = 0xc6;
                                break;

                            case 1:
                                Main.tile[i - 1, j].frameX = 0x2c;
                                Main.tile[i - 1, j].frameY = 220;
                                break;

                            case 2:
                                Main.tile[i - 1, j].frameX = 0x2c;
                                Main.tile[i - 1, j].frameY = 0xf2;
                                break;
                        }
                    }
                    else
                    {
                        switch (num3)
                        {
                            case 0:
                                Main.tile[i - 1, j].frameX = 0x42;
                                Main.tile[i - 1, j].frameY = 0;
                                break;

                            case 1:
                                Main.tile[i - 1, j].frameX = 0x42;
                                Main.tile[i - 1, j].frameY = 0x16;
                                break;

                            case 2:
                                Main.tile[i - 1, j].frameX = 0x42;
                                Main.tile[i - 1, j].frameY = 0x2c;
                                break;
                        }
                    }
                }
                if ((num4 == 6) || (num4 == 7))
                {
                    Main.tile[i + 1, j].active = true;
                    Main.tile[i + 1, j].type = 5;
                    num3 = genRand.Next(3);
                    if (genRand.Next(3) < 2)
                    {
                        switch (num3)
                        {
                            case 0:
                                Main.tile[i + 1, j].frameX = 0x42;
                                Main.tile[i + 1, j].frameY = 0xc6;
                                break;

                            case 1:
                                Main.tile[i + 1, j].frameX = 0x42;
                                Main.tile[i + 1, j].frameY = 220;
                                break;

                            case 2:
                                Main.tile[i + 1, j].frameX = 0x42;
                                Main.tile[i + 1, j].frameY = 0xf2;
                                break;
                        }
                    }
                    else
                    {
                        switch (num3)
                        {
                            case 0:
                                Main.tile[i + 1, j].frameX = 0x58;
                                Main.tile[i + 1, j].frameY = 0x42;
                                break;

                            case 1:
                                Main.tile[i + 1, j].frameX = 0x58;
                                Main.tile[i + 1, j].frameY = 0x58;
                                break;

                            case 2:
                                Main.tile[i + 1, j].frameX = 0x58;
                                Main.tile[i + 1, j].frameY = 110;
                                break;
                        }
                    }
                }
            }
            int num7 = genRand.Next(3);
            bool flag3 = false;
            bool flag4 = false;
            if (Main.tile[i - 1, num].active && (((Main.tile[i - 1, num].type == 2) || (Main.tile[i - 1, num].type == 0x17)) || ((Main.tile[i - 1, num].type == 60) || (Main.tile[i - 1, num].type == 0x6d))))
            {
                flag3 = true;
            }
            if (Main.tile[i + 1, num].active && (((Main.tile[i + 1, num].type == 2) || (Main.tile[i + 1, num].type == 0x17)) || ((Main.tile[i + 1, num].type == 60) || (Main.tile[i + 1, num].type == 0x6d))))
            {
                flag4 = true;
            }
            if (!flag3)
            {
                switch (num7)
                {
                    case 0:
                        num7 = 2;
                        break;

                    case 1:
                        num7 = 3;
                        goto Label_0AE6;
                }
            }
        Label_0AE6:
            if (!flag4)
            {
                switch (num7)
                {
                    case 0:
                        num7 = 1;
                        break;

                    case 2:
                        num7 = 3;
                        break;
                }
            }
            if (flag3 && !flag4)
            {
                num7 = 1;
            }
            if (flag4 && !flag3)
            {
                num7 = 2;
            }
            if ((num7 == 0) || (num7 == 1))
            {
                Main.tile[i + 1, num - 1].active = true;
                Main.tile[i + 1, num - 1].type = 5;
                switch (genRand.Next(3))
                {
                    case 0:
                        Main.tile[i + 1, num - 1].frameX = 0x16;
                        Main.tile[i + 1, num - 1].frameY = 0x84;
                        break;

                    case 1:
                        Main.tile[i + 1, num - 1].frameX = 0x16;
                        Main.tile[i + 1, num - 1].frameY = 0x9a;
                        break;

                    case 2:
                        Main.tile[i + 1, num - 1].frameX = 0x16;
                        Main.tile[i + 1, num - 1].frameY = 0xb0;
                        break;
                }
            }
            if ((num7 == 0) || (num7 == 2))
            {
                Main.tile[i - 1, num - 1].active = true;
                Main.tile[i - 1, num - 1].type = 5;
                switch (genRand.Next(3))
                {
                    case 0:
                        Main.tile[i - 1, num - 1].frameX = 0x2c;
                        Main.tile[i - 1, num - 1].frameY = 0x84;
                        break;

                    case 1:
                        Main.tile[i - 1, num - 1].frameX = 0x2c;
                        Main.tile[i - 1, num - 1].frameY = 0x9a;
                        break;

                    case 2:
                        Main.tile[i - 1, num - 1].frameX = 0x2c;
                        Main.tile[i - 1, num - 1].frameY = 0xb0;
                        break;
                }
            }
            num3 = genRand.Next(3);
            if (num7 == 0)
            {
                switch (num3)
                {
                    case 0:
                        Main.tile[i, num - 1].frameX = 0x58;
                        Main.tile[i, num - 1].frameY = 0x84;
                        break;

                    case 1:
                        Main.tile[i, num - 1].frameX = 0x58;
                        Main.tile[i, num - 1].frameY = 0x9a;
                        break;

                    case 2:
                        Main.tile[i, num - 1].frameX = 0x58;
                        Main.tile[i, num - 1].frameY = 0xb0;
                        break;
                }
            }
            else if (num7 == 1)
            {
                switch (num3)
                {
                    case 0:
                        Main.tile[i, num - 1].frameX = 0;
                        Main.tile[i, num - 1].frameY = 0x84;
                        break;

                    case 1:
                        Main.tile[i, num - 1].frameX = 0;
                        Main.tile[i, num - 1].frameY = 0x9a;
                        break;

                    case 2:
                        Main.tile[i, num - 1].frameX = 0;
                        Main.tile[i, num - 1].frameY = 0xb0;
                        break;
                }
            }
            else if (num7 == 2)
            {
                switch (num3)
                {
                    case 0:
                        Main.tile[i, num - 1].frameX = 0x42;
                        Main.tile[i, num - 1].frameY = 0x84;
                        break;

                    case 1:
                        Main.tile[i, num - 1].frameX = 0x42;
                        Main.tile[i, num - 1].frameY = 0x9a;
                        break;

                    case 2:
                        Main.tile[i, num - 1].frameX = 0x42;
                        Main.tile[i, num - 1].frameY = 0xb0;
                        break;
                }
            }
            if (genRand.Next(3) < 2)
            {
                switch (genRand.Next(3))
                {
                    case 0:
                        Main.tile[i, num - num5].frameX = 0x16;
                        Main.tile[i, num - num5].frameY = 0xc6;
                        break;

                    case 1:
                        Main.tile[i, num - num5].frameX = 0x16;
                        Main.tile[i, num - num5].frameY = 220;
                        break;

                    case 2:
                        Main.tile[i, num - num5].frameX = 0x16;
                        Main.tile[i, num - num5].frameY = 0xf2;
                        break;
                }
            }
            else
            {
                switch (genRand.Next(3))
                {
                    case 0:
                        Main.tile[i, num - num5].frameX = 0;
                        Main.tile[i, num - num5].frameY = 0xc6;
                        break;

                    case 1:
                        Main.tile[i, num - num5].frameX = 0;
                        Main.tile[i, num - num5].frameY = 220;
                        break;

                    case 2:
                        Main.tile[i, num - num5].frameX = 0;
                        Main.tile[i, num - num5].frameY = 0xf2;
                        break;
                }
            }
            RangeFrame(i - 2, (num - num5) - 1, i + 2, num + 1);
            if (Main.netMode == 2)
            {
                NetMessage.SendTileSquare(-1, i, num - ((int) (num5 * 0.5)), num5 + 1);
            }
            return true;
        Label_1051:
            return false;
        }

        public static void GrowShroom(int i, int y)
        {
            int num = y;
            if (((!Main.tile[i - 1, num - 1].lava && !Main.tile[i - 1, num - 1].lava) && !Main.tile[i + 1, num - 1].lava) && (((Main.tile[i, num].active && (Main.tile[i, num].type == 70)) && ((Main.tile[i, num - 1].wall == 0) && Main.tile[i - 1, num].active)) && (((Main.tile[i - 1, num].type == 70) && Main.tile[i + 1, num].active) && ((Main.tile[i + 1, num].type == 70) && EmptyTileCheck(i - 2, i + 2, num - 13, num - 1, 0x47)))))
            {
                int num3 = genRand.Next(4, 11);
                for (int j = num - num3; j < num; j++)
                {
                    Main.tile[i, j].frameNumber = (byte) genRand.Next(3);
                    Main.tile[i, j].active = true;
                    Main.tile[i, j].type = 0x48;
                    switch (genRand.Next(3))
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 0;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 0x12;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 0x24;
                            break;
                    }
                }
                switch (genRand.Next(3))
                {
                    case 0:
                        Main.tile[i, num - num3].frameX = 0x24;
                        Main.tile[i, num - num3].frameY = 0;
                        break;

                    case 1:
                        Main.tile[i, num - num3].frameX = 0x24;
                        Main.tile[i, num - num3].frameY = 0x12;
                        break;

                    case 2:
                        Main.tile[i, num - num3].frameX = 0x24;
                        Main.tile[i, num - num3].frameY = 0x24;
                        break;
                }
                RangeFrame(i - 2, (num - num3) - 1, i + 2, num + 1);
                if (Main.netMode == 2)
                {
                    NetMessage.SendTileSquare(-1, i, num - ((int) (num3 * 0.5)), num3 + 1);
                }
            }
        }

        public static void GrowTree(int i, int y)
        {
            int num4;
            int num = y;
            while (Main.tile[i, num].type == 20)
            {
                num++;
            }
            if ((((Main.tile[i - 1, num - 1].liquid != 0) || (Main.tile[i - 1, num - 1].liquid != 0)) || (Main.tile[i + 1, num - 1].liquid != 0)) && (Main.tile[i, num].type != 60))
            {
                return;
            }
            if (((!Main.tile[i, num].active || (((Main.tile[i, num].type != 2) && (Main.tile[i, num].type != 0x17)) && ((Main.tile[i, num].type != 60) && (Main.tile[i, num].type != 0x6d)))) || (Main.tile[i, num - 1].wall != 0)) || ((!Main.tile[i - 1, num].active || (((Main.tile[i - 1, num].type != 2) && (Main.tile[i - 1, num].type != 0x17)) && ((Main.tile[i - 1, num].type != 60) && (Main.tile[i - 1, num].type != 0x6d)))) && (!Main.tile[i + 1, num].active || (((Main.tile[i + 1, num].type != 2) && (Main.tile[i + 1, num].type != 0x17)) && ((Main.tile[i + 1, num].type != 60) && (Main.tile[i + 1, num].type != 0x6d))))))
            {
                return;
            }
            int num2 = 1;
            int num3 = 0x10;
            if (Main.tile[i, num].type == 60)
            {
                num3 += 5;
            }
            if (!EmptyTileCheck(i - num2, i + num2, num - num3, num - 1, 20))
            {
                return;
            }
            bool flag = false;
            bool flag2 = false;
            int num6 = genRand.Next(5, num3 + 1);
            for (int j = num - num6; j < num; j++)
            {
                Main.tile[i, j].frameNumber = (byte) genRand.Next(3);
                Main.tile[i, j].active = true;
                Main.tile[i, j].type = 5;
                num4 = genRand.Next(3);
                int num5 = genRand.Next(10);
                if ((j == (num - 1)) || (j == (num - num6)))
                {
                    num5 = 0;
                }
                while ((((num5 == 5) || (num5 == 7)) && flag) || (((num5 == 6) || (num5 == 7)) && flag2))
                {
                    num5 = genRand.Next(10);
                }
                flag = false;
                flag2 = false;
                if ((num5 == 5) || (num5 == 7))
                {
                    flag = true;
                }
                if ((num5 == 6) || (num5 == 7))
                {
                    flag2 = true;
                }
                if (num5 == 1)
                {
                    switch (num4)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 0x42;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 0x58;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 110;
                            break;
                    }
                }
                else if (num5 == 2)
                {
                    switch (num4)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0x16;
                            Main.tile[i, j].frameY = 0;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0x16;
                            Main.tile[i, j].frameY = 0x16;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0x16;
                            Main.tile[i, j].frameY = 0x2c;
                            break;
                    }
                }
                else if (num5 == 3)
                {
                    switch (num4)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0x2c;
                            Main.tile[i, j].frameY = 0x42;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0x2c;
                            Main.tile[i, j].frameY = 0x58;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0x2c;
                            Main.tile[i, j].frameY = 110;
                            break;
                    }
                }
                else if (num5 == 4)
                {
                    switch (num4)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0x16;
                            Main.tile[i, j].frameY = 0x42;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0x16;
                            Main.tile[i, j].frameY = 0x58;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0x16;
                            Main.tile[i, j].frameY = 110;
                            break;
                    }
                }
                else if (num5 == 5)
                {
                    switch (num4)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0x58;
                            Main.tile[i, j].frameY = 0;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0x58;
                            Main.tile[i, j].frameY = 0x16;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0x58;
                            Main.tile[i, j].frameY = 0x2c;
                            break;
                    }
                }
                else if (num5 == 6)
                {
                    switch (num4)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0x42;
                            Main.tile[i, j].frameY = 0x42;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0x42;
                            Main.tile[i, j].frameY = 0x58;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0x42;
                            Main.tile[i, j].frameY = 110;
                            break;
                    }
                }
                else if (num5 == 7)
                {
                    switch (num4)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 110;
                            Main.tile[i, j].frameY = 0x42;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 110;
                            Main.tile[i, j].frameY = 0x58;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 110;
                            Main.tile[i, j].frameY = 110;
                            break;
                    }
                }
                else
                {
                    switch (num4)
                    {
                        case 0:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 0;
                            break;

                        case 1:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 0x16;
                            break;

                        case 2:
                            Main.tile[i, j].frameX = 0;
                            Main.tile[i, j].frameY = 0x2c;
                            break;
                    }
                }
                if ((num5 == 5) || (num5 == 7))
                {
                    Main.tile[i - 1, j].active = true;
                    Main.tile[i - 1, j].type = 5;
                    num4 = genRand.Next(3);
                    if (genRand.Next(3) < 2)
                    {
                        switch (num4)
                        {
                            case 0:
                                Main.tile[i - 1, j].frameX = 0x2c;
                                Main.tile[i - 1, j].frameY = 0xc6;
                                break;

                            case 1:
                                Main.tile[i - 1, j].frameX = 0x2c;
                                Main.tile[i - 1, j].frameY = 220;
                                break;

                            case 2:
                                Main.tile[i - 1, j].frameX = 0x2c;
                                Main.tile[i - 1, j].frameY = 0xf2;
                                break;
                        }
                    }
                    else
                    {
                        switch (num4)
                        {
                            case 0:
                                Main.tile[i - 1, j].frameX = 0x42;
                                Main.tile[i - 1, j].frameY = 0;
                                break;

                            case 1:
                                Main.tile[i - 1, j].frameX = 0x42;
                                Main.tile[i - 1, j].frameY = 0x16;
                                break;

                            case 2:
                                Main.tile[i - 1, j].frameX = 0x42;
                                Main.tile[i - 1, j].frameY = 0x2c;
                                break;
                        }
                    }
                }
                if ((num5 == 6) || (num5 == 7))
                {
                    Main.tile[i + 1, j].active = true;
                    Main.tile[i + 1, j].type = 5;
                    num4 = genRand.Next(3);
                    if (genRand.Next(3) < 2)
                    {
                        switch (num4)
                        {
                            case 0:
                                Main.tile[i + 1, j].frameX = 0x42;
                                Main.tile[i + 1, j].frameY = 0xc6;
                                break;

                            case 1:
                                Main.tile[i + 1, j].frameX = 0x42;
                                Main.tile[i + 1, j].frameY = 220;
                                break;

                            case 2:
                                Main.tile[i + 1, j].frameX = 0x42;
                                Main.tile[i + 1, j].frameY = 0xf2;
                                break;
                        }
                    }
                    else
                    {
                        switch (num4)
                        {
                            case 0:
                                Main.tile[i + 1, j].frameX = 0x58;
                                Main.tile[i + 1, j].frameY = 0x42;
                                break;

                            case 1:
                                Main.tile[i + 1, j].frameX = 0x58;
                                Main.tile[i + 1, j].frameY = 0x58;
                                break;

                            case 2:
                                Main.tile[i + 1, j].frameX = 0x58;
                                Main.tile[i + 1, j].frameY = 110;
                                break;
                        }
                    }
                }
            }
            int num8 = genRand.Next(3);
            bool flag3 = false;
            bool flag4 = false;
            if (Main.tile[i - 1, num].active && (((Main.tile[i - 1, num].type == 2) || (Main.tile[i - 1, num].type == 0x17)) || ((Main.tile[i - 1, num].type == 60) || (Main.tile[i - 1, num].type == 0x6d))))
            {
                flag3 = true;
            }
            if (Main.tile[i + 1, num].active && (((Main.tile[i + 1, num].type == 2) || (Main.tile[i + 1, num].type == 0x17)) || ((Main.tile[i + 1, num].type == 60) || (Main.tile[i + 1, num].type == 0x6d))))
            {
                flag4 = true;
            }
            if (!flag3)
            {
                switch (num8)
                {
                    case 0:
                        num8 = 2;
                        break;

                    case 1:
                        num8 = 3;
                        goto Label_0B99;
                }
            }
        Label_0B99:
            if (!flag4)
            {
                switch (num8)
                {
                    case 0:
                        num8 = 1;
                        break;

                    case 2:
                        num8 = 3;
                        break;
                }
            }
            if (flag3 && !flag4)
            {
                num8 = 1;
            }
            if (flag4 && !flag3)
            {
                num8 = 2;
            }
            if ((num8 == 0) || (num8 == 1))
            {
                Main.tile[i + 1, num - 1].active = true;
                Main.tile[i + 1, num - 1].type = 5;
                switch (genRand.Next(3))
                {
                    case 0:
                        Main.tile[i + 1, num - 1].frameX = 0x16;
                        Main.tile[i + 1, num - 1].frameY = 0x84;
                        break;

                    case 1:
                        Main.tile[i + 1, num - 1].frameX = 0x16;
                        Main.tile[i + 1, num - 1].frameY = 0x9a;
                        break;

                    case 2:
                        Main.tile[i + 1, num - 1].frameX = 0x16;
                        Main.tile[i + 1, num - 1].frameY = 0xb0;
                        break;
                }
            }
            if ((num8 == 0) || (num8 == 2))
            {
                Main.tile[i - 1, num - 1].active = true;
                Main.tile[i - 1, num - 1].type = 5;
                switch (genRand.Next(3))
                {
                    case 0:
                        Main.tile[i - 1, num - 1].frameX = 0x2c;
                        Main.tile[i - 1, num - 1].frameY = 0x84;
                        break;

                    case 1:
                        Main.tile[i - 1, num - 1].frameX = 0x2c;
                        Main.tile[i - 1, num - 1].frameY = 0x9a;
                        break;

                    case 2:
                        Main.tile[i - 1, num - 1].frameX = 0x2c;
                        Main.tile[i - 1, num - 1].frameY = 0xb0;
                        break;
                }
            }
            num4 = genRand.Next(3);
            if (num8 == 0)
            {
                switch (num4)
                {
                    case 0:
                        Main.tile[i, num - 1].frameX = 0x58;
                        Main.tile[i, num - 1].frameY = 0x84;
                        break;

                    case 1:
                        Main.tile[i, num - 1].frameX = 0x58;
                        Main.tile[i, num - 1].frameY = 0x9a;
                        break;

                    case 2:
                        Main.tile[i, num - 1].frameX = 0x58;
                        Main.tile[i, num - 1].frameY = 0xb0;
                        break;
                }
            }
            else if (num8 == 1)
            {
                switch (num4)
                {
                    case 0:
                        Main.tile[i, num - 1].frameX = 0;
                        Main.tile[i, num - 1].frameY = 0x84;
                        break;

                    case 1:
                        Main.tile[i, num - 1].frameX = 0;
                        Main.tile[i, num - 1].frameY = 0x9a;
                        break;

                    case 2:
                        Main.tile[i, num - 1].frameX = 0;
                        Main.tile[i, num - 1].frameY = 0xb0;
                        break;
                }
            }
            else if (num8 == 2)
            {
                switch (num4)
                {
                    case 0:
                        Main.tile[i, num - 1].frameX = 0x42;
                        Main.tile[i, num - 1].frameY = 0x84;
                        break;

                    case 1:
                        Main.tile[i, num - 1].frameX = 0x42;
                        Main.tile[i, num - 1].frameY = 0x9a;
                        break;

                    case 2:
                        Main.tile[i, num - 1].frameX = 0x42;
                        Main.tile[i, num - 1].frameY = 0xb0;
                        break;
                }
            }
            if (genRand.Next(4) < 3)
            {
                switch (genRand.Next(3))
                {
                    case 0:
                        Main.tile[i, num - num6].frameX = 0x16;
                        Main.tile[i, num - num6].frameY = 0xc6;
                        break;

                    case 1:
                        Main.tile[i, num - num6].frameX = 0x16;
                        Main.tile[i, num - num6].frameY = 220;
                        break;

                    case 2:
                        Main.tile[i, num - num6].frameX = 0x16;
                        Main.tile[i, num - num6].frameY = 0xf2;
                        break;
                }
            }
            else
            {
                switch (genRand.Next(3))
                {
                    case 0:
                        Main.tile[i, num - num6].frameX = 0;
                        Main.tile[i, num - num6].frameY = 0xc6;
                        break;

                    case 1:
                        Main.tile[i, num - num6].frameX = 0;
                        Main.tile[i, num - num6].frameY = 220;
                        break;

                    case 2:
                        Main.tile[i, num - num6].frameX = 0;
                        Main.tile[i, num - num6].frameY = 0xf2;
                        break;
                }
            }
            RangeFrame(i - 2, (num - num6) - 1, i + 2, num + 1);
            if (Main.netMode == 2)
            {
                NetMessage.SendTileSquare(-1, i, num - ((int) (num6 * 0.5)), num6 + 1);
            }
        }

        public static void hardUpdateWorld(int i, int j)
        {
            if (Main.hardMode)
            {
                int type = Main.tile[i, j].type;
                if (((type == 0x75) && (j > Main.rockLayer)) && (Main.rand.Next(110) == 0))
                {
                    int num2 = genRand.Next(4);
                    int num3 = 0;
                    int num4 = 0;
                    switch (num2)
                    {
                        case 0:
                            num3 = -1;
                            break;

                        case 1:
                            num3 = 1;
                            break;

                        default:
                            if (num2 == 0)
                            {
                                num4 = -1;
                            }
                            else
                            {
                                num4 = 1;
                            }
                            break;
                    }
                    if (!Main.tile[i + num3, j + num4].active)
                    {
                        int num5 = 0;
                        int num6 = 6;
                        for (int k = i - num6; k <= (i + num6); k++)
                        {
                            for (int m = j - num6; m <= (j + num6); m++)
                            {
                                if (Main.tile[k, m].active && (Main.tile[k, m].type == 0x81))
                                {
                                    num5++;
                                }
                            }
                        }
                        if (num5 < 2)
                        {
                            PlaceTile(i + num3, j + num4, 0x81, true, false, -1, 0);
                            NetMessage.SendTileSquare(-1, i + num3, j + num4, 1);
                        }
                    }
                }
                if (((type == 0x17) || (type == 0x19)) || ((type == 0x20) || (type == 0x70)))
                {
                    bool flag = true;
                    while (flag)
                    {
                        flag = false;
                        int num9 = i + genRand.Next(-3, 4);
                        int num10 = j + genRand.Next(-3, 4);
                        if (Main.tile[num9, num10].type == 2)
                        {
                            if (genRand.Next(2) == 0)
                            {
                                flag = true;
                            }
                            Main.tile[num9, num10].type = 0x17;
                            SquareTileFrame(num9, num10, true);
                            NetMessage.SendTileSquare(-1, num9, num10, 1);
                        }
                        else
                        {
                            if (Main.tile[num9, num10].type == 1)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    flag = true;
                                }
                                Main.tile[num9, num10].type = 0x19;
                                SquareTileFrame(num9, num10, true);
                                NetMessage.SendTileSquare(-1, num9, num10, 1);
                                continue;
                            }
                            if (Main.tile[num9, num10].type == 0x35)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    flag = true;
                                }
                                Main.tile[num9, num10].type = 0x70;
                                SquareTileFrame(num9, num10, true);
                                NetMessage.SendTileSquare(-1, num9, num10, 1);
                                continue;
                            }
                            if (Main.tile[num9, num10].type == 0x3b)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    flag = true;
                                }
                                Main.tile[num9, num10].type = 0;
                                SquareTileFrame(num9, num10, true);
                                NetMessage.SendTileSquare(-1, num9, num10, 1);
                                continue;
                            }
                            if (Main.tile[num9, num10].type == 60)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    flag = true;
                                }
                                Main.tile[num9, num10].type = 0x17;
                                SquareTileFrame(num9, num10, true);
                                NetMessage.SendTileSquare(-1, num9, num10, 1);
                                continue;
                            }
                            if (Main.tile[num9, num10].type == 0x45)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    flag = true;
                                }
                                Main.tile[num9, num10].type = 0x20;
                                SquareTileFrame(num9, num10, true);
                                NetMessage.SendTileSquare(-1, num9, num10, 1);
                            }
                        }
                    }
                }
                if ((((type == 0x6d) || (type == 110)) || ((type == 0x71) || (type == 0x73))) || (((type == 0x74) || (type == 0x75)) || (type == 0x76)))
                {
                    bool flag2 = true;
                    while (flag2)
                    {
                        flag2 = false;
                        int num11 = i + genRand.Next(-3, 4);
                        int num12 = j + genRand.Next(-3, 4);
                        if (Main.tile[num11, num12].type == 2)
                        {
                            if (genRand.Next(2) == 0)
                            {
                                flag2 = true;
                            }
                            Main.tile[num11, num12].type = 0x6d;
                            SquareTileFrame(num11, num12, true);
                            NetMessage.SendTileSquare(-1, num11, num12, 1);
                        }
                        else
                        {
                            if (Main.tile[num11, num12].type == 1)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    flag2 = true;
                                }
                                Main.tile[num11, num12].type = 0x75;
                                SquareTileFrame(num11, num12, true);
                                NetMessage.SendTileSquare(-1, num11, num12, 1);
                                continue;
                            }
                            if (Main.tile[num11, num12].type == 0x35)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    flag2 = true;
                                }
                                Main.tile[num11, num12].type = 0x74;
                                SquareTileFrame(num11, num12, true);
                                NetMessage.SendTileSquare(-1, num11, num12, 1);
                            }
                        }
                    }
                }
            }
        }

        public static void HellHouse(int i, int j, byte type = 0x4c, byte wall = 13)
        {
            int width = genRand.Next(8, 20);
            int num2 = genRand.Next(1, 3);
            int num3 = genRand.Next(4, 13);
            int num4 = i;
            int num5 = j;
            for (int k = 0; k < num2; k++)
            {
                int height = genRand.Next(5, 9);
                HellRoom(num4, num5, width, height, type, wall);
                num5 -= height;
            }
            num5 = j;
            for (int m = 0; m < num3; m++)
            {
                int num9 = genRand.Next(5, 9);
                num5 += num9;
                HellRoom(num4, num5, width, num9, type, wall);
            }
            for (int n = i - (width / 2); n <= (i + (width / 2)); n++)
            {
                num5 = j;
                while ((num5 < Main.maxTilesY) && ((Main.tile[n, num5].active && ((Main.tile[n, num5].type == 0x4c) || (Main.tile[n, num5].type == 0x4b))) || ((Main.tile[i, num5].wall == 13) || (Main.tile[i, num5].wall == 14))))
                {
                    num5++;
                }
                int num11 = 6 + genRand.Next(3);
                while ((num5 < Main.maxTilesY) && !Main.tile[n, num5].active)
                {
                    num11--;
                    Main.tile[n, num5].active = true;
                    Main.tile[n, num5].type = 0x39;
                    num5++;
                    if (num11 <= 0)
                    {
                        break;
                    }
                }
            }
            int minValue = 0;
            int maxValue = 0;
            num5 = j;
            while ((num5 < Main.maxTilesY) && ((Main.tile[i, num5].active && ((Main.tile[i, num5].type == 0x4c) || (Main.tile[i, num5].type == 0x4b))) || ((Main.tile[i, num5].wall == 13) || (Main.tile[i, num5].wall == 14))))
            {
                num5++;
            }
            num5--;
            maxValue = num5;
            while ((Main.tile[i, num5].active && ((Main.tile[i, num5].type == 0x4c) || (Main.tile[i, num5].type == 0x4b))) || ((Main.tile[i, num5].wall == 13) || (Main.tile[i, num5].wall == 14)))
            {
                num5--;
                if (Main.tile[i, num5].active && ((Main.tile[i, num5].type == 0x4c) || (Main.tile[i, num5].type == 0x4b)))
                {
                    int num14 = genRand.Next((i - (width / 2)) + 1, (i + (width / 2)) - 1);
                    int num15 = genRand.Next((i - (width / 2)) + 1, (i + (width / 2)) - 1);
                    if (num14 > num15)
                    {
                        int num16 = num14;
                        num14 = num15;
                        num15 = num16;
                    }
                    if (num14 == num15)
                    {
                        if (num14 < i)
                        {
                            num15++;
                        }
                        else
                        {
                            num14--;
                        }
                    }
                    for (int num17 = num14; num17 <= num15; num17++)
                    {
                        if (Main.tile[num17, num5 - 1].wall == 13)
                        {
                            Main.tile[num17, num5].wall = 13;
                        }
                        if (Main.tile[num17, num5 - 1].wall == 14)
                        {
                            Main.tile[num17, num5].wall = 14;
                        }
                        Main.tile[num17, num5].type = 0x13;
                        Main.tile[num17, num5].active = true;
                    }
                    num5--;
                }
            }
            minValue = num5;
            float num18 = (maxValue - minValue) * width;
            float num19 = num18 * 0.02f;
            for (int num20 = 0; num20 < num19; num20++)
            {
                int num21 = genRand.Next(i - (width / 2), (i + (width / 2)) + 1);
                int num22 = genRand.Next(minValue, maxValue);
                int num23 = genRand.Next(3, 8);
                for (int num24 = num21 - num23; num24 <= (num21 + num23); num24++)
                {
                    for (int num25 = num22 - num23; num25 <= (num22 + num23); num25++)
                    {
                        float num26 = Math.Abs((int) (num24 - num21));
                        float num27 = Math.Abs((int) (num25 - num22));
                        if (Math.Sqrt((double) ((num26 * num26) + (num27 * num27))) < (num23 * 0.4))
                        {
                            try
                            {
                                if ((Main.tile[num24, num25].type == 0x4c) || (Main.tile[num24, num25].type == 0x13))
                                {
                                    Main.tile[num24, num25].active = false;
                                }
                                Main.tile[num24, num25].wall = 0;
                            }
                            catch
                            {
                            }
                        }
                    }
                }
            }
        }

        public static void HellRoom(int i, int j, int width, int height, byte type = 0x4c, byte wall = 13)
        {
            if (j <= (Main.maxTilesY - 40))
            {
                for (int k = i - (width / 2); k <= (i + (width / 2)); k++)
                {
                    for (int n = j - height; n <= j; n++)
                    {
                        try
                        {
                            Main.tile[k, n].active = true;
                            Main.tile[k, n].type = type;
                            Main.tile[k, n].liquid = 0;
                            Main.tile[k, n].lava = false;
                        }
                        catch
                        {
                        }
                    }
                }
                for (int m = (i - (width / 2)) + 1; m <= ((i + (width / 2)) - 1); m++)
                {
                    for (int num4 = (j - height) + 1; num4 <= (j - 1); num4++)
                    {
                        try
                        {
                            Main.tile[m, num4].active = false;
                            Main.tile[m, num4].wall = wall;
                            Main.tile[m, num4].liquid = 0;
                            Main.tile[m, num4].lava = false;
                        }
                        catch
                        {
                        }
                    }
                }
            }
        }

        public static void hitSwitch(int i, int j)
        {
            if (Main.tile[i, j] != null)
            {
                if (Main.tile[i, j].type == 0x87)
                {
                    Main.PlaySound(0x1c, i * 0x10, j * 0x10, 0);
                    TripWire(i, j);
                }
                else if (Main.tile[i, j].type == 0x88)
                {
                    if (Main.tile[i, j].frameY == 0)
                    {
                        Main.tile[i, j].frameY = 0x12;
                    }
                    else
                    {
                        Main.tile[i, j].frameY = 0;
                    }
                    Main.PlaySound(0x1c, i * 0x10, j * 0x10, 0);
                    TripWire(i, j);
                }
                else if (Main.tile[i, j].type == 0x90)
                {
                    if (Main.tile[i, j].frameY == 0)
                    {
                        Main.tile[i, j].frameY = 0x12;
                        if (Main.netMode != 1)
                        {
                            checkMech(i, j, 0x4650);
                        }
                    }
                    else
                    {
                        Main.tile[i, j].frameY = 0;
                    }
                    Main.PlaySound(0x1c, i * 0x10, j * 0x10, 0);
                }
                else if (Main.tile[i, j].type == 0x84)
                {
                    int num = i;
                    int num2 = j;
                    short num3 = 0x24;
                    num = (Main.tile[i, j].frameX / 0x12) * -1;
                    num2 = (Main.tile[i, j].frameY / 0x12) * -1;
                    if (num < -1)
                    {
                        num += 2;
                        num3 = -36;
                    }
                    num += i;
                    num2 += j;
                    for (int k = num; k < (num + 2); k++)
                    {
                        for (int n = num2; n < (num2 + 2); n++)
                        {
                            if (Main.tile[k, n].type == 0x84)
                            {
                                Tile tile1 = Main.tile[k, n];
                                tile1.frameX = (short) (tile1.frameX + num3);
                            }
                        }
                    }
                    TileFrame(num, num2, false, false);
                    Main.PlaySound(0x1c, i * 0x10, j * 0x10, 0);
                    for (int m = num; m < (num + 2); m++)
                    {
                        for (int num7 = num2; num7 < (num2 + 2); num7++)
                        {
                            if (((Main.tile[m, num7].type == 0x84) && Main.tile[m, num7].active) && Main.tile[m, num7].wire)
                            {
                                TripWire(m, num7);
                                return;
                            }
                        }
                    }
                }
            }
        }

        public static void hitWire(int i, int j)
        {
            int num35;
            int num36;
            int num37;
            int[] numArray;
            int num38;
            if (numWire >= (maxWire - 1))
            {
                return;
            }
            if (!Main.tile[i, j].wire)
            {
                return;
            }
            for (int k = 0; k < numWire; k++)
            {
                if ((wireX[k] == i) && (wireY[k] == j))
                {
                    return;
                }
            }
            wireX[numWire] = i;
            wireY[numWire] = j;
            numWire++;
            int type = Main.tile[i, j].type;
            bool flag = true;
            for (int m = 0; m < numNoWire; m++)
            {
                if ((noWireX[m] == i) && (noWireY[m] == j))
                {
                    flag = false;
                }
            }
            if (!flag || !Main.tile[i, j].active)
            {
                goto Label_1044;
            }
            switch (type)
            {
                case 0x90:
                    hitSwitch(i, j);
                    SquareTileFrame(i, j, true);
                    NetMessage.SendTileSquare(-1, i, j, 1);
                    goto Label_1044;

                case 130:
                    Main.tile[i, j].type = 0x83;
                    SquareTileFrame(i, j, true);
                    NetMessage.SendTileSquare(-1, i, j, 1);
                    goto Label_1044;

                case 0x83:
                    Main.tile[i, j].type = 130;
                    SquareTileFrame(i, j, true);
                    NetMessage.SendTileSquare(-1, i, j, 1);
                    goto Label_1044;

                case 11:
                    if (CloseDoor(i, j, true))
                    {
                        NetMessage.SendData(0x13, -1, -1, "", 1, (float) i, (float) j, 0f, 0);
                    }
                    goto Label_1044;

                case 10:
                {
                    int direction = 1;
                    if (Main.rand.Next(2) == 0)
                    {
                        direction = -1;
                    }
                    if (!OpenDoor(i, j, direction))
                    {
                        if (OpenDoor(i, j, -direction))
                        {
                            NetMessage.SendData(0x13, -1, -1, "", 0, (float) i, (float) j, (float) -direction, 0);
                        }
                    }
                    else
                    {
                        NetMessage.SendData(0x13, -1, -1, "", 0, (float) i, (float) j, (float) direction, 0);
                    }
                    goto Label_1044;
                }
                case 4:
                    if (Main.tile[i, j].frameX < 0x42)
                    {
                        Tile tile1 = Main.tile[i, j];
                        tile1.frameX = (short) (tile1.frameX + 0x42);
                    }
                    else
                    {
                        Tile tile2 = Main.tile[i, j];
                        tile2.frameX = (short) (tile2.frameX - 0x42);
                    }
                    NetMessage.SendTileSquare(-1, i, j, 1);
                    goto Label_1044;

                case 0x2a:
                {
                    int num5 = j - (Main.tile[i, j].frameY / 0x12);
                    short num6 = 0x12;
                    if (Main.tile[i, j].frameX > 0)
                    {
                        num6 = -18;
                    }
                    Tile tile3 = Main.tile[i, num5];
                    tile3.frameX = (short) (tile3.frameX + num6);
                    Tile tile4 = Main.tile[i, num5 + 1];
                    tile4.frameX = (short) (tile4.frameX + num6);
                    noWire(i, num5);
                    noWire(i, num5 + 1);
                    NetMessage.SendTileSquare(-1, i, j, 2);
                    goto Label_1044;
                }
                case 0x5d:
                {
                    int num7 = j - (Main.tile[i, j].frameY / 0x12);
                    short num8 = 0x12;
                    if (Main.tile[i, j].frameX > 0)
                    {
                        num8 = -18;
                    }
                    Tile tile5 = Main.tile[i, num7];
                    tile5.frameX = (short) (tile5.frameX + num8);
                    Tile tile6 = Main.tile[i, num7 + 1];
                    tile6.frameX = (short) (tile6.frameX + num8);
                    Tile tile7 = Main.tile[i, num7 + 2];
                    tile7.frameX = (short) (tile7.frameX + num8);
                    noWire(i, num7);
                    noWire(i, num7 + 1);
                    noWire(i, num7 + 2);
                    NetMessage.SendTileSquare(-1, i, num7 + 1, 3);
                    goto Label_1044;
                }
                case 0x7e:
                case 100:
                case 0x5f:
                {
                    int num9 = j - (Main.tile[i, j].frameY / 0x12);
                    int num10 = Main.tile[i, j].frameX / 0x12;
                    if (num10 > 1)
                    {
                        num10 -= 2;
                    }
                    num10 = i - num10;
                    short num11 = 0x24;
                    if (Main.tile[num10, num9].frameX > 0)
                    {
                        num11 = -36;
                    }
                    Tile tile8 = Main.tile[num10, num9];
                    tile8.frameX = (short) (tile8.frameX + num11);
                    Tile tile9 = Main.tile[num10, num9 + 1];
                    tile9.frameX = (short) (tile9.frameX + num11);
                    Tile tile10 = Main.tile[num10 + 1, num9];
                    tile10.frameX = (short) (tile10.frameX + num11);
                    Tile tile11 = Main.tile[num10 + 1, num9 + 1];
                    tile11.frameX = (short) (tile11.frameX + num11);
                    noWire(num10, num9);
                    noWire(num10, num9 + 1);
                    noWire(num10 + 1, num9);
                    noWire(num10 + 1, num9 + 1);
                    NetMessage.SendTileSquare(-1, num10, num9, 3);
                    goto Label_1044;
                }
                case 0x22:
                case 0x23:
                case 0x24:
                {
                    int num12 = j - (Main.tile[i, j].frameY / 0x12);
                    int num13 = Main.tile[i, j].frameX / 0x12;
                    if (num13 > 2)
                    {
                        num13 -= 3;
                    }
                    num13 = i - num13;
                    short num14 = 0x36;
                    if (Main.tile[num13, num12].frameX > 0)
                    {
                        num14 = -54;
                    }
                    for (int n = num13; n < (num13 + 3); n++)
                    {
                        for (int num16 = num12; num16 < (num12 + 3); num16++)
                        {
                            Tile tile12 = Main.tile[n, num16];
                            tile12.frameX = (short) (tile12.frameX + num14);
                            noWire(n, num16);
                        }
                    }
                    NetMessage.SendTileSquare(-1, num13 + 1, num12 + 1, 3);
                    goto Label_1044;
                }
                case 0x21:
                {
                    short num17 = 0x12;
                    if (Main.tile[i, j].frameX > 0)
                    {
                        num17 = -18;
                    }
                    Tile tile13 = Main.tile[i, j];
                    tile13.frameX = (short) (tile13.frameX + num17);
                    NetMessage.SendTileSquare(-1, i, j, 3);
                    goto Label_1044;
                }
                case 0x5c:
                {
                    int num18 = j - (Main.tile[i, j].frameY / 0x12);
                    short num19 = 0x12;
                    if (Main.tile[i, j].frameX > 0)
                    {
                        num19 = -18;
                    }
                    Tile tile14 = Main.tile[i, num18];
                    tile14.frameX = (short) (tile14.frameX + num19);
                    Tile tile15 = Main.tile[i, num18 + 1];
                    tile15.frameX = (short) (tile15.frameX + num19);
                    Tile tile16 = Main.tile[i, num18 + 2];
                    tile16.frameX = (short) (tile16.frameX + num19);
                    Tile tile17 = Main.tile[i, num18 + 3];
                    tile17.frameX = (short) (tile17.frameX + num19);
                    Tile tile18 = Main.tile[i, num18 + 4];
                    tile18.frameX = (short) (tile18.frameX + num19);
                    Tile tile19 = Main.tile[i, num18 + 5];
                    tile19.frameX = (short) (tile19.frameX + num19);
                    noWire(i, num18);
                    noWire(i, num18 + 1);
                    noWire(i, num18 + 2);
                    noWire(i, num18 + 3);
                    noWire(i, num18 + 4);
                    noWire(i, num18 + 5);
                    NetMessage.SendTileSquare(-1, i, num18 + 3, 7);
                    goto Label_1044;
                }
                case 0x89:
                    if (checkMech(i, j, 180))
                    {
                        Vector2 vector;
                        int num20 = -1;
                        if (Main.tile[i, j].frameX != 0)
                        {
                            num20 = 1;
                        }
                        float speedX = 12 * num20;
                        int damage = 20;
                        int num23 = 0x62;
                        vector = new Vector2((float)((i * 0x10) + 8), (float)((j * 0x10) + 7));
                        vector.X += (10 * num20);
                        vector.Y += 2f;
                        Projectile.NewProjectile((float) ((int) vector.X), (float) ((int) vector.Y), speedX, 0f, num23, damage, 2f, Main.myPlayer);
                    }
                    goto Label_1044;

                case 0x8b:
                    SwitchMB(i, j);
                    goto Label_1044;

                case 0x8d:
                    KillTile(i, j, false, false, true);
                    NetMessage.SendTileSquare(-1, i, j, 1);
                    Projectile.NewProjectile((float) ((i * 0x10) + 8), (float) ((j * 0x10) + 8), 0f, 0f, 0x6c, 250, 10f, Main.myPlayer);
                    goto Label_1044;

                case 0x8e:
                case 0x8f:
                {
                    int num24 = j - (Main.tile[i, j].frameY / 0x12);
                    int num25 = Main.tile[i, j].frameX / 0x12;
                    if (num25 > 1)
                    {
                        num25 -= 2;
                    }
                    num25 = i - num25;
                    noWire(num25, num24);
                    noWire(num25, num24 + 1);
                    noWire(num25 + 1, num24);
                    noWire(num25 + 1, num24 + 1);
                    if (type == 0x8e)
                    {
                        int num26 = num25;
                        int num27 = num24;
                        for (int num28 = 0; num28 < 4; num28++)
                        {
                            if (numInPump >= (maxPump - 1))
                            {
                                break;
                            }
                            switch (num28)
                            {
                                case 0:
                                    num26 = num25;
                                    num27 = num24 + 1;
                                    break;

                                case 1:
                                    num26 = num25 + 1;
                                    num27 = num24 + 1;
                                    break;

                                case 2:
                                    num26 = num25;
                                    num27 = num24;
                                    break;

                                default:
                                    num26 = num25 + 1;
                                    num27 = num24;
                                    break;
                            }
                            inPumpX[numInPump] = num26;
                            inPumpY[numInPump] = num27;
                            numInPump++;
                        }
                    }
                    else
                    {
                        int num29 = num25;
                        int num30 = num24;
                        for (int num31 = 0; num31 < 4; num31++)
                        {
                            if (numOutPump >= (maxPump - 1))
                            {
                                break;
                            }
                            switch (num31)
                            {
                                case 0:
                                    num29 = num25;
                                    num30 = num24 + 1;
                                    break;

                                case 1:
                                    num29 = num25 + 1;
                                    num30 = num24 + 1;
                                    break;

                                case 2:
                                    num29 = num25;
                                    num30 = num24;
                                    break;

                                default:
                                    num29 = num25 + 1;
                                    num30 = num24;
                                    break;
                            }
                            outPumpX[numOutPump] = num29;
                            outPumpY[numOutPump] = num30;
                            numOutPump++;
                        }
                    }
                    goto Label_1044;
                }
                default:
                {
                    if (type != 0x69)
                    {
                        goto Label_1044;
                    }
                    int num32 = j - (Main.tile[i, j].frameY / 0x12);
                    int num33 = Main.tile[i, j].frameX / 0x12;
                    int num34 = 0;
                    while (num33 >= 2)
                    {
                        num33 -= 2;
                        num34++;
                    }
                    num33 = i - num33;
                    noWire(num33, num32);
                    noWire(num33, num32 + 1);
                    noWire(num33, num32 + 2);
                    noWire(num33 + 1, num32);
                    noWire(num33 + 1, num32 + 1);
                    noWire(num33 + 1, num32 + 2);
                    num35 = (num33 * 0x10) + 0x10;
                    num36 = (num32 + 3) * 0x10;
                    num37 = -1;
                    switch (num34)
                    {
                        case 4:
                            if (checkMech(i, j, 30) && NPC.MechSpawn((float) num35, (float) num36, 1))
                            {
                                num37 = NPC.NewNPC(num35, num36 - 12, 1, 0);
                            }
                            goto Label_101B;

                        case 7:
                            if (checkMech(i, j, 30) && NPC.MechSpawn((float) num35, (float) num36, 0x31))
                            {
                                num37 = NPC.NewNPC(num35 - 4, num36 - 6, 0x31, 0);
                            }
                            goto Label_101B;

                        case 8:
                            if (checkMech(i, j, 30) && NPC.MechSpawn((float) num35, (float) num36, 0x37))
                            {
                                num37 = NPC.NewNPC(num35, num36 - 12, 0x37, 0);
                            }
                            goto Label_101B;

                        case 9:
                            if (checkMech(i, j, 30) && NPC.MechSpawn((float) num35, (float) num36, 0x2e))
                            {
                                num37 = NPC.NewNPC(num35, num36 - 12, 0x2e, 0);
                            }
                            goto Label_101B;

                        case 10:
                            if (checkMech(i, j, 30) && NPC.MechSpawn((float) num35, (float) num36, 0x15))
                            {
                                num37 = NPC.NewNPC(num35, num36, 0x15, 0);
                            }
                            goto Label_101B;

                        case 0x12:
                            if (checkMech(i, j, 30) && NPC.MechSpawn((float) num35, (float) num36, 0x43))
                            {
                                num37 = NPC.NewNPC(num35, num36 - 12, 0x43, 0);
                            }
                            goto Label_101B;

                        case 0x17:
                            if (checkMech(i, j, 30) && NPC.MechSpawn((float) num35, (float) num36, 0x3f))
                            {
                                num37 = NPC.NewNPC(num35, num36 - 12, 0x3f, 0);
                            }
                            goto Label_101B;

                        case 0x1b:
                            if (checkMech(i, j, 30) && NPC.MechSpawn((float) num35, (float) num36, 0x55))
                            {
                                num37 = NPC.NewNPC(num35 - 9, num36, 0x55, 0);
                            }
                            goto Label_101B;

                        case 0x1c:
                            if (checkMech(i, j, 30) && NPC.MechSpawn((float) num35, (float) num36, 0x4a))
                            {
                                num37 = NPC.NewNPC(num35, num36 - 12, 0x4a, 0);
                            }
                            goto Label_101B;

                        case 0x2a:
                            if (checkMech(i, j, 30) && NPC.MechSpawn((float) num35, (float) num36, 0x3a))
                            {
                                num37 = NPC.NewNPC(num35, num36 - 12, 0x3a, 0);
                            }
                            goto Label_101B;

                        case 0x25:
                            if (checkMech(i, j, 600) && Item.MechSpawn((float) num35, (float) num36, 0x3a))
                            {
                                Item.NewItem(num35, num36 - 0x10, 0, 0, 0x3a, 1, false, 0);
                            }
                            goto Label_101B;

                        case 2:
                            if (checkMech(i, j, 600) && Item.MechSpawn((float) num35, (float) num36, 0xb8))
                            {
                                Item.NewItem(num35, num36 - 0x10, 0, 0, 0xb8, 1, false, 0);
                            }
                            goto Label_101B;

                        case 0x11:
                            if (checkMech(i, j, 600) && Item.MechSpawn((float) num35, (float) num36, 0xa6))
                            {
                                Item.NewItem(num35, num36 - 20, 0, 0, 0xa6, 1, false, 0);
                            }
                            goto Label_101B;
                    }
                    if (num34 != 40)
                    {
                        if ((num34 == 0x29) && checkMech(i, j, 300))
                        {
                            int[] numArray2 = new int[10];
                            int index = 0;
                            for (int num42 = 0; num42 < 200; num42++)
                            {
                                if (Main.npc[num42].active && (((Main.npc[num42].type == 0x12) || (Main.npc[num42].type == 20)) || (Main.npc[num42].type == 0x7c)))
                                {
                                    numArray2[index] = num42;
                                    index++;
                                    if (index >= 9)
                                    {
                                        break;
                                    }
                                }
                            }
                            if (index > 0)
                            {
                                int num43 = numArray2[Main.rand.Next(index)];
                                Main.npc[num43].position.X = num35 - (Main.npc[num43].width / 2);
                                Main.npc[num43].position.Y = (num36 - Main.npc[num43].height) - 1;
                                NetMessage.SendData(0x17, -1, -1, "", num43, 0f, 0f, 0f, 0);
                            }
                        }
                        goto Label_101B;
                    }
                    if (!checkMech(i, j, 300))
                    {
                        goto Label_101B;
                    }
                    numArray = new int[10];
                    num38 = 0;
                    for (int num39 = 0; num39 < 200; num39++)
                    {
                        if (Main.npc[num39].active && ((((Main.npc[num39].type == 0x11) || (Main.npc[num39].type == 0x13)) || ((Main.npc[num39].type == 0x16) || (Main.npc[num39].type == 0x26))) || (((Main.npc[num39].type == 0x36) || (Main.npc[num39].type == 0x6b)) || (Main.npc[num39].type == 0x6c))))
                        {
                            numArray[num38] = num39;
                            num38++;
                            if (num38 >= 9)
                            {
                                break;
                            }
                        }
                    }
                    break;
                }
            }
            if (num38 > 0)
            {
                int num40 = numArray[Main.rand.Next(num38)];
                Main.npc[num40].position.X = num35 - (Main.npc[num40].width / 2);
                Main.npc[num40].position.Y = (num36 - Main.npc[num40].height) - 1;
                NetMessage.SendData(0x17, -1, -1, "", num40, 0f, 0f, 0f, 0);
            }
        Label_101B:
            if (num37 >= 0)
            {
                Main.npc[num37].value = 0f;
                Main.npc[num37].npcSlots = 0f;
            }
        Label_1044:
            hitWire(i - 1, j);
            hitWire(i + 1, j);
            hitWire(i, j - 1);
            hitWire(i, j + 1);
        }

        public static void IslandHouse(int i, int j)
        {
            byte num = (byte) genRand.Next(0x2d, 0x30);
            byte num2 = (byte) genRand.Next(10, 13);
            Vector2 vector = new Vector2((float) i, (float) j);
            int num7 = 1;
            if (genRand.Next(2) == 0)
            {
                num7 = -1;
            }
            int num8 = genRand.Next(7, 12);
            int num9 = genRand.Next(5, 7);
            vector.X = i + ((num8 + 2) * num7);
            for (int k = j - 15; k < (j + 30); k++)
            {
                if (Main.tile[(int) vector.X, k].active)
                {
                    vector.Y = k - 1;
                    break;
                }
            }
            vector.X = i;
            int num3 = (int) ((vector.X - num8) - 2f);
            int maxTilesX = (int) ((vector.X + num8) + 2f);
            int num4 = (int) ((vector.Y - num9) - 2f);
            int maxTilesY = ((int) (vector.Y + 2f)) + genRand.Next(3, 5);
            if (num3 < 0)
            {
                num3 = 0;
            }
            if (maxTilesX > Main.maxTilesX)
            {
                maxTilesX = Main.maxTilesX;
            }
            if (num4 < 0)
            {
                num4 = 0;
            }
            if (maxTilesY > Main.maxTilesY)
            {
                maxTilesY = Main.maxTilesY;
            }
            for (int m = num3; m <= maxTilesX; m++)
            {
                for (int num12 = num4; num12 < maxTilesY; num12++)
                {
                    Main.tile[m, num12].active = true;
                    Main.tile[m, num12].type = num;
                    Main.tile[m, num12].wall = 0;
                }
            }
            num3 = ((int) vector.X) - num8;
            maxTilesX = ((int) vector.X) + num8;
            num4 = ((int) vector.Y) - num9;
            maxTilesY = (int) (vector.Y + 1f);
            if (num3 < 0)
            {
                num3 = 0;
            }
            if (maxTilesX > Main.maxTilesX)
            {
                maxTilesX = Main.maxTilesX;
            }
            if (num4 < 0)
            {
                num4 = 0;
            }
            if (maxTilesY > Main.maxTilesY)
            {
                maxTilesY = Main.maxTilesY;
            }
            for (int n = num3; n <= maxTilesX; n++)
            {
                for (int num14 = num4; num14 < maxTilesY; num14++)
                {
                    if (Main.tile[n, num14].wall == 0)
                    {
                        Main.tile[n, num14].active = false;
                        Main.tile[n, num14].wall = num2;
                    }
                }
            }
            int num15 = i + ((num8 + 1) * num7);
            int y = (int) vector.Y;
            for (int num17 = num15 - 2; num17 <= (num15 + 2); num17++)
            {
                Main.tile[num17, y].active = false;
                Main.tile[num17, y - 1].active = false;
                Main.tile[num17, y - 2].active = false;
            }
            PlaceTile(num15, y, 10, true, false, -1, 0);
            int contain = 0;
            int houseCount = WorldGen.houseCount;
            if (houseCount > 2)
            {
                houseCount = genRand.Next(3);
            }
            switch (houseCount)
            {
                case 0:
                    contain = 0x9f;
                    break;

                case 1:
                    contain = 0x41;
                    break;

                case 2:
                    contain = 0x9e;
                    break;
            }
            AddBuriedChest(i, y - 3, contain, false, 2);
            WorldGen.houseCount++;
        }

        public static void JungleRunner(int i, int j)
        {
            Vector2 vector;
            Vector2 vector2;
            double num5 = genRand.Next(5, 11);
            vector.X = i;
            vector.Y = j;
            vector2.X = genRand.Next(-10, 11) * 0.1f;
            vector2.Y = genRand.Next(10, 20) * 0.1f;
            int num6 = 0;
            bool flag = true;
            while (flag)
            {
                if (vector.Y < Main.worldSurface)
                {
                    int x = (int) vector.X;
                    int y = (int) vector.Y;
                    if (((((Main.tile[x, y].wall == 0) && !Main.tile[x, y].active) && ((Main.tile[x, y - 3].wall == 0) && !Main.tile[x, y - 3].active)) && (((Main.tile[x, y - 1].wall == 0) && !Main.tile[x, y - 1].active) && ((Main.tile[x, y - 4].wall == 0) && !Main.tile[x, y - 4].active))) && (((Main.tile[x, y - 2].wall == 0) && !Main.tile[x, y - 2].active) && ((Main.tile[x, y - 5].wall == 0) && !Main.tile[x, y - 5].active)))
                    {
                        flag = false;
                    }
                }
                JungleX = (int) vector.X;
                num5 += genRand.Next(-20, 0x15) * 0.1f;
                if (num5 < 5.0)
                {
                    num5 = 5.0;
                }
                if (num5 > 10.0)
                {
                    num5 = 10.0;
                }
                int num = (int) (vector.X - (num5 * 0.5));
                int maxTilesX = (int) (vector.X + (num5 * 0.5));
                int num2 = (int) (vector.Y - (num5 * 0.5));
                int maxTilesY = (int) (vector.Y + (num5 * 0.5));
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                for (int k = num; k < maxTilesX; k++)
                {
                    for (int m = num2; m < maxTilesY; m++)
                    {
                        if ((Math.Abs((float) (k - vector.X)) + Math.Abs((float) (m - vector.Y))) < ((num5 * 0.5) * (1.0 + (genRand.Next(-10, 11) * 0.015))))
                        {
                            KillTile(k, m, false, false, false);
                        }
                    }
                }
                num6++;
                if ((num6 > 10) && (genRand.Next(50) < num6))
                {
                    num6 = 0;
                    int num11 = -2;
                    if (genRand.Next(2) == 0)
                    {
                        num11 = 2;
                    }
                    TileRunner((int) vector.X, (int) vector.Y, (double) genRand.Next(3, 20), genRand.Next(10, 100), -1, false, (float) num11, 0f, false, true);
                }
                vector += vector2;
                vector2.Y += genRand.Next(-10, 11) * 0.01f;
                if (vector2.Y > 0f)
                {
                    vector2.Y = 0f;
                }
                if (vector2.Y < -2f)
                {
                    vector2.Y = -2f;
                }
                vector2.X += genRand.Next(-10, 11) * 0.1f;
                if (vector.X < (i - 200))
                {
                    vector2.X += genRand.Next(5, 0x15) * 0.1f;
                }
                if (vector.X > (i + 200))
                {
                    vector2.X -= genRand.Next(5, 0x15) * 0.1f;
                }
                if (vector2.X > 1.5)
                {
                    vector2.X = 1.5f;
                }
                if (vector2.X < -1.5)
                {
                    vector2.X = -1.5f;
                }
            }
        }

        public static void kickOut(int n)
        {
            if (Main.netMode == 1)
            {
                NetMessage.SendData(60, -1, -1, "", n, 0f, 0f, 0f, 0);
            }
            else
            {
                Main.npc[n].homeless = true;
            }
        }

        public static void KillTile(int i, int j, bool fail = false, bool effectOnly = false, bool noItem = false)
        {
            if (((i >= 0) && (j >= 0)) && ((i < Main.maxTilesX) && (j < Main.maxTilesY)))
            {
                if (Main.tile[i, j] == null)
                {
                    Main.tile[i, j] = new Tile();
                }
                if (Main.tile[i, j].active)
                {
                    if ((j >= 1) && (Main.tile[i, j - 1] == null))
                    {
                        Main.tile[i, j - 1] = new Tile();
                    }
                    if ((((j < 1) || !Main.tile[i, j - 1].active) || ((((Main.tile[i, j - 1].type != 5) || (Main.tile[i, j].type == 5)) && ((Main.tile[i, j - 1].type != 0x15) || (Main.tile[i, j].type == 0x15))) && ((((Main.tile[i, j - 1].type != 0x1a) || (Main.tile[i, j].type == 0x1a)) && ((Main.tile[i, j - 1].type != 0x48) || (Main.tile[i, j].type == 0x48))) && ((Main.tile[i, j - 1].type != 12) || (Main.tile[i, j].type == 12))))) || ((Main.tile[i, j - 1].type == 5) && (((((Main.tile[i, j - 1].frameX == 0x42) && (Main.tile[i, j - 1].frameY >= 0)) && (Main.tile[i, j - 1].frameY <= 0x2c)) || (((Main.tile[i, j - 1].frameX == 0x58) && (Main.tile[i, j - 1].frameY >= 0x42)) && (Main.tile[i, j - 1].frameY <= 110))) || (Main.tile[i, j - 1].frameY >= 0xc6))))
                    {
                        if (!effectOnly && !stopDrops)
                        {
                            if (Main.tile[i, j].type == 0x7f)
                            {
                                Main.PlaySound(2, i * 0x10, j * 0x10, 0x1b);
                            }
                            else if ((Main.tile[i, j].type == 3) || (Main.tile[i, j].type == 110))
                            {
                                Main.PlaySound(6, i * 0x10, j * 0x10, 1);
                                if (Main.tile[i, j].frameX == 0x90)
                                {
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 5, 1, false, 0);
                                }
                            }
                            else if (Main.tile[i, j].type == 0x18)
                            {
                                Main.PlaySound(6, i * 0x10, j * 0x10, 1);
                                if (Main.tile[i, j].frameX == 0x90)
                                {
                                    Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 60, 1, false, 0);
                                }
                            }
                            else if ((((Main.tileAlch[Main.tile[i, j].type] || (Main.tile[i, j].type == 0x20)) || ((Main.tile[i, j].type == 0x33) || (Main.tile[i, j].type == 0x34))) || (((Main.tile[i, j].type == 0x3d) || (Main.tile[i, j].type == 0x3e)) || ((Main.tile[i, j].type == 0x45) || (Main.tile[i, j].type == 0x47)))) || (((Main.tile[i, j].type == 0x49) || (Main.tile[i, j].type == 0x4a)) || ((Main.tile[i, j].type == 0x71) || (Main.tile[i, j].type == 0x73))))
                            {
                                Main.PlaySound(6, i * 0x10, j * 0x10, 1);
                            }
                            else if ((((((Main.tile[i, j].type == 1) || (Main.tile[i, j].type == 6)) || ((Main.tile[i, j].type == 7) || (Main.tile[i, j].type == 8))) || (((Main.tile[i, j].type == 9) || (Main.tile[i, j].type == 0x16)) || ((Main.tile[i, j].type == 140) || (Main.tile[i, j].type == 0x19)))) || ((((Main.tile[i, j].type == 0x25) || (Main.tile[i, j].type == 0x26)) || ((Main.tile[i, j].type == 0x27) || (Main.tile[i, j].type == 0x29))) || (((Main.tile[i, j].type == 0x2b) || (Main.tile[i, j].type == 0x2c)) || ((Main.tile[i, j].type == 0x2d) || (Main.tile[i, j].type == 0x2e))))) || (((((Main.tile[i, j].type == 0x2f) || (Main.tile[i, j].type == 0x30)) || ((Main.tile[i, j].type == 0x38) || (Main.tile[i, j].type == 0x3a))) || (((Main.tile[i, j].type == 0x3f) || (Main.tile[i, j].type == 0x40)) || ((Main.tile[i, j].type == 0x41) || (Main.tile[i, j].type == 0x42)))) || (((((Main.tile[i, j].type == 0x43) || (Main.tile[i, j].type == 0x44)) || ((Main.tile[i, j].type == 0x4b) || (Main.tile[i, j].type == 0x4c))) || (((Main.tile[i, j].type == 0x6b) || (Main.tile[i, j].type == 0x6c)) || ((Main.tile[i, j].type == 0x6f) || (Main.tile[i, j].type == 0x75)))) || (((Main.tile[i, j].type == 0x76) || (Main.tile[i, j].type == 0x77)) || (((Main.tile[i, j].type == 120) || (Main.tile[i, j].type == 0x79)) || (Main.tile[i, j].type == 0x7a))))))
                            {
                                Main.PlaySound(0x15, i * 0x10, j * 0x10, 1);
                            }
                            else if (Main.tile[i, j].type != 0x8a)
                            {
                                Main.PlaySound(0, i * 0x10, j * 0x10, 1);
                            }
                            if ((Main.tile[i, j].type == 0x81) && !fail)
                            {
                                Main.PlaySound(2, i * 0x10, j * 0x10, 0x1b);
                            }
                        }
                        int num = 10;
                        if (Main.tile[i, j].type == 0x80)
                        {
                            int num2 = i;
                            int frameX = Main.tile[i, j].frameX;
                            int num4 = Main.tile[i, j].frameX;
                            while (num4 >= 100)
                            {
                                num4 -= 100;
                            }
                            while (num4 >= 0x24)
                            {
                                num4 -= 0x24;
                            }
                            if (num4 == 0x12)
                            {
                                frameX = Main.tile[i - 1, j].frameX;
                                num2--;
                            }
                            if (frameX >= 100)
                            {
                                int index = 0;
                                while (frameX >= 100)
                                {
                                    frameX -= 100;
                                    index++;
                                }
                                switch ((Main.tile[num2, j].frameY / 0x12))
                                {
                                    case 0:
                                        Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, Item.headType[index], 1, false, 0);
                                        break;

                                    case 1:
                                        Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, Item.bodyType[index], 1, false, 0);
                                        break;

                                    case 2:
                                        Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, Item.legType[index], 1, false, 0);
                                        break;
                                }
                                frameX = Main.tile[num2, j].frameX;
                                while (frameX >= 100)
                                {
                                    frameX -= 100;
                                }
                                Main.tile[num2, j].frameX = (short) frameX;
                            }
                        }
                        if (fail)
                        {
                            num = 3;
                        }
                        if (Main.tile[i, j].type == 0x8a)
                        {
                            num = 0;
                        }
                        for (int k = 0; k < num; k++)
                        {
                            int type = 0;
                            if (Main.tile[i, j].type == 0)
                            {
                                type = 0;
                            }
                            if ((((((Main.tile[i, j].type == 1) || (Main.tile[i, j].type == 0x10)) || ((Main.tile[i, j].type == 0x11) || (Main.tile[i, j].type == 0x26))) || (((Main.tile[i, j].type == 0x27) || (Main.tile[i, j].type == 0x29)) || ((Main.tile[i, j].type == 0x2b) || (Main.tile[i, j].type == 0x2c)))) || ((((Main.tile[i, j].type == 0x30) || Main.tileStone[Main.tile[i, j].type]) || ((Main.tile[i, j].type == 0x55) || (Main.tile[i, j].type == 90))) || (((Main.tile[i, j].type == 0x5c) || (Main.tile[i, j].type == 0x60)) || ((Main.tile[i, j].type == 0x61) || (Main.tile[i, j].type == 0x63))))) || ((((Main.tile[i, j].type == 0x69) || (Main.tile[i, j].type == 0x75)) || ((Main.tile[i, j].type == 130) || (Main.tile[i, j].type == 0x83))) || ((((Main.tile[i, j].type == 0x84) || (Main.tile[i, j].type == 0x87)) || ((Main.tile[i, j].type == 0x87) || (Main.tile[i, j].type == 0x89))) || (((Main.tile[i, j].type == 0x8e) || (Main.tile[i, j].type == 0x8f)) || (Main.tile[i, j].type == 0x90)))))
                            {
                                type = 1;
                            }
                            if (((Main.tile[i, j].type == 0x21) || (Main.tile[i, j].type == 0x5f)) || ((Main.tile[i, j].type == 0x62) || (Main.tile[i, j].type == 100)))
                            {
                                type = 6;
                            }
                            if (((((Main.tile[i, j].type == 5) || (Main.tile[i, j].type == 10)) || ((Main.tile[i, j].type == 11) || (Main.tile[i, j].type == 14))) || (((Main.tile[i, j].type == 15) || (Main.tile[i, j].type == 0x13)) || ((Main.tile[i, j].type == 30) || (Main.tile[i, j].type == 0x56)))) || ((((Main.tile[i, j].type == 0x57) || (Main.tile[i, j].type == 0x58)) || ((Main.tile[i, j].type == 0x59) || (Main.tile[i, j].type == 0x5d))) || ((((Main.tile[i, j].type == 0x5e) || (Main.tile[i, j].type == 0x68)) || ((Main.tile[i, j].type == 0x6a) || (Main.tile[i, j].type == 0x72))) || (((Main.tile[i, j].type == 0x7c) || (Main.tile[i, j].type == 0x80)) || (Main.tile[i, j].type == 0x8b)))))
                            {
                                type = 7;
                            }
                            if (Main.tile[i, j].type == 0x15)
                            {
                                if (Main.tile[i, j].frameX >= 0x6c)
                                {
                                    type = 0x25;
                                }
                                else if (Main.tile[i, j].frameX >= 0x24)
                                {
                                    type = 10;
                                }
                                else
                                {
                                    type = 7;
                                }
                            }
                            if (Main.tile[i, j].type == 2)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    type = 0;
                                }
                                else
                                {
                                    type = 2;
                                }
                            }
                            if (Main.tile[i, j].type == 0x7f)
                            {
                                type = 0x43;
                            }
                            if (Main.tile[i, j].type == 0x5b)
                            {
                                type = -1;
                            }
                            if ((Main.tile[i, j].type == 6) || (Main.tile[i, j].type == 0x1a))
                            {
                                type = 8;
                            }
                            if (((Main.tile[i, j].type == 7) || (Main.tile[i, j].type == 0x22)) || (Main.tile[i, j].type == 0x2f))
                            {
                                type = 9;
                            }
                            if (((Main.tile[i, j].type == 8) || (Main.tile[i, j].type == 0x24)) || ((Main.tile[i, j].type == 0x2d) || (Main.tile[i, j].type == 0x66)))
                            {
                                type = 10;
                            }
                            if ((((Main.tile[i, j].type == 9) || (Main.tile[i, j].type == 0x23)) || ((Main.tile[i, j].type == 0x2a) || (Main.tile[i, j].type == 0x2e))) || ((Main.tile[i, j].type == 0x7e) || (Main.tile[i, j].type == 0x88)))
                            {
                                type = 11;
                            }
                            if (Main.tile[i, j].type == 12)
                            {
                                type = 12;
                            }
                            if ((Main.tile[i, j].type == 3) || (Main.tile[i, j].type == 0x49))
                            {
                                type = 3;
                            }
                            if ((Main.tile[i, j].type == 13) || (Main.tile[i, j].type == 0x36))
                            {
                                type = 13;
                            }
                            if ((Main.tile[i, j].type == 0x16) || (Main.tile[i, j].type == 140))
                            {
                                type = 14;
                            }
                            if ((Main.tile[i, j].type == 0x1c) || (Main.tile[i, j].type == 0x4e))
                            {
                                type = 0x16;
                            }
                            if (Main.tile[i, j].type == 0x1d)
                            {
                                type = 0x17;
                            }
                            if ((Main.tile[i, j].type == 40) || (Main.tile[i, j].type == 0x67))
                            {
                                type = 0x1c;
                            }
                            if (Main.tile[i, j].type == 0x31)
                            {
                                type = 0x1d;
                            }
                            if (Main.tile[i, j].type == 50)
                            {
                                type = 0x16;
                            }
                            if (Main.tile[i, j].type == 0x33)
                            {
                                type = 30;
                            }
                            if (Main.tile[i, j].type == 0x34)
                            {
                                type = 3;
                            }
                            if ((Main.tile[i, j].type == 0x35) || (Main.tile[i, j].type == 0x51))
                            {
                                type = 0x20;
                            }
                            if ((Main.tile[i, j].type == 0x38) || (Main.tile[i, j].type == 0x4b))
                            {
                                type = 0x25;
                            }
                            if (((Main.tile[i, j].type == 0x39) || (Main.tile[i, j].type == 0x77)) || (Main.tile[i, j].type == 0x8d))
                            {
                                type = 0x24;
                            }
                            if ((Main.tile[i, j].type == 0x3b) || (Main.tile[i, j].type == 120))
                            {
                                type = 0x26;
                            }
                            if (((Main.tile[i, j].type == 0x3d) || (Main.tile[i, j].type == 0x3e)) || ((Main.tile[i, j].type == 0x4a) || (Main.tile[i, j].type == 80)))
                            {
                                type = 40;
                            }
                            if (Main.tile[i, j].type == 0x45)
                            {
                                type = 7;
                            }
                            if ((Main.tile[i, j].type == 0x47) || (Main.tile[i, j].type == 0x48))
                            {
                                type = 0x1a;
                            }
                            if (Main.tile[i, j].type == 70)
                            {
                                type = 0x11;
                            }
                            if (Main.tile[i, j].type == 0x70)
                            {
                                type = 14;
                            }
                            if (Main.tile[i, j].type == 0x7b)
                            {
                                type = 0x35;
                            }
                            if ((Main.tile[i, j].type == 0x74) || (Main.tile[i, j].type == 0x76))
                            {
                                type = 0x33;
                            }
                            if (Main.tile[i, j].type == 0x6d)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    type = 0;
                                }
                                else
                                {
                                    type = 0x2f;
                                }
                            }
                            if (((Main.tile[i, j].type == 110) || (Main.tile[i, j].type == 0x71)) || (Main.tile[i, j].type == 0x73))
                            {
                                type = 0x2f;
                            }
                            if ((Main.tile[i, j].type == 0x6b) || (Main.tile[i, j].type == 0x79))
                            {
                                type = 0x30;
                            }
                            if (((Main.tile[i, j].type == 0x6c) || (Main.tile[i, j].type == 0x7a)) || (Main.tile[i, j].type == 0x86))
                            {
                                type = 0x31;
                            }
                            if ((Main.tile[i, j].type == 0x6f) || (Main.tile[i, j].type == 0x85))
                            {
                                type = 50;
                            }
                            if (Main.tileAlch[Main.tile[i, j].type])
                            {
                                switch ((Main.tile[i, j].frameX / 0x12))
                                {
                                    case 0:
                                        type = 3;
                                        break;

                                    case 1:
                                        type = 3;
                                        break;

                                    case 2:
                                        type = 7;
                                        break;

                                    case 3:
                                        type = 0x11;
                                        break;

                                    case 4:
                                        type = 3;
                                        break;

                                    case 5:
                                        type = 6;
                                        goto Label_1523;
                                }
                            }
                        Label_1523:
                            if (Main.tile[i, j].type == 0x3d)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    type = 0x26;
                                }
                                else
                                {
                                    type = 0x27;
                                }
                            }
                            if (((Main.tile[i, j].type == 0x3a) || (Main.tile[i, j].type == 0x4c)) || (Main.tile[i, j].type == 0x4d))
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    type = 6;
                                }
                                else
                                {
                                    type = 0x19;
                                }
                            }
                            if (Main.tile[i, j].type == 0x25)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    type = 6;
                                }
                                else
                                {
                                    type = 0x17;
                                }
                            }
                            if (Main.tile[i, j].type == 0x20)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    type = 14;
                                }
                                else
                                {
                                    type = 0x18;
                                }
                            }
                            if ((Main.tile[i, j].type == 0x17) || (Main.tile[i, j].type == 0x18))
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    type = 14;
                                }
                                else
                                {
                                    type = 0x11;
                                }
                            }
                            if ((Main.tile[i, j].type == 0x19) || (Main.tile[i, j].type == 0x1f))
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    type = 14;
                                }
                                else
                                {
                                    type = 1;
                                }
                            }
                            if (Main.tile[i, j].type == 20)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    type = 7;
                                }
                                else
                                {
                                    type = 2;
                                }
                            }
                            if (Main.tile[i, j].type == 0x1b)
                            {
                                if (genRand.Next(2) == 0)
                                {
                                    type = 3;
                                }
                                else
                                {
                                    type = 0x13;
                                }
                            }
                            if (Main.tile[i, j].type == 0x81)
                            {
                                if (((Main.tile[i, j].frameX == 0) || (Main.tile[i, j].frameX == 0x36)) || (Main.tile[i, j].frameX == 0x6c))
                                {
                                    type = 0x44;
                                }
                                else if (((Main.tile[i, j].frameX == 0x12) || (Main.tile[i, j].frameX == 0x48)) || (Main.tile[i, j].frameX == 0x7e))
                                {
                                    type = 0x45;
                                }
                                else
                                {
                                    type = 70;
                                }
                            }
                            if (Main.tile[i, j].type == 4)
                            {
                                int num10 = Main.tile[i, j].frameY / 0x16;
                                if (num10 == 0)
                                {
                                    type = 6;
                                }
                                else if (num10 == 8)
                                {
                                    type = 0x4b;
                                }
                                else
                                {
                                    type = 0x3a + num10;
                                }
                            }
                            if ((((Main.tile[i, j].type == 0x22) || (Main.tile[i, j].type == 0x23)) || ((Main.tile[i, j].type == 0x24) || (Main.tile[i, j].type == 0x2a))) && (Main.rand.Next(2) == 0))
                            {
                                type = 6;
                            }
                            if (type >= 0)
                            {
                                Color newColor = new Color();
                                Dust.NewDust(new Vector2((float) (i * 0x10), (float) (j * 0x10)), 0x10, 0x10, type, 0f, 0f, 0, newColor, 1f);
                            }
                        }
                        if (!effectOnly)
                        {
                            if (fail)
                            {
                                if (((Main.tile[i, j].type == 2) || (Main.tile[i, j].type == 0x17)) || (Main.tile[i, j].type == 0x6d))
                                {
                                    Main.tile[i, j].type = 0;
                                }
                                if ((Main.tile[i, j].type == 60) || (Main.tile[i, j].type == 70))
                                {
                                    Main.tile[i, j].type = 0x3b;
                                }
                                SquareTileFrame(i, j, true);
                            }
                            else
                            {
                                if ((Main.tile[i, j].type == 0x15) && (Main.netMode != 1))
                                {
                                    int x = Main.tile[i, j].frameX / 0x12;
                                    int y = j - (Main.tile[i, j].frameY / 0x12);
                                    while (x > 1)
                                    {
                                        x -= 2;
                                    }
                                    x = i - x;
                                    if (!Chest.DestroyChest(x, y))
                                    {
                                        return;
                                    }
                                }
                                if ((!noItem && !stopDrops) && (Main.netMode != 1))
                                {
                                    int num13 = 0;
                                    if (((Main.tile[i, j].type == 0) || (Main.tile[i, j].type == 2)) || (Main.tile[i, j].type == 0x6d))
                                    {
                                        num13 = 2;
                                    }
                                    else if (Main.tile[i, j].type == 1)
                                    {
                                        num13 = 3;
                                    }
                                    else if ((Main.tile[i, j].type == 3) || (Main.tile[i, j].type == 0x49))
                                    {
                                        if ((Main.rand.Next(2) == 0) && Main.player[Player.FindClosest(new Vector2((float) (i * 0x10), (float) (j * 0x10)), 0x10, 0x10)].HasItem(0x119))
                                        {
                                            num13 = 0x11b;
                                        }
                                    }
                                    else if (Main.tile[i, j].type == 4)
                                    {
                                        int num14 = Main.tile[i, j].frameY / 0x16;
                                        if (num14 == 0)
                                        {
                                            num13 = 8;
                                        }
                                        else if (num14 == 8)
                                        {
                                            num13 = 0x20b;
                                        }
                                        else
                                        {
                                            num13 = 0x1aa + num14;
                                        }
                                    }
                                    else if (Main.tile[i, j].type == 5)
                                    {
                                        if ((Main.tile[i, j].frameX >= 0x16) && (Main.tile[i, j].frameY >= 0xc6))
                                        {
                                            if (Main.netMode != 1)
                                            {
                                                if (genRand.Next(2) == 0)
                                                {
                                                    int num15 = j;
                                                    while ((Main.tile[i, num15] != null) && ((!Main.tile[i, num15].active || !Main.tileSolid[Main.tile[i, num15].type]) || Main.tileSolidTop[Main.tile[i, num15].type]))
                                                    {
                                                        num15++;
                                                    }
                                                    if (Main.tile[i, num15] != null)
                                                    {
                                                        if ((Main.tile[i, num15].type == 2) || (Main.tile[i, num15].type == 0x6d))
                                                        {
                                                            num13 = 0x1b;
                                                        }
                                                        else
                                                        {
                                                            num13 = 9;
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    num13 = 9;
                                                }
                                            }
                                        }
                                        else
                                        {
                                            num13 = 9;
                                        }
                                    }
                                    else if (Main.tile[i, j].type == 6)
                                    {
                                        num13 = 11;
                                    }
                                    else if (Main.tile[i, j].type == 7)
                                    {
                                        num13 = 12;
                                    }
                                    else if (Main.tile[i, j].type == 8)
                                    {
                                        num13 = 13;
                                    }
                                    else if (Main.tile[i, j].type == 9)
                                    {
                                        num13 = 14;
                                    }
                                    else if (Main.tile[i, j].type == 0x7b)
                                    {
                                        num13 = 0x1a8;
                                    }
                                    else if (Main.tile[i, j].type == 0x7c)
                                    {
                                        num13 = 480;
                                    }
                                    else if (Main.tile[i, j].type == 13)
                                    {
                                        Main.PlaySound(13, i * 0x10, j * 0x10, 1);
                                        if (Main.tile[i, j].frameX == 0x12)
                                        {
                                            num13 = 0x1c;
                                        }
                                        else if (Main.tile[i, j].frameX == 0x24)
                                        {
                                            num13 = 110;
                                        }
                                        else if (Main.tile[i, j].frameX == 0x36)
                                        {
                                            num13 = 350;
                                        }
                                        else if (Main.tile[i, j].frameX == 0x48)
                                        {
                                            num13 = 0x15f;
                                        }
                                        else
                                        {
                                            num13 = 0x1f;
                                        }
                                    }
                                    else if (Main.tile[i, j].type == 0x13)
                                    {
                                        num13 = 0x5e;
                                    }
                                    else if (Main.tile[i, j].type == 0x16)
                                    {
                                        num13 = 0x38;
                                    }
                                    else if (Main.tile[i, j].type == 140)
                                    {
                                        num13 = 0x241;
                                    }
                                    else if (Main.tile[i, j].type == 0x17)
                                    {
                                        num13 = 2;
                                    }
                                    else if (Main.tile[i, j].type == 0x19)
                                    {
                                        num13 = 0x3d;
                                    }
                                    else if (Main.tile[i, j].type == 30)
                                    {
                                        num13 = 9;
                                    }
                                    else if (Main.tile[i, j].type == 0x21)
                                    {
                                        num13 = 0x69;
                                    }
                                    else if (Main.tile[i, j].type == 0x25)
                                    {
                                        num13 = 0x74;
                                    }
                                    else if (Main.tile[i, j].type == 0x26)
                                    {
                                        num13 = 0x81;
                                    }
                                    else if (Main.tile[i, j].type == 0x27)
                                    {
                                        num13 = 0x83;
                                    }
                                    else if (Main.tile[i, j].type == 40)
                                    {
                                        num13 = 0x85;
                                    }
                                    else if (Main.tile[i, j].type == 0x29)
                                    {
                                        num13 = 0x86;
                                    }
                                    else if (Main.tile[i, j].type == 0x2b)
                                    {
                                        num13 = 0x89;
                                    }
                                    else if (Main.tile[i, j].type == 0x2c)
                                    {
                                        num13 = 0x8b;
                                    }
                                    else if (Main.tile[i, j].type == 0x2d)
                                    {
                                        num13 = 0x8d;
                                    }
                                    else if (Main.tile[i, j].type == 0x2e)
                                    {
                                        num13 = 0x8f;
                                    }
                                    else if (Main.tile[i, j].type == 0x2f)
                                    {
                                        num13 = 0x91;
                                    }
                                    else if (Main.tile[i, j].type == 0x30)
                                    {
                                        num13 = 0x93;
                                    }
                                    else if (Main.tile[i, j].type == 0x31)
                                    {
                                        num13 = 0x94;
                                    }
                                    else if (Main.tile[i, j].type == 0x33)
                                    {
                                        num13 = 150;
                                    }
                                    else if (Main.tile[i, j].type == 0x35)
                                    {
                                        num13 = 0xa9;
                                    }
                                    else if (Main.tile[i, j].type == 0x36)
                                    {
                                        num13 = 170;
                                        Main.PlaySound(13, i * 0x10, j * 0x10, 1);
                                    }
                                    else if (Main.tile[i, j].type == 0x38)
                                    {
                                        num13 = 0xad;
                                    }
                                    else if (Main.tile[i, j].type == 0x39)
                                    {
                                        num13 = 0xac;
                                    }
                                    else if (Main.tile[i, j].type == 0x3a)
                                    {
                                        num13 = 0xae;
                                    }
                                    else if (Main.tile[i, j].type == 60)
                                    {
                                        num13 = 0xb0;
                                    }
                                    else if (Main.tile[i, j].type == 70)
                                    {
                                        num13 = 0xb0;
                                    }
                                    else if (Main.tile[i, j].type == 0x4b)
                                    {
                                        num13 = 0xc0;
                                    }
                                    else if (Main.tile[i, j].type == 0x4c)
                                    {
                                        num13 = 0xd6;
                                    }
                                    else if (Main.tile[i, j].type == 0x4e)
                                    {
                                        num13 = 0xde;
                                    }
                                    else if (Main.tile[i, j].type == 0x51)
                                    {
                                        num13 = 0x113;
                                    }
                                    else if (Main.tile[i, j].type == 80)
                                    {
                                        num13 = 0x114;
                                    }
                                    else if (Main.tile[i, j].type == 0x6b)
                                    {
                                        num13 = 0x16c;
                                    }
                                    else if (Main.tile[i, j].type == 0x6c)
                                    {
                                        num13 = 0x16d;
                                    }
                                    else if (Main.tile[i, j].type == 0x6f)
                                    {
                                        num13 = 0x16e;
                                    }
                                    else if (Main.tile[i, j].type == 0x70)
                                    {
                                        num13 = 370;
                                    }
                                    else if (Main.tile[i, j].type == 0x74)
                                    {
                                        num13 = 0x198;
                                    }
                                    else if (Main.tile[i, j].type == 0x75)
                                    {
                                        num13 = 0x199;
                                    }
                                    else if (Main.tile[i, j].type == 0x81)
                                    {
                                        num13 = 0x1f6;
                                    }
                                    else if (Main.tile[i, j].type == 0x76)
                                    {
                                        num13 = 0x19c;
                                    }
                                    else if (Main.tile[i, j].type == 0x77)
                                    {
                                        num13 = 0x19d;
                                    }
                                    else if (Main.tile[i, j].type == 120)
                                    {
                                        num13 = 0x19e;
                                    }
                                    else if (Main.tile[i, j].type == 0x79)
                                    {
                                        num13 = 0x19f;
                                    }
                                    else if (Main.tile[i, j].type == 0x7a)
                                    {
                                        num13 = 0x1a0;
                                    }
                                    else if (Main.tile[i, j].type == 0x88)
                                    {
                                        num13 = 0x21a;
                                    }
                                    else if (Main.tile[i, j].type == 0x89)
                                    {
                                        num13 = 0x21b;
                                    }
                                    else if (Main.tile[i, j].type == 0x8d)
                                    {
                                        num13 = 580;
                                    }
                                    else if (Main.tile[i, j].type == 0x87)
                                    {
                                        if (Main.tile[i, j].frameY == 0)
                                        {
                                            num13 = 0x211;
                                        }
                                        if (Main.tile[i, j].frameY == 0x12)
                                        {
                                            num13 = 0x21d;
                                        }
                                        if (Main.tile[i, j].frameY == 0x24)
                                        {
                                            num13 = 0x21e;
                                        }
                                        if (Main.tile[i, j].frameY == 0x36)
                                        {
                                            num13 = 0x21f;
                                        }
                                    }
                                    else if (Main.tile[i, j].type == 0x90)
                                    {
                                        if (Main.tile[i, j].frameX == 0)
                                        {
                                            num13 = 0x247;
                                        }
                                        if (Main.tile[i, j].frameX == 0x12)
                                        {
                                            num13 = 0x248;
                                        }
                                        if (Main.tile[i, j].frameX == 0x24)
                                        {
                                            num13 = 0x249;
                                        }
                                    }
                                    else if (Main.tile[i, j].type == 130)
                                    {
                                        num13 = 0x1ff;
                                    }
                                    else if (Main.tile[i, j].type == 0x83)
                                    {
                                        num13 = 0x200;
                                    }
                                    else if ((Main.tile[i, j].type == 0x3d) || (Main.tile[i, j].type == 0x4a))
                                    {
                                        if (Main.tile[i, j].frameX == 0x90)
                                        {
                                            Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x14b, genRand.Next(2, 4), false, 0);
                                        }
                                        else if (Main.tile[i, j].frameX == 0xa2)
                                        {
                                            num13 = 0xdf;
                                        }
                                        else if (((Main.tile[i, j].frameX >= 0x6c) && (Main.tile[i, j].frameX <= 0x7e)) && (genRand.Next(100) == 0))
                                        {
                                            num13 = 0xd0;
                                        }
                                        else if (genRand.Next(100) == 0)
                                        {
                                            num13 = 0xc3;
                                        }
                                    }
                                    else if ((Main.tile[i, j].type == 0x3b) || (Main.tile[i, j].type == 60))
                                    {
                                        num13 = 0xb0;
                                    }
                                    else if ((Main.tile[i, j].type == 0x47) || (Main.tile[i, j].type == 0x48))
                                    {
                                        if (genRand.Next(50) == 0)
                                        {
                                            num13 = 0xc2;
                                        }
                                        else if (genRand.Next(2) == 0)
                                        {
                                            num13 = 0xb7;
                                        }
                                    }
                                    else if ((Main.tile[i, j].type >= 0x3f) && (Main.tile[i, j].type <= 0x44))
                                    {
                                        num13 = (Main.tile[i, j].type - 0x3f) + 0xb1;
                                    }
                                    else if (Main.tile[i, j].type == 50)
                                    {
                                        if (Main.tile[i, j].frameX == 90)
                                        {
                                            num13 = 0xa5;
                                        }
                                        else
                                        {
                                            num13 = 0x95;
                                        }
                                    }
                                    else if (Main.tileAlch[Main.tile[i, j].type] && (Main.tile[i, j].type > 0x52))
                                    {
                                        int num16 = Main.tile[i, j].frameX / 0x12;
                                        bool flag = false;
                                        if (Main.tile[i, j].type == 0x54)
                                        {
                                            flag = true;
                                        }
                                        if ((num16 == 0) && Main.dayTime)
                                        {
                                            flag = true;
                                        }
                                        if ((num16 == 1) && !Main.dayTime)
                                        {
                                            flag = true;
                                        }
                                        if ((num16 == 3) && Main.bloodMoon)
                                        {
                                            flag = true;
                                        }
                                        num13 = 0x139 + num16;
                                        if (flag)
                                        {
                                            Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x133 + num16, genRand.Next(1, 4), false, 0);
                                        }
                                    }
                                    if (num13 > 0)
                                    {
                                        Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, num13, 1, false, -1);
                                    }
                                }
                                Main.tile[i, j].active = false;
                                Main.tile[i, j].frameX = -1;
                                Main.tile[i, j].frameY = -1;
                                Main.tile[i, j].frameNumber = 0;
                                if ((Main.tile[i, j].type == 0x3a) && (j > (Main.maxTilesY - 200)))
                                {
                                    Main.tile[i, j].lava = true;
                                    Main.tile[i, j].liquid = 0x80;
                                }
                                Main.tile[i, j].type = 0;
                                SquareTileFrame(i, j, true);
                            }
                        }
                    }
                }
            }
        }

        public static void KillWall(int i, int j, bool fail = false)
        {
            if (((i >= 0) && (j >= 0)) && ((i < Main.maxTilesX) && (j < Main.maxTilesY)))
            {
                if (Main.tile[i, j] == null)
                {
                    Main.tile[i, j] = new Tile();
                }
                if (Main.tile[i, j].wall > 0)
                {
                    if (Main.tile[i, j].wall == 0x15)
                    {
                        Main.PlaySound(13, i * 0x10, j * 0x10, 1);
                    }
                    else
                    {
                        Main.PlaySound(0, i * 0x10, j * 0x10, 1);
                    }
                    int num = 10;
                    if (fail)
                    {
                        num = 3;
                    }
                    for (int k = 0; k < num; k++)
                    {
                        int type = 0;
                        if ((((Main.tile[i, j].wall == 1) || (Main.tile[i, j].wall == 5)) || ((Main.tile[i, j].wall == 6) || (Main.tile[i, j].wall == 7))) || ((Main.tile[i, j].wall == 8) || (Main.tile[i, j].wall == 9)))
                        {
                            type = 1;
                        }
                        if (Main.tile[i, j].wall == 3)
                        {
                            if (genRand.Next(2) == 0)
                            {
                                type = 14;
                            }
                            else
                            {
                                type = 1;
                            }
                        }
                        if (Main.tile[i, j].wall == 4)
                        {
                            type = 7;
                        }
                        if (Main.tile[i, j].wall == 12)
                        {
                            type = 9;
                        }
                        if (Main.tile[i, j].wall == 10)
                        {
                            type = 10;
                        }
                        if (Main.tile[i, j].wall == 11)
                        {
                            type = 11;
                        }
                        if (Main.tile[i, j].wall == 0x15)
                        {
                            type = 13;
                        }
                        if ((Main.tile[i, j].wall == 0x16) || (Main.tile[i, j].wall == 0x1c))
                        {
                            type = 0x33;
                        }
                        if (Main.tile[i, j].wall == 0x17)
                        {
                            type = 0x26;
                        }
                        if (Main.tile[i, j].wall == 0x18)
                        {
                            type = 0x24;
                        }
                        if (Main.tile[i, j].wall == 0x19)
                        {
                            type = 0x30;
                        }
                        if (Main.tile[i, j].wall == 0x1a)
                        {
                            type = 0x31;
                        }
                        if (Main.tile[i, j].wall == 0x1b)
                        {
                            if (genRand.Next(2) == 0)
                            {
                                type = 7;
                            }
                            else
                            {
                                type = 1;
                            }
                        }
                        Color newColor = new Color();
                        Dust.NewDust(new Vector2((float) (i * 0x10), (float) (j * 0x10)), 0x10, 0x10, type, 0f, 0f, 0, newColor, 1f);
                    }
                    if (fail)
                    {
                        SquareWallFrame(i, j, true);
                    }
                    else
                    {
                        int num4 = 0;
                        if (Main.tile[i, j].wall == 1)
                        {
                            num4 = 0x1a;
                        }
                        if (Main.tile[i, j].wall == 4)
                        {
                            num4 = 0x5d;
                        }
                        if (Main.tile[i, j].wall == 5)
                        {
                            num4 = 130;
                        }
                        if (Main.tile[i, j].wall == 6)
                        {
                            num4 = 0x84;
                        }
                        if (Main.tile[i, j].wall == 7)
                        {
                            num4 = 0x87;
                        }
                        if (Main.tile[i, j].wall == 8)
                        {
                            num4 = 0x8a;
                        }
                        if (Main.tile[i, j].wall == 9)
                        {
                            num4 = 140;
                        }
                        if (Main.tile[i, j].wall == 10)
                        {
                            num4 = 0x8e;
                        }
                        if (Main.tile[i, j].wall == 11)
                        {
                            num4 = 0x90;
                        }
                        if (Main.tile[i, j].wall == 12)
                        {
                            num4 = 0x92;
                        }
                        if (Main.tile[i, j].wall == 14)
                        {
                            num4 = 330;
                        }
                        if (Main.tile[i, j].wall == 0x10)
                        {
                            num4 = 30;
                        }
                        if (Main.tile[i, j].wall == 0x11)
                        {
                            num4 = 0x87;
                        }
                        if (Main.tile[i, j].wall == 0x12)
                        {
                            num4 = 0x8a;
                        }
                        if (Main.tile[i, j].wall == 0x13)
                        {
                            num4 = 140;
                        }
                        if (Main.tile[i, j].wall == 20)
                        {
                            num4 = 330;
                        }
                        if (Main.tile[i, j].wall == 0x15)
                        {
                            num4 = 0x188;
                        }
                        if (Main.tile[i, j].wall == 0x16)
                        {
                            num4 = 0x1a1;
                        }
                        if (Main.tile[i, j].wall == 0x17)
                        {
                            num4 = 0x1a2;
                        }
                        if (Main.tile[i, j].wall == 0x18)
                        {
                            num4 = 0x1a3;
                        }
                        if (Main.tile[i, j].wall == 0x19)
                        {
                            num4 = 420;
                        }
                        if (Main.tile[i, j].wall == 0x1a)
                        {
                            num4 = 0x1a5;
                        }
                        if (Main.tile[i, j].wall == 0x1b)
                        {
                            num4 = 0x1df;
                        }
                        if (num4 > 0)
                        {
                            Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, num4, 1, false, 0);
                        }
                        Main.tile[i, j].wall = 0;
                        SquareWallFrame(i, j, true);
                    }
                }
            }
        }

        public static bool KillWire(int i, int j)
        {
            if (!Main.tile[i, j].wire)
            {
                return false;
            }
            Main.PlaySound(0, i * 0x10, j * 0x10, 1);
            Main.tile[i, j].wire = false;
            if (Main.netMode != 1)
            {
                Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 530, 1, false, 0);
            }
            for (int k = 0; k < 5; k++)
            {
                Color newColor = new Color();
                Dust.NewDust(new Vector2((float) (i * 0x10), (float) (j * 0x10)), 0x10, 0x10, 50, 0f, 0f, 0, newColor, 1f);
            }
            return true;
        }

        public static void Lakinater(int i, int j)
        {
            Vector2 vector;
            Vector2 vector2;
            double num5 = genRand.Next(0x19, 50);
            double num6 = num5;
            float num7 = genRand.Next(30, 80);
            if (genRand.Next(5) == 0)
            {
                num5 *= 1.5;
                num6 *= 1.5;
                num7 *= 1.2f;
            }
            vector.X = i;
            vector.Y = j - (num7 * 0.3f);
            vector2.X = genRand.Next(-10, 11) * 0.1f;
            vector2.Y = genRand.Next(-20, -10) * 0.1f;
            while ((num5 > 0.0) && (num7 > 0f))
            {
                if ((vector.Y + (num6 * 0.5)) > Main.worldSurface)
                {
                    num7 = 0f;
                }
                num5 -= genRand.Next(3);
                num7--;
                int num = (int) (vector.X - (num5 * 0.5));
                int maxTilesX = (int) (vector.X + (num5 * 0.5));
                int num2 = (int) (vector.Y - (num5 * 0.5));
                int maxTilesY = (int) (vector.Y + (num5 * 0.5));
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                num6 = (num5 * genRand.Next(80, 120)) * 0.01;
                for (int k = num; k < maxTilesX; k++)
                {
                    for (int m = num2; m < maxTilesY; m++)
                    {
                        float num10 = Math.Abs((float) (k - vector.X));
                        float num11 = Math.Abs((float) (m - vector.Y));
                        if (Math.Sqrt((double) ((num10 * num10) + (num11 * num11))) < (num6 * 0.4))
                        {
                            if (Main.tile[k, m].active)
                            {
                                Main.tile[k, m].liquid = 0xff;
                            }
                            Main.tile[k, m].active = false;
                        }
                    }
                }
                vector += vector2;
                vector2.X += genRand.Next(-10, 11) * 0.05f;
                vector2.Y += genRand.Next(-10, 11) * 0.05f;
                if (vector2.X > 0.5)
                {
                    vector2.X = 0.5f;
                }
                if (vector2.X < -0.5)
                {
                    vector2.X = -0.5f;
                }
                if (vector2.Y > 1.5)
                {
                    vector2.Y = 1.5f;
                }
                if (vector2.Y < 0.5)
                {
                    vector2.Y = 0.5f;
                }
            }
        }

        public static void loadWorld()
        {
            if (!File.Exists(Main.worldPathName) && Main.autoGen)
            {
                for (int i = Main.worldPathName.Length - 1; i >= 0; i--)
                {
                    if (Main.worldPathName.Substring(i, 1) == @"\")
                    {
                        Directory.CreateDirectory(Main.worldPathName.Substring(0, i));
                        break;
                    }
                }
                clearWorld();
                generateWorld(-1);
                saveWorld(false);
            }
            if (genRand == null)
            {
                genRand = new Random((int) DateTime.Now.Ticks);
            }
            using (FileStream stream = new FileStream(Main.worldPathName, FileMode.Open))
            {
                using (BinaryReader reader = new BinaryReader(stream))
                {
                    try
                    {
                        loadFailed = false;
                        loadSuccess = false;
                        int release = reader.ReadInt32();
                        if (release > Main.curRelease)
                        {
                            Console.WriteLine("Error loading world due to invalid version");
                            loadFailed = true;
                            loadSuccess = false;
                            try
                            {
                                reader.Close();
                                stream.Close();
                            }
                            catch
                            {
                            }
                        }
                        else
                        {
                            Main.worldName = reader.ReadString();
                            Main.worldID = reader.ReadInt32();
                            Main.leftWorld = reader.ReadInt32();
                            Main.rightWorld = reader.ReadInt32();
                            Main.topWorld = reader.ReadInt32();
                            Main.bottomWorld = reader.ReadInt32();
                            Main.maxTilesY = reader.ReadInt32();
                            Main.maxTilesX = reader.ReadInt32();
                            clearWorld();
                            Main.spawnTileX = reader.ReadInt32();
                            Main.spawnTileY = reader.ReadInt32();
                            Main.worldSurface = reader.ReadDouble();
                            Main.rockLayer = reader.ReadDouble();
                            tempTime = reader.ReadDouble();
                            tempDayTime = reader.ReadBoolean();
                            tempMoonPhase = reader.ReadInt32();
                            tempBloodMoon = reader.ReadBoolean();
                            Main.dungeonX = reader.ReadInt32();
                            Main.dungeonY = reader.ReadInt32();
                            NPC.downedBoss1 = reader.ReadBoolean();
                            NPC.downedBoss2 = reader.ReadBoolean();
                            NPC.downedBoss3 = reader.ReadBoolean();
                            if (release >= 0x1d)
                            {
                                NPC.savedGoblin = reader.ReadBoolean();
                                NPC.savedWizard = reader.ReadBoolean();
                                if (release >= 0x22)
                                {
                                    NPC.savedMech = reader.ReadBoolean();
                                }
                                NPC.downedGoblins = reader.ReadBoolean();
                            }
                            if (release >= 0x20)
                            {
                                NPC.downedClown = reader.ReadBoolean();
                            }
                            shadowOrbSmashed = reader.ReadBoolean();
                            spawnMeteor = reader.ReadBoolean();
                            shadowOrbCount = reader.ReadByte();
                            if (release >= 0x17)
                            {
                                altarCount = reader.ReadInt32();
                                Main.hardMode = reader.ReadBoolean();
                            }
                            Main.invasionDelay = reader.ReadInt32();
                            Main.invasionSize = reader.ReadInt32();
                            Main.invasionType = reader.ReadInt32();
                            Main.invasionX = reader.ReadDouble();
                            for (int j = 0; j < Main.maxTilesX; j++)
                            {
                                float num4 = ((float) j) / ((float) Main.maxTilesX);
                                Main.statusText = "Loading world data: " + ((int) ((num4 * 100f) + 1f)) + "%";
                                for (int num5 = 0; num5 < Main.maxTilesY; num5++)
                                {
                                    Main.tile[j, num5].active = reader.ReadBoolean();
                                    if (Main.tile[j, num5].active)
                                    {
                                        Main.tile[j, num5].type = reader.ReadByte();
                                        if (Main.tile[j, num5].type == 0x7f)
                                        {
                                            Main.tile[j, num5].active = false;
                                        }
                                        if (Main.tileFrameImportant[Main.tile[j, num5].type])
                                        {
                                            if ((release < 0x1c) && (Main.tile[j, num5].type == 4))
                                            {
                                                Main.tile[j, num5].frameX = 0;
                                                Main.tile[j, num5].frameY = 0;
                                            }
                                            else
                                            {
                                                Main.tile[j, num5].frameX = reader.ReadInt16();
                                                Main.tile[j, num5].frameY = reader.ReadInt16();
                                                if (Main.tile[j, num5].type == 0x90)
                                                {
                                                    Main.tile[j, num5].frameY = 0;
                                                }
                                            }
                                        }
                                        else
                                        {
                                            Main.tile[j, num5].frameX = -1;
                                            Main.tile[j, num5].frameY = -1;
                                        }
                                    }
                                    if (release <= 0x19)
                                    {
                                        reader.ReadBoolean();
                                    }
                                    if (reader.ReadBoolean())
                                    {
                                        Main.tile[j, num5].wall = reader.ReadByte();
                                    }
                                    if (reader.ReadBoolean())
                                    {
                                        Main.tile[j, num5].liquid = reader.ReadByte();
                                        Main.tile[j, num5].lava = reader.ReadBoolean();
                                    }
                                    if (release >= 0x21)
                                    {
                                        Main.tile[j, num5].wire = reader.ReadBoolean();
                                    }
                                    if (release >= 0x19)
                                    {
                                        int num6 = reader.ReadInt16();
                                        if (num6 > 0)
                                        {
                                            for (int num7 = num5 + 1; num7 < ((num5 + num6) + 1); num7++)
                                            {
                                                Main.tile[j, num7].active = Main.tile[j, num5].active;
                                                Main.tile[j, num7].type = Main.tile[j, num5].type;
                                                Main.tile[j, num7].wall = Main.tile[j, num5].wall;
                                                Main.tile[j, num7].frameX = Main.tile[j, num5].frameX;
                                                Main.tile[j, num7].frameY = Main.tile[j, num5].frameY;
                                                Main.tile[j, num7].liquid = Main.tile[j, num5].liquid;
                                                Main.tile[j, num7].lava = Main.tile[j, num5].lava;
                                                Main.tile[j, num7].wire = Main.tile[j, num5].wire;
                                            }
                                            num5 += num6;
                                        }
                                    }
                                }
                            }
                            for (int k = 0; k < 0x3e8; k++)
                            {
                                if (reader.ReadBoolean())
                                {
                                    Main.chest[k] = new Chest();
                                    Main.chest[k].x = reader.ReadInt32();
                                    Main.chest[k].y = reader.ReadInt32();
                                    for (int num9 = 0; num9 < Chest.maxItems; num9++)
                                    {
                                        Main.chest[k].item[num9] = new Item();
                                        byte num10 = reader.ReadByte();
                                        if (num10 > 0)
                                        {
                                            string itemName = Item.VersionName(reader.ReadString(), release);
                                            Main.chest[k].item[num9].SetDefaults(itemName);
                                            Main.chest[k].item[num9].stack = num10;
                                            if (release >= 0x24)
                                            {
                                                Main.chest[k].item[num9].Prefix(reader.ReadByte());
                                            }
                                        }
                                    }
                                }
                            }
                            for (int m = 0; m < 0x3e8; m++)
                            {
                                if (reader.ReadBoolean())
                                {
                                    string str3 = reader.ReadString();
                                    int num12 = reader.ReadInt32();
                                    int num13 = reader.ReadInt32();
                                    if (Main.tile[num12, num13].active && ((Main.tile[num12, num13].type == 0x37) || (Main.tile[num12, num13].type == 0x55)))
                                    {
                                        Main.sign[m] = new Sign();
                                        Main.sign[m].x = num12;
                                        Main.sign[m].y = num13;
                                        Main.sign[m].text = str3;
                                    }
                                }
                            }
                            bool flag = reader.ReadBoolean();
                            for (int n = 0; flag; n++)
                            {
                                Main.npc[n].SetDefaults(reader.ReadString());
                                Main.npc[n].position.X = reader.ReadSingle();
                                Main.npc[n].position.Y = reader.ReadSingle();
                                Main.npc[n].homeless = reader.ReadBoolean();
                                Main.npc[n].homeTileX = reader.ReadInt32();
                                Main.npc[n].homeTileY = reader.ReadInt32();
                                flag = reader.ReadBoolean();
                            }
                            if (release >= 0x1f)
                            {
                                Main.chrName[0x11] = reader.ReadString();
                                Main.chrName[0x12] = reader.ReadString();
                                Main.chrName[0x13] = reader.ReadString();
                                Main.chrName[20] = reader.ReadString();
                                Main.chrName[0x16] = reader.ReadString();
                                Main.chrName[0x36] = reader.ReadString();
                                Main.chrName[0x26] = reader.ReadString();
                                Main.chrName[0x6b] = reader.ReadString();
                                Main.chrName[0x6c] = reader.ReadString();
                                if (release >= 0x23)
                                {
                                    Main.chrName[0x7c] = reader.ReadString();
                                }
                            }
                            if (release >= 7)
                            {
                                bool flag2 = reader.ReadBoolean();
                                string str4 = reader.ReadString();
                                int num15 = reader.ReadInt32();
                                if ((!flag2 || (str4 != Main.worldName)) || (num15 != Main.worldID))
                                {
                                    Console.WriteLine("Error loading world due to invalid header");
                                    loadSuccess = false;
                                    loadFailed = true;
                                    reader.Close();
                                    stream.Close();
                                    return;
                                }
                                loadSuccess = true;
                            }
                            else
                            {
                                loadSuccess = true;
                            }
                            reader.Close();
                            stream.Close();
                            if (!loadFailed && loadSuccess)
                            {
                                gen = true;
                                for (int num16 = 0; num16 < Main.maxTilesX; num16++)
                                {
                                    float num17 = ((float) num16) / ((float) Main.maxTilesX);
                                    Main.statusText = "Checking tile alignment: " + ((int) ((num17 * 100f) + 1f)) + "%";
                                    CountTiles(num16);
                                }
                                waterLine = Main.maxTilesY;
                                NPC.setNames();
                                Liquid.QuickWater(2, -1, -1);
                                WaterCheck();
                                int num18 = 0;
                                Liquid.quickSettle = true;
                                int num19 = Liquid.numLiquid + LiquidBuffer.numLiquidBuffer;
                                float num20 = 0f;
                                while ((Liquid.numLiquid > 0) && (num18 < 0x186a0))
                                {
                                    num18++;
                                    float num21 = ((float) (num19 - (Liquid.numLiquid + LiquidBuffer.numLiquidBuffer))) / ((float) num19);
                                    if ((Liquid.numLiquid + LiquidBuffer.numLiquidBuffer) > num19)
                                    {
                                        num19 = Liquid.numLiquid + LiquidBuffer.numLiquidBuffer;
                                    }
                                    if (num21 > num20)
                                    {
                                        num20 = num21;
                                    }
                                    else
                                    {
                                        num21 = num20;
                                    }
                                    Main.statusText = "Settling liquids: " + ((int) (((num21 * 100f) / 2f) + 50f)) + "%";
                                    Liquid.UpdateLiquid();
                                }
                                Liquid.quickSettle = false;
                                WaterCheck();
                                gen = false;
                            }
                        }
                    }
                    catch (Exception exception)
                    {
                        Console.WriteLine("Error loading world: "+exception);
                        loadFailed = true;
                        loadSuccess = false;
                        try
                        {
                            reader.Close();
                            stream.Close();
                        }
                        catch
                        {
                        }
                    }
                }
            }
        }

        public static void MakeDungeon(int x, int y, int tileType = 0x29, int wallType = 7)
        {
            int num = genRand.Next(3);
            int num2 = genRand.Next(3);
            switch (num)
            {
                case 1:
                    tileType = 0x2b;
                    break;

                case 2:
                    tileType = 0x2c;
                    break;
            }
            switch (num2)
            {
                case 1:
                    wallType = 8;
                    break;

                case 2:
                    wallType = 9;
                    break;
            }
            numDDoors = 0;
            numDPlats = 0;
            numDRooms = 0;
            WorldGen.dungeonX = x;
            WorldGen.dungeonY = y;
            dMinX = x;
            dMaxX = x;
            dMinY = y;
            dMaxY = y;
            dxStrength1 = genRand.Next(0x19, 30);
            dyStrength1 = genRand.Next(20, 0x19);
            dxStrength2 = genRand.Next(0x23, 50);
            dyStrength2 = genRand.Next(10, 15);
            float num3 = Main.maxTilesX / 60;
            num3 += genRand.Next(0, (int) (num3 / 3f));
            float num4 = num3;
            int num5 = 5;
            DungeonRoom(WorldGen.dungeonX, WorldGen.dungeonY, tileType, wallType);
            while (num3 > 0f)
            {
                if (WorldGen.dungeonX < dMinX)
                {
                    dMinX = WorldGen.dungeonX;
                }
                if (WorldGen.dungeonX > dMaxX)
                {
                    dMaxX = WorldGen.dungeonX;
                }
                if (WorldGen.dungeonY > dMaxY)
                {
                    dMaxY = WorldGen.dungeonY;
                }
                num3--;
                Main.statusText = "Creating dungeon: " + ((int) (((num4 - num3) / num4) * 60f)) + "%";
                if (num5 > 0)
                {
                    num5--;
                }
                if ((num5 == 0) & (genRand.Next(3) == 0))
                {
                    num5 = 5;
                    if (genRand.Next(2) == 0)
                    {
                        int dungeonX = WorldGen.dungeonX;
                        int dungeonY = WorldGen.dungeonY;
                        DungeonHalls(WorldGen.dungeonX, WorldGen.dungeonY, tileType, wallType, false);
                        if (genRand.Next(2) == 0)
                        {
                            DungeonHalls(WorldGen.dungeonX, WorldGen.dungeonY, tileType, wallType, false);
                        }
                        DungeonRoom(WorldGen.dungeonX, WorldGen.dungeonY, tileType, wallType);
                        WorldGen.dungeonX = dungeonX;
                        WorldGen.dungeonY = dungeonY;
                    }
                    else
                    {
                        DungeonRoom(WorldGen.dungeonX, WorldGen.dungeonY, tileType, wallType);
                    }
                }
                else
                {
                    DungeonHalls(WorldGen.dungeonX, WorldGen.dungeonY, tileType, wallType, false);
                }
            }
            DungeonRoom(WorldGen.dungeonX, WorldGen.dungeonY, tileType, wallType);
            int num8 = dRoomX[0];
            int num9 = dRoomY[0];
            for (int i = 0; i < numDRooms; i++)
            {
                if (dRoomY[i] < num9)
                {
                    num8 = dRoomX[i];
                    num9 = dRoomY[i];
                }
            }
            WorldGen.dungeonX = num8;
            WorldGen.dungeonY = num9;
            dEnteranceX = num8;
            dSurface = false;
            num5 = 5;
            while (!dSurface)
            {
                if (num5 > 0)
                {
                    num5--;
                }
                if (((num5 == 0) & (genRand.Next(5) == 0)) && (WorldGen.dungeonY > (Main.worldSurface + 50.0)))
                {
                    num5 = 10;
                    int num11 = WorldGen.dungeonX;
                    int num12 = WorldGen.dungeonY;
                    DungeonHalls(WorldGen.dungeonX, WorldGen.dungeonY, tileType, wallType, true);
                    DungeonRoom(WorldGen.dungeonX, WorldGen.dungeonY, tileType, wallType);
                    WorldGen.dungeonX = num11;
                    WorldGen.dungeonY = num12;
                }
                DungeonStairs(WorldGen.dungeonX, WorldGen.dungeonY, tileType, wallType);
            }
            DungeonEnt(WorldGen.dungeonX, WorldGen.dungeonY, tileType, wallType);
            Main.statusText = "Creating dungeon: 65%";
            for (int j = 0; j < numDRooms; j++)
            {
                for (int num14 = dRoomL[j]; num14 <= dRoomR[j]; num14++)
                {
                    if (!Main.tile[num14, dRoomT[j] - 1].active)
                    {
                        DPlatX[numDPlats] = num14;
                        DPlatY[numDPlats] = dRoomT[j] - 1;
                        numDPlats++;
                        break;
                    }
                }
                for (int num15 = dRoomL[j]; num15 <= dRoomR[j]; num15++)
                {
                    if (!Main.tile[num15, dRoomB[j] + 1].active)
                    {
                        DPlatX[numDPlats] = num15;
                        DPlatY[numDPlats] = dRoomB[j] + 1;
                        numDPlats++;
                        break;
                    }
                }
                for (int num16 = dRoomT[j]; num16 <= dRoomB[j]; num16++)
                {
                    if (!Main.tile[dRoomL[j] - 1, num16].active)
                    {
                        DDoorX[numDDoors] = dRoomL[j] - 1;
                        DDoorY[numDDoors] = num16;
                        DDoorPos[numDDoors] = -1;
                        numDDoors++;
                        break;
                    }
                }
                for (int num17 = dRoomT[j]; num17 <= dRoomB[j]; num17++)
                {
                    if (!Main.tile[dRoomR[j] + 1, num17].active)
                    {
                        DDoorX[numDDoors] = dRoomR[j] + 1;
                        DDoorY[numDDoors] = num17;
                        DDoorPos[numDDoors] = 1;
                        numDDoors++;
                        break;
                    }
                }
            }
            Main.statusText = "Creating dungeon: 70%";
            int num18 = 0;
            int num19 = 0x3e8;
            int num20 = 0;
            while (num20 < (Main.maxTilesX / 100))
            {
                num18++;
                int num21 = genRand.Next(dMinX, dMaxX);
                int num22 = genRand.Next(((int) Main.worldSurface) + 0x19, dMaxY);
                int num23 = num21;
                if ((Main.tile[num21, num22].wall == wallType) && !Main.tile[num21, num22].active)
                {
                    int num24 = 1;
                    if (genRand.Next(2) == 0)
                    {
                        num24 = -1;
                    }
                    while (!Main.tile[num21, num22].active)
                    {
                        num22 += num24;
                    }
                    if ((Main.tile[num21 - 1, num22].active && Main.tile[num21 + 1, num22].active) && (!Main.tile[num21 - 1, num22 - num24].active && !Main.tile[num21 + 1, num22 - num24].active))
                    {
                        num20++;
                        int num25 = genRand.Next(5, 13);
                        while ((Main.tile[num21 - 1, num22].active && Main.tile[num21, num22 + num24].active) && ((Main.tile[num21, num22].active && !Main.tile[num21, num22 - num24].active) && (num25 > 0)))
                        {
                            Main.tile[num21, num22].type = 0x30;
                            if (!Main.tile[num21 - 1, num22 - num24].active && !Main.tile[num21 + 1, num22 - num24].active)
                            {
                                Main.tile[num21, num22 - num24].type = 0x30;
                                Main.tile[num21, num22 - num24].active = true;
                            }
                            num21--;
                            num25--;
                        }
                        num25 = genRand.Next(5, 13);
                        num21 = num23 + 1;
                        while ((Main.tile[num21 + 1, num22].active && Main.tile[num21, num22 + num24].active) && ((Main.tile[num21, num22].active && !Main.tile[num21, num22 - num24].active) && (num25 > 0)))
                        {
                            Main.tile[num21, num22].type = 0x30;
                            if (!Main.tile[num21 - 1, num22 - num24].active && !Main.tile[num21 + 1, num22 - num24].active)
                            {
                                Main.tile[num21, num22 - num24].type = 0x30;
                                Main.tile[num21, num22 - num24].active = true;
                            }
                            num21++;
                            num25--;
                        }
                    }
                }
                if (num18 > num19)
                {
                    num18 = 0;
                    num20++;
                }
            }
            num18 = 0;
            num19 = 0x3e8;
            num20 = 0;
            Main.statusText = "Creating dungeon: 75%";
            while (num20 < (Main.maxTilesX / 100))
            {
                num18++;
                int num26 = genRand.Next(dMinX, dMaxX);
                int num27 = genRand.Next(((int) Main.worldSurface) + 0x19, dMaxY);
                int num28 = num27;
                if ((Main.tile[num26, num27].wall == wallType) && !Main.tile[num26, num27].active)
                {
                    int num29 = 1;
                    if (genRand.Next(2) == 0)
                    {
                        num29 = -1;
                    }
                    while (((num26 > 5) && (num26 < (Main.maxTilesX - 5))) && !Main.tile[num26, num27].active)
                    {
                        num26 += num29;
                    }
                    if ((Main.tile[num26, num27 - 1].active && Main.tile[num26, num27 + 1].active) && (!Main.tile[num26 - num29, num27 - 1].active && !Main.tile[num26 - num29, num27 + 1].active))
                    {
                        num20++;
                        int num30 = genRand.Next(5, 13);
                        while ((Main.tile[num26, num27 - 1].active && Main.tile[num26 + num29, num27].active) && ((Main.tile[num26, num27].active && !Main.tile[num26 - num29, num27].active) && (num30 > 0)))
                        {
                            Main.tile[num26, num27].type = 0x30;
                            if (!Main.tile[num26 - num29, num27 - 1].active && !Main.tile[num26 - num29, num27 + 1].active)
                            {
                                Main.tile[num26 - num29, num27].type = 0x30;
                                Main.tile[num26 - num29, num27].active = true;
                            }
                            num27--;
                            num30--;
                        }
                        num30 = genRand.Next(5, 13);
                        num27 = num28 + 1;
                        while ((Main.tile[num26, num27 + 1].active && Main.tile[num26 + num29, num27].active) && ((Main.tile[num26, num27].active && !Main.tile[num26 - num29, num27].active) && (num30 > 0)))
                        {
                            Main.tile[num26, num27].type = 0x30;
                            if (!Main.tile[num26 - num29, num27 - 1].active && !Main.tile[num26 - num29, num27 + 1].active)
                            {
                                Main.tile[num26 - num29, num27].type = 0x30;
                                Main.tile[num26 - num29, num27].active = true;
                            }
                            num27++;
                            num30--;
                        }
                    }
                }
                if (num18 > num19)
                {
                    num18 = 0;
                    num20++;
                }
            }
            Main.statusText = "Creating dungeon: 80%";
            for (int k = 0; k < numDDoors; k++)
            {
                int num32 = DDoorX[k] - 10;
                int num33 = DDoorX[k] + 10;
                int num34 = 100;
                int num35 = 0;
                int num36 = 0;
                int num37 = 0;
                for (int num38 = num32; num38 < num33; num38++)
                {
                    bool flag = true;
                    int num39 = DDoorY[k];
                    while (!Main.tile[num38, num39].active)
                    {
                        num39--;
                    }
                    if (!Main.tileDungeon[Main.tile[num38, num39].type])
                    {
                        flag = false;
                    }
                    num36 = num39;
                    num39 = DDoorY[k];
                    while (!Main.tile[num38, num39].active)
                    {
                        num39++;
                    }
                    if (!Main.tileDungeon[Main.tile[num38, num39].type])
                    {
                        flag = false;
                    }
                    num37 = num39;
                    if ((num37 - num36) >= 3)
                    {
                        int num40 = num38 - 20;
                        int num41 = num38 + 20;
                        int num42 = num37 - 10;
                        int num43 = num37 + 10;
                        for (int num44 = num40; num44 < num41; num44++)
                        {
                            for (int num45 = num42; num45 < num43; num45++)
                            {
                                if (Main.tile[num44, num45].active && (Main.tile[num44, num45].type == 10))
                                {
                                    flag = false;
                                    break;
                                }
                            }
                        }
                        if (flag)
                        {
                            for (int num46 = num37 - 3; num46 < num37; num46++)
                            {
                                for (int num47 = num38 - 3; num47 <= (num38 + 3); num47++)
                                {
                                    if (Main.tile[num47, num46].active)
                                    {
                                        flag = false;
                                        break;
                                    }
                                }
                            }
                        }
                        if (flag && ((num37 - num36) < 20))
                        {
                            bool flag2 = false;
                            if ((DDoorPos[k] == 0) && ((num37 - num36) < num34))
                            {
                                flag2 = true;
                            }
                            if ((DDoorPos[k] == -1) && (num38 > num35))
                            {
                                flag2 = true;
                            }
                            if ((DDoorPos[k] == 1) && ((num38 < num35) || (num35 == 0)))
                            {
                                flag2 = true;
                            }
                            if (flag2)
                            {
                                num35 = num38;
                                num34 = num37 - num36;
                            }
                        }
                    }
                }
                if (num34 < 20)
                {
                    int num48 = num35;
                    int num49 = DDoorY[k];
                    int num50 = num49;
                    while (!Main.tile[num48, num49].active)
                    {
                        Main.tile[num48, num49].active = false;
                        num49++;
                    }
                    while (!Main.tile[num48, num50].active)
                    {
                        num50--;
                    }
                    num49--;
                    num50++;
                    for (int num51 = num50; num51 < (num49 - 2); num51++)
                    {
                        Main.tile[num48, num51].active = true;
                        Main.tile[num48, num51].type = (byte) tileType;
                    }
                    PlaceTile(num48, num49, 10, true, false, -1, 0);
                    num48--;
                    int num52 = num49 - 3;
                    while (!Main.tile[num48, num52].active)
                    {
                        num52--;
                    }
                    if (((num49 - num52) < ((num49 - num50) + 5)) && Main.tileDungeon[Main.tile[num48, num52].type])
                    {
                        for (int num53 = (num49 - 4) - genRand.Next(3); num53 > num52; num53--)
                        {
                            Main.tile[num48, num53].active = true;
                            Main.tile[num48, num53].type = (byte) tileType;
                        }
                    }
                    num48 += 2;
                    num52 = num49 - 3;
                    while (!Main.tile[num48, num52].active)
                    {
                        num52--;
                    }
                    if (((num49 - num52) < ((num49 - num50) + 5)) && Main.tileDungeon[Main.tile[num48, num52].type])
                    {
                        for (int num54 = (num49 - 4) - genRand.Next(3); num54 > num52; num54--)
                        {
                            Main.tile[num48, num54].active = true;
                            Main.tile[num48, num54].type = (byte) tileType;
                        }
                    }
                    num49++;
                    num48--;
                    Main.tile[num48 - 1, num49].active = true;
                    Main.tile[num48 - 1, num49].type = (byte) tileType;
                    Main.tile[num48 + 1, num49].active = true;
                    Main.tile[num48 + 1, num49].type = (byte) tileType;
                }
            }
            Main.statusText = "Creating dungeon: 85%";
            for (int m = 0; m < numDPlats; m++)
            {
                int num56 = DPlatX[m];
                int num57 = DPlatY[m];
                int maxTilesX = Main.maxTilesX;
                int num59 = 10;
                for (int num60 = num57 - 5; num60 <= (num57 + 5); num60++)
                {
                    int num61 = num56;
                    int num62 = num56;
                    bool flag3 = false;
                    if (!Main.tile[num61, num60].active)
                    {
                        goto Label_10D9;
                    }
                    flag3 = true;
                    goto Label_1129;
                Label_10B5:
                    num61--;
                    if (!Main.tileDungeon[Main.tile[num61, num60].type])
                    {
                        flag3 = true;
                    }
                Label_10D9:
                    if (!Main.tile[num61, num60].active)
                    {
                        goto Label_10B5;
                    }
                    while (!Main.tile[num62, num60].active)
                    {
                        num62++;
                        if (!Main.tileDungeon[Main.tile[num62, num60].type])
                        {
                            flag3 = true;
                        }
                    }
                Label_1129:
                    if (!flag3 && ((num62 - num61) <= num59))
                    {
                        bool flag4 = true;
                        int num63 = (num56 - (num59 / 2)) - 2;
                        int num64 = (num56 + (num59 / 2)) + 2;
                        int num65 = num60 - 5;
                        int num66 = num60 + 5;
                        for (int num67 = num63; num67 <= num64; num67++)
                        {
                            for (int num68 = num65; num68 <= num66; num68++)
                            {
                                if (Main.tile[num67, num68].active && (Main.tile[num67, num68].type == 0x13))
                                {
                                    flag4 = false;
                                    break;
                                }
                            }
                        }
                        for (int num69 = num60 + 3; num69 >= (num60 - 5); num69--)
                        {
                            if (Main.tile[num56, num69].active)
                            {
                                flag4 = false;
                                break;
                            }
                        }
                        if (flag4)
                        {
                            maxTilesX = num60;
                            break;
                        }
                    }
                }
                if ((maxTilesX > (num57 - 10)) && (maxTilesX < (num57 + 10)))
                {
                    int num70 = num56;
                    int num71 = maxTilesX;
                    int num72 = num56 + 1;
                    while (!Main.tile[num70, num71].active)
                    {
                        Main.tile[num70, num71].active = true;
                        Main.tile[num70, num71].type = 0x13;
                        num70--;
                    }
                    while (!Main.tile[num72, num71].active)
                    {
                        Main.tile[num72, num71].active = true;
                        Main.tile[num72, num71].type = 0x13;
                        num72++;
                    }
                }
            }
            Main.statusText = "Creating dungeon: 90%";
            num18 = 0;
            num19 = 0x3e8;
            num20 = 0;
            while (num20 < (Main.maxTilesX / 20))
            {
                num18++;
                int num73 = genRand.Next(dMinX, dMaxX);
                int num74 = genRand.Next(dMinY, dMaxY);
                bool flag5 = true;
                if ((Main.tile[num73, num74].wall == wallType) && !Main.tile[num73, num74].active)
                {
                    int num75 = 1;
                    if (genRand.Next(2) == 0)
                    {
                        num75 = -1;
                    }
                    while (flag5 && !Main.tile[num73, num74].active)
                    {
                        num73 -= num75;
                        if ((num73 < 5) || (num73 > (Main.maxTilesX - 5)))
                        {
                            flag5 = false;
                        }
                        else if (Main.tile[num73, num74].active && !Main.tileDungeon[Main.tile[num73, num74].type])
                        {
                            flag5 = false;
                        }
                    }
                    if (((flag5 && Main.tile[num73, num74].active) && (Main.tileDungeon[Main.tile[num73, num74].type] && Main.tile[num73, num74 - 1].active)) && ((Main.tileDungeon[Main.tile[num73, num74 - 1].type] && Main.tile[num73, num74 + 1].active) && Main.tileDungeon[Main.tile[num73, num74 + 1].type]))
                    {
                        num73 += num75;
                        for (int num76 = num73 - 3; num76 <= (num73 + 3); num76++)
                        {
                            for (int num77 = num74 - 3; num77 <= (num74 + 3); num77++)
                            {
                                if (Main.tile[num76, num77].active && (Main.tile[num76, num77].type == 0x13))
                                {
                                    flag5 = false;
                                    break;
                                }
                            }
                        }
                        if (flag5 && ((!Main.tile[num73, num74 - 1].active & !Main.tile[num73, num74 - 2].active) & !Main.tile[num73, num74 - 3].active))
                        {
                            int num78 = num73;
                            int num79 = num73;
                            while (((num78 > dMinX) && (num78 < dMaxX)) && ((!Main.tile[num78, num74].active && !Main.tile[num78, num74 - 1].active) && !Main.tile[num78, num74 + 1].active))
                            {
                                num78 += num75;
                            }
                            num78 = Math.Abs((int) (num73 - num78));
                            bool flag6 = false;
                            if (genRand.Next(2) == 0)
                            {
                                flag6 = true;
                            }
                            if (num78 > 5)
                            {
                                for (int num80 = genRand.Next(1, 4); num80 > 0; num80--)
                                {
                                    Main.tile[num73, num74].active = true;
                                    Main.tile[num73, num74].type = 0x13;
                                    if (flag6)
                                    {
                                        PlaceTile(num73, num74 - 1, 50, true, false, -1, 0);
                                        if ((genRand.Next(50) == 0) && (Main.tile[num73, num74 - 1].type == 50))
                                        {
                                            Main.tile[num73, num74 - 1].frameX = 90;
                                        }
                                    }
                                    num73 += num75;
                                }
                                num18 = 0;
                                num20++;
                                if (!flag6 && (genRand.Next(2) == 0))
                                {
                                    num73 = num79;
                                    num74--;
                                    int type = 0;
                                    if (genRand.Next(4) == 0)
                                    {
                                        type = 1;
                                    }
                                    if (type == 0)
                                    {
                                        type = 13;
                                    }
                                    else if (type == 1)
                                    {
                                        type = 0x31;
                                    }
                                    PlaceTile(num73, num74, type, true, false, -1, 0);
                                    if (Main.tile[num73, num74].type == 13)
                                    {
                                        if (genRand.Next(2) == 0)
                                        {
                                            Main.tile[num73, num74].frameX = 0x12;
                                        }
                                        else
                                        {
                                            Main.tile[num73, num74].frameX = 0x24;
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                if (num18 > num19)
                {
                    num18 = 0;
                    num20++;
                }
            }
            Main.statusText = "Creating dungeon: 95%";
            int num82 = 0;
            for (int n = 0; n < numDRooms; n++)
            {
                int num84 = 0;
                while (num84 < 0x3e8)
                {
                    int num85 = (int) (dRoomSize[n] * 0.4);
                    int num86 = dRoomX[n] + genRand.Next(-num85, num85 + 1);
                    int num87 = dRoomY[n] + genRand.Next(-num85, num85 + 1);
                    int contain = 0;
                    num82++;
                    int style = 2;
                    switch (num82)
                    {
                        case 1:
                            contain = 0x149;
                            break;

                        case 2:
                            contain = 0x9b;
                            break;

                        case 3:
                            contain = 0x9c;
                            break;

                        case 4:
                            contain = 0x9d;
                            break;

                        case 5:
                            contain = 0xa3;
                            break;

                        case 6:
                            contain = 0x71;
                            break;

                        case 7:
                            contain = 0x147;
                            style = 0;
                            break;

                        default:
                            contain = 0xa4;
                            num82 = 0;
                            break;
                    }
                    if (num87 < (Main.worldSurface + 50.0))
                    {
                        contain = 0x147;
                        style = 0;
                    }
                    if ((contain == 0) && (genRand.Next(2) == 0))
                    {
                        num84 = 0x3e8;
                    }
                    else
                    {
                        if (AddBuriedChest(num86, num87, contain, false, style))
                        {
                            num84 += 0x3e8;
                        }
                        num84++;
                    }
                }
            }
            dMinX -= 0x19;
            dMaxX += 0x19;
            dMinY -= 0x19;
            dMaxY += 0x19;
            if (dMinX < 0)
            {
                dMinX = 0;
            }
            if (dMaxX > Main.maxTilesX)
            {
                dMaxX = Main.maxTilesX;
            }
            if (dMinY < 0)
            {
                dMinY = 0;
            }
            if (dMaxY > Main.maxTilesY)
            {
                dMaxY = Main.maxTilesY;
            }
            num18 = 0;
            num19 = 0x3e8;
            num20 = 0;
            while (num20 < (Main.maxTilesX / 150))
            {
                num18++;
                int num90 = genRand.Next(dMinX, dMaxX);
                int num91 = genRand.Next(dMinY, dMaxY);
                if (Main.tile[num90, num91].wall == wallType)
                {
                    for (int num92 = num91; num92 > dMinY; num92--)
                    {
                        if (Main.tile[num90, num92 - 1].active && (Main.tile[num90, num92 - 1].type == tileType))
                        {
                            bool flag7 = false;
                            for (int num93 = num90 - 15; num93 < (num90 + 15); num93++)
                            {
                                for (int num94 = num92 - 15; num94 < (num92 + 15); num94++)
                                {
                                    if ((((num93 > 0) && (num93 < Main.maxTilesX)) && ((num94 > 0) && (num94 < Main.maxTilesY))) && (Main.tile[num93, num94].type == 0x2a))
                                    {
                                        flag7 = true;
                                        break;
                                    }
                                }
                            }
                            if ((Main.tile[num90 - 1, num92].active || Main.tile[num90 + 1, num92].active) || ((Main.tile[num90 - 1, num92 + 1].active || Main.tile[num90 + 1, num92 + 1].active) || Main.tile[num90, num92 + 2].active))
                            {
                                flag7 = true;
                            }
                            if (!flag7)
                            {
                                Place1x2Top(num90, num92, 0x2a);
                                if (Main.tile[num90, num92].type == 0x2a)
                                {
                                    num18 = 0;
                                    num20++;
                                    for (int num95 = 0; num95 < 0x3e8; num95++)
                                    {
                                        int num96 = num90 + genRand.Next(-12, 13);
                                        int num97 = num92 + genRand.Next(3, 0x15);
                                        if (((!Main.tile[num96, num97].active && !Main.tile[num96, num97 + 1].active) && ((Main.tile[num96 - 1, num97].type != 0x30) && (Main.tile[num96 + 1, num97].type != 0x30))) && Collision.CanHit(new Vector2((float) (num96 * 0x10), (float) (num97 * 0x10)), 0x10, 0x10, new Vector2((float) (num90 * 0x10), (float) ((num92 * 0x10) + 1)), 0x10, 0x10))
                                        {
                                            PlaceTile(num96, num97, 0x88, true, false, -1, 0);
                                            if (Main.tile[num96, num97].active)
                                            {
                                                while ((num96 != num90) || (num97 != num92))
                                                {
                                                    Main.tile[num96, num97].wire = true;
                                                    if (num96 > num90)
                                                    {
                                                        num96--;
                                                    }
                                                    if (num96 < num90)
                                                    {
                                                        num96++;
                                                    }
                                                    Main.tile[num96, num97].wire = true;
                                                    if (num97 > num92)
                                                    {
                                                        num97--;
                                                    }
                                                    if (num97 < num92)
                                                    {
                                                        num97++;
                                                    }
                                                    Main.tile[num96, num97].wire = true;
                                                }
                                                if (Main.rand.Next(3) > 0)
                                                {
                                                    Main.tile[num90, num92].frameX = 0x12;
                                                    Main.tile[num90, num92 + 1].frameX = 0x12;
                                                }
                                                break;
                                            }
                                        }
                                    }
                                }
                            }
                            break;
                        }
                    }
                }
                if (num18 > num19)
                {
                    num20++;
                    num18 = 0;
                }
            }
            num18 = 0;
            num19 = 0x3e8;
            num20 = 0;
            while (num20 < (Main.maxTilesX / 500))
            {
                num18++;
                int num98 = genRand.Next(dMinX, dMaxX);
                int num99 = genRand.Next(dMinY, dMaxY);
                if ((Main.tile[num98, num99].wall == wallType) && placeTrap(num98, num99, 0))
                {
                    num18 = num19;
                }
                if (num18 > num19)
                {
                    num20++;
                    num18 = 0;
                }
            }
        }

        public static bool meteor(int i, int j)
        {
            if ((i < 50) || (i > (Main.maxTilesX - 50)))
            {
                return false;
            }
            if ((j < 50) || (j > (Main.maxTilesY - 50)))
            {
                return false;
            }
            int num = 0x19;
            Rectangle rectangle = new Rectangle((i - num) * 0x10, (j - num) * 0x10, (num * 2) * 0x10, (num * 2) * 0x10);
            for (int k = 0; k < 0xff; k++)
            {
                if (Main.player[k].active)
                {
                    Rectangle rectangle2 = new Rectangle(((((int) Main.player[k].position.X) + (Main.player[k].width / 2)) - (NPC.sWidth / 2)) - NPC.safeRangeX, ((((int) Main.player[k].position.Y) + (Main.player[k].height / 2)) - (NPC.sHeight / 2)) - NPC.safeRangeY, NPC.sWidth + (NPC.safeRangeX * 2), NPC.sHeight + (NPC.safeRangeY * 2));
                    if (rectangle.Intersects(rectangle2))
                    {
                        return false;
                    }
                }
            }
            for (int m = 0; m < 200; m++)
            {
                if (Main.npc[m].active)
                {
                    Rectangle rectangle3 = new Rectangle((int) Main.npc[m].position.X, (int) Main.npc[m].position.Y, Main.npc[m].width, Main.npc[m].height);
                    if (rectangle.Intersects(rectangle3))
                    {
                        return false;
                    }
                }
            }
            for (int n = i - num; n < (i + num); n++)
            {
                for (int num5 = j - num; num5 < (j + num); num5++)
                {
                    if (Main.tile[n, num5].active && (Main.tile[n, num5].type == 0x15))
                    {
                        return false;
                    }
                }
            }
            stopDrops = true;
            num = 15;
            for (int num6 = i - num; num6 < (i + num); num6++)
            {
                for (int num7 = j - num; num7 < (j + num); num7++)
                {
                    if ((num7 > ((j + Main.rand.Next(-2, 3)) - 5)) && ((Math.Abs((int) (i - num6)) + Math.Abs((int) (j - num7))) < ((num * 1.5) + Main.rand.Next(-5, 5))))
                    {
                        if (!Main.tileSolid[Main.tile[num6, num7].type])
                        {
                            Main.tile[num6, num7].active = false;
                        }
                        Main.tile[num6, num7].type = 0x25;
                    }
                }
            }
            num = 10;
            for (int num8 = i - num; num8 < (i + num); num8++)
            {
                for (int num9 = j - num; num9 < (j + num); num9++)
                {
                    if ((num9 > ((j + Main.rand.Next(-2, 3)) - 5)) && ((Math.Abs((int) (i - num8)) + Math.Abs((int) (j - num9))) < (num + Main.rand.Next(-3, 4))))
                    {
                        Main.tile[num8, num9].active = false;
                    }
                }
            }
            num = 0x10;
            for (int num10 = i - num; num10 < (i + num); num10++)
            {
                for (int num11 = j - num; num11 < (j + num); num11++)
                {
                    if ((Main.tile[num10, num11].type == 5) || (Main.tile[num10, num11].type == 0x20))
                    {
                        KillTile(num10, num11, false, false, false);
                    }
                    SquareTileFrame(num10, num11, true);
                    SquareWallFrame(num10, num11, true);
                }
            }
            num = 0x17;
            for (int num12 = i - num; num12 < (i + num); num12++)
            {
                for (int num13 = j - num; num13 < (j + num); num13++)
                {
                    if ((Main.tile[num12, num13].active && (Main.rand.Next(10) == 0)) && ((Math.Abs((int) (i - num12)) + Math.Abs((int) (j - num13))) < (num * 1.3)))
                    {
                        if ((Main.tile[num12, num13].type == 5) || (Main.tile[num12, num13].type == 0x20))
                        {
                            KillTile(num12, num13, false, false, false);
                        }
                        Main.tile[num12, num13].type = 0x25;
                        SquareTileFrame(num12, num13, true);
                    }
                }
            }
            stopDrops = false;
            if (Main.netMode == 0)
            {
                Main.NewText("A meteorite has landed!", 50, 0xff, 130);
            }
            else if (Main.netMode == 2)
            {
                NetMessage.SendData(0x19, -1, -1, "A meteorite has landed!", 0xff, 50f, 255f, 130f, 0);
            }
            if (Main.netMode != 1)
            {
                NetMessage.SendTileSquare(-1, i, j, 30);
            }
            return true;
        }

        public static void MineHouse(int i, int j)
        {
            if (((i >= 50) && (i <= (Main.maxTilesX - 50))) && ((j >= 50) && (j <= (Main.maxTilesY - 50))))
            {
                int num = genRand.Next(6, 12);
                int num2 = genRand.Next(3, 6);
                int num3 = genRand.Next(15, 30);
                int num4 = genRand.Next(15, 30);
                if (!SolidTile(i, j) && (Main.tile[i, j].wall <= 0))
                {
                    int num5 = j - num;
                    int num6 = j + num2;
                    for (int k = 0; k < 2; k++)
                    {
                        bool flag = true;
                        int num8 = i;
                        int num9 = j;
                        int num10 = -1;
                        int num11 = num3;
                        if (k == 1)
                        {
                            num10 = 1;
                            num11 = num4;
                            num8++;
                        }
                        while (flag)
                        {
                            if ((num9 - num) < num5)
                            {
                                num5 = num9 - num;
                            }
                            if ((num9 + num2) > num6)
                            {
                                num6 = num9 + num2;
                            }
                            for (int num12 = 0; num12 < 2; num12++)
                            {
                                int num13 = num9;
                                bool flag2 = true;
                                int num14 = num;
                                int num15 = -1;
                                if (num12 == 1)
                                {
                                    num13++;
                                    num14 = num2;
                                    num15 = 1;
                                }
                                while (flag2)
                                {
                                    if (((num8 != i) && (Main.tile[num8 - num10, num13].wall != 0x1b)) && (SolidTile(num8 - num10, num13) || !Main.tile[num8 - num10, num13].active))
                                    {
                                        Main.tile[num8 - num10, num13].active = true;
                                        Main.tile[num8 - num10, num13].type = 30;
                                    }
                                    if (SolidTile(num8 - 1, num13))
                                    {
                                        Main.tile[num8 - 1, num13].type = 30;
                                    }
                                    if (SolidTile(num8 + 1, num13))
                                    {
                                        Main.tile[num8 + 1, num13].type = 30;
                                    }
                                    if (SolidTile(num8, num13))
                                    {
                                        int num16 = 0;
                                        if (SolidTile(num8 - 1, num13))
                                        {
                                            num16++;
                                        }
                                        if (SolidTile(num8 + 1, num13))
                                        {
                                            num16++;
                                        }
                                        if (SolidTile(num8, num13 - 1))
                                        {
                                            num16++;
                                        }
                                        if (SolidTile(num8, num13 + 1))
                                        {
                                            num16++;
                                        }
                                        if (num16 < 2)
                                        {
                                            Main.tile[num8, num13].active = false;
                                        }
                                        else
                                        {
                                            flag2 = false;
                                            Main.tile[num8, num13].type = 30;
                                        }
                                    }
                                    else
                                    {
                                        Main.tile[num8, num13].wall = 0x1b;
                                        Main.tile[num8, num13].liquid = 0;
                                        Main.tile[num8, num13].lava = false;
                                    }
                                    num13 += num15;
                                    num14--;
                                    if (num14 <= 0)
                                    {
                                        if (!Main.tile[num8, num13].active)
                                        {
                                            Main.tile[num8, num13].active = true;
                                            Main.tile[num8, num13].type = 30;
                                        }
                                        flag2 = false;
                                    }
                                }
                            }
                            num11--;
                            num8 += num10;
                            if (SolidTile(num8, num9))
                            {
                                int num17 = 0;
                                int num18 = 0;
                                int num19 = num9;
                                bool flag3 = true;
                                while (flag3)
                                {
                                    num19--;
                                    num17++;
                                    if (SolidTile(num8 - num10, num19))
                                    {
                                        num17 = 0x3e7;
                                        flag3 = false;
                                    }
                                    else if (!SolidTile(num8, num19))
                                    {
                                        flag3 = false;
                                    }
                                }
                                num19 = num9;
                                flag3 = true;
                                while (flag3)
                                {
                                    num19++;
                                    num18++;
                                    if (SolidTile(num8 - num10, num19))
                                    {
                                        num18 = 0x3e7;
                                        flag3 = false;
                                    }
                                    else if (!SolidTile(num8, num19))
                                    {
                                        flag3 = false;
                                    }
                                }
                                if (num18 <= num17)
                                {
                                    if (num18 > num2)
                                    {
                                        num11 = 0;
                                    }
                                    else
                                    {
                                        num9 += num18 + 1;
                                    }
                                }
                                else if (num17 > num)
                                {
                                    num11 = 0;
                                }
                                else
                                {
                                    num9 -= num17 + 1;
                                }
                            }
                            if (num11 <= 0)
                            {
                                flag = false;
                            }
                        }
                    }
                    int num20 = (i - num3) - 1;
                    int num21 = (i + num4) + 2;
                    int num22 = num5 - 1;
                    int num23 = num6 + 2;
                    for (int m = num20; m < num21; m++)
                    {
                        for (int num25 = num22; num25 < num23; num25++)
                        {
                            if ((Main.tile[m, num25].wall == 0x1b) && !Main.tile[m, num25].active)
                            {
                                if (((Main.tile[m - 1, num25].wall != 0x1b) && (m < i)) && !SolidTile(m - 1, num25))
                                {
                                    PlaceTile(m, num25, 30, true, false, -1, 0);
                                    Main.tile[m, num25].wall = 0;
                                }
                                if (((Main.tile[m + 1, num25].wall != 0x1b) && (m > i)) && !SolidTile(m + 1, num25))
                                {
                                    PlaceTile(m, num25, 30, true, false, -1, 0);
                                    Main.tile[m, num25].wall = 0;
                                }
                                for (int num26 = m - 1; num26 <= (m + 1); num26++)
                                {
                                    for (int num27 = num25 - 1; num27 <= (num25 + 1); num27++)
                                    {
                                        if (SolidTile(num26, num27))
                                        {
                                            Main.tile[num26, num27].type = 30;
                                        }
                                    }
                                }
                            }
                            if (((((Main.tile[m, num25].type == 30) && (Main.tile[m - 1, num25].wall == 0x1b)) && (Main.tile[m + 1, num25].wall == 0x1b)) && ((Main.tile[m, num25 - 1].wall == 0x1b) || Main.tile[m, num25 - 1].active)) && ((Main.tile[m, num25 + 1].wall == 0x1b) || Main.tile[m, num25 + 1].active))
                            {
                                Main.tile[m, num25].active = false;
                                Main.tile[m, num25].wall = 0x1b;
                            }
                        }
                    }
                    for (int n = num20; n < num21; n++)
                    {
                        for (int num29 = num22; num29 < num23; num29++)
                        {
                            if (Main.tile[n, num29].type == 30)
                            {
                                if (((Main.tile[n - 1, num29].wall == 0x1b) && (Main.tile[n + 1, num29].wall == 0x1b)) && (!Main.tile[n - 1, num29].active && !Main.tile[n + 1, num29].active))
                                {
                                    Main.tile[n, num29].active = false;
                                    Main.tile[n, num29].wall = 0x1b;
                                }
                                if ((((Main.tile[n, num29 - 1].type != 0x15) && (Main.tile[n - 1, num29].wall == 0x1b)) && ((Main.tile[n + 1, num29].type == 30) && (Main.tile[n + 2, num29].wall == 0x1b))) && (!Main.tile[n - 1, num29].active && !Main.tile[n + 2, num29].active))
                                {
                                    Main.tile[n, num29].active = false;
                                    Main.tile[n, num29].wall = 0x1b;
                                    Main.tile[n + 1, num29].active = false;
                                    Main.tile[n + 1, num29].wall = 0x1b;
                                }
                                if (((Main.tile[n, num29 - 1].wall == 0x1b) && (Main.tile[n, num29 + 1].wall == 0x1b)) && (!Main.tile[n, num29 - 1].active && !Main.tile[n, num29 + 1].active))
                                {
                                    Main.tile[n, num29].active = false;
                                    Main.tile[n, num29].wall = 0x1b;
                                }
                            }
                        }
                    }
                    for (int num30 = num20; num30 < num21; num30++)
                    {
                        for (int num31 = num23; num31 > num22; num31--)
                        {
                            bool flag4 = false;
                            if (Main.tile[num30, num31].active && (Main.tile[num30, num31].type == 30))
                            {
                                int num32 = -1;
                                for (int num33 = 0; num33 < 2; num33++)
                                {
                                    if (!SolidTile(num30 + num32, num31) && (Main.tile[num30 + num32, num31].wall == 0))
                                    {
                                        int num34 = 0;
                                        int num35 = num31;
                                        int num36 = num31;
                                        while ((Main.tile[num30, num35].active && (Main.tile[num30, num35].type == 30)) && (!SolidTile(num30 + num32, num35) && (Main.tile[num30 + num32, num35].wall == 0)))
                                        {
                                            num35--;
                                            num34++;
                                        }
                                        num35++;
                                        int num37 = num35 + 1;
                                        if (num34 > 4)
                                        {
                                            if (genRand.Next(2) == 0)
                                            {
                                                num35 = num36 - 1;
                                                bool flag5 = true;
                                                for (int num38 = num30 - 2; num38 <= (num30 + 2); num38++)
                                                {
                                                    for (int num39 = num35 - 2; num39 <= num35; num39++)
                                                    {
                                                        if ((num38 != num30) && Main.tile[num38, num39].active)
                                                        {
                                                            flag5 = false;
                                                        }
                                                    }
                                                }
                                                if (flag5)
                                                {
                                                    Main.tile[num30, num35].active = false;
                                                    Main.tile[num30, num35 - 1].active = false;
                                                    Main.tile[num30, num35 - 2].active = false;
                                                    PlaceTile(num30, num35, 10, true, false, -1, 0);
                                                    flag4 = true;
                                                }
                                            }
                                            if (!flag4)
                                            {
                                                for (int num40 = num37; num40 < num36; num40++)
                                                {
                                                    Main.tile[num30, num40].type = 0x7c;
                                                }
                                            }
                                        }
                                    }
                                    num32 = 1;
                                }
                            }
                            if (flag4)
                            {
                                goto Label_0A73;
                            }
                        }
                    Label_0A73:;
                    }
                    for (int num41 = num20; num41 < num21; num41++)
                    {
                        bool flag6 = true;
                        for (int num42 = num22; num42 < num23; num42++)
                        {
                            for (int num43 = num41 - 2; num43 <= (num41 + 2); num43++)
                            {
                                if (Main.tile[num43, num42].active && (!SolidTile(num43, num42) || (Main.tile[num43, num42].type == 10)))
                                {
                                    flag6 = false;
                                }
                            }
                        }
                        if (flag6)
                        {
                            for (int num44 = num22; num44 < num23; num44++)
                            {
                                if ((Main.tile[num41, num44].wall == 0x1b) && !Main.tile[num41, num44].active)
                                {
                                    PlaceTile(num41, num44, 0x7c, true, false, -1, 0);
                                }
                            }
                        }
                        num41 += genRand.Next(3);
                    }
                    for (int num45 = 0; num45 < 4; num45++)
                    {
                        int num46 = genRand.Next(num20 + 2, num21 - 1);
                        int num47 = genRand.Next(num22 + 2, num23 - 1);
                        while (Main.tile[num46, num47].wall != 0x1b)
                        {
                            num46 = genRand.Next(num20 + 2, num21 - 1);
                            num47 = genRand.Next(num22 + 2, num23 - 1);
                        }
                        while (Main.tile[num46, num47].active)
                        {
                            num47--;
                        }
                        while (!Main.tile[num46, num47].active)
                        {
                            num47++;
                        }
                        num47--;
                        if (Main.tile[num46, num47].wall == 0x1b)
                        {
                            if (genRand.Next(3) == 0)
                            {
                                int type = genRand.Next(9);
                                switch (type)
                                {
                                    case 0:
                                        type = 14;
                                        break;

                                    case 1:
                                        type = 0x10;
                                        break;

                                    case 2:
                                        type = 0x12;
                                        break;

                                    case 3:
                                        type = 0x56;
                                        break;

                                    case 4:
                                        type = 0x57;
                                        break;

                                    case 5:
                                        type = 0x5e;
                                        break;

                                    case 6:
                                        type = 0x65;
                                        break;

                                    case 7:
                                        type = 0x68;
                                        break;

                                    case 8:
                                        type = 0x6a;
                                        break;
                                }
                                PlaceTile(num46, num47, type, true, false, -1, 0);
                            }
                            else
                            {
                                int style = genRand.Next(2, 0x2b);
                                PlaceTile(num46, num47, 0x69, true, true, -1, style);
                            }
                        }
                    }
                }
            }
        }

        public static void Mountinater(int i, int j)
        {
            Vector2 vector;
            Vector2 vector2;
            double num5 = genRand.Next(80, 120);
            double num6 = num5;
            float num7 = genRand.Next(40, 0x37);
            vector.X = i;
            vector.Y = j + (num7 / 2f);
            vector2.X = genRand.Next(-10, 11) * 0.1f;
            vector2.Y = genRand.Next(-20, -10) * 0.1f;
            while ((num5 > 0.0) && (num7 > 0f))
            {
                num5 -= genRand.Next(4);
                num7--;
                int num = (int) (vector.X - (num5 * 0.5));
                int maxTilesX = (int) (vector.X + (num5 * 0.5));
                int num2 = (int) (vector.Y - (num5 * 0.5));
                int maxTilesY = (int) (vector.Y + (num5 * 0.5));
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                num6 = (num5 * genRand.Next(80, 120)) * 0.01;
                for (int k = num; k < maxTilesX; k++)
                {
                    for (int m = num2; m < maxTilesY; m++)
                    {
                        float num10 = Math.Abs((float) (k - vector.X));
                        float num11 = Math.Abs((float) (m - vector.Y));
                        if ((Math.Sqrt((double) ((num10 * num10) + (num11 * num11))) < (num6 * 0.4)) && !Main.tile[k, m].active)
                        {
                            Main.tile[k, m].active = true;
                            Main.tile[k, m].type = 0;
                        }
                    }
                }
                vector += vector2;
                vector2.X += genRand.Next(-10, 11) * 0.05f;
                vector2.Y += genRand.Next(-10, 11) * 0.05f;
                if (vector2.X > 0.5)
                {
                    vector2.X = 0.5f;
                }
                if (vector2.X < -0.5)
                {
                    vector2.X = -0.5f;
                }
                if (vector2.Y > -0.5)
                {
                    vector2.Y = -0.5f;
                }
                if (vector2.Y < -1.5)
                {
                    vector2.Y = -1.5f;
                }
            }
        }

        public static bool MoveNPC(int x, int y, int n)
        {
            if (!StartRoomCheck(x, y))
            {
                Main.NewText("This is not valid housing.", 0xff, 240, 20);
                return false;
            }
            if (!RoomNeeds(spawnNPC))
            {
                int index = 0;
                string[] strArray = new string[4];
                if (!roomTorch)
                {
                    strArray[index] = "a light source";
                    index++;
                }
                if (!roomDoor)
                {
                    strArray[index] = "a door";
                    index++;
                }
                if (!roomTable)
                {
                    strArray[index] = "a table";
                    index++;
                }
                if (!roomChair)
                {
                    strArray[index] = "a chair";
                    index++;
                }
                string str = "";
                for (int i = 0; i < index; i++)
                {
                    if ((index == 2) && (i == 1))
                    {
                        str = str + " and ";
                    }
                    else if ((i > 0) && (i != (index - 1)))
                    {
                        str = str + ", and ";
                    }
                    else if (i > 0)
                    {
                        str = str + ", ";
                    }
                    str = str + strArray[i];
                }
                Main.NewText("This housing is missing " + str + ".", 0xff, 240, 20);
                return false;
            }
            ScoreRoom(-1);
            if (hiScore > 0)
            {
                return true;
            }
            if (roomOccupied)
            {
                Main.NewText("This housing is already occupied.", 0xff, 240, 20);
            }
            else if (roomEvil)
            {
                Main.NewText("This housing is corrupted.", 0xff, 240, 20);
            }
            else
            {
                Main.NewText("This housing is not suitable.", 0xff, 240, 20);
            }
            return false;
        }

        public static void moveRoom(int x, int y, int n)
        {
            if (Main.netMode == 1)
            {
                NetMessage.SendData(60, -1, -1, "", n, (float) x, (float) y, 1f, 0);
            }
            else
            {
                spawnNPC = Main.npc[n].type;
                Main.npc[n].homeless = true;
                SpawnNPC(x, y);
            }
        }

        public static void MudWallRunner(int i, int j)
        {
            Vector2 vector;
            Vector2 vector2;
            double num5 = genRand.Next(5, 15);
            float num6 = genRand.Next(5, 20);
            float num7 = num6;
            vector.X = i;
            vector.Y = j;
            vector2.X = genRand.Next(-10, 11) * 0.1f;
            vector2.Y = genRand.Next(-10, 11) * 0.1f;
            while ((num5 > 0.0) && (num7 > 0f))
            {
                double num8 = num5 * (num7 / num6);
                num7--;
                int num = (int) (vector.X - (num8 * 0.5));
                int maxTilesX = (int) (vector.X + (num8 * 0.5));
                int num2 = (int) (vector.Y - (num8 * 0.5));
                int maxTilesY = (int) (vector.Y + (num8 * 0.5));
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                for (int k = num; k < maxTilesX; k++)
                {
                    for (int m = num2; m < maxTilesY; m++)
                    {
                        if ((Math.Abs((float) (k - vector.X)) + Math.Abs((float) (m - vector.Y))) < ((num5 * 0.5) * (1.0 + (genRand.Next(-10, 11) * 0.015))))
                        {
                            Main.tile[k, m].wall = 0;
                        }
                    }
                }
                vector += vector2;
                vector2.X += genRand.Next(-10, 11) * 0.05f;
                if (vector2.X > 1f)
                {
                    vector2.X = 1f;
                }
                if (vector2.X < -1f)
                {
                    vector2.X = -1f;
                }
                vector2.Y += genRand.Next(-10, 11) * 0.05f;
                if (vector2.Y > 1f)
                {
                    vector2.Y = 1f;
                }
                if (vector2.Y < -1f)
                {
                    vector2.Y = -1f;
                }
            }
        }

        public static void noWire(int i, int j)
        {
            if (numNoWire < (maxWire - 1))
            {
                noWireX[numNoWire] = i;
                noWireY[numNoWire] = j;
                numNoWire++;
            }
        }

        public static bool OpenDoor(int i, int j, int direction)
        {
            int num3;
            int num = 0;
            if (Main.tile[i, j - 1] == null)
            {
                Main.tile[i, j - 1] = new Tile();
            }
            if (Main.tile[i, j - 2] == null)
            {
                Main.tile[i, j - 2] = new Tile();
            }
            if (Main.tile[i, j + 1] == null)
            {
                Main.tile[i, j + 1] = new Tile();
            }
            if (Main.tile[i, j] == null)
            {
                Main.tile[i, j] = new Tile();
            }
            if ((Main.tile[i, j - 1].frameY == 0) && (Main.tile[i, j - 1].type == Main.tile[i, j].type))
            {
                num = j - 1;
            }
            else if ((Main.tile[i, j - 2].frameY == 0) && (Main.tile[i, j - 2].type == Main.tile[i, j].type))
            {
                num = j - 2;
            }
            else if ((Main.tile[i, j + 1].frameY == 0) && (Main.tile[i, j + 1].type == Main.tile[i, j].type))
            {
                num = j + 1;
            }
            else
            {
                num = j;
            }
            int num2 = i;
            short num4 = 0;
            if (direction == -1)
            {
                num2 = i - 1;
                num4 = 0x24;
                num3 = i - 1;
            }
            else
            {
                num2 = i;
                num3 = i + 1;
            }
            bool flag = true;
            for (int k = num; k < (num + 3); k++)
            {
                if (Main.tile[num3, k] == null)
                {
                    Main.tile[num3, k] = new Tile();
                }
                if (Main.tile[num3, k].active)
                {
                    if ((((Main.tileCut[Main.tile[num3, k].type] || (Main.tile[num3, k].type == 3)) || ((Main.tile[num3, k].type == 0x18) || (Main.tile[num3, k].type == 0x34))) || (((Main.tile[num3, k].type == 0x3d) || (Main.tile[num3, k].type == 0x3e)) || ((Main.tile[num3, k].type == 0x45) || (Main.tile[num3, k].type == 0x47)))) || (((Main.tile[num3, k].type == 0x49) || (Main.tile[num3, k].type == 0x4a)) || (((Main.tile[num3, k].type == 110) || (Main.tile[num3, k].type == 0x71)) || (Main.tile[num3, k].type == 0x73))))
                    {
                        KillTile(num3, k, false, false, false);
                    }
                    else
                    {
                        flag = false;
                        break;
                    }
                }
            }
            if (flag)
            {
                if (Main.netMode != 1)
                {
                    for (int n = num2; n <= (num2 + 1); n++)
                    {
                        for (int num7 = num; num7 <= (num + 2); num7++)
                        {
                            if (numNoWire < (maxWire - 1))
                            {
                                noWireX[numNoWire] = n;
                                noWireY[numNoWire] = num7;
                                numNoWire++;
                            }
                        }
                    }
                }
                Main.PlaySound(8, i * 0x10, j * 0x10, 1);
                Main.tile[num2, num].active = true;
                Main.tile[num2, num].type = 11;
                Main.tile[num2, num].frameY = 0;
                Main.tile[num2, num].frameX = num4;
                if (Main.tile[num2 + 1, num] == null)
                {
                    Main.tile[num2 + 1, num] = new Tile();
                }
                Main.tile[num2 + 1, num].active = true;
                Main.tile[num2 + 1, num].type = 11;
                Main.tile[num2 + 1, num].frameY = 0;
                Main.tile[num2 + 1, num].frameX = (short) (num4 + 0x12);
                if (Main.tile[num2, num + 1] == null)
                {
                    Main.tile[num2, num + 1] = new Tile();
                }
                Main.tile[num2, num + 1].active = true;
                Main.tile[num2, num + 1].type = 11;
                Main.tile[num2, num + 1].frameY = 0x12;
                Main.tile[num2, num + 1].frameX = num4;
                if (Main.tile[num2 + 1, num + 1] == null)
                {
                    Main.tile[num2 + 1, num + 1] = new Tile();
                }
                Main.tile[num2 + 1, num + 1].active = true;
                Main.tile[num2 + 1, num + 1].type = 11;
                Main.tile[num2 + 1, num + 1].frameY = 0x12;
                Main.tile[num2 + 1, num + 1].frameX = (short) (num4 + 0x12);
                if (Main.tile[num2, num + 2] == null)
                {
                    Main.tile[num2, num + 2] = new Tile();
                }
                Main.tile[num2, num + 2].active = true;
                Main.tile[num2, num + 2].type = 11;
                Main.tile[num2, num + 2].frameY = 0x24;
                Main.tile[num2, num + 2].frameX = num4;
                if (Main.tile[num2 + 1, num + 2] == null)
                {
                    Main.tile[num2 + 1, num + 2] = new Tile();
                }
                Main.tile[num2 + 1, num + 2].active = true;
                Main.tile[num2 + 1, num + 2].type = 11;
                Main.tile[num2 + 1, num + 2].frameY = 0x24;
                Main.tile[num2 + 1, num + 2].frameX = (short) (num4 + 0x12);
                for (int m = num2 - 1; m <= (num2 + 2); m++)
                {
                    for (int num9 = num - 1; num9 <= (num + 2); num9++)
                    {
                        TileFrame(m, num9, false, false);
                    }
                }
            }
            return flag;
        }

        public static void OreRunner(int i, int j, double strength, int steps, int type)
        {
            Vector2 vector;
            Vector2 vector2;
            double num5 = strength;
            float num6 = steps;
            vector.X = i;
            vector.Y = j;
            vector2.X = genRand.Next(-10, 11) * 0.1f;
            vector2.Y = genRand.Next(-10, 11) * 0.1f;
            while ((num5 > 0.0) && (num6 > 0f))
            {
                if (((vector.Y < 0f) && (num6 > 0f)) && (type == 0x3b))
                {
                    num6 = 0f;
                }
                num5 = strength * (num6 / ((float) steps));
                num6--;
                int num = (int) (vector.X - (num5 * 0.5));
                int maxTilesX = (int) (vector.X + (num5 * 0.5));
                int num2 = (int) (vector.Y - (num5 * 0.5));
                int maxTilesY = (int) (vector.Y + (num5 * 0.5));
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                for (int k = num; k < maxTilesX; k++)
                {
                    for (int m = num2; m < maxTilesY; m++)
                    {
                        if ((((Math.Abs((float) (k - vector.X)) + Math.Abs((float) (m - vector.Y))) < ((strength * 0.5) * (1.0 + (genRand.Next(-10, 11) * 0.015)))) && Main.tile[k, m].active) && (((((Main.tile[k, m].type == 0) || (Main.tile[k, m].type == 1)) || ((Main.tile[k, m].type == 0x17) || (Main.tile[k, m].type == 0x19))) || (((Main.tile[k, m].type == 40) || (Main.tile[k, m].type == 0x35)) || ((Main.tile[k, m].type == 0x39) || (Main.tile[k, m].type == 0x3b)))) || ((((Main.tile[k, m].type == 60) || (Main.tile[k, m].type == 70)) || ((Main.tile[k, m].type == 0x6d) || (Main.tile[k, m].type == 0x70))) || ((Main.tile[k, m].type == 0x74) || (Main.tile[k, m].type == 0x75)))))
                        {
                            Main.tile[k, m].type = (byte) type;
                            SquareTileFrame(k, m, true);
                            if (Main.netMode == 2)
                            {
                                NetMessage.SendTileSquare(-1, k, m, 1);
                            }
                        }
                    }
                }
                vector += vector2;
                vector2.X += genRand.Next(-10, 11) * 0.05f;
                if (vector2.X > 1f)
                {
                    vector2.X = 1f;
                }
                if (vector2.X < -1f)
                {
                    vector2.X = -1f;
                }
            }
        }

        public static void Place1x1(int x, int y, int type, int style = 0)
        {
            if (Main.tile[x, y] == null)
            {
                Main.tile[x, y] = new Tile();
            }
            if (Main.tile[x, y + 1] == null)
            {
                Main.tile[x, y + 1] = new Tile();
            }
            if (SolidTile(x, y + 1) && !Main.tile[x, y].active)
            {
                Main.tile[x, y].active = true;
                Main.tile[x, y].type = (byte) type;
                if (type == 0x90)
                {
                    Main.tile[x, y].frameX = (short) (style * 0x12);
                    Main.tile[x, y].frameY = 0;
                }
                else
                {
                    Main.tile[x, y].frameY = (short) (style * 0x12);
                }
            }
        }

        public static void Place1x2(int x, int y, int type, int style)
        {
            short num = 0;
            if (type == 20)
            {
                num = (short) (genRand.Next(3) * 0x12);
            }
            if (Main.tile[x, y - 1] == null)
            {
                Main.tile[x, y - 1] = new Tile();
            }
            if (Main.tile[x, y + 1] == null)
            {
                Main.tile[x, y + 1] = new Tile();
            }
            if ((Main.tile[x, y + 1].active && Main.tileSolid[Main.tile[x, y + 1].type]) && !Main.tile[x, y - 1].active)
            {
                short num2 = (short) (style * 40);
                Main.tile[x, y - 1].active = true;
                Main.tile[x, y - 1].frameY = num2;
                Main.tile[x, y - 1].frameX = num;
                Main.tile[x, y - 1].type = (byte) type;
                Main.tile[x, y].active = true;
                Main.tile[x, y].frameY = (short) (num2 + 0x12);
                Main.tile[x, y].frameX = num;
                Main.tile[x, y].type = (byte) type;
            }
        }

        public static void Place1x2Top(int x, int y, int type)
        {
            short num = 0;
            if (Main.tile[x, y - 1] == null)
            {
                Main.tile[x, y - 1] = new Tile();
            }
            if (Main.tile[x, y + 1] == null)
            {
                Main.tile[x, y + 1] = new Tile();
            }
            if ((Main.tile[x, y - 1].active && Main.tileSolid[Main.tile[x, y - 1].type]) && (!Main.tileSolidTop[Main.tile[x, y - 1].type] && !Main.tile[x, y + 1].active))
            {
                Main.tile[x, y].active = true;
                Main.tile[x, y].frameY = 0;
                Main.tile[x, y].frameX = num;
                Main.tile[x, y].type = (byte) type;
                Main.tile[x, y + 1].active = true;
                Main.tile[x, y + 1].frameY = 0x12;
                Main.tile[x, y + 1].frameX = num;
                Main.tile[x, y + 1].type = (byte) type;
            }
        }

        public static void Place1xX(int x, int y, int type, int style = 0)
        {
            int num = style * 0x12;
            int num2 = 3;
            if (type == 0x5c)
            {
                num2 = 6;
            }
            bool flag = true;
            for (int i = (y - num2) + 1; i < (y + 1); i++)
            {
                if (Main.tile[x, i] == null)
                {
                    Main.tile[x, i] = new Tile();
                }
                if (Main.tile[x, i].active)
                {
                    flag = false;
                }
                if ((type == 0x5d) && (Main.tile[x, i].liquid > 0))
                {
                    flag = false;
                }
            }
            if ((flag && Main.tile[x, y + 1].active) && Main.tileSolid[Main.tile[x, y + 1].type])
            {
                for (int j = 0; j < num2; j++)
                {
                    Main.tile[x, ((y - num2) + 1) + j].active = true;
                    Main.tile[x, ((y - num2) + 1) + j].frameY = (short) (j * 0x12);
                    Main.tile[x, ((y - num2) + 1) + j].frameX = (short) num;
                    Main.tile[x, ((y - num2) + 1) + j].type = (byte) type;
                }
            }
        }

        public static void Place2x1(int x, int y, int type)
        {
            if (Main.tile[x, y] == null)
            {
                Main.tile[x, y] = new Tile();
            }
            if (Main.tile[x + 1, y] == null)
            {
                Main.tile[x + 1, y] = new Tile();
            }
            if (Main.tile[x, y + 1] == null)
            {
                Main.tile[x, y + 1] = new Tile();
            }
            if (Main.tile[x + 1, y + 1] == null)
            {
                Main.tile[x + 1, y + 1] = new Tile();
            }
            bool flag = false;
            if ((((type != 0x1d) && (type != 0x67)) && (Main.tile[x, y + 1].active && Main.tile[x + 1, y + 1].active)) && ((Main.tileSolid[Main.tile[x, y + 1].type] && Main.tileSolid[Main.tile[x + 1, y + 1].type]) && (!Main.tile[x, y].active && !Main.tile[x + 1, y].active)))
            {
                flag = true;
            }
            else if (((type == 0x1d) || (type == 0x67)) && (((Main.tile[x, y + 1].active && Main.tile[x + 1, y + 1].active) && (Main.tileTable[Main.tile[x, y + 1].type] && Main.tileTable[Main.tile[x + 1, y + 1].type])) && (!Main.tile[x, y].active && !Main.tile[x + 1, y].active)))
            {
                flag = true;
            }
            if (flag)
            {
                Main.tile[x, y].active = true;
                Main.tile[x, y].frameY = 0;
                Main.tile[x, y].frameX = 0;
                Main.tile[x, y].type = (byte) type;
                Main.tile[x + 1, y].active = true;
                Main.tile[x + 1, y].frameY = 0;
                Main.tile[x + 1, y].frameX = 0x12;
                Main.tile[x + 1, y].type = (byte) type;
            }
        }

        public static void Place2x2(int x, int superY, int type)
        {
            int num = superY;
            if ((type == 0x5f) || (type == 0x7e))
            {
                num++;
            }
            if (((x >= 5) && (x <= (Main.maxTilesX - 5))) && ((num >= 5) && (num <= (Main.maxTilesY - 5))))
            {
                bool flag = true;
                for (int i = x - 1; i < (x + 1); i++)
                {
                    for (int j = num - 1; j < (num + 1); j++)
                    {
                        if (Main.tile[i, j] == null)
                        {
                            Main.tile[i, j] = new Tile();
                        }
                        if (Main.tile[i, j].active)
                        {
                            flag = false;
                        }
                        if ((type == 0x62) && (Main.tile[i, j].liquid > 0))
                        {
                            flag = false;
                        }
                    }
                    if ((type == 0x5f) || (type == 0x7e))
                    {
                        if (Main.tile[i, num - 2] == null)
                        {
                            Main.tile[i, num - 2] = new Tile();
                        }
                        if ((!Main.tile[i, num - 2].active || !Main.tileSolid[Main.tile[i, num - 2].type]) || Main.tileSolidTop[Main.tile[i, num - 2].type])
                        {
                            flag = false;
                        }
                    }
                    else
                    {
                        if (Main.tile[i, num + 1] == null)
                        {
                            Main.tile[i, num + 1] = new Tile();
                        }
                        if (!Main.tile[i, num + 1].active || (!Main.tileSolid[Main.tile[i, num + 1].type] && !Main.tileTable[Main.tile[i, num + 1].type]))
                        {
                            flag = false;
                        }
                    }
                }
                if (flag)
                {
                    Main.tile[x - 1, num - 1].active = true;
                    Main.tile[x - 1, num - 1].frameY = 0;
                    Main.tile[x - 1, num - 1].frameX = 0;
                    Main.tile[x - 1, num - 1].type = (byte) type;
                    Main.tile[x, num - 1].active = true;
                    Main.tile[x, num - 1].frameY = 0;
                    Main.tile[x, num - 1].frameX = 0x12;
                    Main.tile[x, num - 1].type = (byte) type;
                    Main.tile[x - 1, num].active = true;
                    Main.tile[x - 1, num].frameY = 0x12;
                    Main.tile[x - 1, num].frameX = 0;
                    Main.tile[x - 1, num].type = (byte) type;
                    Main.tile[x, num].active = true;
                    Main.tile[x, num].frameY = 0x12;
                    Main.tile[x, num].frameX = 0x12;
                    Main.tile[x, num].type = (byte) type;
                }
            }
        }

        public static void Place2xX(int x, int y, int type, int style = 0)
        {
            int num = style * 0x24;
            int num2 = 3;
            if (type == 0x68)
            {
                num2 = 5;
            }
            bool flag = true;
            for (int i = (y - num2) + 1; i < (y + 1); i++)
            {
                if (Main.tile[x, i] == null)
                {
                    Main.tile[x, i] = new Tile();
                }
                if (Main.tile[x, i].active)
                {
                    flag = false;
                }
                if (Main.tile[x + 1, i] == null)
                {
                    Main.tile[x + 1, i] = new Tile();
                }
                if (Main.tile[x + 1, i].active)
                {
                    flag = false;
                }
            }
            if (((flag && Main.tile[x, y + 1].active) && (Main.tileSolid[Main.tile[x, y + 1].type] && Main.tile[x + 1, y + 1].active)) && Main.tileSolid[Main.tile[x + 1, y + 1].type])
            {
                for (int j = 0; j < num2; j++)
                {
                    Main.tile[x, ((y - num2) + 1) + j].active = true;
                    Main.tile[x, ((y - num2) + 1) + j].frameY = (short) (j * 0x12);
                    Main.tile[x, ((y - num2) + 1) + j].frameX = (short) num;
                    Main.tile[x, ((y - num2) + 1) + j].type = (byte) type;
                    Main.tile[x + 1, ((y - num2) + 1) + j].active = true;
                    Main.tile[x + 1, ((y - num2) + 1) + j].frameY = (short) (j * 0x12);
                    Main.tile[x + 1, ((y - num2) + 1) + j].frameX = (short) (num + 0x12);
                    Main.tile[x + 1, ((y - num2) + 1) + j].type = (byte) type;
                }
            }
        }

        public static void Place3x2(int x, int y, int type)
        {
            if (((x >= 5) && (x <= (Main.maxTilesX - 5))) && ((y >= 5) && (y <= (Main.maxTilesY - 5))))
            {
                bool flag = true;
                for (int i = x - 1; i < (x + 2); i++)
                {
                    for (int j = y - 1; j < (y + 1); j++)
                    {
                        if (Main.tile[i, j] == null)
                        {
                            Main.tile[i, j] = new Tile();
                        }
                        if (Main.tile[i, j].active)
                        {
                            flag = false;
                        }
                    }
                    if (Main.tile[i, y + 1] == null)
                    {
                        Main.tile[i, y + 1] = new Tile();
                    }
                    if (!Main.tile[i, y + 1].active || !Main.tileSolid[Main.tile[i, y + 1].type])
                    {
                        flag = false;
                    }
                }
                if (flag)
                {
                    Main.tile[x - 1, y - 1].active = true;
                    Main.tile[x - 1, y - 1].frameY = 0;
                    Main.tile[x - 1, y - 1].frameX = 0;
                    Main.tile[x - 1, y - 1].type = (byte) type;
                    Main.tile[x, y - 1].active = true;
                    Main.tile[x, y - 1].frameY = 0;
                    Main.tile[x, y - 1].frameX = 0x12;
                    Main.tile[x, y - 1].type = (byte) type;
                    Main.tile[x + 1, y - 1].active = true;
                    Main.tile[x + 1, y - 1].frameY = 0;
                    Main.tile[x + 1, y - 1].frameX = 0x24;
                    Main.tile[x + 1, y - 1].type = (byte) type;
                    Main.tile[x - 1, y].active = true;
                    Main.tile[x - 1, y].frameY = 0x12;
                    Main.tile[x - 1, y].frameX = 0;
                    Main.tile[x - 1, y].type = (byte) type;
                    Main.tile[x, y].active = true;
                    Main.tile[x, y].frameY = 0x12;
                    Main.tile[x, y].frameX = 0x12;
                    Main.tile[x, y].type = (byte) type;
                    Main.tile[x + 1, y].active = true;
                    Main.tile[x + 1, y].frameY = 0x12;
                    Main.tile[x + 1, y].frameX = 0x24;
                    Main.tile[x + 1, y].type = (byte) type;
                }
            }
        }

        public static void Place3x3(int x, int y, int type)
        {
            bool flag = true;
            int num = 0;
            if (type == 0x6a)
            {
                num = -2;
                for (int i = x - 1; i < (x + 2); i++)
                {
                    for (int k = y - 2; k < (y + 1); k++)
                    {
                        if (Main.tile[i, k] == null)
                        {
                            Main.tile[i, k] = new Tile();
                        }
                        if (Main.tile[i, k].active)
                        {
                            flag = false;
                        }
                    }
                }
                for (int j = x - 1; j < (x + 2); j++)
                {
                    if (Main.tile[j, y + 1] == null)
                    {
                        Main.tile[j, y + 1] = new Tile();
                    }
                    if (!Main.tile[j, y + 1].active || !Main.tileSolid[Main.tile[j, y + 1].type])
                    {
                        flag = false;
                        break;
                    }
                }
            }
            else
            {
                for (int m = x - 1; m < (x + 2); m++)
                {
                    for (int n = y; n < (y + 3); n++)
                    {
                        if (Main.tile[m, n] == null)
                        {
                            Main.tile[m, n] = new Tile();
                        }
                        if (Main.tile[m, n].active)
                        {
                            flag = false;
                        }
                    }
                }
                if (Main.tile[x, y - 1] == null)
                {
                    Main.tile[x, y - 1] = new Tile();
                }
                if ((!Main.tile[x, y - 1].active || !Main.tileSolid[Main.tile[x, y - 1].type]) || Main.tileSolidTop[Main.tile[x, y - 1].type])
                {
                    flag = false;
                }
            }
            if (flag)
            {
                Main.tile[x - 1, y + num].active = true;
                Main.tile[x - 1, y + num].frameY = 0;
                Main.tile[x - 1, y + num].frameX = 0;
                Main.tile[x - 1, y + num].type = (byte) type;
                Main.tile[x, y + num].active = true;
                Main.tile[x, y + num].frameY = 0;
                Main.tile[x, y + num].frameX = 0x12;
                Main.tile[x, y + num].type = (byte) type;
                Main.tile[x + 1, y + num].active = true;
                Main.tile[x + 1, y + num].frameY = 0;
                Main.tile[x + 1, y + num].frameX = 0x24;
                Main.tile[x + 1, y + num].type = (byte) type;
                Main.tile[x - 1, (y + 1) + num].active = true;
                Main.tile[x - 1, (y + 1) + num].frameY = 0x12;
                Main.tile[x - 1, (y + 1) + num].frameX = 0;
                Main.tile[x - 1, (y + 1) + num].type = (byte) type;
                Main.tile[x, (y + 1) + num].active = true;
                Main.tile[x, (y + 1) + num].frameY = 0x12;
                Main.tile[x, (y + 1) + num].frameX = 0x12;
                Main.tile[x, (y + 1) + num].type = (byte) type;
                Main.tile[x + 1, (y + 1) + num].active = true;
                Main.tile[x + 1, (y + 1) + num].frameY = 0x12;
                Main.tile[x + 1, (y + 1) + num].frameX = 0x24;
                Main.tile[x + 1, (y + 1) + num].type = (byte) type;
                Main.tile[x - 1, (y + 2) + num].active = true;
                Main.tile[x - 1, (y + 2) + num].frameY = 0x24;
                Main.tile[x - 1, (y + 2) + num].frameX = 0;
                Main.tile[x - 1, (y + 2) + num].type = (byte) type;
                Main.tile[x, (y + 2) + num].active = true;
                Main.tile[x, (y + 2) + num].frameY = 0x24;
                Main.tile[x, (y + 2) + num].frameX = 0x12;
                Main.tile[x, (y + 2) + num].type = (byte) type;
                Main.tile[x + 1, (y + 2) + num].active = true;
                Main.tile[x + 1, (y + 2) + num].frameY = 0x24;
                Main.tile[x + 1, (y + 2) + num].frameX = 0x24;
                Main.tile[x + 1, (y + 2) + num].type = (byte) type;
            }
        }

        public static void Place3x4(int x, int y, int type)
        {
            if (((x >= 5) && (x <= (Main.maxTilesX - 5))) && ((y >= 5) && (y <= (Main.maxTilesY - 5))))
            {
                bool flag = true;
                for (int i = x - 1; i < (x + 2); i++)
                {
                    for (int j = y - 3; j < (y + 1); j++)
                    {
                        if (Main.tile[i, j] == null)
                        {
                            Main.tile[i, j] = new Tile();
                        }
                        if (Main.tile[i, j].active)
                        {
                            flag = false;
                        }
                    }
                    if (Main.tile[i, y + 1] == null)
                    {
                        Main.tile[i, y + 1] = new Tile();
                    }
                    if (!Main.tile[i, y + 1].active || !Main.tileSolid[Main.tile[i, y + 1].type])
                    {
                        flag = false;
                    }
                }
                if (flag)
                {
                    for (int k = -3; k <= 0; k++)
                    {
                        short num4 = (short) ((3 + k) * 0x12);
                        Main.tile[x - 1, y + k].active = true;
                        Main.tile[x - 1, y + k].frameY = num4;
                        Main.tile[x - 1, y + k].frameX = 0;
                        Main.tile[x - 1, y + k].type = (byte) type;
                        Main.tile[x, y + k].active = true;
                        Main.tile[x, y + k].frameY = num4;
                        Main.tile[x, y + k].frameX = 0x12;
                        Main.tile[x, y + k].type = (byte) type;
                        Main.tile[x + 1, y + k].active = true;
                        Main.tile[x + 1, y + k].frameY = num4;
                        Main.tile[x + 1, y + k].frameX = 0x24;
                        Main.tile[x + 1, y + k].type = (byte) type;
                    }
                }
            }
        }

        public static void Place4x2(int x, int y, int type, int direction = -1)
        {
            if (((x >= 5) && (x <= (Main.maxTilesX - 5))) && ((y >= 5) && (y <= (Main.maxTilesY - 5))))
            {
                bool flag = true;
                for (int i = x - 1; i < (x + 3); i++)
                {
                    for (int j = y - 1; j < (y + 1); j++)
                    {
                        if (Main.tile[i, j] == null)
                        {
                            Main.tile[i, j] = new Tile();
                        }
                        if (Main.tile[i, j].active)
                        {
                            flag = false;
                        }
                    }
                    if (Main.tile[i, y + 1] == null)
                    {
                        Main.tile[i, y + 1] = new Tile();
                    }
                    if (!Main.tile[i, y + 1].active || !Main.tileSolid[Main.tile[i, y + 1].type])
                    {
                        flag = false;
                    }
                }
                short num3 = 0;
                if (direction == 1)
                {
                    num3 = 0x48;
                }
                if (flag)
                {
                    Main.tile[x - 1, y - 1].active = true;
                    Main.tile[x - 1, y - 1].frameY = 0;
                    Main.tile[x - 1, y - 1].frameX = num3;
                    Main.tile[x - 1, y - 1].type = (byte) type;
                    Main.tile[x, y - 1].active = true;
                    Main.tile[x, y - 1].frameY = 0;
                    Main.tile[x, y - 1].frameX = (short) (0x12 + num3);
                    Main.tile[x, y - 1].type = (byte) type;
                    Main.tile[x + 1, y - 1].active = true;
                    Main.tile[x + 1, y - 1].frameY = 0;
                    Main.tile[x + 1, y - 1].frameX = (short) (0x24 + num3);
                    Main.tile[x + 1, y - 1].type = (byte) type;
                    Main.tile[x + 2, y - 1].active = true;
                    Main.tile[x + 2, y - 1].frameY = 0;
                    Main.tile[x + 2, y - 1].frameX = (short) (0x36 + num3);
                    Main.tile[x + 2, y - 1].type = (byte) type;
                    Main.tile[x - 1, y].active = true;
                    Main.tile[x - 1, y].frameY = 0x12;
                    Main.tile[x - 1, y].frameX = num3;
                    Main.tile[x - 1, y].type = (byte) type;
                    Main.tile[x, y].active = true;
                    Main.tile[x, y].frameY = 0x12;
                    Main.tile[x, y].frameX = (short) (0x12 + num3);
                    Main.tile[x, y].type = (byte) type;
                    Main.tile[x + 1, y].active = true;
                    Main.tile[x + 1, y].frameY = 0x12;
                    Main.tile[x + 1, y].frameX = (short) (0x24 + num3);
                    Main.tile[x + 1, y].type = (byte) type;
                    Main.tile[x + 2, y].active = true;
                    Main.tile[x + 2, y].frameY = 0x12;
                    Main.tile[x + 2, y].frameX = (short) (0x36 + num3);
                    Main.tile[x + 2, y].type = (byte) type;
                }
            }
        }

        public static bool PlaceAlch(int x, int y, int style)
        {
            if (Main.tile[x, y] == null)
            {
                Main.tile[x, y] = new Tile();
            }
            if (Main.tile[x, y + 1] == null)
            {
                Main.tile[x, y + 1] = new Tile();
            }
            if (!Main.tile[x, y].active && Main.tile[x, y + 1].active)
            {
                bool flag = false;
                if (style == 0)
                {
                    if (((Main.tile[x, y + 1].type != 2) && (Main.tile[x, y + 1].type != 0x4e)) && (Main.tile[x, y + 1].type != 0x6d))
                    {
                        flag = true;
                    }
                    if (Main.tile[x, y].liquid > 0)
                    {
                        flag = true;
                    }
                }
                else if (style == 1)
                {
                    if ((Main.tile[x, y + 1].type != 60) && (Main.tile[x, y + 1].type != 0x4e))
                    {
                        flag = true;
                    }
                    if (Main.tile[x, y].liquid > 0)
                    {
                        flag = true;
                    }
                }
                else if (style == 2)
                {
                    if (((Main.tile[x, y + 1].type != 0) && (Main.tile[x, y + 1].type != 0x3b)) && (Main.tile[x, y + 1].type != 0x4e))
                    {
                        flag = true;
                    }
                    if (Main.tile[x, y].liquid > 0)
                    {
                        flag = true;
                    }
                }
                else if (style == 3)
                {
                    if (((Main.tile[x, y + 1].type != 0x17) && (Main.tile[x, y + 1].type != 0x19)) && (Main.tile[x, y + 1].type != 0x4e))
                    {
                        flag = true;
                    }
                    if (Main.tile[x, y].liquid > 0)
                    {
                        flag = true;
                    }
                }
                else if (style == 4)
                {
                    if (((Main.tile[x, y + 1].type != 0x35) && (Main.tile[x, y + 1].type != 0x4e)) && (Main.tile[x, y + 1].type != 0x74))
                    {
                        flag = true;
                    }
                    if ((Main.tile[x, y].liquid > 0) && Main.tile[x, y].lava)
                    {
                        flag = true;
                    }
                }
                else if (style == 5)
                {
                    if ((Main.tile[x, y + 1].type != 0x39) && (Main.tile[x, y + 1].type != 0x4e))
                    {
                        flag = true;
                    }
                    if ((Main.tile[x, y].liquid > 0) && !Main.tile[x, y].lava)
                    {
                        flag = true;
                    }
                }
                if (!flag)
                {
                    Main.tile[x, y].active = true;
                    Main.tile[x, y].type = 0x52;
                    Main.tile[x, y].frameX = (short) (0x12 * style);
                    Main.tile[x, y].frameY = 0;
                    return true;
                }
            }
            return false;
        }

        public static void PlaceBanner(int x, int y, int type, int style = 0)
        {
            int num = style * 0x12;
            if (Main.tile[x, y - 1] == null)
            {
                Main.tile[x, y - 1] = new Tile();
            }
            if (Main.tile[x, y] == null)
            {
                Main.tile[x, y] = new Tile();
            }
            if (Main.tile[x, y + 1] == null)
            {
                Main.tile[x, y + 1] = new Tile();
            }
            if (Main.tile[x, y + 2] == null)
            {
                Main.tile[x, y + 2] = new Tile();
            }
            if (((Main.tile[x, y - 1].active && Main.tileSolid[Main.tile[x, y - 1].type]) && (!Main.tileSolidTop[Main.tile[x, y - 1].type] && !Main.tile[x, y].active)) && (!Main.tile[x, y + 1].active && !Main.tile[x, y + 2].active))
            {
                Main.tile[x, y].active = true;
                Main.tile[x, y].frameY = 0;
                Main.tile[x, y].frameX = (short) num;
                Main.tile[x, y].type = (byte) type;
                Main.tile[x, y + 1].active = true;
                Main.tile[x, y + 1].frameY = 0x12;
                Main.tile[x, y + 1].frameX = (short) num;
                Main.tile[x, y + 1].type = (byte) type;
                Main.tile[x, y + 2].active = true;
                Main.tile[x, y + 2].frameY = 0x24;
                Main.tile[x, y + 2].frameX = (short) num;
                Main.tile[x, y + 2].type = (byte) type;
            }
        }

        public static int PlaceChest(int x, int y, int type = 0x15, bool notNearOtherChests = false, int style = 0)
        {
            bool flag = true;
            int num = -1;
            for (int i = x; i < (x + 2); i++)
            {
                for (int j = y - 1; j < (y + 1); j++)
                {
                    if (Main.tile[i, j] == null)
                    {
                        Main.tile[i, j] = new Tile();
                    }
                    if (Main.tile[i, j].active)
                    {
                        flag = false;
                    }
                    if (Main.tile[i, j].lava)
                    {
                        flag = false;
                    }
                }
                if (Main.tile[i, y + 1] == null)
                {
                    Main.tile[i, y + 1] = new Tile();
                }
                if (!Main.tile[i, y + 1].active || !Main.tileSolid[Main.tile[i, y + 1].type])
                {
                    flag = false;
                }
            }
            if (flag && notNearOtherChests)
            {
                for (int k = x - 0x19; k < (x + 0x19); k++)
                {
                    for (int m = y - 8; m < (y + 8); m++)
                    {
                        try
                        {
                            if (Main.tile[k, m].active && (Main.tile[k, m].type == 0x15))
                            {
                                flag = false;
                                return -1;
                            }
                        }
                        catch
                        {
                        }
                    }
                }
            }
            if (flag)
            {
                num = Chest.CreateChest(x, y - 1);
                if (num == -1)
                {
                    flag = false;
                }
            }
            if (flag)
            {
                Main.tile[x, y - 1].active = true;
                Main.tile[x, y - 1].frameY = 0;
                Main.tile[x, y - 1].frameX = (short) (0x24 * style);
                Main.tile[x, y - 1].type = (byte) type;
                Main.tile[x + 1, y - 1].active = true;
                Main.tile[x + 1, y - 1].frameY = 0;
                Main.tile[x + 1, y - 1].frameX = (short) (0x12 + (0x24 * style));
                Main.tile[x + 1, y - 1].type = (byte) type;
                Main.tile[x, y].active = true;
                Main.tile[x, y].frameY = 0x12;
                Main.tile[x, y].frameX = (short) (0x24 * style);
                Main.tile[x, y].type = (byte) type;
                Main.tile[x + 1, y].active = true;
                Main.tile[x + 1, y].frameY = 0x12;
                Main.tile[x + 1, y].frameX = (short) (0x12 + (0x24 * style));
                Main.tile[x + 1, y].type = (byte) type;
            }
            return num;
        }

        public static bool PlaceDoor(int i, int j, int type)
        {
            try
            {
                if ((Main.tile[i, j - 2].active && Main.tileSolid[Main.tile[i, j - 2].type]) && (Main.tile[i, j + 2].active && Main.tileSolid[Main.tile[i, j + 2].type]))
                {
                    Main.tile[i, j - 1].active = true;
                    Main.tile[i, j - 1].type = 10;
                    Main.tile[i, j - 1].frameY = 0;
                    Main.tile[i, j - 1].frameX = (short) (genRand.Next(3) * 0x12);
                    Main.tile[i, j].active = true;
                    Main.tile[i, j].type = 10;
                    Main.tile[i, j].frameY = 0x12;
                    Main.tile[i, j].frameX = (short) (genRand.Next(3) * 0x12);
                    Main.tile[i, j + 1].active = true;
                    Main.tile[i, j + 1].type = 10;
                    Main.tile[i, j + 1].frameY = 0x24;
                    Main.tile[i, j + 1].frameX = (short) (genRand.Next(3) * 0x12);
                    return true;
                }
                return false;
            }
            catch
            {
                return false;
            }
        }

        public static void PlaceMan(int i, int j, int dir)
        {
            for (int k = i; k <= (i + 1); k++)
            {
                for (int m = j - 2; m <= j; m++)
                {
                    if (Main.tile[k, m].active)
                    {
                        return;
                    }
                }
            }
            if (SolidTile(i, j + 1) && SolidTile(i + 1, j + 1))
            {
                byte num3 = 0;
                if (dir == 1)
                {
                    num3 = 0x24;
                }
                Main.tile[i, j - 2].active = true;
                Main.tile[i, j - 2].frameY = 0;
                Main.tile[i, j - 2].frameX = num3;
                Main.tile[i, j - 2].type = 0x80;
                Main.tile[i, j - 1].active = true;
                Main.tile[i, j - 1].frameY = 0x12;
                Main.tile[i, j - 1].frameX = num3;
                Main.tile[i, j - 1].type = 0x80;
                Main.tile[i, j].active = true;
                Main.tile[i, j].frameY = 0x24;
                Main.tile[i, j].frameX = num3;
                Main.tile[i, j].type = 0x80;
                Main.tile[i + 1, j - 2].active = true;
                Main.tile[i + 1, j - 2].frameY = 0;
                Main.tile[i + 1, j - 2].frameX = (byte) (0x12 + num3);
                Main.tile[i + 1, j - 2].type = 0x80;
                Main.tile[i + 1, j - 1].active = true;
                Main.tile[i + 1, j - 1].frameY = 0x12;
                Main.tile[i + 1, j - 1].frameX = (byte) (0x12 + num3);
                Main.tile[i + 1, j - 1].type = 0x80;
                Main.tile[i + 1, j].active = true;
                Main.tile[i + 1, j].frameY = 0x24;
                Main.tile[i + 1, j].frameX = (byte) (0x12 + num3);
                Main.tile[i + 1, j].type = 0x80;
            }
        }

        public static void PlaceMB(int X, int y, int type, int style)
        {
            int num = X + 1;
            if (((num >= 5) && (num <= (Main.maxTilesX - 5))) && ((y >= 5) && (y <= (Main.maxTilesY - 5))))
            {
                bool flag = true;
                for (int i = num - 1; i < (num + 1); i++)
                {
                    for (int j = y - 1; j < (y + 1); j++)
                    {
                        if (Main.tile[i, j] == null)
                        {
                            Main.tile[i, j] = new Tile();
                        }
                        if (Main.tile[i, j].active)
                        {
                            flag = false;
                        }
                    }
                    if (Main.tile[i, y + 1] == null)
                    {
                        Main.tile[i, y + 1] = new Tile();
                    }
                    if (!Main.tile[i, y + 1].active || (!Main.tileSolid[Main.tile[i, y + 1].type] && !Main.tileTable[Main.tile[i, y + 1].type]))
                    {
                        flag = false;
                    }
                }
                if (flag)
                {
                    Main.tile[num - 1, y - 1].active = true;
                    Main.tile[num - 1, y - 1].frameY = (short) (style * 0x24);
                    Main.tile[num - 1, y - 1].frameX = 0;
                    Main.tile[num - 1, y - 1].type = (byte) type;
                    Main.tile[num, y - 1].active = true;
                    Main.tile[num, y - 1].frameY = (short) (style * 0x24);
                    Main.tile[num, y - 1].frameX = 0x12;
                    Main.tile[num, y - 1].type = (byte) type;
                    Main.tile[num - 1, y].active = true;
                    Main.tile[num - 1, y].frameY = (short) ((style * 0x24) + 0x12);
                    Main.tile[num - 1, y].frameX = 0;
                    Main.tile[num - 1, y].type = (byte) type;
                    Main.tile[num, y].active = true;
                    Main.tile[num, y].frameY = (short) ((style * 0x24) + 0x12);
                    Main.tile[num, y].frameX = 0x12;
                    Main.tile[num, y].type = (byte) type;
                }
            }
        }

        public static void PlaceOnTable1x1(int x, int y, int type, int style = 0)
        {
            bool flag = false;
            if (Main.tile[x, y] == null)
            {
                Main.tile[x, y] = new Tile();
            }
            if (Main.tile[x, y + 1] == null)
            {
                Main.tile[x, y + 1] = new Tile();
            }
            if ((!Main.tile[x, y].active && Main.tile[x, y + 1].active) && Main.tileTable[Main.tile[x, y + 1].type])
            {
                flag = true;
            }
            if (((type == 0x4e) && !Main.tile[x, y].active) && (Main.tile[x, y + 1].active && Main.tileSolid[Main.tile[x, y + 1].type]))
            {
                flag = true;
            }
            if (flag)
            {
                Main.tile[x, y].active = true;
                Main.tile[x, y].frameX = (short) (style * 0x12);
                Main.tile[x, y].frameY = 0;
                Main.tile[x, y].type = (byte) type;
                if (type == 50)
                {
                    Main.tile[x, y].frameX = (short) (0x12 * genRand.Next(5));
                }
            }
        }

        public static bool PlacePot(int x, int y, int type = 0x1c)
        {
            bool flag = true;
            for (int i = x; i < (x + 2); i++)
            {
                for (int k = y - 1; k < (y + 1); k++)
                {
                    if (Main.tile[i, k] == null)
                    {
                        Main.tile[i, k] = new Tile();
                    }
                    if (Main.tile[i, k].active)
                    {
                        flag = false;
                    }
                }
                if (Main.tile[i, y + 1] == null)
                {
                    Main.tile[i, y + 1] = new Tile();
                }
                if (!Main.tile[i, y + 1].active || !Main.tileSolid[Main.tile[i, y + 1].type])
                {
                    flag = false;
                }
            }
            if (!flag)
            {
                return false;
            }
            for (int j = 0; j < 2; j++)
            {
                for (int m = -1; m < 1; m++)
                {
                    int num5 = (j * 0x12) + (genRand.Next(3) * 0x24);
                    int num6 = (m + 1) * 0x12;
                    Main.tile[x + j, y + m].active = true;
                    Main.tile[x + j, y + m].frameX = (short) num5;
                    Main.tile[x + j, y + m].frameY = (short) num6;
                    Main.tile[x + j, y + m].type = (byte) type;
                }
            }
            return true;
        }

        public static bool PlaceSign(int x, int y, int type)
        {
            int num = x - 2;
            int num2 = x + 3;
            int num3 = y - 2;
            int num4 = y + 3;
            if (num < 0)
            {
                return false;
            }
            if (num2 > Main.maxTilesX)
            {
                return false;
            }
            if (num3 < 0)
            {
                return false;
            }
            if (num4 > Main.maxTilesY)
            {
                return false;
            }
            for (int i = num; i < num2; i++)
            {
                for (int k = num3; k < num4; k++)
                {
                    if (Main.tile[i, k] == null)
                    {
                        Main.tile[i, k] = new Tile();
                    }
                }
            }
            int num7 = x;
            int num8 = y;
            int num9 = 0;
            if (type == 0x37)
            {
                if ((!Main.tile[x, y + 1].active || !Main.tileSolid[Main.tile[x, y + 1].type]) || (!Main.tile[x + 1, y + 1].active || !Main.tileSolid[Main.tile[x + 1, y + 1].type]))
                {
                    if (((!Main.tile[x, y - 1].active || !Main.tileSolid[Main.tile[x, y - 1].type]) || (Main.tileSolidTop[Main.tile[x, y - 1].type] || !Main.tile[x + 1, y - 1].active)) || (!Main.tileSolid[Main.tile[x + 1, y - 1].type] || Main.tileSolidTop[Main.tile[x + 1, y - 1].type]))
                    {
                        if (((!Main.tile[x - 1, y].active || !Main.tileSolid[Main.tile[x - 1, y].type]) || (Main.tileSolidTop[Main.tile[x - 1, y].type] || Main.tileNoAttach[Main.tile[x - 1, y].type])) || ((!Main.tile[x - 1, y + 1].active || !Main.tileSolid[Main.tile[x - 1, y + 1].type]) || (Main.tileSolidTop[Main.tile[x - 1, y + 1].type] || Main.tileNoAttach[Main.tile[x - 1, y + 1].type])))
                        {
                            if (((!Main.tile[x + 1, y].active || !Main.tileSolid[Main.tile[x + 1, y].type]) || (Main.tileSolidTop[Main.tile[x + 1, y].type] || Main.tileNoAttach[Main.tile[x + 1, y].type])) || ((!Main.tile[x + 1, y + 1].active || !Main.tileSolid[Main.tile[x + 1, y + 1].type]) || (Main.tileSolidTop[Main.tile[x + 1, y + 1].type] || Main.tileNoAttach[Main.tile[x + 1, y + 1].type])))
                            {
                                return false;
                            }
                            num7--;
                            num9 = 3;
                        }
                        else
                        {
                            num9 = 2;
                        }
                    }
                    else
                    {
                        num9 = 1;
                    }
                }
                else
                {
                    num8--;
                    num9 = 0;
                }
            }
            else if (type == 0x55)
            {
                if ((!Main.tile[x, y + 1].active || !Main.tileSolid[Main.tile[x, y + 1].type]) || (!Main.tile[x + 1, y + 1].active || !Main.tileSolid[Main.tile[x + 1, y + 1].type]))
                {
                    return false;
                }
                num8--;
                num9 = 0;
            }
            if ((Main.tile[num7, num8].active || Main.tile[num7 + 1, num8].active) || (Main.tile[num7, num8 + 1].active || Main.tile[num7 + 1, num8 + 1].active))
            {
                return false;
            }
            int num10 = 0x24 * num9;
            for (int j = 0; j < 2; j++)
            {
                for (int m = 0; m < 2; m++)
                {
                    Main.tile[num7 + j, num8 + m].active = true;
                    Main.tile[num7 + j, num8 + m].type = (byte) type;
                    Main.tile[num7 + j, num8 + m].frameX = (short) (num10 + (0x12 * j));
                    Main.tile[num7 + j, num8 + m].frameY = (short) (0x12 * m);
                }
            }
            return true;
        }

        public static void PlaceSunflower(int x, int y, int type = 0x1b)
        {
            if (y <= (Main.worldSurface - 1.0))
            {
                bool flag = true;
                for (int i = x; i < (x + 2); i++)
                {
                    for (int j = y - 3; j < (y + 1); j++)
                    {
                        if (Main.tile[i, j] == null)
                        {
                            Main.tile[i, j] = new Tile();
                        }
                        if (Main.tile[i, j].active || (Main.tile[i, j].wall > 0))
                        {
                            flag = false;
                        }
                    }
                    if (Main.tile[i, y + 1] == null)
                    {
                        Main.tile[i, y + 1] = new Tile();
                    }
                    if (!Main.tile[i, y + 1].active || ((Main.tile[i, y + 1].type != 2) && (Main.tile[i, y + 1].type != 0x6d)))
                    {
                        flag = false;
                    }
                }
                if (flag)
                {
                    for (int k = 0; k < 2; k++)
                    {
                        for (int m = -3; m < 1; m++)
                        {
                            int num5 = (k * 0x12) + (genRand.Next(3) * 0x24);
                            int num6 = (m + 3) * 0x12;
                            Main.tile[x + k, y + m].active = true;
                            Main.tile[x + k, y + m].frameX = (short) num5;
                            Main.tile[x + k, y + m].frameY = (short) num6;
                            Main.tile[x + k, y + m].type = (byte) type;
                        }
                    }
                }
            }
        }

        public static bool PlaceTile(int i, int j, int type, bool mute = false, bool forced = false, int plr = -1, int style = 0)
        {
            if (type >= 0x91)
            {
                return false;
            }
            bool flag = false;
            if (((i >= 0) && (j >= 0)) && ((i < Main.maxTilesX) && (j < Main.maxTilesY)))
            {
                if (Main.tile[i, j] == null)
                {
                    Main.tile[i, j] = new Tile();
                }
                if (((((!forced && !Collision.EmptyTile(i, j, false)) && Main.tileSolid[type]) && (((type != 0x17) || (Main.tile[i, j].type != 0)) || !Main.tile[i, j].active)) && (((type != 2) || (Main.tile[i, j].type != 0)) || !Main.tile[i, j].active)) && (((((type != 0x6d) || (Main.tile[i, j].type != 0)) || !Main.tile[i, j].active) && (((type != 60) || (Main.tile[i, j].type != 0x3b)) || !Main.tile[i, j].active)) && (((type != 70) || (Main.tile[i, j].type != 0x3b)) || !Main.tile[i, j].active)))
                {
                    return flag;
                }
                if ((type == 0x17) && ((Main.tile[i, j].type != 0) || !Main.tile[i, j].active))
                {
                    return false;
                }
                if ((type == 2) && ((Main.tile[i, j].type != 0) || !Main.tile[i, j].active))
                {
                    return false;
                }
                if ((type == 0x6d) && ((Main.tile[i, j].type != 0) || !Main.tile[i, j].active))
                {
                    return false;
                }
                if ((type == 60) && ((Main.tile[i, j].type != 0x3b) || !Main.tile[i, j].active))
                {
                    return false;
                }
                if (type == 0x51)
                {
                    if (Main.tile[i - 1, j] == null)
                    {
                        Main.tile[i - 1, j] = new Tile();
                    }
                    if (Main.tile[i + 1, j] == null)
                    {
                        Main.tile[i + 1, j] = new Tile();
                    }
                    if (Main.tile[i, j - 1] == null)
                    {
                        Main.tile[i, j - 1] = new Tile();
                    }
                    if (Main.tile[i, j + 1] == null)
                    {
                        Main.tile[i, j + 1] = new Tile();
                    }
                    if ((Main.tile[i - 1, j].active || Main.tile[i + 1, j].active) || Main.tile[i, j - 1].active)
                    {
                        return false;
                    }
                    if (!Main.tile[i, j + 1].active || !Main.tileSolid[Main.tile[i, j + 1].type])
                    {
                        return false;
                    }
                }
                if (Main.tile[i, j].liquid > 0)
                {
                    if (type == 4)
                    {
                        if (style != 8)
                        {
                            return false;
                        }
                    }
                    else if ((((type == 3) || (type == 4)) || ((type == 20) || (type == 0x18))) || (((type == 0x1b) || (type == 0x20)) || (((type == 0x33) || (type == 0x45)) || (type == 0x48))))
                    {
                        return false;
                    }
                }
                Main.tile[i, j].frameY = 0;
                Main.tile[i, j].frameX = 0;
                if (((type == 3) || (type == 0x18)) || (type == 110))
                {
                    if ((((j + 1) < Main.maxTilesY) && Main.tile[i, j + 1].active) && ((((Main.tile[i, j + 1].type == 2) && (type == 3)) || ((Main.tile[i, j + 1].type == 0x17) && (type == 0x18))) || (((Main.tile[i, j + 1].type == 0x4e) && (type == 3)) || ((Main.tile[i, j + 1].type == 0x6d) && (type == 110)))))
                    {
                        if ((type == 0x18) && (genRand.Next(13) == 0))
                        {
                            Main.tile[i, j].active = true;
                            Main.tile[i, j].type = 0x20;
                            SquareTileFrame(i, j, true);
                        }
                        else if (Main.tile[i, j + 1].type == 0x4e)
                        {
                            Main.tile[i, j].active = true;
                            Main.tile[i, j].type = (byte) type;
                            Main.tile[i, j].frameX = (short) ((genRand.Next(2) * 0x12) + 0x6c);
                        }
                        else if ((Main.tile[i, j].wall == 0) && (Main.tile[i, j + 1].wall == 0))
                        {
                            if ((genRand.Next(50) == 0) || ((type == 0x18) && (genRand.Next(40) == 0)))
                            {
                                Main.tile[i, j].active = true;
                                Main.tile[i, j].type = (byte) type;
                                Main.tile[i, j].frameX = 0x90;
                            }
                            else if (genRand.Next(0x23) == 0)
                            {
                                Main.tile[i, j].active = true;
                                Main.tile[i, j].type = (byte) type;
                                Main.tile[i, j].frameX = (short) ((genRand.Next(2) * 0x12) + 0x6c);
                            }
                            else
                            {
                                Main.tile[i, j].active = true;
                                Main.tile[i, j].type = (byte) type;
                                Main.tile[i, j].frameX = (short) (genRand.Next(6) * 0x12);
                            }
                        }
                    }
                }
                else if (type == 0x3d)
                {
                    if ((((j + 1) < Main.maxTilesY) && Main.tile[i, j + 1].active) && (Main.tile[i, j + 1].type == 60))
                    {
                        if ((genRand.Next(0x10) == 0) && (j > Main.worldSurface))
                        {
                            Main.tile[i, j].active = true;
                            Main.tile[i, j].type = 0x45;
                            SquareTileFrame(i, j, true);
                        }
                        else if ((genRand.Next(60) == 0) && (j > Main.rockLayer))
                        {
                            Main.tile[i, j].active = true;
                            Main.tile[i, j].type = (byte) type;
                            Main.tile[i, j].frameX = 0x90;
                        }
                        else if ((genRand.Next(0x3e8) == 0) && (j > Main.rockLayer))
                        {
                            Main.tile[i, j].active = true;
                            Main.tile[i, j].type = (byte) type;
                            Main.tile[i, j].frameX = 0xa2;
                        }
                        else if (genRand.Next(15) == 0)
                        {
                            Main.tile[i, j].active = true;
                            Main.tile[i, j].type = (byte) type;
                            Main.tile[i, j].frameX = (short) ((genRand.Next(2) * 0x12) + 0x6c);
                        }
                        else
                        {
                            Main.tile[i, j].active = true;
                            Main.tile[i, j].type = (byte) type;
                            Main.tile[i, j].frameX = (short) (genRand.Next(6) * 0x12);
                        }
                    }
                }
                else if (type == 0x47)
                {
                    if ((((j + 1) < Main.maxTilesY) && Main.tile[i, j + 1].active) && (Main.tile[i, j + 1].type == 70))
                    {
                        Main.tile[i, j].active = true;
                        Main.tile[i, j].type = (byte) type;
                        Main.tile[i, j].frameX = (short) (genRand.Next(5) * 0x12);
                    }
                }
                else if (type == 0x81)
                {
                    if ((SolidTile(i - 1, j) || SolidTile(i + 1, j)) || (SolidTile(i, j - 1) || SolidTile(i, j + 1)))
                    {
                        Main.tile[i, j].active = true;
                        Main.tile[i, j].type = (byte) type;
                        Main.tile[i, j].frameX = (short) (genRand.Next(8) * 0x12);
                        SquareTileFrame(i, j, true);
                    }
                }
                else if (((type == 0x84) || (type == 0x8a)) || ((type == 0x8e) || (type == 0x8f)))
                {
                    Place2x2(i, j, type);
                }
                else if (type == 0x89)
                {
                    Main.tile[i, j].active = true;
                    Main.tile[i, j].type = (byte) type;
                    if (style == 1)
                    {
                        Main.tile[i, j].frameX = 0x12;
                    }
                }
                else if (type == 0x88)
                {
                    if (Main.tile[i - 1, j] == null)
                    {
                        Main.tile[i - 1, j] = new Tile();
                    }
                    if (Main.tile[i + 1, j] == null)
                    {
                        Main.tile[i + 1, j] = new Tile();
                    }
                    if (Main.tile[i, j + 1] == null)
                    {
                        Main.tile[i, j + 1] = new Tile();
                    }
                    if (((Main.tile[i - 1, j].active && ((Main.tileSolid[Main.tile[i - 1, j].type] || (Main.tile[i - 1, j].type == 0x7c)) || (((Main.tile[i - 1, j].type == 5) && (Main.tile[i - 1, j - 1].type == 5)) && (Main.tile[i - 1, j + 1].type == 5)))) || (Main.tile[i + 1, j].active && ((Main.tileSolid[Main.tile[i + 1, j].type] || (Main.tile[i + 1, j].type == 0x7c)) || (((Main.tile[i + 1, j].type == 5) && (Main.tile[i + 1, j - 1].type == 5)) && (Main.tile[i + 1, j + 1].type == 5))))) || (Main.tile[i, j + 1].active && Main.tileSolid[Main.tile[i, j + 1].type]))
                    {
                        Main.tile[i, j].active = true;
                        Main.tile[i, j].type = (byte) type;
                        SquareTileFrame(i, j, true);
                    }
                }
                else if (type == 4)
                {
                    if (Main.tile[i - 1, j] == null)
                    {
                        Main.tile[i - 1, j] = new Tile();
                    }
                    if (Main.tile[i + 1, j] == null)
                    {
                        Main.tile[i + 1, j] = new Tile();
                    }
                    if (Main.tile[i, j + 1] == null)
                    {
                        Main.tile[i, j + 1] = new Tile();
                    }
                    if (((Main.tile[i - 1, j].active && ((Main.tileSolid[Main.tile[i - 1, j].type] || (Main.tile[i - 1, j].type == 0x7c)) || (((Main.tile[i - 1, j].type == 5) && (Main.tile[i - 1, j - 1].type == 5)) && (Main.tile[i - 1, j + 1].type == 5)))) || (Main.tile[i + 1, j].active && ((Main.tileSolid[Main.tile[i + 1, j].type] || (Main.tile[i + 1, j].type == 0x7c)) || (((Main.tile[i + 1, j].type == 5) && (Main.tile[i + 1, j - 1].type == 5)) && (Main.tile[i + 1, j + 1].type == 5))))) || (Main.tile[i, j + 1].active && Main.tileSolid[Main.tile[i, j + 1].type]))
                    {
                        Main.tile[i, j].active = true;
                        Main.tile[i, j].type = (byte) type;
                        Main.tile[i, j].frameY = (short) (0x16 * style);
                        SquareTileFrame(i, j, true);
                    }
                }
                else if (type == 10)
                {
                    if (Main.tile[i, j - 1] == null)
                    {
                        Main.tile[i, j - 1] = new Tile();
                    }
                    if (Main.tile[i, j - 2] == null)
                    {
                        Main.tile[i, j - 2] = new Tile();
                    }
                    if (Main.tile[i, j - 3] == null)
                    {
                        Main.tile[i, j - 3] = new Tile();
                    }
                    if (Main.tile[i, j + 1] == null)
                    {
                        Main.tile[i, j + 1] = new Tile();
                    }
                    if (Main.tile[i, j + 2] == null)
                    {
                        Main.tile[i, j + 2] = new Tile();
                    }
                    if (Main.tile[i, j + 3] == null)
                    {
                        Main.tile[i, j + 3] = new Tile();
                    }
                    if ((Main.tile[i, j - 1].active || Main.tile[i, j - 2].active) || (!Main.tile[i, j - 3].active || !Main.tileSolid[Main.tile[i, j - 3].type]))
                    {
                        if ((Main.tile[i, j + 1].active || Main.tile[i, j + 2].active) || (!Main.tile[i, j + 3].active || !Main.tileSolid[Main.tile[i, j + 3].type]))
                        {
                            return false;
                        }
                        PlaceDoor(i, j + 1, type);
                        SquareTileFrame(i, j, true);
                    }
                    else
                    {
                        PlaceDoor(i, j - 1, type);
                        SquareTileFrame(i, j, true);
                    }
                }
                else if (type == 0x80)
                {
                    PlaceMan(i, j, style);
                    SquareTileFrame(i, j, true);
                }
                else if (type == 0x8b)
                {
                    PlaceMB(i, j, type, style);
                    SquareTileFrame(i, j, true);
                }
                else if (((type == 0x22) || (type == 0x23)) || ((type == 0x24) || (type == 0x6a)))
                {
                    Place3x3(i, j, type);
                    SquareTileFrame(i, j, true);
                }
                else if (((type == 13) || (type == 0x21)) || (((type == 0x31) || (type == 50)) || (type == 0x4e)))
                {
                    PlaceOnTable1x1(i, j, type, style);
                    SquareTileFrame(i, j, true);
                }
                else if ((((type == 14) || (type == 0x1a)) || ((type == 0x56) || (type == 0x57))) || (((type == 0x58) || (type == 0x59)) || (type == 0x72)))
                {
                    Place3x2(i, j, type);
                    SquareTileFrame(i, j, true);
                }
                else if (type == 20)
                {
                    if (Main.tile[i, j + 1] == null)
                    {
                        Main.tile[i, j + 1] = new Tile();
                    }
                    if (Main.tile[i, j + 1].active && ((Main.tile[i, j + 1].type == 2) || (Main.tile[i, j + 1].type == 0x6d)))
                    {
                        Place1x2(i, j, type, style);
                        SquareTileFrame(i, j, true);
                    }
                }
                else if (type == 15)
                {
                    if (Main.tile[i, j - 1] == null)
                    {
                        Main.tile[i, j - 1] = new Tile();
                    }
                    if (Main.tile[i, j] == null)
                    {
                        Main.tile[i, j] = new Tile();
                    }
                    Place1x2(i, j, type, style);
                    SquareTileFrame(i, j, true);
                }
                else if (((type == 0x10) || (type == 0x12)) || (((type == 0x1d) || (type == 0x67)) || (type == 0x86)))
                {
                    Place2x1(i, j, type);
                    SquareTileFrame(i, j, true);
                }
                else if ((type == 0x5c) || (type == 0x5d))
                {
                    Place1xX(i, j, type, 0);
                    SquareTileFrame(i, j, true);
                }
                else if ((type == 0x68) || (type == 0x69))
                {
                    Place2xX(i, j, type, style);
                    SquareTileFrame(i, j, true);
                }
                else if (((type == 0x11) || (type == 0x4d)) || (type == 0x85))
                {
                    Place3x2(i, j, type);
                    SquareTileFrame(i, j, true);
                }
                else if (type == 0x15)
                {
                    PlaceChest(i, j, type, false, style);
                    SquareTileFrame(i, j, true);
                }
                else if (type == 0x5b)
                {
                    PlaceBanner(i, j, type, style);
                    SquareTileFrame(i, j, true);
                }
                else if (((type == 0x87) || (type == 0x8d)) || (type == 0x90))
                {
                    Place1x1(i, j, type, style);
                    SquareTileFrame(i, j, true);
                }
                else if ((type == 0x65) || (type == 0x66))
                {
                    Place3x4(i, j, type);
                    SquareTileFrame(i, j, true);
                }
                else if (type == 0x1b)
                {
                    PlaceSunflower(i, j, 0x1b);
                    SquareTileFrame(i, j, true);
                }
                else if (type == 0x1c)
                {
                    PlacePot(i, j, 0x1c);
                    SquareTileFrame(i, j, true);
                }
                else if (type == 0x2a)
                {
                    Place1x2Top(i, j, type);
                    SquareTileFrame(i, j, true);
                }
                else if ((type == 0x37) || (type == 0x55))
                {
                    PlaceSign(i, j, type);
                }
                else if (Main.tileAlch[type])
                {
                    PlaceAlch(i, j, style);
                }
                else if ((((type == 0x5e) || (type == 0x5f)) || ((type == 0x60) || (type == 0x61))) || (((type == 0x62) || (type == 0x63)) || (((type == 100) || (type == 0x7d)) || (type == 0x7e))))
                {
                    Place2x2(i, j, type);
                }
                else if ((type == 0x4f) || (type == 90))
                {
                    int direction = 1;
                    if (plr > -1)
                    {
                        direction = Main.player[plr].direction;
                    }
                    Place4x2(i, j, type, direction);
                }
                else if (type == 0x51)
                {
                    Main.tile[i, j].frameX = (short) (0x1a * genRand.Next(6));
                    Main.tile[i, j].active = true;
                    Main.tile[i, j].type = (byte) type;
                }
                else
                {
                    Main.tile[i, j].active = true;
                    Main.tile[i, j].type = (byte) type;
                }
                if (Main.tile[i, j].active && !mute)
                {
                    SquareTileFrame(i, j, true);
                    flag = true;
                    if (type == 0x7f)
                    {
                        Main.PlaySound(2, i * 0x10, j * 0x10, 30);
                    }
                    else
                    {
                        Main.PlaySound(0, i * 0x10, j * 0x10, 1);
                    }
                    if ((type != 0x16) && (type != 140))
                    {
                        return flag;
                    }
                    for (int k = 0; k < 3; k++)
                    {
                        Color newColor = new Color();
                        Dust.NewDust(new Vector2((float) (i * 0x10), (float) (j * 0x10)), 0x10, 0x10, 14, 0f, 0f, 0, newColor, 1f);
                    }
                }
            }
            return flag;
        }

        public static bool placeTrap(int x2, int y2, int type = -1)
        {
            int i = x2;
            int j = y2;
            while (!SolidTile(i, j))
            {
                j++;
                if (j >= (Main.maxTilesY - 300))
                {
                    return false;
                }
            }
            j--;
            if ((Main.tile[i, j].liquid <= 0) || !Main.tile[i, j].lava)
            {
                if ((type == -1) && (Main.rand.Next(20) == 0))
                {
                    type = 2;
                }
                else if (type == -1)
                {
                    type = Main.rand.Next(2);
                }
                if (((Main.tile[i, j].active || Main.tile[i - 1, j].active) || (Main.tile[i + 1, j].active || Main.tile[i, j - 1].active)) || ((Main.tile[i - 1, j - 1].active || Main.tile[i + 1, j - 1].active) || ((Main.tile[i, j - 2].active || Main.tile[i - 1, j - 2].active) || Main.tile[i + 1, j - 2].active)))
                {
                    return false;
                }
                if (Main.tile[i, j + 1].type == 0x30)
                {
                    return false;
                }
                if (type == 0)
                {
                    int num3 = i;
                    int num4 = j;
                    num4 -= genRand.Next(3);
                    while (!SolidTile(num3, num4))
                    {
                        num3--;
                    }
                    int num5 = num3;
                    num3 = i;
                    while (!SolidTile(num3, num4))
                    {
                        num3++;
                    }
                    int num6 = num3;
                    int num7 = i - num5;
                    int num8 = num6 - i;
                    bool flag = false;
                    bool flag2 = false;
                    if ((num7 > 5) && (num7 < 50))
                    {
                        flag = true;
                    }
                    if ((num8 > 5) && (num8 < 50))
                    {
                        flag2 = true;
                    }
                    if (flag && !SolidTile(num5, num4 + 1))
                    {
                        flag = false;
                    }
                    if (flag2 && !SolidTile(num6, num4 + 1))
                    {
                        flag2 = false;
                    }
                    if (flag && (((Main.tile[num5, num4].type == 10) || (Main.tile[num5, num4].type == 0x30)) || ((Main.tile[num5, num4 + 1].type == 10) || (Main.tile[num5, num4 + 1].type == 0x30))))
                    {
                        flag = false;
                    }
                    if (flag2 && (((Main.tile[num6, num4].type == 10) || (Main.tile[num6, num4].type == 0x30)) || ((Main.tile[num6, num4 + 1].type == 10) || (Main.tile[num6, num4 + 1].type == 0x30))))
                    {
                        flag2 = false;
                    }
                    int style = 0;
                    if (flag && flag2)
                    {
                        style = 1;
                        num3 = num5;
                        if (genRand.Next(2) == 0)
                        {
                            num3 = num6;
                            style = -1;
                        }
                    }
                    else if (flag2)
                    {
                        num3 = num6;
                        style = -1;
                    }
                    else if (flag)
                    {
                        num3 = num5;
                        style = 1;
                    }
                    else
                    {
                        return false;
                    }
                    if (Main.tile[i, j].wall > 0)
                    {
                        PlaceTile(i, j, 0x87, true, true, -1, 2);
                    }
                    else
                    {
                        PlaceTile(i, j, 0x87, true, true, -1, genRand.Next(2, 4));
                    }
                    KillTile(num3, num4, false, false, false);
                    PlaceTile(num3, num4, 0x89, true, true, -1, style);
                    int num10 = i;
                    int num11 = j;
                    while ((num10 != num3) || (num11 != num4))
                    {
                        Main.tile[num10, num11].wire = true;
                        if (num10 > num3)
                        {
                            num10--;
                        }
                        if (num10 < num3)
                        {
                            num10++;
                        }
                        Main.tile[num10, num11].wire = true;
                        if (num11 > num4)
                        {
                            num11--;
                        }
                        if (num11 < num4)
                        {
                            num11++;
                        }
                        Main.tile[num10, num11].wire = true;
                    }
                    return true;
                }
                if (type == 1)
                {
                    int num12 = i;
                    int num13 = j - 8;
                    num12 += genRand.Next(-1, 2);
                    bool flag3 = true;
                    while (flag3)
                    {
                        bool flag4 = true;
                        int num14 = 0;
                        for (int n = num12 - 2; n <= (num12 + 3); n++)
                        {
                            for (int num16 = num13; num16 <= (num13 + 3); num16++)
                            {
                                if (!SolidTile(n, num16))
                                {
                                    flag4 = false;
                                }
                                if (Main.tile[n, num16].active && (((Main.tile[n, num16].type == 0) || (Main.tile[n, num16].type == 1)) || (Main.tile[n, num16].type == 0x3b)))
                                {
                                    num14++;
                                }
                            }
                        }
                        num13--;
                        if (num13 < Main.worldSurface)
                        {
                            return false;
                        }
                        if (flag4 && (num14 > 2))
                        {
                            flag3 = false;
                        }
                    }
                    if (((j - num13) <= 5) || ((j - num13) >= 40))
                    {
                        return false;
                    }
                    for (int k = num12; k <= (num12 + 1); k++)
                    {
                        for (int num18 = num13; num18 <= j; num18++)
                        {
                            if (SolidTile(k, num18))
                            {
                                KillTile(k, num18, false, false, false);
                            }
                        }
                    }
                    for (int m = num12 - 2; m <= (num12 + 3); m++)
                    {
                        for (int num20 = num13 - 2; num20 <= (num13 + 3); num20++)
                        {
                            if (SolidTile(m, num20))
                            {
                                Main.tile[m, num20].type = 1;
                            }
                        }
                    }
                    PlaceTile(i, j, 0x87, true, true, -1, genRand.Next(2, 4));
                    PlaceTile(num12, num13 + 2, 130, true, false, -1, 0);
                    PlaceTile(num12 + 1, num13 + 2, 130, true, false, -1, 0);
                    PlaceTile(num12 + 1, num13 + 1, 0x8a, true, false, -1, 0);
                    num13 += 2;
                    Main.tile[num12, num13].wire = true;
                    Main.tile[num12 + 1, num13].wire = true;
                    num13++;
                    PlaceTile(num12, num13, 130, true, false, -1, 0);
                    PlaceTile(num12 + 1, num13, 130, true, false, -1, 0);
                    Main.tile[num12, num13].wire = true;
                    Main.tile[num12 + 1, num13].wire = true;
                    PlaceTile(num12, num13 + 1, 130, true, false, -1, 0);
                    PlaceTile(num12 + 1, num13 + 1, 130, true, false, -1, 0);
                    Main.tile[num12, num13 + 1].wire = true;
                    Main.tile[num12 + 1, num13 + 1].wire = true;
                    int num21 = i;
                    int num22 = j;
                    while ((num21 != num12) || (num22 != num13))
                    {
                        Main.tile[num21, num22].wire = true;
                        if (num21 > num12)
                        {
                            num21--;
                        }
                        if (num21 < num12)
                        {
                            num21++;
                        }
                        Main.tile[num21, num22].wire = true;
                        if (num22 > num13)
                        {
                            num22--;
                        }
                        if (num22 < num13)
                        {
                            num22++;
                        }
                        Main.tile[num21, num22].wire = true;
                    }
                    return true;
                }
                if (type == 2)
                {
                    int num23 = Main.rand.Next(4, 7);
                    int num24 = i;
                    num24 += Main.rand.Next(-1, 2);
                    int num25 = j;
                    for (int num26 = 0; num26 < num23; num26++)
                    {
                        num25++;
                        if (!SolidTile(num24, num25))
                        {
                            return false;
                        }
                    }
                    for (int num27 = num24 - 2; num27 <= (num24 + 2); num27++)
                    {
                        for (int num28 = num25 - 2; num28 <= (num25 + 2); num28++)
                        {
                            if (!SolidTile(num27, num28))
                            {
                                return false;
                            }
                        }
                    }
                    KillTile(num24, num25, false, false, false);
                    Main.tile[num24, num25].active = true;
                    Main.tile[num24, num25].type = 0x8d;
                    Main.tile[num24, num25].frameX = 0;
                    Main.tile[num24, num25].frameY = (short) (0x12 * Main.rand.Next(2));
                    PlaceTile(i, j, 0x87, true, true, -1, genRand.Next(2, 4));
                    int num29 = i;
                    int num30 = j;
                    while ((num29 != num24) || (num30 != num25))
                    {
                        Main.tile[num29, num30].wire = true;
                        if (num29 > num24)
                        {
                            num29--;
                        }
                        if (num29 < num24)
                        {
                            num29++;
                        }
                        Main.tile[num29, num30].wire = true;
                        if (num30 > num25)
                        {
                            num30--;
                        }
                        if (num30 < num25)
                        {
                            num30++;
                        }
                        Main.tile[num29, num30].wire = true;
                    }
                }
            }
            return false;
        }

        public static void PlaceWall(int i, int j, int type, bool mute = false)
        {
            if (((i > 1) && (j > 1)) && ((i < (Main.maxTilesX - 2)) && (j < (Main.maxTilesY - 2))))
            {
                if (Main.tile[i, j] == null)
                {
                    Main.tile[i, j] = new Tile();
                }
                if (Main.tile[i, j].wall == 0)
                {
                    Main.tile[i, j].wall = (byte) type;
                    SquareWallFrame(i, j, true);
                    if (!mute)
                    {
                        Main.PlaySound(0, i * 0x10, j * 0x10, 1);
                    }
                }
            }
        }

        public static bool PlaceWire(int i, int j)
        {
            if (!Main.tile[i, j].wire)
            {
                Main.PlaySound(0, i * 0x10, j * 0x10, 1);
                Main.tile[i, j].wire = true;
                return true;
            }
            return false;
        }

        public static void PlantAlch()
        {
            int x = genRand.Next(20, Main.maxTilesX - 20);
            int num2 = 0;
            if (genRand.Next(40) == 0)
            {
                num2 = genRand.Next((((int) Main.rockLayer) + Main.maxTilesY) / 2, Main.maxTilesY - 20);
            }
            else if (genRand.Next(10) == 0)
            {
                num2 = genRand.Next(0, Main.maxTilesY - 20);
            }
            else
            {
                num2 = genRand.Next((int) Main.worldSurface, Main.maxTilesY - 20);
            }
            while ((num2 < (Main.maxTilesY - 20)) && !Main.tile[x, num2].active)
            {
                num2++;
            }
            if ((Main.tile[x, num2].active && !Main.tile[x, num2 - 1].active) && (Main.tile[x, num2 - 1].liquid == 0))
            {
                if ((Main.tile[x, num2].type == 2) || (Main.tile[x, num2].type == 0x6d))
                {
                    PlaceAlch(x, num2 - 1, 0);
                }
                if (Main.tile[x, num2].type == 60)
                {
                    PlaceAlch(x, num2 - 1, 1);
                }
                if ((Main.tile[x, num2].type == 0) || (Main.tile[x, num2].type == 0x3b))
                {
                    PlaceAlch(x, num2 - 1, 2);
                }
                if ((Main.tile[x, num2].type == 0x17) || (Main.tile[x, num2].type == 0x19))
                {
                    PlaceAlch(x, num2 - 1, 3);
                }
                if ((Main.tile[x, num2].type == 0x35) || (Main.tile[x, num2].type == 0x74))
                {
                    PlaceAlch(x, num2 - 1, 4);
                }
                if (Main.tile[x, num2].type == 0x39)
                {
                    PlaceAlch(x, num2 - 1, 5);
                }
                if (Main.tile[x, num2 - 1].active && (Main.netMode == 2))
                {
                    NetMessage.SendTileSquare(-1, x, num2 - 1, 1);
                }
            }
        }

        public static void PlantCactus(int i, int j)
        {
            GrowCactus(i, j);
            for (int k = 0; k < 150; k++)
            {
                int num2 = genRand.Next(i - 1, i + 2);
                int num3 = genRand.Next(j - 10, j + 2);
                GrowCactus(num2, num3);
            }
        }

        public static void PlantCheck(int i, int j)
        {
            int num = -1;
            int type = Main.tile[i, j].type;
            int num1 = i - 1;
            int maxTilesX = Main.maxTilesX;
            int num4 = i + 1;
            int num5 = j - 1;
            if ((j + 1) >= Main.maxTilesY)
            {
                num = type;
            }
            if ((((i - 1) >= 0) && (Main.tile[i - 1, j] != null)) && Main.tile[i - 1, j].active)
            {
                byte num6 = Main.tile[i - 1, j].type;
            }
            if ((((i + 1) < Main.maxTilesX) && (Main.tile[i + 1, j] != null)) && Main.tile[i + 1, j].active)
            {
                byte num7 = Main.tile[i + 1, j].type;
            }
            if ((((j - 1) >= 0) && (Main.tile[i, j - 1] != null)) && Main.tile[i, j - 1].active)
            {
                byte num8 = Main.tile[i, j - 1].type;
            }
            if ((((j + 1) < Main.maxTilesY) && (Main.tile[i, j + 1] != null)) && Main.tile[i, j + 1].active)
            {
                num = Main.tile[i, j + 1].type;
            }
            if ((((i - 1) >= 0) && ((j - 1) >= 0)) && ((Main.tile[i - 1, j - 1] != null) && Main.tile[i - 1, j - 1].active))
            {
                byte num9 = Main.tile[i - 1, j - 1].type;
            }
            if ((((i + 1) < Main.maxTilesX) && ((j - 1) >= 0)) && ((Main.tile[i + 1, j - 1] != null) && Main.tile[i + 1, j - 1].active))
            {
                byte num10 = Main.tile[i + 1, j - 1].type;
            }
            if ((((i - 1) >= 0) && ((j + 1) < Main.maxTilesY)) && ((Main.tile[i - 1, j + 1] != null) && Main.tile[i - 1, j + 1].active))
            {
                byte num11 = Main.tile[i - 1, j + 1].type;
            }
            if ((((i + 1) < Main.maxTilesX) && ((j + 1) < Main.maxTilesY)) && ((Main.tile[i + 1, j + 1] != null) && Main.tile[i + 1, j + 1].active))
            {
                byte num12 = Main.tile[i + 1, j + 1].type;
            }
            if ((((((type == 3) && (num != 2)) && (num != 0x4e)) || ((type == 0x18) && (num != 0x17))) || (((type == 0x3d) && (num != 60)) || ((type == 0x47) && (num != 70)))) || (((((type == 0x49) && (num != 2)) && (num != 0x4e)) || ((type == 0x4a) && (num != 60))) || (((type == 110) && (num != 0x6d)) || ((type == 0x71) && (num != 0x6d)))))
            {
                if (num == 0x17)
                {
                    type = 0x18;
                    if (Main.tile[i, j].frameX >= 0xa2)
                    {
                        Main.tile[i, j].frameX = 0x7e;
                    }
                }
                else if (num == 2)
                {
                    if (type == 0x71)
                    {
                        type = 0x49;
                    }
                    else
                    {
                        type = 3;
                    }
                }
                else if (num == 0x6d)
                {
                    if (type == 0x49)
                    {
                        type = 0x71;
                    }
                    else
                    {
                        type = 110;
                    }
                }
                if (type != Main.tile[i, j].type)
                {
                    Main.tile[i, j].type = (byte) type;
                }
                else
                {
                    KillTile(i, j, false, false, false);
                }
            }
        }

        public static bool PlayerLOS(int x, int y)
        {
            Rectangle rectangle = new Rectangle(x * 0x10, y * 0x10, 0x10, 0x10);
            for (int i = 0; i < 0xff; i++)
            {
                if (Main.player[i].active)
                {
                    Rectangle rectangle2 = new Rectangle((int) ((Main.player[i].position.X + (Main.player[i].width * 0.5)) - (NPC.sWidth * 0.6)), (int) ((Main.player[i].position.Y + (Main.player[i].height * 0.5)) - (NPC.sHeight * 0.6)), (int) (NPC.sWidth * 1.2), (int) (NPC.sHeight * 1.2));
                    if (rectangle.Intersects(rectangle2))
                    {
                        return true;
                    }
                }
            }
            return false;
        }

        public static void playWorld()
        {
            ThreadPool.QueueUserWorkItem(new WaitCallback(WorldGen.playWorldCallBack), 1);
        }

        public static void playWorldCallBack(object threadContext)
        {
            if (Main.rand == null)
            {
                Main.rand = new Random((int) DateTime.Now.Ticks);
            }
            for (int i = 0; i < 0xff; i++)
            {
                if (i != Main.myPlayer)
                {
                    Main.player[i].active = false;
                }
            }
            loadWorld();
            if (loadFailed || !loadSuccess)
            {
                loadWorld();
                if (loadFailed || !loadSuccess)
                {
                    if (File.Exists(Main.worldPathName + ".bak"))
                    {
                        worldBackup = true;
                    }
                    else
                    {
                        worldBackup = false;
                    }
                    if (!Main.dedServ)
                    {
                        if (worldBackup)
                        {
                            Main.menuMode = 200;
                            return;
                        }
                        Main.menuMode = 0xc9;
                        return;
                    }
                    if (worldBackup)
                    {
                        File.Copy(Main.worldPathName + ".bak", Main.worldPathName, true);
                        File.Delete(Main.worldPathName + ".bak");
                        loadWorld();
                        if (loadFailed || !loadSuccess)
                        {
                            loadWorld();
                            if (loadFailed || !loadSuccess)
                            {
                                Console.WriteLine("Load failed!");
                                return;
                            }
                        }
                    }
                    else
                    {
                        Console.WriteLine("Load failed!  No backup found.");
                        return;
                    }
                }
            }
            EveryTileFrame();
            if (Main.gameMenu)
            {
                Main.gameMenu = false;
            }
            Main.player[Main.myPlayer].Spawn();
            Main.player[Main.myPlayer].UpdatePlayer(Main.myPlayer);
            Main.dayTime = tempDayTime;
            Main.time = tempTime;
            Main.moonPhase = tempMoonPhase;
            Main.bloodMoon = tempBloodMoon;
            Main.PlaySound(11, -1, -1, 1);
            Main.resetClouds = true;
        }

        public static void QuickFindHome(int npc)
        {
            if (((Main.npc[npc].homeTileX > 10) && (Main.npc[npc].homeTileY > 10)) && ((Main.npc[npc].homeTileX < (Main.maxTilesX - 10)) && (Main.npc[npc].homeTileY < Main.maxTilesY)))
            {
                canSpawn = false;
                StartRoomCheck(Main.npc[npc].homeTileX, Main.npc[npc].homeTileY - 1);
                if (!canSpawn)
                {
                    for (int i = Main.npc[npc].homeTileX - 1; i < (Main.npc[npc].homeTileX + 2); i++)
                    {
                        for (int j = Main.npc[npc].homeTileY - 1; j < (Main.npc[npc].homeTileY + 2); j++)
                        {
                            if (StartRoomCheck(i, j))
                            {
                                break;
                            }
                        }
                    }
                }
                if (!canSpawn)
                {
                    int num3 = 10;
                    for (int k = Main.npc[npc].homeTileX - num3; k <= (Main.npc[npc].homeTileX + num3); k += 2)
                    {
                        for (int m = Main.npc[npc].homeTileY - num3; m <= (Main.npc[npc].homeTileY + num3); m += 2)
                        {
                            if (StartRoomCheck(k, m))
                            {
                                break;
                            }
                        }
                    }
                }
                if (canSpawn)
                {
                    RoomNeeds(Main.npc[npc].type);
                    if (canSpawn)
                    {
                        ScoreRoom(npc);
                    }
                    if (canSpawn && (hiScore > 0))
                    {
                        Main.npc[npc].homeTileX = bestX;
                        Main.npc[npc].homeTileY = bestY;
                        Main.npc[npc].homeless = false;
                        canSpawn = false;
                    }
                    else
                    {
                        Main.npc[npc].homeless = true;
                    }
                }
                else
                {
                    Main.npc[npc].homeless = true;
                }
            }
        }

        public static void RangeFrame(int startX, int startY, int endX, int endY)
        {
            int num = startX;
            int num2 = endX + 1;
            int num3 = startY;
            int num4 = endY + 1;
            for (int i = num - 1; i < (num2 + 1); i++)
            {
                for (int j = num3 - 1; j < (num4 + 1); j++)
                {
                    TileFrame(i, j, false, false);
                    WallFrame(i, j, false);
                }
            }
        }

        private static void resetGen()
        {
            mudWall = false;
            hellChest = 0;
            JungleX = 0;
            numMCaves = 0;
            numIslandHouses = 0;
            houseCount = 0;
            dEnteranceX = 0;
            numDRooms = 0;
            numDDoors = 0;
            numDPlats = 0;
            numJChests = 0;
        }

        public static bool RoomNeeds(int npcType)
        {
            roomChair = false;
            roomDoor = false;
            roomTable = false;
            roomTorch = false;
            if ((houseTile[15] || houseTile[0x4f]) || (houseTile[0x59] || houseTile[0x66]))
            {
                roomChair = true;
            }
            if (((houseTile[14] || houseTile[0x12]) || (houseTile[0x57] || houseTile[0x58])) || (houseTile[90] || houseTile[0x65]))
            {
                roomTable = true;
            }
            if (((houseTile[4] || houseTile[0x21]) || (houseTile[0x22] || houseTile[0x23])) || (((houseTile[0x24] || houseTile[0x2a]) || (houseTile[0x31] || houseTile[0x5d])) || ((houseTile[0x5f] || houseTile[0x62]) || houseTile[100])))
            {
                roomTorch = true;
            }
            if ((houseTile[10] || houseTile[11]) || houseTile[0x13])
            {
                roomDoor = true;
            }
            if ((roomChair && roomTable) && (roomDoor && roomTorch))
            {
                canSpawn = true;
            }
            else
            {
                canSpawn = false;
            }
            return canSpawn;
        }

        public static void saveAndPlay()
        {
            ThreadPool.QueueUserWorkItem(new WaitCallback(WorldGen.saveAndPlayCallBack), 1);
        }

        public static void saveAndPlayCallBack(object threadContext)
        {
            saveWorld(false);
        }

        public static void SaveAndQuit()
        {
            Main.PlaySound(11, -1, -1, 1);
            ThreadPool.QueueUserWorkItem(new WaitCallback(WorldGen.SaveAndQuitCallBack), 1);
        }

        public static void SaveAndQuitCallBack(object threadContext)
        {
            Main.menuMode = 10;
            Main.gameMenu = true;
            Player.SavePlayer(Main.player[Main.myPlayer], Main.playerPathName);
            if (Main.netMode == 0)
            {
                saveWorld(false);
                Main.PlaySound(10, -1, -1, 1);
            }
            else
            {
                Netplay.disconnect = true;
                Main.netMode = 0;
            }
            Main.menuMode = 0;
        }

        public static void saveToonWhilePlaying()
        {
            ThreadPool.QueueUserWorkItem(new WaitCallback(WorldGen.saveToonWhilePlayingCallBack), 1);
        }

        public static void saveToonWhilePlayingCallBack(object threadContext)
        {
            Player.SavePlayer(Main.player[Main.myPlayer], Main.playerPathName);
        }

        public static void saveWorld(bool resetTime = false)
        {
            if (Main.worldName == "")
            {
                Main.worldName = "World";
            }
            if (!saveLock)
            {
                saveLock = true;
                while (hardLock)
                {
                    Main.statusText = "Setting hard mode...";
                }
                lock (padlock)
                {
                    try
                    {
                        Directory.CreateDirectory(Main.WorldPath);
                    }
                    catch
                    {
                    }
                    if (!Main.skipMenu)
                    {
                        bool dayTime = Main.dayTime;
                        tempTime = Main.time;
                        tempMoonPhase = Main.moonPhase;
                        tempBloodMoon = Main.bloodMoon;
                        if (resetTime)
                        {
                            dayTime = true;
                            tempTime = 13500.0;
                            tempMoonPhase = 0;
                            tempBloodMoon = false;
                        }
                        if (Main.worldPathName != null)
                        {
                            new Stopwatch().Start();
                            string path = Main.worldPathName + ".sav";
                            using (FileStream stream = new FileStream(path, FileMode.Create))
                            {
                                using (BinaryWriter writer = new BinaryWriter(stream))
                                {
                                    writer.Write(Main.curRelease);
                                    writer.Write(Main.worldName);
                                    writer.Write(Main.worldID);
                                    writer.Write((int) Main.leftWorld);
                                    writer.Write((int) Main.rightWorld);
                                    writer.Write((int) Main.topWorld);
                                    writer.Write((int) Main.bottomWorld);
                                    writer.Write(Main.maxTilesY);
                                    writer.Write(Main.maxTilesX);
                                    writer.Write(Main.spawnTileX);
                                    writer.Write(Main.spawnTileY);
                                    writer.Write(Main.worldSurface);
                                    writer.Write(Main.rockLayer);
                                    writer.Write(tempTime);
                                    writer.Write(dayTime);
                                    writer.Write(tempMoonPhase);
                                    writer.Write(tempBloodMoon);
                                    writer.Write(Main.dungeonX);
                                    writer.Write(Main.dungeonY);
                                    writer.Write(NPC.downedBoss1);
                                    writer.Write(NPC.downedBoss2);
                                    writer.Write(NPC.downedBoss3);
                                    writer.Write(NPC.savedGoblin);
                                    writer.Write(NPC.savedWizard);
                                    writer.Write(NPC.savedMech);
                                    writer.Write(NPC.downedGoblins);
                                    writer.Write(NPC.downedClown);
                                    writer.Write(shadowOrbSmashed);
                                    writer.Write(spawnMeteor);
                                    writer.Write((byte) shadowOrbCount);
                                    writer.Write(altarCount);
                                    writer.Write(Main.hardMode);
                                    writer.Write(Main.invasionDelay);
                                    writer.Write(Main.invasionSize);
                                    writer.Write(Main.invasionType);
                                    writer.Write(Main.invasionX);
                                    for (int i = 0; i < Main.maxTilesX; i++)
                                    {
                                        float num2 = ((float) i) / ((float) Main.maxTilesX);
                                        Main.statusText = "Saving world data: " + ((int) ((num2 * 100f) + 1f)) + "%";
                                        for (int n = 0; n < Main.maxTilesY; n++)
                                        {
                                            if ((Main.tile[i, n].type == 0x7f) && Main.tile[i, n].active)
                                            {
                                                KillTile(i, n, false, false, false);
                                                KillTile(i, n, false, false, false);
                                                if (!Main.tile[i, n].active && (Main.netMode != 0))
                                                {
                                                    NetMessage.SendData(0x11, -1, -1, "", 0, (float) i, (float) n, 0f, 0);
                                                }
                                            }
                                            Tile tile = (Tile) Main.tile[i, n].Clone();
                                            writer.Write(tile.active);
                                            if (tile.active)
                                            {
                                                writer.Write(tile.type);
                                                if (Main.tileFrameImportant[tile.type])
                                                {
                                                    writer.Write(tile.frameX);
                                                    writer.Write(tile.frameY);
                                                }
                                            }
                                            if (Main.tile[i, n].wall > 0)
                                            {
                                                writer.Write(true);
                                                writer.Write(tile.wall);
                                            }
                                            else
                                            {
                                                writer.Write(false);
                                            }
                                            if (tile.liquid > 0)
                                            {
                                                writer.Write(true);
                                                writer.Write(tile.liquid);
                                                writer.Write(tile.lava);
                                            }
                                            else
                                            {
                                                writer.Write(false);
                                            }
                                            writer.Write(tile.wire);
                                            int num4 = 1;
                                            while (((n + num4) < Main.maxTilesY) && tile.isTheSameAs(Main.tile[i, n + num4]))
                                            {
                                                num4++;
                                            }
                                            num4--;
                                            writer.Write((short) num4);
                                            n += num4;
                                        }
                                    }
                                    for (int j = 0; j < 0x3e8; j++)
                                    {
                                        if (Main.chest[j] == null)
                                        {
                                            writer.Write(false);
                                        }
                                        else
                                        {
                                            Chest chest = (Chest) Main.chest[j].Clone();
                                            writer.Write(true);
                                            writer.Write(chest.x);
                                            writer.Write(chest.y);
                                            for (int num6 = 0; num6 < Chest.maxItems; num6++)
                                            {
                                                if (chest.item[num6].type == 0)
                                                {
                                                    chest.item[num6].stack = 0;
                                                }
                                                writer.Write((byte) chest.item[num6].stack);
                                                if (chest.item[num6].stack > 0)
                                                {
                                                    writer.Write(chest.item[num6].name);
                                                    writer.Write(chest.item[num6].prefix);
                                                }
                                            }
                                        }
                                    }
                                    for (int k = 0; k < 0x3e8; k++)
                                    {
                                        if ((Main.sign[k] == null) || (Main.sign[k].text == null))
                                        {
                                            writer.Write(false);
                                        }
                                        else
                                        {
                                            Sign sign = (Sign) Main.sign[k].Clone();
                                            writer.Write(true);
                                            writer.Write(sign.text);
                                            writer.Write(sign.x);
                                            writer.Write(sign.y);
                                        }
                                    }
                                    for (int m = 0; m < 200; m++)
                                    {
                                        NPC npc = (NPC) Main.npc[m].Clone();
                                        if (npc.active && npc.townNPC)
                                        {
                                            writer.Write(true);
                                            writer.Write(npc.name);
                                            writer.Write(npc.position.X);
                                            writer.Write(npc.position.Y);
                                            writer.Write(npc.homeless);
                                            writer.Write(npc.homeTileX);
                                            writer.Write(npc.homeTileY);
                                        }
                                    }
                                    writer.Write(false);
                                    writer.Write(Main.chrName[0x11]);
                                    writer.Write(Main.chrName[0x12]);
                                    writer.Write(Main.chrName[0x13]);
                                    writer.Write(Main.chrName[20]);
                                    writer.Write(Main.chrName[0x16]);
                                    writer.Write(Main.chrName[0x36]);
                                    writer.Write(Main.chrName[0x26]);
                                    writer.Write(Main.chrName[0x6b]);
                                    writer.Write(Main.chrName[0x6c]);
                                    writer.Write(Main.chrName[0x7c]);
                                    writer.Write(true);
                                    writer.Write(Main.worldName);
                                    writer.Write(Main.worldID);
                                    writer.Close();
                                    stream.Close();
                                    if (File.Exists(Main.worldPathName))
                                    {
                                        Main.statusText = "Backing up world file...";
                                        string destFileName = Main.worldPathName + ".bak";
                                        File.Copy(Main.worldPathName, destFileName, true);
                                    }
                                    File.Copy(path, Main.worldPathName, true);
                                    File.Delete(path);
                                }
                            }
                            saveLock = false;
                        }
                    }
                }
            }
        }

        public static void ScoreRoom(int ignoreNPC = -1)
        {
            roomOccupied = false;
            roomEvil = false;
            for (int i = 0; i < 200; i++)
            {
                if ((Main.npc[i].active && Main.npc[i].townNPC) && ((ignoreNPC != i) && !Main.npc[i].homeless))
                {
                    for (int k = 0; k < numRoomTiles; k++)
                    {
                        if ((Main.npc[i].homeTileX == roomX[k]) && (Main.npc[i].homeTileY == roomY[k]))
                        {
                            bool flag = false;
                            for (int m = 0; m < numRoomTiles; m++)
                            {
                                if ((Main.npc[i].homeTileX == roomX[m]) && ((Main.npc[i].homeTileY - 1) == roomY[m]))
                                {
                                    flag = true;
                                    break;
                                }
                            }
                            if (flag)
                            {
                                roomOccupied = true;
                                hiScore = -1;
                                return;
                            }
                        }
                    }
                }
            }
            hiScore = 0;
            int num4 = 0;
            int num5 = 0;
            int num6 = 0;
            int num7 = ((roomX1 - ((Main.zoneX / 2) / 0x10)) - 1) - Lighting.offScreenTiles;
            int num8 = ((roomX2 + ((Main.zoneX / 2) / 0x10)) + 1) + Lighting.offScreenTiles;
            int num9 = ((roomY1 - ((Main.zoneY / 2) / 0x10)) - 1) - Lighting.offScreenTiles;
            int maxTilesX = ((roomY2 + ((Main.zoneY / 2) / 0x10)) + 1) + Lighting.offScreenTiles;
            if (num7 < 0)
            {
                num7 = 0;
            }
            if (num8 >= Main.maxTilesX)
            {
                num8 = Main.maxTilesX - 1;
            }
            if (num9 < 0)
            {
                num9 = 0;
            }
            if (maxTilesX > Main.maxTilesX)
            {
                maxTilesX = Main.maxTilesX;
            }
            for (int j = num7 + 1; j < num8; j++)
            {
                for (int n = num9 + 2; n < (maxTilesX + 2); n++)
                {
                    if (Main.tile[j, n].active)
                    {
                        if (((Main.tile[j, n].type == 0x17) || (Main.tile[j, n].type == 0x18)) || (((Main.tile[j, n].type == 0x19) || (Main.tile[j, n].type == 0x20)) || (Main.tile[j, n].type == 0x70)))
                        {
                            num6++;
                        }
                        else if (Main.tile[j, n].type == 0x1b)
                        {
                            num6 -= 5;
                        }
                        else if (((Main.tile[j, n].type == 0x6d) || (Main.tile[j, n].type == 110)) || ((Main.tile[j, n].type == 0x71) || (Main.tile[j, n].type == 0x74)))
                        {
                            num6--;
                        }
                    }
                }
            }
            if (num6 < 50)
            {
                num6 = 0;
            }
            num5 = -num6;
            if (num5 <= -250)
            {
                hiScore = num5;
                roomEvil = true;
            }
            else
            {
                num7 = roomX1;
                num8 = roomX2;
                num9 = roomY1;
                maxTilesX = roomY2;
                for (int num13 = num7 + 1; num13 < num8; num13++)
                {
                    for (int num14 = num9 + 2; num14 < (maxTilesX + 2); num14++)
                    {
                        if (!Main.tile[num13, num14].active)
                        {
                            continue;
                        }
                        num4 = num5;
                        if (((Main.tileSolid[Main.tile[num13, num14].type] && !Main.tileSolidTop[Main.tile[num13, num14].type]) && (!Collision.SolidTiles(num13 - 1, num13 + 1, num14 - 3, num14 - 1) && Main.tile[num13 - 1, num14].active)) && ((Main.tileSolid[Main.tile[num13 - 1, num14].type] && Main.tile[num13 + 1, num14].active) && Main.tileSolid[Main.tile[num13 + 1, num14].type]))
                        {
                            for (int num15 = num13 - 2; num15 < (num13 + 3); num15++)
                            {
                                for (int num16 = num14 - 4; num16 < num14; num16++)
                                {
                                    if (Main.tile[num15, num16].active)
                                    {
                                        if (num15 == num13)
                                        {
                                            num4 -= 15;
                                        }
                                        else if ((Main.tile[num15, num16].type == 10) || (Main.tile[num15, num16].type == 11))
                                        {
                                            num4 -= 20;
                                        }
                                        else if (Main.tileSolid[Main.tile[num15, num16].type])
                                        {
                                            num4 -= 5;
                                        }
                                        else
                                        {
                                            num4 += 5;
                                        }
                                    }
                                }
                            }
                            if (num4 > hiScore)
                            {
                                bool flag2 = false;
                                for (int num17 = 0; num17 < numRoomTiles; num17++)
                                {
                                    if ((roomX[num17] == num13) && (roomY[num17] == num14))
                                    {
                                        flag2 = true;
                                        break;
                                    }
                                }
                                if (flag2)
                                {
                                    hiScore = num4;
                                    bestX = num13;
                                    bestY = num14;
                                }
                            }
                        }
                    }
                }
            }
        }

        public static void SectionTileFrame(int startX, int startY, int endX, int endY)
        {
            int num = startX * 200;
            int num2 = (endX + 1) * 200;
            int num3 = startY * 150;
            int num4 = (endY + 1) * 150;
            if (num < 1)
            {
                num = 1;
            }
            if (num3 < 1)
            {
                num3 = 1;
            }
            if (num > (Main.maxTilesX - 2))
            {
                num = Main.maxTilesX - 2;
            }
            if (num3 > (Main.maxTilesY - 2))
            {
                num3 = Main.maxTilesY - 2;
            }
            for (int i = num - 1; i < (num2 + 1); i++)
            {
                for (int j = num3 - 1; j < (num4 + 1); j++)
                {
                    if (Main.tile[i, j] == null)
                    {
                        Main.tile[i, j] = new Tile();
                    }
                    TileFrame(i, j, true, true);
                    WallFrame(i, j, true);
                }
            }
        }

        public static void serverLoadWorld()
        {
            ThreadPool.QueueUserWorkItem(new WaitCallback(WorldGen.serverLoadWorldCallBack), 1);
        }

        public static void serverLoadWorldCallBack(object threadContext)
        {
            loadWorld();
            if (loadFailed || !loadSuccess)
            {
                loadWorld();
                if (loadFailed || !loadSuccess)
                {
                    if (File.Exists(Main.worldPathName + ".bak"))
                    {
                        worldBackup = true;
                    }
                    else
                    {
                        worldBackup = false;
                    }
                    if (!Main.dedServ)
                    {
                        if (worldBackup)
                        {
                            Main.menuMode = 200;
                            return;
                        }
                        Main.menuMode = 0xc9;
                        return;
                    }
                    if (worldBackup)
                    {
                        File.Copy(Main.worldPathName + ".bak", Main.worldPathName, true);
                        File.Delete(Main.worldPathName + ".bak");
                        loadWorld();
                        if (loadFailed || !loadSuccess)
                        {
                            loadWorld();
                            if (loadFailed || !loadSuccess)
                            {
                                Console.WriteLine("Load failed!");
                                return;
                            }
                        }
                    }
                    else
                    {
                        Console.WriteLine("Load failed!  No backup found.");
                        return;
                    }
                }
            }
            Main.PlaySound(10, -1, -1, 1);
            Netplay.StartServer();
            Main.dayTime = tempDayTime;
            Main.time = tempTime;
            Main.moonPhase = tempMoonPhase;
            Main.bloodMoon = tempBloodMoon;
        }

        public static void setWorldSize()
        {
            Main.bottomWorld = Main.maxTilesY * 0x10;
            Main.rightWorld = Main.maxTilesX * 0x10;
            Main.maxSectionsX = Main.maxTilesX / 200;
            Main.maxSectionsY = Main.maxTilesY / 150;
        }

        public static void ShroomPatch(int i, int j)
        {
            Vector2 vector;
            Vector2 vector2;
            double num5 = genRand.Next(40, 70);
            double num6 = num5;
            float num7 = genRand.Next(20, 30);
            if (genRand.Next(5) == 0)
            {
                num5 *= 1.5;
                num6 *= 1.5;
                num7 *= 1.2f;
            }
            vector.X = i;
            vector.Y = j - (num7 * 0.3f);
            vector2.X = genRand.Next(-10, 11) * 0.1f;
            vector2.Y = genRand.Next(-20, -10) * 0.1f;
            while ((num5 > 0.0) && (num7 > 0f))
            {
                num5 -= genRand.Next(3);
                num7--;
                int num = (int) (vector.X - (num5 * 0.5));
                int maxTilesX = (int) (vector.X + (num5 * 0.5));
                int num2 = (int) (vector.Y - (num5 * 0.5));
                int maxTilesY = (int) (vector.Y + (num5 * 0.5));
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                num6 = (num5 * genRand.Next(80, 120)) * 0.01;
                for (int k = num; k < maxTilesX; k++)
                {
                    for (int n = num2; n < maxTilesY; n++)
                    {
                        float num10 = Math.Abs((float) (k - vector.X));
                        float num11 = Math.Abs((float) ((n - vector.Y) * 2.3f));
                        if (Math.Sqrt((double) ((num10 * num10) + (num11 * num11))) < (num6 * 0.4))
                        {
                            if (n < (vector.Y + (num6 * 0.02)))
                            {
                                if (Main.tile[k, n].type != 0x3b)
                                {
                                    Main.tile[k, n].active = false;
                                }
                            }
                            else
                            {
                                Main.tile[k, n].type = 0x3b;
                            }
                            Main.tile[k, n].liquid = 0;
                            Main.tile[k, n].lava = false;
                        }
                    }
                }
                vector += vector2;
                vector.X += vector2.X;
                vector2.X += genRand.Next(-10, 11) * 0.05f;
                vector2.Y -= genRand.Next(11) * 0.05f;
                if ((vector2.X > -0.5) && (vector2.X < 0.5))
                {
                    if (vector2.X < 0f)
                    {
                        vector2.X = -0.5f;
                    }
                    else
                    {
                        vector2.X = 0.5f;
                    }
                }
                if (vector2.X > 2f)
                {
                    vector2.X = 1f;
                }
                if (vector2.X < -2f)
                {
                    vector2.X = -1f;
                }
                if (vector2.Y > 1f)
                {
                    vector2.Y = 1f;
                }
                if (vector2.Y < -1f)
                {
                    vector2.Y = -1f;
                }
                for (int m = 0; m < 2; m++)
                {
                    int num14 = ((int) vector.X) + genRand.Next(-20, 20);
                    int num15 = ((int) vector.Y) + genRand.Next(0, 20);
                    while (!Main.tile[num14, num15].active && (Main.tile[num14, num15].type != 0x3b))
                    {
                        num14 = ((int) vector.X) + genRand.Next(-20, 20);
                        num15 = ((int) vector.Y) + genRand.Next(0, 20);
                    }
                    int num16 = genRand.Next(7, 10);
                    int steps = genRand.Next(7, 10);
                    TileRunner(num14, num15, (double) num16, steps, 0x3b, false, 0f, 2f, true, true);
                    if (genRand.Next(3) == 0)
                    {
                        TileRunner(num14, num15, (double) (num16 - 3), steps - 3, -1, false, 0f, 2f, true, true);
                    }
                }
            }
        }

        public static void SmashAltar(int i, int j)
        {
            if ((((Main.netMode != 1) && Main.hardMode) && !noTileActions) && !gen)
            {
                int type = altarCount % 3;
                int num2 = (altarCount / 3) + 1;
                float num3 = Main.maxTilesX / 0x1068;
                int num4 = 1 - type;
                num3 = (num3 * 310f) - (0x55 * type);
                num3 *= 0.85f;
                num3 /= (float) num2;
                switch (type)
                {
                    case 0:
                        if (Main.netMode == 0)
                        {
                            Main.NewText("Your world has been blessed with Cobalt!", 50, 0xff, 130);
                        }
                        else if (Main.netMode == 2)
                        {
                            NetMessage.SendData(0x19, -1, -1, "Your world has been blessed with Cobalt!", 0xff, 50f, 255f, 130f, 0);
                        }
                        type = 0x6b;
                        num3 *= 1.05f;
                        break;

                    case 1:
                        if (Main.netMode == 0)
                        {
                            Main.NewText("Your world has been blessed with Mythril!", 50, 0xff, 130);
                        }
                        else if (Main.netMode == 2)
                        {
                            NetMessage.SendData(0x19, -1, -1, "Your world has been blessed with Mythril!", 0xff, 50f, 255f, 130f, 0);
                        }
                        type = 0x6c;
                        break;

                    default:
                        if (Main.netMode == 0)
                        {
                            Main.NewText("Your world has been blessed with Adamantite!", 50, 0xff, 130);
                        }
                        else if (Main.netMode == 2)
                        {
                            NetMessage.SendData(0x19, -1, -1, "Your world has been blessed with Adamantite!", 0xff, 50f, 255f, 130f, 0);
                        }
                        type = 0x6f;
                        break;
                }
                for (int k = 0; k < num3; k++)
                {
                    int num6 = genRand.Next(100, Main.maxTilesX - 100);
                    double worldSurface = Main.worldSurface;
                    switch (type)
                    {
                        case 0x6c:
                            worldSurface = Main.rockLayer;
                            break;

                        case 0x6f:
                            worldSurface = ((Main.rockLayer + Main.rockLayer) + Main.maxTilesY) / 3.0;
                            break;
                    }
                    int num8 = genRand.Next((int) worldSurface, Main.maxTilesY - 150);
                    OreRunner(num6, num8, (double) genRand.Next(5, 9 + num4), genRand.Next(5, 9 + num4), type);
                }
                int num9 = genRand.Next(3);
                while (num9 != 2)
                {
                    int tileX = genRand.Next(100, Main.maxTilesX - 100);
                    int tileY = genRand.Next(((int) Main.rockLayer) + 50, Main.maxTilesY - 300);
                    if (Main.tile[tileX, tileY].active && (Main.tile[tileX, tileY].type == 1))
                    {
                        if (num9 == 0)
                        {
                            Main.tile[tileX, tileY].type = 0x19;
                        }
                        else
                        {
                            Main.tile[tileX, tileY].type = 0x75;
                        }
                        if (Main.netMode == 2)
                        {
                            NetMessage.SendTileSquare(-1, tileX, tileY, 1);
                        }
                        break;
                    }
                }
                if (Main.netMode != 1)
                {
                    int num12 = Main.rand.Next(2) + 1;
                    for (int m = 0; m < num12; m++)
                    {
                        NPC.SpawnOnPlayer(Player.FindClosest(new Vector2((float) (i * 0x10), (float) (j * 0x10)), 0x10, 0x10), 0x52);
                    }
                }
                altarCount++;
            }
        }

        public static void smCallBack(object threadContext)
        {
            if (!Main.hardMode)
            {
                hardLock = true;
                Main.hardMode = true;
                if (genRand == null)
                {
                    genRand = new Random((int) DateTime.Now.Ticks);
                }
                float num = genRand.Next(300, 400) * 0.001f;
                int i = (int) (Main.maxTilesX * num);
                int num3 = (int) (Main.maxTilesX * (1f - num));
                int num4 = 1;
                if (genRand.Next(2) == 0)
                {
                    num3 = (int) (Main.maxTilesX * num);
                    i = (int) (Main.maxTilesX * (1f - num));
                    num4 = -1;
                }
                GERunner(i, 0, (float) (3 * num4), 5f, true);
                GERunner(num3, 0, (float) (3 * -num4), 5f, false);
                if (Main.netMode == 0)
                {
                    Main.NewText("The ancient spirits of light and dark have been released.", 50, 0xff, 130);
                }
                else if (Main.netMode == 2)
                {
                    NetMessage.SendData(0x19, -1, -1, "The ancient spirits of light and dark have been released.", 0xff, 50f, 255f, 130f, 0);
                }
                if (Main.netMode == 2)
                {
                    Netplay.ResetSections();
                }
                hardLock = false;
            }
        }

        public static bool SolidTile(int i, int j)
        {
            try
            {
                if (Main.tile[i, j] == null)
                {
                    return true;
                }
                if ((Main.tile[i, j].active && Main.tileSolid[Main.tile[i, j].type]) && !Main.tileSolidTop[Main.tile[i, j].type])
                {
                    return true;
                }
            }
            catch
            {
            }
            return false;
        }

        public static void SpawnNPC(int x, int y)
        {
            if (Main.wallHouse[Main.tile[x, y].wall])
            {
                canSpawn = true;
            }
            if ((canSpawn && StartRoomCheck(x, y)) && RoomNeeds(spawnNPC))
            {
                ScoreRoom(-1);
                if (hiScore > 0)
                {
                    int index = -1;
                    for (int i = 0; i < 200; i++)
                    {
                        if ((Main.npc[i].active && Main.npc[i].homeless) && (Main.npc[i].type == spawnNPC))
                        {
                            index = i;
                            break;
                        }
                    }
                    if (index != -1)
                    {
                        spawnNPC = 0;
                        Main.npc[index].homeTileX = WorldGen.bestX;
                        Main.npc[index].homeTileY = WorldGen.bestY;
                        Main.npc[index].homeless = false;
                    }
                    else
                    {
                        int bestX = WorldGen.bestX;
                        int bestY = WorldGen.bestY;
                        bool flag = false;
                        if (!flag)
                        {
                            flag = true;
                            Rectangle rectangle = new Rectangle((((bestX * 0x10) + 8) - (NPC.sWidth / 2)) - NPC.safeRangeX, (((bestY * 0x10) + 8) - (NPC.sHeight / 2)) - NPC.safeRangeY, NPC.sWidth + (NPC.safeRangeX * 2), NPC.sHeight + (NPC.safeRangeY * 2));
                            for (int j = 0; j < 0xff; j++)
                            {
                                if (Main.player[j].active)
                                {
                                    Rectangle rectangle2 = new Rectangle((int) Main.player[j].position.X, (int) Main.player[j].position.Y, Main.player[j].width, Main.player[j].height);
                                    if (rectangle2.Intersects(rectangle))
                                    {
                                        flag = false;
                                        break;
                                    }
                                }
                            }
                        }
                        if (!flag && (bestY <= Main.worldSurface))
                        {
                            for (int k = 1; k < 500; k++)
                            {
                                for (int m = 0; m < 2; m++)
                                {
                                    if (m == 0)
                                    {
                                        bestX = WorldGen.bestX + k;
                                    }
                                    else
                                    {
                                        bestX = WorldGen.bestX - k;
                                    }
                                    if ((bestX > 10) && (bestX < (Main.maxTilesX - 10)))
                                    {
                                        int num8 = WorldGen.bestY - k;
                                        double worldSurface = WorldGen.bestY + k;
                                        if (num8 < 10)
                                        {
                                            num8 = 10;
                                        }
                                        if (worldSurface > Main.worldSurface)
                                        {
                                            worldSurface = Main.worldSurface;
                                        }
                                        for (int n = num8; n < worldSurface; n++)
                                        {
                                            bestY = n;
                                            if (Main.tile[bestX, bestY].active && Main.tileSolid[Main.tile[bestX, bestY].type])
                                            {
                                                if (!Collision.SolidTiles(bestX - 1, bestX + 1, bestY - 3, bestY - 1))
                                                {
                                                    flag = true;
                                                    Rectangle rectangle3 = new Rectangle((((bestX * 0x10) + 8) - (NPC.sWidth / 2)) - NPC.safeRangeX, (((bestY * 0x10) + 8) - (NPC.sHeight / 2)) - NPC.safeRangeY, NPC.sWidth + (NPC.safeRangeX * 2), NPC.sHeight + (NPC.safeRangeY * 2));
                                                    for (int num11 = 0; num11 < 0xff; num11++)
                                                    {
                                                        if (Main.player[num11].active)
                                                        {
                                                            Rectangle rectangle4 = new Rectangle((int) Main.player[num11].position.X, (int) Main.player[num11].position.Y, Main.player[num11].width, Main.player[num11].height);
                                                            if (rectangle4.Intersects(rectangle3))
                                                            {
                                                                flag = false;
                                                                break;
                                                            }
                                                        }
                                                    }
                                                }
                                                break;
                                            }
                                        }
                                    }
                                    if (flag)
                                    {
                                        break;
                                    }
                                }
                                if (flag)
                                {
                                    break;
                                }
                            }
                        }
                        int num12 = NPC.NewNPC(bestX * 0x10, bestY * 0x10, spawnNPC, 1);
                        Main.npc[num12].homeTileX = WorldGen.bestX;
                        Main.npc[num12].homeTileY = WorldGen.bestY;
                        if (bestX < WorldGen.bestX)
                        {
                            Main.npc[num12].direction = 1;
                        }
                        else if (bestX > WorldGen.bestX)
                        {
                            Main.npc[num12].direction = -1;
                        }
                        Main.npc[num12].netUpdate = true;
                        string name = Main.npc[num12].name;
                        if (Main.chrName[Main.npc[num12].type] != "")
                        {
                            name = Main.chrName[Main.npc[num12].type] + " the " + Main.npc[num12].name;
                        }
                        if (Main.netMode == 0)
                        {
                            Main.NewText(name + " has arrived!", 50, 0x7d, 0xff);
                        }
                        else if (Main.netMode == 2)
                        {
                            NetMessage.SendData(0x19, -1, -1, name + " has arrived!", 0xff, 50f, 125f, 255f, 0);
                        }
                    }
                    spawnNPC = 0;
                }
            }
        }

        public static void SpreadGrass(int i, int j, int dirt = 0, int grass = 2, bool repeat = true)
        {
            try
            {
                if ((((Main.tile[i, j].type == dirt) && Main.tile[i, j].active) && ((j >= Main.worldSurface) || (grass != 70))) && ((j < Main.worldSurface) || (dirt != 0)))
                {
                    int num = i - 1;
                    int maxTilesX = i + 2;
                    int num3 = j - 1;
                    int maxTilesY = j + 2;
                    if (num < 0)
                    {
                        num = 0;
                    }
                    if (maxTilesX > Main.maxTilesX)
                    {
                        maxTilesX = Main.maxTilesX;
                    }
                    if (num3 < 0)
                    {
                        num3 = 0;
                    }
                    if (maxTilesY > Main.maxTilesY)
                    {
                        maxTilesY = Main.maxTilesY;
                    }
                    bool flag = true;
                    for (int k = num; k < maxTilesX; k++)
                    {
                        for (int m = num3; m < maxTilesY; m++)
                        {
                            if (!Main.tile[k, m].active || !Main.tileSolid[Main.tile[k, m].type])
                            {
                                flag = false;
                            }
                            if (Main.tile[k, m].lava && (Main.tile[k, m].liquid > 0))
                            {
                                flag = true;
                                goto Label_00F9;
                            }
                        }
                    Label_00F9:;
                    }
                    if (!flag && ((grass != 0x17) || (Main.tile[i, j - 1].type != 0x1b)))
                    {
                        Main.tile[i, j].type = (byte) grass;
                        for (int n = num; n < maxTilesX; n++)
                        {
                            for (int num8 = num3; num8 < maxTilesY; num8++)
                            {
                                if (Main.tile[n, num8].active && (Main.tile[n, num8].type == dirt))
                                {
                                    try
                                    {
                                        if (repeat && (grassSpread < 0x3e8))
                                        {
                                            grassSpread++;
                                            SpreadGrass(n, num8, dirt, grass, true);
                                            grassSpread--;
                                        }
                                    }
                                    catch
                                    {
                                    }
                                }
                            }
                        }
                    }
                }
            }
            catch
            {
            }
        }

        public static void SquareTileFrame(int i, int j, bool resetFrame = true)
        {
            TileFrame(i - 1, j - 1, false, false);
            TileFrame(i - 1, j, false, false);
            TileFrame(i - 1, j + 1, false, false);
            TileFrame(i, j - 1, false, false);
            TileFrame(i, j, resetFrame, false);
            TileFrame(i, j + 1, false, false);
            TileFrame(i + 1, j - 1, false, false);
            TileFrame(i + 1, j, false, false);
            TileFrame(i + 1, j + 1, false, false);
        }

        public static void SquareWallFrame(int i, int j, bool resetFrame = true)
        {
            WallFrame(i - 1, j - 1, false);
            WallFrame(i - 1, j, false);
            WallFrame(i - 1, j + 1, false);
            WallFrame(i, j - 1, false);
            WallFrame(i, j, resetFrame);
            WallFrame(i, j + 1, false);
            WallFrame(i + 1, j - 1, false);
            WallFrame(i + 1, j, false);
            WallFrame(i + 1, j + 1, false);
        }

        public static void StartHardmode()
        {
            if (Main.netMode != 1)
            {
                ThreadPool.QueueUserWorkItem(new WaitCallback(WorldGen.smCallBack), 1);
            }
        }

        public static bool StartRoomCheck(int x, int y)
        {
            roomX1 = x;
            roomX2 = x;
            roomY1 = y;
            roomY2 = y;
            numRoomTiles = 0;
            for (int i = 0; i < 0x91; i++)
            {
                houseTile[i] = false;
            }
            canSpawn = true;
            if (Main.tile[x, y].active && Main.tileSolid[Main.tile[x, y].type])
            {
                canSpawn = false;
            }
            CheckRoom(x, y);
            if (numRoomTiles < 60)
            {
                canSpawn = false;
            }
            return canSpawn;
        }

        public static void SwitchMB(int i, int j)
        {
            int tileX = i;
            int tileY = j;
            int num3 = Main.tile[i, j].frameY / 0x12;
            while (num3 >= 2)
            {
                num3 -= 2;
            }
            int num4 = Main.tile[i, j].frameX / 0x12;
            if (num4 >= 2)
            {
                num4 -= 2;
            }
            tileX = i - num4;
            tileY = j - num3;
            for (int k = tileX; k < (tileX + 2); k++)
            {
                for (int m = tileY; m < (tileY + 2); m++)
                {
                    if (Main.tile[k, m] == null)
                    {
                        Main.tile[k, m] = new Tile();
                    }
                    if (Main.tile[k, m].active && (Main.tile[k, m].type == 0x8b))
                    {
                        if (Main.tile[k, m].frameX < 0x24)
                        {
                            Tile tile1 = Main.tile[k, m];
                            tile1.frameX = (short) (tile1.frameX + 0x24);
                        }
                        else
                        {
                            Tile tile2 = Main.tile[k, m];
                            tile2.frameX = (short) (tile2.frameX - 0x24);
                        }
                        noWireX[numNoWire] = k;
                        noWireY[numNoWire] = m;
                        numNoWire++;
                    }
                }
            }
            NetMessage.SendTileSquare(-1, tileX, tileY, 3);
        }

        public static void TileFrame(int i, int j, bool resetFrame = false, bool noBreak = false)
        {
            try
            {
                if ((((i <= 5) || (j <= 5)) || ((i >= (Main.maxTilesX - 5)) || (j >= (Main.maxTilesY - 5)))) || (Main.tile[i, j] == null))
                {
                    return;
                }
                if (((Main.tile[i, j].liquid > 0) && (Main.netMode != 1)) && !noLiquidCheck)
                {
                    Liquid.AddWater(i, j);
                }
                if (!Main.tile[i, j].active || ((noBreak && Main.tileFrameImportant[Main.tile[i, j].type]) && (Main.tile[i, j].type != 4)))
                {
                    return;
                }
                int type = Main.tile[i, j].type;
                if (Main.tileStone[type])
                {
                    type = 1;
                }
                int frameX = Main.tile[i, j].frameX;
                int frameY = Main.tile[i, j].frameY;
                Rectangle rectangle = new Rectangle(-1, -1, 0, 0);
                if (Main.tileFrameImportant[Main.tile[i, j].type])
                {
                    if (type == 4)
                    {
                        short num4 = 0;
                        if (Main.tile[i, j].frameX >= 0x42)
                        {
                            num4 = 0x42;
                        }
                        int num5 = -1;
                        int num6 = -1;
                        int num7 = -1;
                        int num8 = -1;
                        int num9 = -1;
                        int num10 = -1;
                        int num11 = -1;
                        if ((Main.tile[i, j - 1] != null) && Main.tile[i, j - 1].active)
                        {
                            byte num1 = Main.tile[i, j - 1].type;
                        }
                        if ((Main.tile[i, j + 1] != null) && Main.tile[i, j + 1].active)
                        {
                            num5 = Main.tile[i, j + 1].type;
                        }
                        if ((Main.tile[i - 1, j] != null) && Main.tile[i - 1, j].active)
                        {
                            num6 = Main.tile[i - 1, j].type;
                        }
                        if ((Main.tile[i + 1, j] != null) && Main.tile[i + 1, j].active)
                        {
                            num7 = Main.tile[i + 1, j].type;
                        }
                        if ((Main.tile[i - 1, j + 1] != null) && Main.tile[i - 1, j + 1].active)
                        {
                            num8 = Main.tile[i - 1, j + 1].type;
                        }
                        if ((Main.tile[i + 1, j + 1] != null) && Main.tile[i + 1, j + 1].active)
                        {
                            num9 = Main.tile[i + 1, j + 1].type;
                        }
                        if ((Main.tile[i - 1, j - 1] != null) && Main.tile[i - 1, j - 1].active)
                        {
                            num10 = Main.tile[i - 1, j - 1].type;
                        }
                        if ((Main.tile[i + 1, j - 1] != null) && Main.tile[i + 1, j - 1].active)
                        {
                            num11 = Main.tile[i + 1, j - 1].type;
                        }
                        if (((num5 >= 0) && Main.tileSolid[num5]) && !Main.tileNoAttach[num5])
                        {
                            Main.tile[i, j].frameX = num4;
                        }
                        else if ((((num6 >= 0) && Main.tileSolid[num6]) && !Main.tileNoAttach[num6]) || ((num6 == 0x7c) || (((num6 == 5) && (num10 == 5)) && (num8 == 5))))
                        {
                            Main.tile[i, j].frameX = (short) (0x16 + num4);
                        }
                        else if ((((num7 >= 0) && Main.tileSolid[num7]) && !Main.tileNoAttach[num7]) || ((num7 == 0x7c) || (((num7 == 5) && (num11 == 5)) && (num9 == 5))))
                        {
                            Main.tile[i, j].frameX = (short) (0x2c + num4);
                        }
                        else
                        {
                            KillTile(i, j, false, false, false);
                        }
                    }
                    else if (type == 0x88)
                    {
                        int num12 = -1;
                        int num13 = -1;
                        int num14 = -1;
                        if ((Main.tile[i, j - 1] != null) && Main.tile[i, j - 1].active)
                        {
                            byte num49 = Main.tile[i, j - 1].type;
                        }
                        if ((Main.tile[i, j + 1] != null) && Main.tile[i, j + 1].active)
                        {
                            num12 = Main.tile[i, j + 1].type;
                        }
                        if ((Main.tile[i - 1, j] != null) && Main.tile[i - 1, j].active)
                        {
                            num13 = Main.tile[i - 1, j].type;
                        }
                        if ((Main.tile[i + 1, j] != null) && Main.tile[i + 1, j].active)
                        {
                            num14 = Main.tile[i + 1, j].type;
                        }
                        if (((num12 >= 0) && Main.tileSolid[num12]) && !Main.tileNoAttach[num12])
                        {
                            Main.tile[i, j].frameX = 0;
                        }
                        else if ((((num13 >= 0) && Main.tileSolid[num13]) && !Main.tileNoAttach[num13]) || ((num13 == 0x7c) || (num13 == 5)))
                        {
                            Main.tile[i, j].frameX = 0x12;
                        }
                        else if ((((num14 >= 0) && Main.tileSolid[num14]) && !Main.tileNoAttach[num14]) || ((num14 == 0x7c) || (num14 == 5)))
                        {
                            Main.tile[i, j].frameX = 0x24;
                        }
                        else
                        {
                            KillTile(i, j, false, false, false);
                        }
                    }
                    else if (type == 0x81)
                    {
                        int num15 = -1;
                        int num16 = -1;
                        int num17 = -1;
                        int num18 = -1;
                        if ((Main.tile[i, j - 1] != null) && Main.tile[i, j - 1].active)
                        {
                            num16 = Main.tile[i, j - 1].type;
                        }
                        if ((Main.tile[i, j + 1] != null) && Main.tile[i, j + 1].active)
                        {
                            num15 = Main.tile[i, j + 1].type;
                        }
                        if ((Main.tile[i - 1, j] != null) && Main.tile[i - 1, j].active)
                        {
                            num17 = Main.tile[i - 1, j].type;
                        }
                        if ((Main.tile[i + 1, j] != null) && Main.tile[i + 1, j].active)
                        {
                            num18 = Main.tile[i + 1, j].type;
                        }
                        if (((num15 >= 0) && Main.tileSolid[num15]) && !Main.tileSolidTop[num15])
                        {
                            Main.tile[i, j].frameY = 0;
                        }
                        else if (((num17 >= 0) && Main.tileSolid[num17]) && !Main.tileSolidTop[num17])
                        {
                            Main.tile[i, j].frameY = 0x36;
                        }
                        else if (((num18 >= 0) && Main.tileSolid[num18]) && !Main.tileSolidTop[num18])
                        {
                            Main.tile[i, j].frameY = 0x24;
                        }
                        else if (((num16 >= 0) && Main.tileSolid[num16]) && !Main.tileSolidTop[num16])
                        {
                            Main.tile[i, j].frameY = 0x12;
                        }
                        else
                        {
                            KillTile(i, j, false, false, false);
                        }
                    }
                    else if ((((type == 3) || (type == 0x18)) || ((type == 0x3d) || (type == 0x47))) || (((type == 0x49) || (type == 0x4a)) || ((type == 110) || (type == 0x71))))
                    {
                        PlantCheck(i, j);
                    }
                    else if ((type == 12) || (type == 0x1f))
                    {
                        CheckOrb(i, j, type);
                    }
                    else if (type == 10)
                    {
                        if (!destroyObject)
                        {
                            int num19 = Main.tile[i, j].frameY;
                            int num20 = j;
                            bool flag = false;
                            switch (num19)
                            {
                                case 0:
                                    num20 = j;
                                    break;

                                case 0x12:
                                    num20 = j - 1;
                                    break;

                                case 0x24:
                                    num20 = j - 2;
                                    break;
                            }
                            if (Main.tile[i, num20 - 1] == null)
                            {
                                Main.tile[i, num20 - 1] = new Tile();
                            }
                            if (Main.tile[i, num20 + 3] == null)
                            {
                                Main.tile[i, num20 + 3] = new Tile();
                            }
                            if (Main.tile[i, num20 + 2] == null)
                            {
                                Main.tile[i, num20 + 2] = new Tile();
                            }
                            if (Main.tile[i, num20 + 1] == null)
                            {
                                Main.tile[i, num20 + 1] = new Tile();
                            }
                            if (Main.tile[i, num20] == null)
                            {
                                Main.tile[i, num20] = new Tile();
                            }
                            if (!Main.tile[i, num20 - 1].active || !Main.tileSolid[Main.tile[i, num20 - 1].type])
                            {
                                flag = true;
                            }
                            if (!Main.tile[i, num20 + 3].active || !Main.tileSolid[Main.tile[i, num20 + 3].type])
                            {
                                flag = true;
                            }
                            if (!Main.tile[i, num20].active || (Main.tile[i, num20].type != type))
                            {
                                flag = true;
                            }
                            if (!Main.tile[i, num20 + 1].active || (Main.tile[i, num20 + 1].type != type))
                            {
                                flag = true;
                            }
                            if (!Main.tile[i, num20 + 2].active || (Main.tile[i, num20 + 2].type != type))
                            {
                                flag = true;
                            }
                            if (flag)
                            {
                                destroyObject = true;
                                KillTile(i, num20, false, false, false);
                                KillTile(i, num20 + 1, false, false, false);
                                KillTile(i, num20 + 2, false, false, false);
                                Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x19, 1, false, 0);
                            }
                            destroyObject = false;
                        }
                    }
                    else if (type == 11)
                    {
                        if (!destroyObject)
                        {
                            int num21 = 0;
                            int num22 = i;
                            int num23 = j;
                            int num24 = Main.tile[i, j].frameX;
                            int num25 = Main.tile[i, j].frameY;
                            bool flag2 = false;
                            switch (num24)
                            {
                                case 0:
                                    num22 = i;
                                    num21 = 1;
                                    break;

                                case 0x12:
                                    num22 = i - 1;
                                    num21 = 1;
                                    break;

                                case 0x24:
                                    num22 = i + 1;
                                    num21 = -1;
                                    break;

                                case 0x36:
                                    num22 = i;
                                    num21 = -1;
                                    break;
                            }
                            if (num25 == 0)
                            {
                                num23 = j;
                            }
                            else if (num25 == 0x12)
                            {
                                num23 = j - 1;
                            }
                            else if (num25 == 0x24)
                            {
                                num23 = j - 2;
                            }
                            if (Main.tile[num22, num23 + 3] == null)
                            {
                                Main.tile[num22, num23 + 3] = new Tile();
                            }
                            if (Main.tile[num22, num23 - 1] == null)
                            {
                                Main.tile[num22, num23 - 1] = new Tile();
                            }
                            if ((!Main.tile[num22, num23 - 1].active || !Main.tileSolid[Main.tile[num22, num23 - 1].type]) || (!Main.tile[num22, num23 + 3].active || !Main.tileSolid[Main.tile[num22, num23 + 3].type]))
                            {
                                flag2 = true;
                                destroyObject = true;
                                Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x19, 1, false, 0);
                            }
                            int num26 = num22;
                            if (num21 == -1)
                            {
                                num26 = num22 - 1;
                            }
                            for (int k = num26; k < (num26 + 2); k++)
                            {
                                for (int m = num23; m < (num23 + 3); m++)
                                {
                                    if (!flag2 && ((Main.tile[k, m].type != 11) || !Main.tile[k, m].active))
                                    {
                                        destroyObject = true;
                                        Item.NewItem(i * 0x10, j * 0x10, 0x10, 0x10, 0x19, 1, false, 0);
                                        flag2 = true;
                                        k = num26;
                                        m = num23;
                                    }
                                    if (flag2)
                                    {
                                        KillTile(k, m, false, false, false);
                                    }
                                }
                            }
                            destroyObject = false;
                        }
                    }
                    else if (((type == 0x22) || (type == 0x23)) || ((type == 0x24) || (type == 0x6a)))
                    {
                        Check3x3(i, j, (byte) type);
                    }
                    else if ((type == 15) || (type == 20))
                    {
                        Check1x2(i, j, (byte) type);
                    }
                    else if ((((type == 14) || (type == 0x11)) || ((type == 0x1a) || (type == 0x4d))) || ((((type == 0x56) || (type == 0x57)) || ((type == 0x58) || (type == 0x59))) || ((type == 0x72) || (type == 0x85))))
                    {
                        Check3x2(i, j, (byte) type);
                    }
                    else if (((type == 0x87) || (type == 0x90)) || (type == 0x8d))
                    {
                        Check1x1(i, j, type);
                    }
                    else if (((type == 0x10) || (type == 0x12)) || (((type == 0x1d) || (type == 0x67)) || (type == 0x86)))
                    {
                        Check2x1(i, j, (byte) type);
                    }
                    else if (((type == 13) || (type == 0x21)) || ((type == 50) || (type == 0x4e)))
                    {
                        CheckOnTable1x1(i, j, (byte) type);
                    }
                    else if (type == 0x15)
                    {
                        CheckChest(i, j, (byte) type);
                    }
                    else if (type == 0x80)
                    {
                        CheckMan(i, j);
                    }
                    else if (type == 0x1b)
                    {
                        CheckSunflower(i, j, 0x1b);
                    }
                    else if (type == 0x1c)
                    {
                        CheckPot(i, j, 0x1c);
                    }
                    else if (((type == 0x84) || (type == 0x8a)) || ((type == 0x8e) || (type == 0x8f)))
                    {
                        Check2x2(i, j, type);
                    }
                    else if (type == 0x5b)
                    {
                        CheckBanner(i, j, (byte) type);
                    }
                    else if (type == 0x8b)
                    {
                        CheckMB(i, j, (byte) type);
                    }
                    else if ((type == 0x5c) || (type == 0x5d))
                    {
                        Check1xX(i, j, (byte) type);
                    }
                    else if ((type == 0x68) || (type == 0x69))
                    {
                        Check2xX(i, j, (byte) type);
                    }
                    else if ((type == 0x65) || (type == 0x66))
                    {
                        Check3x4(i, j, (byte) type);
                    }
                    else if (type == 0x2a)
                    {
                        Check1x2Top(i, j, (byte) type);
                    }
                    else if ((type == 0x37) || (type == 0x55))
                    {
                        CheckSign(i, j, type);
                    }
                    else if ((type == 0x4f) || (type == 90))
                    {
                        Check4x2(i, j, type);
                    }
                    else if ((((type == 0x55) || (type == 0x5e)) || ((type == 0x5f) || (type == 0x60))) || ((((type == 0x61) || (type == 0x62)) || ((type == 0x63) || (type == 100))) || ((type == 0x7d) || (type == 0x7e))))
                    {
                        Check2x2(i, j, type);
                    }
                    else if (type == 0x51)
                    {
                        int num29 = -1;
                        int num30 = -1;
                        int num31 = -1;
                        int num32 = -1;
                        if ((Main.tile[i, j - 1] != null) && Main.tile[i, j - 1].active)
                        {
                            num30 = Main.tile[i, j - 1].type;
                        }
                        if ((Main.tile[i, j + 1] != null) && Main.tile[i, j + 1].active)
                        {
                            num29 = Main.tile[i, j + 1].type;
                        }
                        if ((Main.tile[i - 1, j] != null) && Main.tile[i - 1, j].active)
                        {
                            num31 = Main.tile[i - 1, j].type;
                        }
                        if ((Main.tile[i + 1, j] != null) && Main.tile[i + 1, j].active)
                        {
                            num32 = Main.tile[i + 1, j].type;
                        }
                        if (((num31 != -1) || (num30 != -1)) || (num32 != -1))
                        {
                            KillTile(i, j, false, false, false);
                        }
                        else if ((num29 < 0) || !Main.tileSolid[num29])
                        {
                            KillTile(i, j, false, false, false);
                        }
                    }
                    else if (Main.tileAlch[type])
                    {
                        CheckAlch(i, j);
                    }
                    else if (type == 0x48)
                    {
                        int num33 = -1;
                        int num34 = -1;
                        if ((Main.tile[i, j - 1] != null) && Main.tile[i, j - 1].active)
                        {
                            num34 = Main.tile[i, j - 1].type;
                        }
                        if ((Main.tile[i, j + 1] != null) && Main.tile[i, j + 1].active)
                        {
                            num33 = Main.tile[i, j + 1].type;
                        }
                        if ((num33 != type) && (num33 != 70))
                        {
                            KillTile(i, j, false, false, false);
                        }
                        else if ((num34 != type) && (Main.tile[i, j].frameX == 0))
                        {
                            Main.tile[i, j].frameNumber = (byte) genRand.Next(3);
                            if (Main.tile[i, j].frameNumber == 0)
                            {
                                Main.tile[i, j].frameX = 0x12;
                                Main.tile[i, j].frameY = 0;
                            }
                            if (Main.tile[i, j].frameNumber == 1)
                            {
                                Main.tile[i, j].frameX = 0x12;
                                Main.tile[i, j].frameY = 0x12;
                            }
                            if (Main.tile[i, j].frameNumber == 2)
                            {
                                Main.tile[i, j].frameX = 0x12;
                                Main.tile[i, j].frameY = 0x24;
                            }
                        }
                    }
                    else if (type == 5)
                    {
                        CheckTree(i, j);
                    }
                    return;
                }
                int index = -1;
                int num36 = -1;
                int num37 = -1;
                int num38 = -1;
                int num39 = -1;
                int num40 = -1;
                int num41 = -1;
                int num42 = -1;
                if ((Main.tile[i - 1, j] != null) && Main.tile[i - 1, j].active)
                {
                    if (Main.tileStone[Main.tile[i - 1, j].type])
                    {
                        num38 = 1;
                    }
                    else
                    {
                        num38 = Main.tile[i - 1, j].type;
                    }
                }
                if ((Main.tile[i + 1, j] != null) && Main.tile[i + 1, j].active)
                {
                    if (Main.tileStone[Main.tile[i + 1, j].type])
                    {
                        num39 = 1;
                    }
                    else
                    {
                        num39 = Main.tile[i + 1, j].type;
                    }
                }
                if ((Main.tile[i, j - 1] != null) && Main.tile[i, j - 1].active)
                {
                    if (Main.tileStone[Main.tile[i, j - 1].type])
                    {
                        num36 = 1;
                    }
                    else
                    {
                        num36 = Main.tile[i, j - 1].type;
                    }
                }
                if ((Main.tile[i, j + 1] != null) && Main.tile[i, j + 1].active)
                {
                    if (Main.tileStone[Main.tile[i, j + 1].type])
                    {
                        num41 = 1;
                    }
                    else
                    {
                        num41 = Main.tile[i, j + 1].type;
                    }
                }
                if ((Main.tile[i - 1, j - 1] != null) && Main.tile[i - 1, j - 1].active)
                {
                    if (Main.tileStone[Main.tile[i - 1, j - 1].type])
                    {
                        index = 1;
                    }
                    else
                    {
                        index = Main.tile[i - 1, j - 1].type;
                    }
                }
                if ((Main.tile[i + 1, j - 1] != null) && Main.tile[i + 1, j - 1].active)
                {
                    if (Main.tileStone[Main.tile[i + 1, j - 1].type])
                    {
                        num37 = 1;
                    }
                    else
                    {
                        num37 = Main.tile[i + 1, j - 1].type;
                    }
                }
                if ((Main.tile[i - 1, j + 1] != null) && Main.tile[i - 1, j + 1].active)
                {
                    if (Main.tileStone[Main.tile[i - 1, j + 1].type])
                    {
                        num40 = 1;
                    }
                    else
                    {
                        num40 = Main.tile[i - 1, j + 1].type;
                    }
                }
                if ((Main.tile[i + 1, j + 1] != null) && Main.tile[i + 1, j + 1].active)
                {
                    if (Main.tileStone[Main.tile[i + 1, j + 1].type])
                    {
                        num42 = 1;
                    }
                    else
                    {
                        num42 = Main.tile[i + 1, j + 1].type;
                    }
                }
                if (!Main.tileSolid[type])
                {
                    if (type == 0x31)
                    {
                        CheckOnTable1x1(i, j, (byte) type);
                    }
                    else
                    {
                        if (type != 80)
                        {
                            goto Label_185F;
                        }
                        CactusFrame(i, j);
                    }
                    return;
                }
                if (type == 0x13)
                {
                    if ((num39 >= 0) && !Main.tileSolid[num39])
                    {
                        num39 = -1;
                    }
                    if ((num38 >= 0) && !Main.tileSolid[num38])
                    {
                        num38 = -1;
                    }
                    if ((num38 == type) && (num39 == type))
                    {
                        if (Main.tile[i, j].frameNumber == 0)
                        {
                            rectangle.X = 0;
                            rectangle.Y = 0;
                        }
                        else if (Main.tile[i, j].frameNumber == 1)
                        {
                            rectangle.X = 0;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if ((num38 == type) && (num39 == -1))
                    {
                        if (Main.tile[i, j].frameNumber == 0)
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 0;
                        }
                        else if (Main.tile[i, j].frameNumber == 1)
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if ((num38 == -1) && (num39 == type))
                    {
                        if (Main.tile[i, j].frameNumber == 0)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0;
                        }
                        else if (Main.tile[i, j].frameNumber == 1)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if ((num38 != type) && (num39 == type))
                    {
                        if (Main.tile[i, j].frameNumber == 0)
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0;
                        }
                        else if (Main.tile[i, j].frameNumber == 1)
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if ((num38 == type) && (num39 != type))
                    {
                        if (Main.tile[i, j].frameNumber == 0)
                        {
                            rectangle.X = 0x48;
                            rectangle.Y = 0;
                        }
                        else if (Main.tile[i, j].frameNumber == 1)
                        {
                            rectangle.X = 0x48;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0x48;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if (((num38 != type) && (num38 != -1)) && (num39 == -1))
                    {
                        if (Main.tile[i, j].frameNumber == 0)
                        {
                            rectangle.X = 0x6c;
                            rectangle.Y = 0;
                        }
                        else if (Main.tile[i, j].frameNumber == 1)
                        {
                            rectangle.X = 0x6c;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0x6c;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if (((num38 == -1) && (num39 != type)) && (num39 != -1))
                    {
                        if (Main.tile[i, j].frameNumber == 0)
                        {
                            rectangle.X = 0x7e;
                            rectangle.Y = 0;
                        }
                        else if (Main.tile[i, j].frameNumber == 1)
                        {
                            rectangle.X = 0x7e;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0x7e;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if (Main.tile[i, j].frameNumber == 0)
                    {
                        rectangle.X = 90;
                        rectangle.Y = 0;
                    }
                    else if (Main.tile[i, j].frameNumber == 1)
                    {
                        rectangle.X = 90;
                        rectangle.Y = 0x12;
                    }
                    else
                    {
                        rectangle.X = 90;
                        rectangle.Y = 0x24;
                    }
                }
            Label_185F:
                WorldGen.mergeUp = false;
                WorldGen.mergeDown = false;
                WorldGen.mergeLeft = false;
                WorldGen.mergeRight = false;
                int frameNumber = 0;
                if (resetFrame)
                {
                    frameNumber = genRand.Next(0, 3);
                    Main.tile[i, j].frameNumber = (byte) frameNumber;
                }
                else
                {
                    frameNumber = Main.tile[i, j].frameNumber;
                }
                if (type == 0)
                {
                    if ((num36 >= 0) && Main.tileMergeDirt[num36])
                    {
                        TileFrame(i, j - 1, false, false);
                        if (WorldGen.mergeDown)
                        {
                            num36 = type;
                        }
                    }
                    if ((num41 >= 0) && Main.tileMergeDirt[num41])
                    {
                        TileFrame(i, j + 1, false, false);
                        if (WorldGen.mergeUp)
                        {
                            num41 = type;
                        }
                    }
                    if ((num38 >= 0) && Main.tileMergeDirt[num38])
                    {
                        TileFrame(i - 1, j, false, false);
                        if (WorldGen.mergeRight)
                        {
                            num38 = type;
                        }
                    }
                    if ((num39 >= 0) && Main.tileMergeDirt[num39])
                    {
                        TileFrame(i + 1, j, false, false);
                        if (WorldGen.mergeLeft)
                        {
                            num39 = type;
                        }
                    }
                    switch (num36)
                    {
                        case 2:
                        case 0x17:
                        case 0x6d:
                            num36 = type;
                            break;
                    }
                    if (((num41 == 2) || (num41 == 0x17)) || (num41 == 0x6d))
                    {
                        num41 = type;
                    }
                    if (((num38 == 2) || (num38 == 0x17)) || (num38 == 0x6d))
                    {
                        num38 = type;
                    }
                    if (((num39 == 2) || (num39 == 0x17)) || (num39 == 0x6d))
                    {
                        num39 = type;
                    }
                    if ((index >= 0) && Main.tileMergeDirt[index])
                    {
                        index = type;
                    }
                    else if (((index == 2) || (index == 0x17)) || (index == 0x6d))
                    {
                        index = type;
                    }
                    if ((num37 >= 0) && Main.tileMergeDirt[num37])
                    {
                        num37 = type;
                    }
                    else if (((num37 == 2) || (num37 == 0x17)) || (num37 == 0x6d))
                    {
                        num37 = type;
                    }
                    if ((num40 >= 0) && Main.tileMergeDirt[num40])
                    {
                        num40 = type;
                    }
                    else if (((num40 == 2) || (num40 == 0x17)) || (num37 == 0x6d))
                    {
                        num40 = type;
                    }
                    if ((num42 >= 0) && Main.tileMergeDirt[num42])
                    {
                        num42 = type;
                    }
                    else if (((num42 == 2) || (num42 == 0x17)) || (num42 == 0x6d))
                    {
                        num42 = type;
                    }
                    if (j < Main.rockLayer)
                    {
                        if (num36 == 0x3b)
                        {
                            num36 = -2;
                        }
                        if (num41 == 0x3b)
                        {
                            num41 = -2;
                        }
                        if (num38 == 0x3b)
                        {
                            num38 = -2;
                        }
                        if (num39 == 0x3b)
                        {
                            num39 = -2;
                        }
                        if (index == 0x3b)
                        {
                            index = -2;
                        }
                        if (num37 == 0x3b)
                        {
                            num37 = -2;
                        }
                        if (num40 == 0x3b)
                        {
                            num40 = -2;
                        }
                        if (num42 == 0x3b)
                        {
                            num42 = -2;
                        }
                    }
                }
                else if (Main.tileMergeDirt[type])
                {
                    if (num36 == 0)
                    {
                        num36 = -2;
                    }
                    if (num41 == 0)
                    {
                        num41 = -2;
                    }
                    if (num38 == 0)
                    {
                        num38 = -2;
                    }
                    if (num39 == 0)
                    {
                        num39 = -2;
                    }
                    if (index == 0)
                    {
                        index = -2;
                    }
                    if (num37 == 0)
                    {
                        num37 = -2;
                    }
                    if (num40 == 0)
                    {
                        num40 = -2;
                    }
                    if (num42 == 0)
                    {
                        num42 = -2;
                    }
                    if (type == 1)
                    {
                        if (j > Main.rockLayer)
                        {
                            if (num36 == 0x3b)
                            {
                                TileFrame(i, j - 1, false, false);
                                if (WorldGen.mergeDown)
                                {
                                    num36 = type;
                                }
                            }
                            if (num41 == 0x3b)
                            {
                                TileFrame(i, j + 1, false, false);
                                if (WorldGen.mergeUp)
                                {
                                    num41 = type;
                                }
                            }
                            if (num38 == 0x3b)
                            {
                                TileFrame(i - 1, j, false, false);
                                if (WorldGen.mergeRight)
                                {
                                    num38 = type;
                                }
                            }
                            if (num39 == 0x3b)
                            {
                                TileFrame(i + 1, j, false, false);
                                if (WorldGen.mergeLeft)
                                {
                                    num39 = type;
                                }
                            }
                            if (index == 0x3b)
                            {
                                index = type;
                            }
                            if (num37 == 0x3b)
                            {
                                num37 = type;
                            }
                            if (num40 == 0x3b)
                            {
                                num40 = type;
                            }
                            if (num42 == 0x3b)
                            {
                                num42 = type;
                            }
                        }
                        if (num36 == 0x39)
                        {
                            TileFrame(i, j - 1, false, false);
                            if (WorldGen.mergeDown)
                            {
                                num36 = type;
                            }
                        }
                        if (num41 == 0x39)
                        {
                            TileFrame(i, j + 1, false, false);
                            if (WorldGen.mergeUp)
                            {
                                num41 = type;
                            }
                        }
                        if (num38 == 0x39)
                        {
                            TileFrame(i - 1, j, false, false);
                            if (WorldGen.mergeRight)
                            {
                                num38 = type;
                            }
                        }
                        if (num39 == 0x39)
                        {
                            TileFrame(i + 1, j, false, false);
                            if (WorldGen.mergeLeft)
                            {
                                num39 = type;
                            }
                        }
                        if (index == 0x39)
                        {
                            index = type;
                        }
                        if (num37 == 0x39)
                        {
                            num37 = type;
                        }
                        if (num40 == 0x39)
                        {
                            num40 = type;
                        }
                        if (num42 == 0x39)
                        {
                            num42 = type;
                        }
                    }
                }
                else if (((type == 0x3a) || (type == 0x4c)) || (type == 0x4b))
                {
                    if (num36 == 0x39)
                    {
                        num36 = -2;
                    }
                    if (num41 == 0x39)
                    {
                        num41 = -2;
                    }
                    if (num38 == 0x39)
                    {
                        num38 = -2;
                    }
                    if (num39 == 0x39)
                    {
                        num39 = -2;
                    }
                    if (index == 0x39)
                    {
                        index = -2;
                    }
                    if (num37 == 0x39)
                    {
                        num37 = -2;
                    }
                    if (num40 == 0x39)
                    {
                        num40 = -2;
                    }
                    if (num42 == 0x39)
                    {
                        num42 = -2;
                    }
                }
                else if (type == 0x3b)
                {
                    if (j > Main.rockLayer)
                    {
                        if (num36 == 1)
                        {
                            num36 = -2;
                        }
                        if (num41 == 1)
                        {
                            num41 = -2;
                        }
                        if (num38 == 1)
                        {
                            num38 = -2;
                        }
                        if (num39 == 1)
                        {
                            num39 = -2;
                        }
                        if (index == 1)
                        {
                            index = -2;
                        }
                        if (num37 == 1)
                        {
                            num37 = -2;
                        }
                        if (num40 == 1)
                        {
                            num40 = -2;
                        }
                        if (num42 == 1)
                        {
                            num42 = -2;
                        }
                    }
                    if (num36 == 60)
                    {
                        num36 = type;
                    }
                    if (num41 == 60)
                    {
                        num41 = type;
                    }
                    if (num38 == 60)
                    {
                        num38 = type;
                    }
                    if (num39 == 60)
                    {
                        num39 = type;
                    }
                    if (index == 60)
                    {
                        index = type;
                    }
                    if (num37 == 60)
                    {
                        num37 = type;
                    }
                    if (num40 == 60)
                    {
                        num40 = type;
                    }
                    if (num42 == 60)
                    {
                        num42 = type;
                    }
                    if (num36 == 70)
                    {
                        num36 = type;
                    }
                    if (num41 == 70)
                    {
                        num41 = type;
                    }
                    if (num38 == 70)
                    {
                        num38 = type;
                    }
                    if (num39 == 70)
                    {
                        num39 = type;
                    }
                    if (index == 70)
                    {
                        index = type;
                    }
                    if (num37 == 70)
                    {
                        num37 = type;
                    }
                    if (num40 == 70)
                    {
                        num40 = type;
                    }
                    if (num42 == 70)
                    {
                        num42 = type;
                    }
                    if (j < Main.rockLayer)
                    {
                        if (num36 == 0)
                        {
                            TileFrame(i, j - 1, false, false);
                            if (WorldGen.mergeDown)
                            {
                                num36 = type;
                            }
                        }
                        if (num41 == 0)
                        {
                            TileFrame(i, j + 1, false, false);
                            if (WorldGen.mergeUp)
                            {
                                num41 = type;
                            }
                        }
                        if (num38 == 0)
                        {
                            TileFrame(i - 1, j, false, false);
                            if (WorldGen.mergeRight)
                            {
                                num38 = type;
                            }
                        }
                        if (num39 == 0)
                        {
                            TileFrame(i + 1, j, false, false);
                            if (WorldGen.mergeLeft)
                            {
                                num39 = type;
                            }
                        }
                        if (index == 0)
                        {
                            index = type;
                        }
                        if (num37 == 0)
                        {
                            num37 = type;
                        }
                        if (num40 == 0)
                        {
                            num40 = type;
                        }
                        if (num42 == 0)
                        {
                            num42 = type;
                        }
                    }
                }
                else if (type == 0x39)
                {
                    if (num36 == 1)
                    {
                        num36 = -2;
                    }
                    if (num41 == 1)
                    {
                        num41 = -2;
                    }
                    if (num38 == 1)
                    {
                        num38 = -2;
                    }
                    if (num39 == 1)
                    {
                        num39 = -2;
                    }
                    if (index == 1)
                    {
                        index = -2;
                    }
                    if (num37 == 1)
                    {
                        num37 = -2;
                    }
                    if (num40 == 1)
                    {
                        num40 = -2;
                    }
                    if (num42 == 1)
                    {
                        num42 = -2;
                    }
                    switch (num36)
                    {
                        case 0x3a:
                        case 0x4c:
                        case 0x4b:
                            TileFrame(i, j - 1, false, false);
                            if (WorldGen.mergeDown)
                            {
                                num36 = type;
                            }
                            break;
                    }
                    if (((num41 == 0x3a) || (num41 == 0x4c)) || (num41 == 0x4b))
                    {
                        TileFrame(i, j + 1, false, false);
                        if (WorldGen.mergeUp)
                        {
                            num41 = type;
                        }
                    }
                    if (((num38 == 0x3a) || (num38 == 0x4c)) || (num38 == 0x4b))
                    {
                        TileFrame(i - 1, j, false, false);
                        if (WorldGen.mergeRight)
                        {
                            num38 = type;
                        }
                    }
                    if (((num39 == 0x3a) || (num39 == 0x4c)) || (num39 == 0x4b))
                    {
                        TileFrame(i + 1, j, false, false);
                        if (WorldGen.mergeLeft)
                        {
                            num39 = type;
                        }
                    }
                    if (((index == 0x3a) || (index == 0x4c)) || (index == 0x4b))
                    {
                        index = type;
                    }
                    if (((num37 == 0x3a) || (num37 == 0x4c)) || (num37 == 0x4b))
                    {
                        num37 = type;
                    }
                    if (((num40 == 0x3a) || (num40 == 0x4c)) || (num40 == 0x4b))
                    {
                        num40 = type;
                    }
                    if (((num42 == 0x3a) || (num42 == 0x4c)) || (num42 == 0x4b))
                    {
                        num42 = type;
                    }
                }
                else if (type == 0x20)
                {
                    if (num41 == 0x17)
                    {
                        num41 = type;
                    }
                }
                else if (type == 0x45)
                {
                    if (num41 == 60)
                    {
                        num41 = type;
                    }
                }
                else if (type == 0x33)
                {
                    if ((num36 > -1) && !Main.tileNoAttach[num36])
                    {
                        num36 = type;
                    }
                    if ((num41 > -1) && !Main.tileNoAttach[num41])
                    {
                        num41 = type;
                    }
                    if ((num38 > -1) && !Main.tileNoAttach[num38])
                    {
                        num38 = type;
                    }
                    if ((num39 > -1) && !Main.tileNoAttach[num39])
                    {
                        num39 = type;
                    }
                    if ((index > -1) && !Main.tileNoAttach[index])
                    {
                        index = type;
                    }
                    if ((num37 > -1) && !Main.tileNoAttach[num37])
                    {
                        num37 = type;
                    }
                    if ((num40 > -1) && !Main.tileNoAttach[num40])
                    {
                        num40 = type;
                    }
                    if ((num42 > -1) && !Main.tileNoAttach[num42])
                    {
                        num42 = type;
                    }
                }
                bool flag3 = false;
                if (((type == 2) || (type == 0x17)) || (((type == 60) || (type == 70)) || (type == 0x6d)))
                {
                    flag3 = true;
                    if (((num36 > -1) && !Main.tileSolid[num36]) && (num36 != type))
                    {
                        num36 = -1;
                    }
                    if (((num41 > -1) && !Main.tileSolid[num41]) && (num41 != type))
                    {
                        num41 = -1;
                    }
                    if (((num38 > -1) && !Main.tileSolid[num38]) && (num38 != type))
                    {
                        num38 = -1;
                    }
                    if (((num39 > -1) && !Main.tileSolid[num39]) && (num39 != type))
                    {
                        num39 = -1;
                    }
                    if (((index > -1) && !Main.tileSolid[index]) && (index != type))
                    {
                        index = -1;
                    }
                    if (((num37 > -1) && !Main.tileSolid[num37]) && (num37 != type))
                    {
                        num37 = -1;
                    }
                    if (((num40 > -1) && !Main.tileSolid[num40]) && (num40 != type))
                    {
                        num40 = -1;
                    }
                    if (((num42 > -1) && !Main.tileSolid[num42]) && (num42 != type))
                    {
                        num42 = -1;
                    }
                    int num44 = 0;
                    if ((type == 60) || (type == 70))
                    {
                        num44 = 0x3b;
                    }
                    else if (type == 2)
                    {
                        if (num36 == 0x17)
                        {
                            num36 = num44;
                        }
                        if (num41 == 0x17)
                        {
                            num41 = num44;
                        }
                        if (num38 == 0x17)
                        {
                            num38 = num44;
                        }
                        if (num39 == 0x17)
                        {
                            num39 = num44;
                        }
                        if (index == 0x17)
                        {
                            index = num44;
                        }
                        if (num37 == 0x17)
                        {
                            num37 = num44;
                        }
                        if (num40 == 0x17)
                        {
                            num40 = num44;
                        }
                        if (num42 == 0x17)
                        {
                            num42 = num44;
                        }
                    }
                    else if (type == 0x17)
                    {
                        if (num36 == 2)
                        {
                            num36 = num44;
                        }
                        if (num41 == 2)
                        {
                            num41 = num44;
                        }
                        if (num38 == 2)
                        {
                            num38 = num44;
                        }
                        if (num39 == 2)
                        {
                            num39 = num44;
                        }
                        if (index == 2)
                        {
                            index = num44;
                        }
                        if (num37 == 2)
                        {
                            num37 = num44;
                        }
                        if (num40 == 2)
                        {
                            num40 = num44;
                        }
                        if (num42 == 2)
                        {
                            num42 = num44;
                        }
                    }
                    if (((num36 != type) && (num36 != num44)) && ((num41 == type) || (num41 == num44)))
                    {
                        if ((num38 == num44) && (num39 == type))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0;
                                rectangle.Y = 0xc6;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x12;
                                rectangle.Y = 0xc6;
                            }
                            else
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0xc6;
                            }
                        }
                        else if ((num38 == type) && (num39 == num44))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0xc6;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 0xc6;
                            }
                            else
                            {
                                rectangle.X = 90;
                                rectangle.Y = 0xc6;
                            }
                        }
                    }
                    else if (((num41 != type) && (num41 != num44)) && ((num36 == type) || (num36 == num44)))
                    {
                        if ((num38 == num44) && (num39 == type))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0;
                                rectangle.Y = 0xd8;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x12;
                                rectangle.Y = 0xd8;
                            }
                            else
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0xd8;
                            }
                        }
                        else if ((num38 == type) && (num39 == num44))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0xd8;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 0xd8;
                            }
                            else
                            {
                                rectangle.X = 90;
                                rectangle.Y = 0xd8;
                            }
                        }
                    }
                    else if (((num38 != type) && (num38 != num44)) && ((num39 == type) || (num39 == num44)))
                    {
                        if ((num36 == num44) && (num41 == type))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 0x90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 0xa2;
                            }
                            else
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 180;
                            }
                        }
                        else if ((num41 == type) && (num39 == num36))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 0x6c;
                            }
                            else
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 0x7e;
                            }
                        }
                    }
                    else if (((num39 != type) && (num39 != num44)) && ((num38 == type) || (num38 == num44)))
                    {
                        if ((num36 == num44) && (num41 == type))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 90;
                                rectangle.Y = 0x90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 90;
                                rectangle.Y = 0xa2;
                            }
                            else
                            {
                                rectangle.X = 90;
                                rectangle.Y = 180;
                            }
                        }
                        else if ((num41 == type) && (num39 == num36))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 90;
                                rectangle.Y = 90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 90;
                                rectangle.Y = 0x6c;
                            }
                            else
                            {
                                rectangle.X = 90;
                                rectangle.Y = 0x7e;
                            }
                        }
                    }
                    else if (((num36 == type) && (num41 == type)) && ((num38 == type) && (num39 == type)))
                    {
                        if (((index != type) && (num37 != type)) && ((num40 != type) && (num42 != type)))
                        {
                            if (num42 == num44)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x6c;
                                    rectangle.Y = 0x144;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x7e;
                                    rectangle.Y = 0x144;
                                }
                                else
                                {
                                    rectangle.X = 0x90;
                                    rectangle.Y = 0x144;
                                }
                            }
                            else if (num37 == num44)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x6c;
                                    rectangle.Y = 0x156;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x7e;
                                    rectangle.Y = 0x156;
                                }
                                else
                                {
                                    rectangle.X = 0x90;
                                    rectangle.Y = 0x156;
                                }
                            }
                            else if (num40 == num44)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x6c;
                                    rectangle.Y = 360;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x7e;
                                    rectangle.Y = 360;
                                }
                                else
                                {
                                    rectangle.X = 0x90;
                                    rectangle.Y = 360;
                                }
                            }
                            else if (index == num44)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x6c;
                                    rectangle.Y = 0x17a;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x7e;
                                    rectangle.Y = 0x17a;
                                }
                                else
                                {
                                    rectangle.X = 0x90;
                                    rectangle.Y = 0x17a;
                                }
                            }
                            else if (frameNumber == 0)
                            {
                                rectangle.X = 0x90;
                                rectangle.Y = 0xea;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0xc6;
                                rectangle.Y = 0xea;
                            }
                            else
                            {
                                rectangle.X = 0xfc;
                                rectangle.Y = 0xea;
                            }
                        }
                        else if ((index != type) && (num42 != type))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0x132;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0x132;
                            }
                            else
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 0x132;
                            }
                        }
                        else if ((num37 != type) && (num40 != type))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 90;
                                rectangle.Y = 0x132;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x6c;
                                rectangle.Y = 0x132;
                            }
                            else
                            {
                                rectangle.X = 0x7e;
                                rectangle.Y = 0x132;
                            }
                        }
                        else if (((index != type) && (num37 == type)) && ((num40 == type) && (num42 == type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0x6c;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0x90;
                            }
                            else
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 180;
                            }
                        }
                        else if (((index == type) && (num37 != type)) && ((num40 == type) && (num42 == type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0x6c;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0x90;
                            }
                            else
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 180;
                            }
                        }
                        else if (((index == type) && (num37 == type)) && ((num40 != type) && (num42 == type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0x7e;
                            }
                            else
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0xa2;
                            }
                        }
                        else if (((index == type) && (num37 == type)) && ((num40 == type) && (num42 != type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0x7e;
                            }
                            else
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0xa2;
                            }
                        }
                    }
                    else if ((((num36 == type) && (num41 == num44)) && ((num38 == type) && (num39 == type))) && ((index == -1) && (num37 == -1)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x6c;
                            rectangle.Y = 0x12;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x7e;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0x90;
                            rectangle.Y = 0x12;
                        }
                    }
                    else if ((((num36 == num44) && (num41 == type)) && ((num38 == type) && (num39 == type))) && ((num40 == -1) && (num42 == -1)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x6c;
                            rectangle.Y = 0x24;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x7e;
                            rectangle.Y = 0x24;
                        }
                        else
                        {
                            rectangle.X = 0x90;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if ((((num36 == type) && (num41 == type)) && ((num38 == num44) && (num39 == type))) && ((num37 == -1) && (num42 == -1)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0xc6;
                            rectangle.Y = 0;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0xc6;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0xc6;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if ((((num36 == type) && (num41 == type)) && ((num38 == type) && (num39 == num44))) && ((index == -1) && (num40 == -1)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 180;
                            rectangle.Y = 0;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 180;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 180;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if (((num36 == type) && (num41 == num44)) && ((num38 == type) && (num39 == type)))
                    {
                        if (num37 == -1)
                        {
                            if (index != -1)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x24;
                                    rectangle.Y = 0x6c;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x24;
                                    rectangle.Y = 0x90;
                                }
                                else
                                {
                                    rectangle.X = 0x24;
                                    rectangle.Y = 180;
                                }
                            }
                        }
                        else if (frameNumber == 0)
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x6c;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x90;
                        }
                        else
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 180;
                        }
                    }
                    else if (((num36 == num44) && (num41 == type)) && ((num38 == type) && (num39 == type)))
                    {
                        if (num42 == -1)
                        {
                            if (num40 != -1)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x24;
                                    rectangle.Y = 90;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x24;
                                    rectangle.Y = 0x7e;
                                }
                                else
                                {
                                    rectangle.X = 0x24;
                                    rectangle.Y = 0xa2;
                                }
                            }
                        }
                        else if (frameNumber == 0)
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 90;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x7e;
                        }
                        else
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0xa2;
                        }
                    }
                    else if (((num36 == type) && (num41 == type)) && ((num38 == type) && (num39 == num44)))
                    {
                        if (index == -1)
                        {
                            if (num40 != -1)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x36;
                                    rectangle.Y = 0x6c;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x36;
                                    rectangle.Y = 0x90;
                                }
                                else
                                {
                                    rectangle.X = 0x36;
                                    rectangle.Y = 180;
                                }
                            }
                        }
                        else if (frameNumber == 0)
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 90;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x7e;
                        }
                        else
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0xa2;
                        }
                    }
                    else if (((num36 == type) && (num41 == type)) && ((num38 == num44) && (num39 == type)))
                    {
                        if (num37 == -1)
                        {
                            if (num42 != -1)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x24;
                                    rectangle.Y = 0x6c;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x24;
                                    rectangle.Y = 0x90;
                                }
                                else
                                {
                                    rectangle.X = 0x24;
                                    rectangle.Y = 180;
                                }
                            }
                        }
                        else if (frameNumber == 0)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 90;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0x7e;
                        }
                        else
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0xa2;
                        }
                    }
                    else if (((((num36 == num44) && (num41 == type)) && ((num38 == type) && (num39 == type))) || (((num36 == type) && (num41 == num44)) && ((num38 == type) && (num39 == type)))) || ((((num36 == type) && (num41 == type)) && ((num38 == num44) && (num39 == type))) || (((num36 == type) && (num41 == type)) && ((num38 == type) && (num39 == num44)))))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 0x12;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x12;
                        }
                    }
                    if ((((num36 == type) || (num36 == num44)) && ((num41 == type) || (num41 == num44))) && (((num38 == type) || (num38 == num44)) && ((num39 == type) || (num39 == num44))))
                    {
                        if (((((index != type) && (index != num44)) && ((num37 == type) || (num37 == num44))) && ((num40 == type) || (num40 == num44))) && ((num42 == type) || (num42 == num44)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0x6c;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0x90;
                            }
                            else
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 180;
                            }
                        }
                        else if (((((num37 != type) && (num37 != num44)) && ((index == type) || (index == num44))) && ((num40 == type) || (num40 == num44))) && ((num42 == type) || (num42 == num44)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0x6c;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0x90;
                            }
                            else
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 180;
                            }
                        }
                        else if (((((num40 != type) && (num40 != num44)) && ((index == type) || (index == num44))) && ((num37 == type) || (num37 == num44))) && ((num42 == type) || (num42 == num44)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0x7e;
                            }
                            else
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0xa2;
                            }
                        }
                        else if (((((num42 != type) && (num42 != num44)) && ((index == type) || (index == num44))) && ((num40 == type) || (num40 == num44))) && ((num37 == type) || (num37 == num44)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0x7e;
                            }
                            else
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0xa2;
                            }
                        }
                    }
                    if ((((num36 != num44) && (num36 != type)) && ((num41 == type) && (num38 != num44))) && (((num38 != type) && (num39 == type)) && ((num42 != num44) && (num42 != type))))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 90;
                            rectangle.Y = 270;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x6c;
                            rectangle.Y = 270;
                        }
                        else
                        {
                            rectangle.X = 0x7e;
                            rectangle.Y = 270;
                        }
                    }
                    else if ((((num36 != num44) && (num36 != type)) && ((num41 == type) && (num38 == type))) && (((num39 != num44) && (num39 != type)) && ((num40 != num44) && (num40 != type))))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x90;
                            rectangle.Y = 270;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0xa2;
                            rectangle.Y = 270;
                        }
                        else
                        {
                            rectangle.X = 180;
                            rectangle.Y = 270;
                        }
                    }
                    else if ((((num41 != num44) && (num41 != type)) && ((num36 == type) && (num38 != num44))) && (((num38 != type) && (num39 == type)) && ((num37 != num44) && (num37 != type))))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 90;
                            rectangle.Y = 0x120;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x6c;
                            rectangle.Y = 0x120;
                        }
                        else
                        {
                            rectangle.X = 0x7e;
                            rectangle.Y = 0x120;
                        }
                    }
                    else if ((((num41 != num44) && (num41 != type)) && ((num36 == type) && (num38 == type))) && (((num39 != num44) && (num39 != type)) && ((index != num44) && (index != type))))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x90;
                            rectangle.Y = 0x120;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0xa2;
                            rectangle.Y = 0x120;
                        }
                        else
                        {
                            rectangle.X = 180;
                            rectangle.Y = 0x120;
                        }
                    }
                    else if (((((num36 != type) && (num36 != num44)) && ((num41 == type) && (num38 == type))) && (((num39 == type) && (num40 != type)) && ((num40 != num44) && (num42 != type)))) && (num42 != num44))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x90;
                            rectangle.Y = 0xd8;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0xc6;
                            rectangle.Y = 0xd8;
                        }
                        else
                        {
                            rectangle.X = 0xfc;
                            rectangle.Y = 0xd8;
                        }
                    }
                    else if (((((num41 != type) && (num41 != num44)) && ((num36 == type) && (num38 == type))) && (((num39 == type) && (index != type)) && ((index != num44) && (num37 != type)))) && (num37 != num44))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x90;
                            rectangle.Y = 0xfc;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0xc6;
                            rectangle.Y = 0xfc;
                        }
                        else
                        {
                            rectangle.X = 0xfc;
                            rectangle.Y = 0xfc;
                        }
                    }
                    else if (((((num38 != type) && (num38 != num44)) && ((num41 == type) && (num36 == type))) && (((num39 == type) && (num37 != type)) && ((num37 != num44) && (num42 != type)))) && (num42 != num44))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x7e;
                            rectangle.Y = 0xea;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 180;
                            rectangle.Y = 0xea;
                        }
                        else
                        {
                            rectangle.X = 0xea;
                            rectangle.Y = 0xea;
                        }
                    }
                    else if (((((num39 != type) && (num39 != num44)) && ((num41 == type) && (num36 == type))) && (((num38 == type) && (index != type)) && ((index != num44) && (num40 != type)))) && (num40 != num44))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0xa2;
                            rectangle.Y = 0xea;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0xd8;
                            rectangle.Y = 0xea;
                        }
                        else
                        {
                            rectangle.X = 270;
                            rectangle.Y = 0xea;
                        }
                    }
                    else if ((((num36 != num44) && (num36 != type)) && ((num41 == num44) || (num41 == type))) && ((num38 == num44) && (num39 == num44)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 270;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 270;
                        }
                        else
                        {
                            rectangle.X = 0x48;
                            rectangle.Y = 270;
                        }
                    }
                    else if ((((num41 != num44) && (num41 != type)) && ((num36 == num44) || (num36 == type))) && ((num38 == num44) && (num39 == num44)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0x120;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x120;
                        }
                        else
                        {
                            rectangle.X = 0x48;
                            rectangle.Y = 0x120;
                        }
                    }
                    else if ((((num38 != num44) && (num38 != type)) && ((num39 == num44) || (num39 == type))) && ((num36 == num44) && (num41 == num44)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0;
                            rectangle.Y = 270;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0;
                            rectangle.Y = 0x120;
                        }
                        else
                        {
                            rectangle.X = 0;
                            rectangle.Y = 0x132;
                        }
                    }
                    else if ((((num39 != num44) && (num39 != type)) && ((num38 == num44) || (num38 == type))) && ((num36 == num44) && (num41 == num44)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 270;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 0x120;
                        }
                        else
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 0x132;
                        }
                    }
                    else if (((num36 == type) && (num41 == num44)) && ((num38 == num44) && (num39 == num44)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0xc6;
                            rectangle.Y = 0x120;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0xd8;
                            rectangle.Y = 0x120;
                        }
                        else
                        {
                            rectangle.X = 0xea;
                            rectangle.Y = 0x120;
                        }
                    }
                    else if (((num36 == num44) && (num41 == type)) && ((num38 == num44) && (num39 == num44)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0xc6;
                            rectangle.Y = 270;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0xd8;
                            rectangle.Y = 270;
                        }
                        else
                        {
                            rectangle.X = 0xea;
                            rectangle.Y = 270;
                        }
                    }
                    else if (((num36 == num44) && (num41 == num44)) && ((num38 == type) && (num39 == num44)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0xc6;
                            rectangle.Y = 0x132;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0xd8;
                            rectangle.Y = 0x132;
                        }
                        else
                        {
                            rectangle.X = 0xea;
                            rectangle.Y = 0x132;
                        }
                    }
                    else if (((num36 == num44) && (num41 == num44)) && ((num38 == num44) && (num39 == type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x90;
                            rectangle.Y = 0x132;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0xa2;
                            rectangle.Y = 0x132;
                        }
                        else
                        {
                            rectangle.X = 180;
                            rectangle.Y = 0x132;
                        }
                    }
                    if ((((num36 != type) && (num36 != num44)) && ((num41 == type) && (num38 == type))) && (num39 == type))
                    {
                        if (((num40 == num44) || (num40 == type)) && ((num42 != num44) && (num42 != type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0;
                                rectangle.Y = 0x144;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x12;
                                rectangle.Y = 0x144;
                            }
                            else
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0x144;
                            }
                        }
                        else if (((num42 == num44) || (num42 == type)) && ((num40 != num44) && (num40 != type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0x144;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 0x144;
                            }
                            else
                            {
                                rectangle.X = 90;
                                rectangle.Y = 0x144;
                            }
                        }
                    }
                    else if ((((num41 != type) && (num41 != num44)) && ((num36 == type) && (num38 == type))) && (num39 == type))
                    {
                        if (((index == num44) || (index == type)) && ((num37 != num44) && (num37 != type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0;
                                rectangle.Y = 0x156;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x12;
                                rectangle.Y = 0x156;
                            }
                            else
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0x156;
                            }
                        }
                        else if (((num37 == num44) || (num37 == type)) && ((index != num44) && (index != type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0x156;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 0x156;
                            }
                            else
                            {
                                rectangle.X = 90;
                                rectangle.Y = 0x156;
                            }
                        }
                    }
                    else if ((((num38 != type) && (num38 != num44)) && ((num36 == type) && (num41 == type))) && (num39 == type))
                    {
                        if (((num37 == num44) || (num37 == type)) && ((num42 != num44) && (num42 != type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 360;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 360;
                            }
                            else
                            {
                                rectangle.X = 90;
                                rectangle.Y = 360;
                            }
                        }
                        else if (((num42 == num44) || (num42 == type)) && ((num37 != num44) && (num37 != type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0;
                                rectangle.Y = 360;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x12;
                                rectangle.Y = 360;
                            }
                            else
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 360;
                            }
                        }
                    }
                    else if ((((num39 != type) && (num39 != num44)) && ((num36 == type) && (num41 == type))) && (num38 == type))
                    {
                        if (((index == num44) || (index == type)) && ((num40 != num44) && (num40 != type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0;
                                rectangle.Y = 0x17a;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x12;
                                rectangle.Y = 0x17a;
                            }
                            else
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0x17a;
                            }
                        }
                        else if (((num40 == num44) || (num40 == type)) && ((index != num44) && (index != type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0x17a;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 0x17a;
                            }
                            else
                            {
                                rectangle.X = 90;
                                rectangle.Y = 0x17a;
                            }
                        }
                    }
                    if (((((num36 == type) || (num36 == num44)) && ((num41 == type) || (num41 == num44))) && (((num38 == type) || (num38 == num44)) && ((num39 == type) || (num39 == num44)))) && (((index != -1) && (num37 != -1)) && ((num40 != -1) && (num42 != -1))))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 0x12;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x12;
                        }
                    }
                    if (num36 == num44)
                    {
                        num36 = -2;
                    }
                    if (num41 == num44)
                    {
                        num41 = -2;
                    }
                    if (num38 == num44)
                    {
                        num38 = -2;
                    }
                    if (num39 == num44)
                    {
                        num39 = -2;
                    }
                    if (index == num44)
                    {
                        index = -2;
                    }
                    if (num37 == num44)
                    {
                        num37 = -2;
                    }
                    if (num40 == num44)
                    {
                        num40 = -2;
                    }
                    if (num42 == num44)
                    {
                        num42 = -2;
                    }
                }
                if (((rectangle.X == -1) && (rectangle.Y == -1)) && (((Main.tileMergeDirt[type] || (type == 0)) || ((type == 2) || (type == 0x39))) || ((((type == 0x3a) || (type == 0x3b)) || ((type == 60) || (type == 70))) || (((type == 0x6d) || (type == 0x4c)) || (type == 0x4b)))))
                {
                    if (!flag3)
                    {
                        flag3 = true;
                        if (((num36 > -1) && !Main.tileSolid[num36]) && (num36 != type))
                        {
                            num36 = -1;
                        }
                        if (((num41 > -1) && !Main.tileSolid[num41]) && (num41 != type))
                        {
                            num41 = -1;
                        }
                        if (((num38 > -1) && !Main.tileSolid[num38]) && (num38 != type))
                        {
                            num38 = -1;
                        }
                        if (((num39 > -1) && !Main.tileSolid[num39]) && (num39 != type))
                        {
                            num39 = -1;
                        }
                        if (((index > -1) && !Main.tileSolid[index]) && (index != type))
                        {
                            index = -1;
                        }
                        if (((num37 > -1) && !Main.tileSolid[num37]) && (num37 != type))
                        {
                            num37 = -1;
                        }
                        if (((num40 > -1) && !Main.tileSolid[num40]) && (num40 != type))
                        {
                            num40 = -1;
                        }
                        if (((num42 > -1) && !Main.tileSolid[num42]) && (num42 != type))
                        {
                            num42 = -1;
                        }
                    }
                    if ((num36 >= 0) && (num36 != type))
                    {
                        num36 = -1;
                    }
                    if ((num41 >= 0) && (num41 != type))
                    {
                        num41 = -1;
                    }
                    if ((num38 >= 0) && (num38 != type))
                    {
                        num38 = -1;
                    }
                    if ((num39 >= 0) && (num39 != type))
                    {
                        num39 = -1;
                    }
                    if (((num36 != -1) && (num41 != -1)) && ((num38 != -1) && (num39 != -1)))
                    {
                        if (((num36 == -2) && (num41 == type)) && ((num38 == type) && (num39 == type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x90;
                                rectangle.Y = 0x6c;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0xa2;
                                rectangle.Y = 0x6c;
                            }
                            else
                            {
                                rectangle.X = 180;
                                rectangle.Y = 0x6c;
                            }
                            WorldGen.mergeUp = true;
                        }
                        else if (((num36 == type) && (num41 == -2)) && ((num38 == type) && (num39 == type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x90;
                                rectangle.Y = 90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0xa2;
                                rectangle.Y = 90;
                            }
                            else
                            {
                                rectangle.X = 180;
                                rectangle.Y = 90;
                            }
                            WorldGen.mergeDown = true;
                        }
                        else if (((num36 == type) && (num41 == type)) && ((num38 == -2) && (num39 == type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0xa2;
                                rectangle.Y = 0x7e;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0xa2;
                                rectangle.Y = 0x90;
                            }
                            else
                            {
                                rectangle.X = 0xa2;
                                rectangle.Y = 0xa2;
                            }
                            WorldGen.mergeLeft = true;
                        }
                        else if (((num36 == type) && (num41 == type)) && ((num38 == type) && (num39 == -2)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x90;
                                rectangle.Y = 0x7e;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x90;
                                rectangle.Y = 0x90;
                            }
                            else
                            {
                                rectangle.X = 0x90;
                                rectangle.Y = 0xa2;
                            }
                            WorldGen.mergeRight = true;
                        }
                        else if (((num36 == -2) && (num41 == type)) && ((num38 == -2) && (num39 == type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0x7e;
                            }
                            else
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0xa2;
                            }
                            WorldGen.mergeUp = true;
                            WorldGen.mergeLeft = true;
                        }
                        else if (((num36 == -2) && (num41 == type)) && ((num38 == type) && (num39 == -2)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0x7e;
                            }
                            else
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0xa2;
                            }
                            WorldGen.mergeUp = true;
                            WorldGen.mergeRight = true;
                        }
                        else if (((num36 == type) && (num41 == -2)) && ((num38 == -2) && (num39 == type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0x6c;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0x90;
                            }
                            else
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 180;
                            }
                            WorldGen.mergeDown = true;
                            WorldGen.mergeLeft = true;
                        }
                        else if (((num36 == type) && (num41 == -2)) && ((num38 == type) && (num39 == -2)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0x6c;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0x90;
                            }
                            else
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 180;
                            }
                            WorldGen.mergeDown = true;
                            WorldGen.mergeRight = true;
                        }
                        else if (((num36 == type) && (num41 == type)) && ((num38 == -2) && (num39 == -2)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 180;
                                rectangle.Y = 0x7e;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 180;
                                rectangle.Y = 0x90;
                            }
                            else
                            {
                                rectangle.X = 180;
                                rectangle.Y = 0xa2;
                            }
                            WorldGen.mergeLeft = true;
                            WorldGen.mergeRight = true;
                        }
                        else if (((num36 == -2) && (num41 == -2)) && ((num38 == type) && (num39 == type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x90;
                                rectangle.Y = 180;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0xa2;
                                rectangle.Y = 180;
                            }
                            else
                            {
                                rectangle.X = 180;
                                rectangle.Y = 180;
                            }
                            WorldGen.mergeUp = true;
                            WorldGen.mergeDown = true;
                        }
                        else if (((num36 == -2) && (num41 == type)) && ((num38 == -2) && (num39 == -2)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0xc6;
                                rectangle.Y = 90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0xc6;
                                rectangle.Y = 0x6c;
                            }
                            else
                            {
                                rectangle.X = 0xc6;
                                rectangle.Y = 0x7e;
                            }
                            WorldGen.mergeUp = true;
                            WorldGen.mergeLeft = true;
                            WorldGen.mergeRight = true;
                        }
                        else if (((num36 == type) && (num41 == -2)) && ((num38 == -2) && (num39 == -2)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0xc6;
                                rectangle.Y = 0x90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0xc6;
                                rectangle.Y = 0xa2;
                            }
                            else
                            {
                                rectangle.X = 0xc6;
                                rectangle.Y = 180;
                            }
                            WorldGen.mergeDown = true;
                            WorldGen.mergeLeft = true;
                            WorldGen.mergeRight = true;
                        }
                        else if (((num36 == -2) && (num41 == -2)) && ((num38 == type) && (num39 == -2)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0xd8;
                                rectangle.Y = 0x90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0xd8;
                                rectangle.Y = 0xa2;
                            }
                            else
                            {
                                rectangle.X = 0xd8;
                                rectangle.Y = 180;
                            }
                            WorldGen.mergeUp = true;
                            WorldGen.mergeDown = true;
                            WorldGen.mergeRight = true;
                        }
                        else if (((num36 == -2) && (num41 == -2)) && ((num38 == -2) && (num39 == type)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0xd8;
                                rectangle.Y = 90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0xd8;
                                rectangle.Y = 0x6c;
                            }
                            else
                            {
                                rectangle.X = 0xd8;
                                rectangle.Y = 0x7e;
                            }
                            WorldGen.mergeUp = true;
                            WorldGen.mergeDown = true;
                            WorldGen.mergeLeft = true;
                        }
                        else if (((num36 == -2) && (num41 == -2)) && ((num38 == -2) && (num39 == -2)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x6c;
                                rectangle.Y = 0xc6;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x7e;
                                rectangle.Y = 0xc6;
                            }
                            else
                            {
                                rectangle.X = 0x90;
                                rectangle.Y = 0xc6;
                            }
                            WorldGen.mergeUp = true;
                            WorldGen.mergeDown = true;
                            WorldGen.mergeLeft = true;
                            WorldGen.mergeRight = true;
                        }
                        else if (((num36 == type) && (num41 == type)) && ((num38 == type) && (num39 == type)))
                        {
                            if (index == -2)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x12;
                                    rectangle.Y = 0x6c;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x12;
                                    rectangle.Y = 0x90;
                                }
                                else
                                {
                                    rectangle.X = 0x12;
                                    rectangle.Y = 180;
                                }
                            }
                            if (num37 == -2)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0;
                                    rectangle.Y = 0x6c;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0;
                                    rectangle.Y = 0x90;
                                }
                                else
                                {
                                    rectangle.X = 0;
                                    rectangle.Y = 180;
                                }
                            }
                            if (num40 == -2)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x12;
                                    rectangle.Y = 90;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x12;
                                    rectangle.Y = 0x7e;
                                }
                                else
                                {
                                    rectangle.X = 0x12;
                                    rectangle.Y = 0xa2;
                                }
                            }
                            if (num42 == -2)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0;
                                    rectangle.Y = 90;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0;
                                    rectangle.Y = 0x7e;
                                }
                                else
                                {
                                    rectangle.X = 0;
                                    rectangle.Y = 0xa2;
                                }
                            }
                        }
                    }
                    else
                    {
                        if ((((type != 2) && (type != 0x17)) && ((type != 60) && (type != 70))) && (type != 0x6d))
                        {
                            if (((num36 == -1) && (num41 == -2)) && ((num38 == type) && (num39 == type)))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0xea;
                                    rectangle.Y = 0;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0xfc;
                                    rectangle.Y = 0;
                                }
                                else
                                {
                                    rectangle.X = 270;
                                    rectangle.Y = 0;
                                }
                                WorldGen.mergeDown = true;
                            }
                            else if (((num36 == -2) && (num41 == -1)) && ((num38 == type) && (num39 == type)))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0xea;
                                    rectangle.Y = 0x12;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0xfc;
                                    rectangle.Y = 0x12;
                                }
                                else
                                {
                                    rectangle.X = 270;
                                    rectangle.Y = 0x12;
                                }
                                WorldGen.mergeUp = true;
                            }
                            else if (((num36 == type) && (num41 == type)) && ((num38 == -1) && (num39 == -2)))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0xea;
                                    rectangle.Y = 0x24;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0xfc;
                                    rectangle.Y = 0x24;
                                }
                                else
                                {
                                    rectangle.X = 270;
                                    rectangle.Y = 0x24;
                                }
                                WorldGen.mergeRight = true;
                            }
                            else if (((num36 == type) && (num41 == type)) && ((num38 == -2) && (num39 == -1)))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0xea;
                                    rectangle.Y = 0x36;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0xfc;
                                    rectangle.Y = 0x36;
                                }
                                else
                                {
                                    rectangle.X = 270;
                                    rectangle.Y = 0x36;
                                }
                                WorldGen.mergeLeft = true;
                            }
                        }
                        if (((num36 != -1) && (num41 != -1)) && ((num38 == -1) && (num39 == type)))
                        {
                            if ((num36 == -2) && (num41 == type))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x48;
                                    rectangle.Y = 0x90;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x48;
                                    rectangle.Y = 0xa2;
                                }
                                else
                                {
                                    rectangle.X = 0x48;
                                    rectangle.Y = 180;
                                }
                                WorldGen.mergeUp = true;
                            }
                            else if ((num41 == -2) && (num36 == type))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x48;
                                    rectangle.Y = 90;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x48;
                                    rectangle.Y = 0x6c;
                                }
                                else
                                {
                                    rectangle.X = 0x48;
                                    rectangle.Y = 0x7e;
                                }
                                WorldGen.mergeDown = true;
                            }
                        }
                        else if (((num36 != -1) && (num41 != -1)) && ((num38 == type) && (num39 == -1)))
                        {
                            if ((num36 == -2) && (num41 == type))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 90;
                                    rectangle.Y = 0x90;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 90;
                                    rectangle.Y = 0xa2;
                                }
                                else
                                {
                                    rectangle.X = 90;
                                    rectangle.Y = 180;
                                }
                                WorldGen.mergeUp = true;
                            }
                            else if ((num41 == -2) && (num36 == type))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 90;
                                    rectangle.Y = 90;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 90;
                                    rectangle.Y = 0x6c;
                                }
                                else
                                {
                                    rectangle.X = 90;
                                    rectangle.Y = 0x7e;
                                }
                                WorldGen.mergeDown = true;
                            }
                        }
                        else if (((num36 == -1) && (num41 == type)) && ((num38 != -1) && (num39 != -1)))
                        {
                            if ((num38 == -2) && (num39 == type))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0;
                                    rectangle.Y = 0xc6;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x12;
                                    rectangle.Y = 0xc6;
                                }
                                else
                                {
                                    rectangle.X = 0x24;
                                    rectangle.Y = 0xc6;
                                }
                                WorldGen.mergeLeft = true;
                            }
                            else if ((num39 == -2) && (num38 == type))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x36;
                                    rectangle.Y = 0xc6;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x48;
                                    rectangle.Y = 0xc6;
                                }
                                else
                                {
                                    rectangle.X = 90;
                                    rectangle.Y = 0xc6;
                                }
                                WorldGen.mergeRight = true;
                            }
                        }
                        else if (((num36 == type) && (num41 == -1)) && ((num38 != -1) && (num39 != -1)))
                        {
                            if ((num38 == -2) && (num39 == type))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0;
                                    rectangle.Y = 0xd8;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x12;
                                    rectangle.Y = 0xd8;
                                }
                                else
                                {
                                    rectangle.X = 0x24;
                                    rectangle.Y = 0xd8;
                                }
                                WorldGen.mergeLeft = true;
                            }
                            else if ((num39 == -2) && (num38 == type))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x36;
                                    rectangle.Y = 0xd8;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x48;
                                    rectangle.Y = 0xd8;
                                }
                                else
                                {
                                    rectangle.X = 90;
                                    rectangle.Y = 0xd8;
                                }
                                WorldGen.mergeRight = true;
                            }
                        }
                        else if (((num36 != -1) && (num41 != -1)) && ((num38 == -1) && (num39 == -1)))
                        {
                            if ((num36 == -2) && (num41 == -2))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x6c;
                                    rectangle.Y = 0xd8;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x6c;
                                    rectangle.Y = 0xea;
                                }
                                else
                                {
                                    rectangle.X = 0x6c;
                                    rectangle.Y = 0xfc;
                                }
                                WorldGen.mergeUp = true;
                                WorldGen.mergeDown = true;
                            }
                            else if (num36 == -2)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x7e;
                                    rectangle.Y = 0x90;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x7e;
                                    rectangle.Y = 0xa2;
                                }
                                else
                                {
                                    rectangle.X = 0x7e;
                                    rectangle.Y = 180;
                                }
                                WorldGen.mergeUp = true;
                            }
                            else if (num41 == -2)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x7e;
                                    rectangle.Y = 90;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x7e;
                                    rectangle.Y = 0x6c;
                                }
                                else
                                {
                                    rectangle.X = 0x7e;
                                    rectangle.Y = 0x7e;
                                }
                                WorldGen.mergeDown = true;
                            }
                        }
                        else if (((num36 == -1) && (num41 == -1)) && ((num38 != -1) && (num39 != -1)))
                        {
                            if ((num38 == -2) && (num39 == -2))
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0xa2;
                                    rectangle.Y = 0xc6;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 180;
                                    rectangle.Y = 0xc6;
                                }
                                else
                                {
                                    rectangle.X = 0xc6;
                                    rectangle.Y = 0xc6;
                                }
                                WorldGen.mergeLeft = true;
                                WorldGen.mergeRight = true;
                            }
                            else if (num38 == -2)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0;
                                    rectangle.Y = 0xfc;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x12;
                                    rectangle.Y = 0xfc;
                                }
                                else
                                {
                                    rectangle.X = 0x24;
                                    rectangle.Y = 0xfc;
                                }
                                WorldGen.mergeLeft = true;
                            }
                            else if (num39 == -2)
                            {
                                if (frameNumber == 0)
                                {
                                    rectangle.X = 0x36;
                                    rectangle.Y = 0xfc;
                                }
                                else if (frameNumber == 1)
                                {
                                    rectangle.X = 0x48;
                                    rectangle.Y = 0xfc;
                                }
                                else
                                {
                                    rectangle.X = 90;
                                    rectangle.Y = 0xfc;
                                }
                                WorldGen.mergeRight = true;
                            }
                        }
                        else if (((num36 == -2) && (num41 == -1)) && ((num38 == -1) && (num39 == -1)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x6c;
                                rectangle.Y = 0x90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x6c;
                                rectangle.Y = 0xa2;
                            }
                            else
                            {
                                rectangle.X = 0x6c;
                                rectangle.Y = 180;
                            }
                            WorldGen.mergeUp = true;
                        }
                        else if (((num36 == -1) && (num41 == -2)) && ((num38 == -1) && (num39 == -1)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x6c;
                                rectangle.Y = 90;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x6c;
                                rectangle.Y = 0x6c;
                            }
                            else
                            {
                                rectangle.X = 0x6c;
                                rectangle.Y = 0x7e;
                            }
                            WorldGen.mergeDown = true;
                        }
                        else if (((num36 == -1) && (num41 == -1)) && ((num38 == -2) && (num39 == -1)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0;
                                rectangle.Y = 0xea;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x12;
                                rectangle.Y = 0xea;
                            }
                            else
                            {
                                rectangle.X = 0x24;
                                rectangle.Y = 0xea;
                            }
                            WorldGen.mergeLeft = true;
                        }
                        else if (((num36 == -1) && (num41 == -1)) && ((num38 == -1) && (num39 == -2)))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x36;
                                rectangle.Y = 0xea;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x48;
                                rectangle.Y = 0xea;
                            }
                            else
                            {
                                rectangle.X = 90;
                                rectangle.Y = 0xea;
                            }
                            WorldGen.mergeRight = true;
                        }
                    }
                }
                if ((rectangle.X < 0) || (rectangle.Y < 0))
                {
                    if (!flag3)
                    {
                        flag3 = true;
                        if (((num36 > -1) && !Main.tileSolid[num36]) && (num36 != type))
                        {
                            num36 = -1;
                        }
                        if (((num41 > -1) && !Main.tileSolid[num41]) && (num41 != type))
                        {
                            num41 = -1;
                        }
                        if (((num38 > -1) && !Main.tileSolid[num38]) && (num38 != type))
                        {
                            num38 = -1;
                        }
                        if (((num39 > -1) && !Main.tileSolid[num39]) && (num39 != type))
                        {
                            num39 = -1;
                        }
                        if (((index > -1) && !Main.tileSolid[index]) && (index != type))
                        {
                            index = -1;
                        }
                        if (((num37 > -1) && !Main.tileSolid[num37]) && (num37 != type))
                        {
                            num37 = -1;
                        }
                        if (((num40 > -1) && !Main.tileSolid[num40]) && (num40 != type))
                        {
                            num40 = -1;
                        }
                        if (((num42 > -1) && !Main.tileSolid[num42]) && (num42 != type))
                        {
                            num42 = -1;
                        }
                    }
                    if (((type == 2) || (type == 0x17)) || (((type == 60) || (type == 70)) || (type == 0x6d)))
                    {
                        if (num36 == -2)
                        {
                            num36 = type;
                        }
                        if (num41 == -2)
                        {
                            num41 = type;
                        }
                        if (num38 == -2)
                        {
                            num38 = type;
                        }
                        if (num39 == -2)
                        {
                            num39 = type;
                        }
                        if (index == -2)
                        {
                            index = type;
                        }
                        if (num37 == -2)
                        {
                            num37 = type;
                        }
                        if (num40 == -2)
                        {
                            num40 = type;
                        }
                        if (num42 == -2)
                        {
                            num42 = type;
                        }
                    }
                    if (((num36 == type) && (num41 == type)) && ((num38 == type) & (num39 == type)))
                    {
                        if ((index != type) && (num37 != type))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x6c;
                                rectangle.Y = 0x12;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x7e;
                                rectangle.Y = 0x12;
                            }
                            else
                            {
                                rectangle.X = 0x90;
                                rectangle.Y = 0x12;
                            }
                        }
                        else if ((num40 != type) && (num42 != type))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0x6c;
                                rectangle.Y = 0x24;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0x7e;
                                rectangle.Y = 0x24;
                            }
                            else
                            {
                                rectangle.X = 0x90;
                                rectangle.Y = 0x24;
                            }
                        }
                        else if ((index != type) && (num40 != type))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 180;
                                rectangle.Y = 0;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 180;
                                rectangle.Y = 0x12;
                            }
                            else
                            {
                                rectangle.X = 180;
                                rectangle.Y = 0x24;
                            }
                        }
                        else if ((num37 != type) && (num42 != type))
                        {
                            if (frameNumber == 0)
                            {
                                rectangle.X = 0xc6;
                                rectangle.Y = 0;
                            }
                            else if (frameNumber == 1)
                            {
                                rectangle.X = 0xc6;
                                rectangle.Y = 0x12;
                            }
                            else
                            {
                                rectangle.X = 0xc6;
                                rectangle.Y = 0x24;
                            }
                        }
                        else if (frameNumber == 0)
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 0x12;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x12;
                        }
                    }
                    else if (((num36 != type) && (num41 == type)) && ((num38 == type) & (num39 == type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 0;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0;
                        }
                        else
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0;
                        }
                    }
                    else if (((num36 == type) && (num41 != type)) && ((num38 == type) & (num39 == type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 0x24;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0x24;
                        }
                        else
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if (((num36 == type) && (num41 == type)) && ((num38 != type) & (num39 == type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0;
                            rectangle.Y = 0;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if (((num36 == type) && (num41 == type)) && ((num38 == type) & (num39 != type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x48;
                            rectangle.Y = 0;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x48;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0x48;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if (((num36 != type) && (num41 == type)) && ((num38 != type) & (num39 == type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0;
                            rectangle.Y = 0x36;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0x36;
                        }
                        else
                        {
                            rectangle.X = 0x48;
                            rectangle.Y = 0x36;
                        }
                    }
                    else if (((num36 != type) && (num41 == type)) && ((num38 == type) & (num39 != type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 0x36;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x36;
                        }
                        else
                        {
                            rectangle.X = 90;
                            rectangle.Y = 0x36;
                        }
                    }
                    else if (((num36 == type) && (num41 != type)) && ((num38 != type) & (num39 == type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0;
                            rectangle.Y = 0x48;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0x48;
                        }
                        else
                        {
                            rectangle.X = 0x48;
                            rectangle.Y = 0x48;
                        }
                    }
                    else if (((num36 == type) && (num41 != type)) && ((num38 == type) & (num39 != type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 0x48;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x48;
                        }
                        else
                        {
                            rectangle.X = 90;
                            rectangle.Y = 0x48;
                        }
                    }
                    else if (((num36 == type) && (num41 == type)) && ((num38 != type) & (num39 != type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 90;
                            rectangle.Y = 0;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 90;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 90;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if (((num36 != type) && (num41 != type)) && ((num38 == type) & (num39 == type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x6c;
                            rectangle.Y = 0x48;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x7e;
                            rectangle.Y = 0x48;
                        }
                        else
                        {
                            rectangle.X = 0x90;
                            rectangle.Y = 0x48;
                        }
                    }
                    else if (((num36 != type) && (num41 == type)) && ((num38 != type) & (num39 != type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x6c;
                            rectangle.Y = 0;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x7e;
                            rectangle.Y = 0;
                        }
                        else
                        {
                            rectangle.X = 0x90;
                            rectangle.Y = 0;
                        }
                    }
                    else if (((num36 == type) && (num41 != type)) && ((num38 != type) & (num39 != type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0x6c;
                            rectangle.Y = 0x36;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0x7e;
                            rectangle.Y = 0x36;
                        }
                        else
                        {
                            rectangle.X = 0x90;
                            rectangle.Y = 0x36;
                        }
                    }
                    else if (((num36 != type) && (num41 != type)) && ((num38 != type) & (num39 == type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0xa2;
                            rectangle.Y = 0;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0xa2;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0xa2;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if (((num36 != type) && (num41 != type)) && ((num38 == type) & (num39 != type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0xd8;
                            rectangle.Y = 0;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 0xd8;
                            rectangle.Y = 0x12;
                        }
                        else
                        {
                            rectangle.X = 0xd8;
                            rectangle.Y = 0x24;
                        }
                    }
                    else if (((num36 != type) && (num41 != type)) && ((num38 != type) & (num39 != type)))
                    {
                        if (frameNumber == 0)
                        {
                            rectangle.X = 0xa2;
                            rectangle.Y = 0x36;
                        }
                        else if (frameNumber == 1)
                        {
                            rectangle.X = 180;
                            rectangle.Y = 0x36;
                        }
                        else
                        {
                            rectangle.X = 0xc6;
                            rectangle.Y = 0x36;
                        }
                    }
                }
                if ((rectangle.X <= -1) || (rectangle.Y <= -1))
                {
                    if (frameNumber <= 0)
                    {
                        rectangle.X = 0x12;
                        rectangle.Y = 0x12;
                    }
                    else if (frameNumber == 1)
                    {
                        rectangle.X = 0x24;
                        rectangle.Y = 0x12;
                    }
                    if (frameNumber >= 2)
                    {
                        rectangle.X = 0x36;
                        rectangle.Y = 0x12;
                    }
                }
                Main.tile[i, j].frameX = (short) rectangle.X;
                Main.tile[i, j].frameY = (short) rectangle.Y;
                if (((type == 0x34) || (type == 0x3e)) || (type == 0x73))
                {
                    if (Main.tile[i, j - 1] != null)
                    {
                        if (!Main.tile[i, j - 1].active)
                        {
                            num36 = -1;
                        }
                        else
                        {
                            num36 = Main.tile[i, j - 1].type;
                        }
                    }
                    else
                    {
                        num36 = type;
                    }
                    if ((type == 0x34) && ((num36 == 0x6d) || (num36 == 0x73)))
                    {
                        Main.tile[i, j].type = 0x73;
                        SquareTileFrame(i, j, true);
                        return;
                    }
                    if ((type == 0x73) && ((num36 == 2) || (num36 == 0x34)))
                    {
                        Main.tile[i, j].type = 0x34;
                        SquareTileFrame(i, j, true);
                        return;
                    }
                    if (num36 != type)
                    {
                        bool flag4 = false;
                        if (num36 == -1)
                        {
                            flag4 = true;
                        }
                        if ((type == 0x34) && (num36 != 2))
                        {
                            flag4 = true;
                        }
                        if ((type == 0x3e) && (num36 != 60))
                        {
                            flag4 = true;
                        }
                        if ((type == 0x73) && (num36 != 0x6d))
                        {
                            flag4 = true;
                        }
                        if (flag4)
                        {
                            KillTile(i, j, false, false, false);
                        }
                    }
                }
                if (!noTileActions && (((type == 0x35) || (type == 0x70)) || ((type == 0x74) || (type == 0x7b))))
                {
                    if (Main.netMode == 0)
                    {
                        if ((Main.tile[i, j + 1] != null) && !Main.tile[i, j + 1].active)
                        {
                            bool flag5 = true;
                            if (Main.tile[i, j - 1].active && (Main.tile[i, j - 1].type == 0x15))
                            {
                                flag5 = false;
                            }
                            if (flag5)
                            {
                                int num45 = 0x1f;
                                switch (type)
                                {
                                    case 0x3b:
                                        num45 = 0x27;
                                        break;

                                    case 0x39:
                                        num45 = 40;
                                        break;

                                    case 0x70:
                                        num45 = 0x38;
                                        break;

                                    case 0x74:
                                        num45 = 0x43;
                                        break;

                                    case 0x7b:
                                        num45 = 0x47;
                                        break;
                                }
                                Main.tile[i, j].active = false;
                                int num46 = Projectile.NewProjectile((float) ((i * 0x10) + 8), (float) ((j * 0x10) + 8), 0f, 0.41f, num45, 10, 0f, Main.myPlayer);
                                Main.projectile[num46].ai[0] = 1f;
                                SquareTileFrame(i, j, true);
                            }
                        }
                    }
                    else if (((Main.netMode == 2) && (Main.tile[i, j + 1] != null)) && !Main.tile[i, j + 1].active)
                    {
                        bool flag6 = true;
                        if (Main.tile[i, j - 1].active && (Main.tile[i, j - 1].type == 0x15))
                        {
                            flag6 = false;
                        }
                        if (flag6)
                        {
                            int num47 = 0x1f;
                            switch (type)
                            {
                                case 0x3b:
                                    num47 = 0x27;
                                    break;

                                case 0x39:
                                    num47 = 40;
                                    break;

                                case 0x70:
                                    num47 = 0x38;
                                    break;

                                case 0x74:
                                    num47 = 0x43;
                                    break;

                                case 0x7b:
                                    num47 = 0x47;
                                    break;
                            }
                            Main.tile[i, j].active = false;
                            int num48 = Projectile.NewProjectile((float) ((i * 0x10) + 8), (float) ((j * 0x10) + 8), 0f, 2.5f, num47, 10, 0f, Main.myPlayer);
                            Main.projectile[num48].velocity.Y = 0.5f;
                            Main.projectile[num48].position.Y += 2f;
                            Main.projectile[num48].netUpdate = true;
                            NetMessage.SendTileSquare(-1, i, j, 1);
                            SquareTileFrame(i, j, true);
                        }
                    }
                }
                if (((rectangle.X != frameX) && (rectangle.Y != frameY)) && ((frameX >= 0) && (frameY >= 0)))
                {
                    bool mergeUp = WorldGen.mergeUp;
                    bool mergeDown = WorldGen.mergeDown;
                    bool mergeLeft = WorldGen.mergeLeft;
                    bool mergeRight = WorldGen.mergeRight;
                    TileFrame(i - 1, j, false, false);
                    TileFrame(i + 1, j, false, false);
                    TileFrame(i, j - 1, false, false);
                    TileFrame(i, j + 1, false, false);
                    WorldGen.mergeUp = mergeUp;
                    WorldGen.mergeDown = mergeDown;
                    WorldGen.mergeLeft = mergeLeft;
                    WorldGen.mergeRight = mergeRight;
                }
            }
            catch
            {
            }
        }

        public static void TileRunner(int i, int j, double strength, int steps, int type, bool addTile = false, float speedX = 0f, float speedY = 0f, bool noYChange = false, bool overRide = true)
        {
            Vector2 vector;
            Vector2 vector2;
            double num5 = strength;
            float num6 = steps;
            vector.X = i;
            vector.Y = j;
            vector2.X = genRand.Next(-10, 11) * 0.1f;
            vector2.Y = genRand.Next(-10, 11) * 0.1f;
            if ((speedX != 0f) || (speedY != 0f))
            {
                vector2.X = speedX;
                vector2.Y = speedY;
            }
            while ((num5 > 0.0) && (num6 > 0f))
            {
                if (((vector.Y < 0f) && (num6 > 0f)) && (type == 0x3b))
                {
                    num6 = 0f;
                }
                num5 = strength * (num6 / ((float) steps));
                num6--;
                int num = (int) (vector.X - (num5 * 0.5));
                int maxTilesX = (int) (vector.X + (num5 * 0.5));
                int num2 = (int) (vector.Y - (num5 * 0.5));
                int maxTilesY = (int) (vector.Y + (num5 * 0.5));
                if (num < 0)
                {
                    num = 0;
                }
                if (maxTilesX > Main.maxTilesX)
                {
                    maxTilesX = Main.maxTilesX;
                }
                if (num2 < 0)
                {
                    num2 = 0;
                }
                if (maxTilesY > Main.maxTilesY)
                {
                    maxTilesY = Main.maxTilesY;
                }
                for (int k = num; k < maxTilesX; k++)
                {
                    for (int m = num2; m < maxTilesY; m++)
                    {
                        if ((Math.Abs((float) (k - vector.X)) + Math.Abs((float) (m - vector.Y))) < ((strength * 0.5) * (1.0 + (genRand.Next(-10, 11) * 0.015))))
                        {
                            if ((mudWall && (m > Main.worldSurface)) && (m < ((Main.maxTilesY - 210) - genRand.Next(3))))
                            {
                                PlaceWall(k, m, 15, true);
                            }
                            if (type < 0)
                            {
                                if (((type == -2) && Main.tile[k, m].active) && ((m < waterLine) || (m > lavaLine)))
                                {
                                    Main.tile[k, m].liquid = 0xff;
                                    if (m > lavaLine)
                                    {
                                        Main.tile[k, m].lava = true;
                                    }
                                }
                                Main.tile[k, m].active = false;
                            }
                            else
                            {
                                if (((overRide || !Main.tile[k, m].active) && ((type != 40) || (Main.tile[k, m].type != 0x35))) && ((!Main.tileStone[type] || (Main.tile[k, m].type == 1)) && ((Main.tile[k, m].type != 0x2d) && (((Main.tile[k, m].type != 1) || (type != 0x3b)) || (m >= (Main.worldSurface + genRand.Next(-50, 50)))))))
                                {
                                    if ((Main.tile[k, m].type != 0x35) || (m >= Main.worldSurface))
                                    {
                                        Main.tile[k, m].type = (byte) type;
                                    }
                                    else if (type == 0x3b)
                                    {
                                        Main.tile[k, m].type = (byte) type;
                                    }
                                }
                                if (addTile)
                                {
                                    Main.tile[k, m].active = true;
                                    Main.tile[k, m].liquid = 0;
                                    Main.tile[k, m].lava = false;
                                }
                                if ((noYChange && (m < Main.worldSurface)) && (type != 0x3b))
                                {
                                    Main.tile[k, m].wall = 2;
                                }
                                if (((type == 0x3b) && (m > waterLine)) && (Main.tile[k, m].liquid > 0))
                                {
                                    Main.tile[k, m].lava = false;
                                    Main.tile[k, m].liquid = 0;
                                }
                            }
                        }
                    }
                }
                vector += vector2;
                if (num5 > 50.0)
                {
                    vector += vector2;
                    num6--;
                    vector2.Y += genRand.Next(-10, 11) * 0.05f;
                    vector2.X += genRand.Next(-10, 11) * 0.05f;
                    if (num5 > 100.0)
                    {
                        vector += vector2;
                        num6--;
                        vector2.Y += genRand.Next(-10, 11) * 0.05f;
                        vector2.X += genRand.Next(-10, 11) * 0.05f;
                        if (num5 > 150.0)
                        {
                            vector += vector2;
                            num6--;
                            vector2.Y += genRand.Next(-10, 11) * 0.05f;
                            vector2.X += genRand.Next(-10, 11) * 0.05f;
                            if (num5 > 200.0)
                            {
                                vector += vector2;
                                num6--;
                                vector2.Y += genRand.Next(-10, 11) * 0.05f;
                                vector2.X += genRand.Next(-10, 11) * 0.05f;
                                if (num5 > 250.0)
                                {
                                    vector += vector2;
                                    num6--;
                                    vector2.Y += genRand.Next(-10, 11) * 0.05f;
                                    vector2.X += genRand.Next(-10, 11) * 0.05f;
                                    if (num5 > 300.0)
                                    {
                                        vector += vector2;
                                        num6--;
                                        vector2.Y += genRand.Next(-10, 11) * 0.05f;
                                        vector2.X += genRand.Next(-10, 11) * 0.05f;
                                        if (num5 > 400.0)
                                        {
                                            vector += vector2;
                                            num6--;
                                            vector2.Y += genRand.Next(-10, 11) * 0.05f;
                                            vector2.X += genRand.Next(-10, 11) * 0.05f;
                                            if (num5 > 500.0)
                                            {
                                                vector += vector2;
                                                num6--;
                                                vector2.Y += genRand.Next(-10, 11) * 0.05f;
                                                vector2.X += genRand.Next(-10, 11) * 0.05f;
                                                if (num5 > 600.0)
                                                {
                                                    vector += vector2;
                                                    num6--;
                                                    vector2.Y += genRand.Next(-10, 11) * 0.05f;
                                                    vector2.X += genRand.Next(-10, 11) * 0.05f;
                                                    if (num5 > 700.0)
                                                    {
                                                        vector += vector2;
                                                        num6--;
                                                        vector2.Y += genRand.Next(-10, 11) * 0.05f;
                                                        vector2.X += genRand.Next(-10, 11) * 0.05f;
                                                        if (num5 > 800.0)
                                                        {
                                                            vector += vector2;
                                                            num6--;
                                                            vector2.Y += genRand.Next(-10, 11) * 0.05f;
                                                            vector2.X += genRand.Next(-10, 11) * 0.05f;
                                                            if (num5 > 900.0)
                                                            {
                                                                vector += vector2;
                                                                num6--;
                                                                vector2.Y += genRand.Next(-10, 11) * 0.05f;
                                                                vector2.X += genRand.Next(-10, 11) * 0.05f;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                vector2.X += genRand.Next(-10, 11) * 0.05f;
                if (vector2.X > 1f)
                {
                    vector2.X = 1f;
                }
                if (vector2.X < -1f)
                {
                    vector2.X = -1f;
                }
                if (!noYChange)
                {
                    vector2.Y += genRand.Next(-10, 11) * 0.05f;
                    if (vector2.Y > 1f)
                    {
                        vector2.Y = 1f;
                    }
                    if (vector2.Y < -1f)
                    {
                        vector2.Y = -1f;
                    }
                }
                else if ((type != 0x3b) && (num5 < 3.0))
                {
                    if (vector2.Y > 1f)
                    {
                        vector2.Y = 1f;
                    }
                    if (vector2.Y < -1f)
                    {
                        vector2.Y = -1f;
                    }
                }
                if ((type == 0x3b) && !noYChange)
                {
                    if (vector2.Y > 0.5)
                    {
                        vector2.Y = 0.5f;
                    }
                    if (vector2.Y < -0.5)
                    {
                        vector2.Y = -0.5f;
                    }
                    if (vector.Y < (Main.rockLayer + 100.0))
                    {
                        vector2.Y = 1f;
                    }
                    if (vector.Y > (Main.maxTilesY - 300))
                    {
                        vector2.Y = -1f;
                    }
                }
            }
        }

        public static void TripWire(int i, int j)
        {
            if (Main.netMode != 1)
            {
                numWire = 0;
                numNoWire = 0;
                numInPump = 0;
                numOutPump = 0;
                noWire(i, j);
                hitWire(i, j);
                if ((numInPump > 0) && (numOutPump > 0))
                {
                    xferWater();
                }
            }
        }

        public static void UpdateMech()
        {
            for (int i = numMechs - 1; i >= 0; i--)
            {
                mechTime[i]--;
                if (Main.tile[mechX[i], mechY[i]].active && (Main.tile[mechX[i], mechY[i]].type == 0x90))
                {
                    if (Main.tile[mechX[i], mechY[i]].frameY == 0)
                    {
                        mechTime[i] = 0;
                    }
                    else
                    {
                        int num2 = Main.tile[mechX[i], mechY[i]].frameX / 0x12;
                        switch (num2)
                        {
                            case 0:
                                num2 = 60;
                                break;

                            case 1:
                                num2 = 180;
                                break;

                            case 2:
                                num2 = 300;
                                break;
                        }
                        if (Math.IEEERemainder((double) mechTime[i], (double) num2) == 0.0)
                        {
                            mechTime[i] = 0x4650;
                            TripWire(mechX[i], mechY[i]);
                        }
                    }
                }
                if (mechTime[i] <= 0)
                {
                    if (Main.tile[mechX[i], mechY[i]].active && (Main.tile[mechX[i], mechY[i]].type == 0x90))
                    {
                        Main.tile[mechX[i], mechY[i]].frameY = 0;
                        NetMessage.SendTileSquare(-1, mechX[i], mechY[i], 1);
                    }
                    for (int j = i; j < numMechs; j++)
                    {
                        mechX[j] = mechX[j + 1];
                        mechY[j] = mechY[j + 1];
                        mechTime[j] = mechTime[j + 1];
                    }
                    numMechs--;
                }
            }
        }

        public static void UpdateWorld()
        {
            UpdateMech();
            totalD++;
            if (totalD >= 10)
            {
                totalD = 0;
                CountTiles(totalX);
                totalX++;
                if (totalX >= Main.maxTilesX)
                {
                    totalX = 0;
                }
            }
            Liquid.skipCount++;
            if (Liquid.skipCount > 1)
            {
                Liquid.UpdateLiquid();
                Liquid.skipCount = 0;
            }
            float num = 3E-05f * Main.worldRate;
            float num2 = 1.5E-05f * Main.worldRate;
            bool flag = false;
            spawnDelay++;
            if (Main.invasionType > 0)
            {
                spawnDelay = 0;
            }
            if (spawnDelay >= 20)
            {
                flag = true;
                spawnDelay = 0;
                if (spawnNPC != 0x25)
                {
                    for (int k = 0; k < 200; k++)
                    {
                        if ((Main.npc[k].active && Main.npc[k].homeless) && Main.npc[k].townNPC)
                        {
                            spawnNPC = Main.npc[k].type;
                            break;
                        }
                    }
                }
            }
            for (int i = 0; i < ((Main.maxTilesX * Main.maxTilesY) * num); i++)
            {
                int x = genRand.Next(10, Main.maxTilesX - 10);
                int y = genRand.Next(10, ((int) Main.worldSurface) - 1);
                int num7 = x - 1;
                int num8 = x + 2;
                int num9 = y - 1;
                int num10 = y + 2;
                if (num7 < 10)
                {
                    num7 = 10;
                }
                if (num8 > (Main.maxTilesX - 10))
                {
                    num8 = Main.maxTilesX - 10;
                }
                if (num9 < 10)
                {
                    num9 = 10;
                }
                if (num10 > (Main.maxTilesY - 10))
                {
                    num10 = Main.maxTilesY - 10;
                }
                if (Main.tile[x, y] != null)
                {
                    if (Main.tileAlch[Main.tile[x, y].type])
                    {
                        GrowAlch(x, y);
                    }
                    if (Main.tile[x, y].liquid > 0x20)
                    {
                        if (Main.tile[x, y].active && (((Main.tile[x, y].type == 3) || (Main.tile[x, y].type == 20)) || (((Main.tile[x, y].type == 0x18) || (Main.tile[x, y].type == 0x1b)) || (Main.tile[x, y].type == 0x49))))
                        {
                            KillTile(x, y, false, false, false);
                            if (Main.netMode == 2)
                            {
                                NetMessage.SendData(0x11, -1, -1, "", 0, (float) x, (float) y, 0f, 0);
                            }
                        }
                    }
                    else if (Main.tile[x, y].active)
                    {
                        hardUpdateWorld(x, y);
                        if (Main.tile[x, y].type == 80)
                        {
                            if (genRand.Next(15) == 0)
                            {
                                GrowCactus(x, y);
                            }
                        }
                        else if (Main.tile[x, y].type == 0x35)
                        {
                            if (!Main.tile[x, num9].active)
                            {
                                if ((x < 250) || (x > (Main.maxTilesX - 250)))
                                {
                                    if ((((genRand.Next(500) == 0) && (Main.tile[x, num9].liquid == 0xff)) && ((Main.tile[x, num9 - 1].liquid == 0xff) && (Main.tile[x, num9 - 2].liquid == 0xff))) && ((Main.tile[x, num9 - 3].liquid == 0xff) && (Main.tile[x, num9 - 4].liquid == 0xff)))
                                    {
                                        PlaceTile(x, num9, 0x51, true, false, -1, 0);
                                        if ((Main.netMode == 2) && Main.tile[x, num9].active)
                                        {
                                            NetMessage.SendTileSquare(-1, x, num9, 1);
                                        }
                                    }
                                }
                                else if (((x > 400) && (x < (Main.maxTilesX - 400))) && (genRand.Next(300) == 0))
                                {
                                    GrowCactus(x, y);
                                }
                            }
                        }
                        else if ((Main.tile[x, y].type == 0x74) || (Main.tile[x, y].type == 0x70))
                        {
                            if ((!Main.tile[x, num9].active && (x > 400)) && ((x < (Main.maxTilesX - 400)) && (genRand.Next(300) == 0)))
                            {
                                GrowCactus(x, y);
                            }
                        }
                        else if (Main.tile[x, y].type == 0x4e)
                        {
                            if (!Main.tile[x, num9].active)
                            {
                                PlaceTile(x, num9, 3, true, false, -1, 0);
                                if ((Main.netMode == 2) && Main.tile[x, num9].active)
                                {
                                    NetMessage.SendTileSquare(-1, x, num9, 1);
                                }
                            }
                        }
                        else if (((Main.tile[x, y].type == 2) || (Main.tile[x, y].type == 0x17)) || ((Main.tile[x, y].type == 0x20) || (Main.tile[x, y].type == 0x6d)))
                        {
                            int type = Main.tile[x, y].type;
                            if ((!Main.tile[x, num9].active && (genRand.Next(12) == 0)) && (type == 2))
                            {
                                PlaceTile(x, num9, 3, true, false, -1, 0);
                                if ((Main.netMode == 2) && Main.tile[x, num9].active)
                                {
                                    NetMessage.SendTileSquare(-1, x, num9, 1);
                                }
                            }
                            if ((!Main.tile[x, num9].active && (genRand.Next(10) == 0)) && (type == 0x17))
                            {
                                PlaceTile(x, num9, 0x18, true, false, -1, 0);
                                if ((Main.netMode == 2) && Main.tile[x, num9].active)
                                {
                                    NetMessage.SendTileSquare(-1, x, num9, 1);
                                }
                            }
                            if ((!Main.tile[x, num9].active && (genRand.Next(10) == 0)) && (type == 0x6d))
                            {
                                PlaceTile(x, num9, 110, true, false, -1, 0);
                                if ((Main.netMode == 2) && Main.tile[x, num9].active)
                                {
                                    NetMessage.SendTileSquare(-1, x, num9, 1);
                                }
                            }
                            bool flag2 = false;
                            for (int m = num7; m < num8; m++)
                            {
                                for (int n = num9; n < num10; n++)
                                {
                                    if (((x != m) || (y != n)) && Main.tile[m, n].active)
                                    {
                                        if (type == 0x20)
                                        {
                                            type = 0x17;
                                        }
                                        if (((Main.tile[m, n].type == 0) || ((type == 0x17) && (Main.tile[m, n].type == 2))) || ((type == 0x17) && (Main.tile[m, n].type == 0x6d)))
                                        {
                                            SpreadGrass(m, n, 0, type, false);
                                            if (type == 0x17)
                                            {
                                                SpreadGrass(m, n, 2, type, false);
                                            }
                                            if (type == 0x17)
                                            {
                                                SpreadGrass(m, n, 0x6d, type, false);
                                            }
                                            if (Main.tile[m, n].type == type)
                                            {
                                                SquareTileFrame(m, n, true);
                                                flag2 = true;
                                            }
                                        }
                                        if (((Main.tile[m, n].type == 0) || ((type == 0x6d) && (Main.tile[m, n].type == 2))) || ((type == 0x6d) && (Main.tile[m, n].type == 0x17)))
                                        {
                                            SpreadGrass(m, n, 0, type, false);
                                            if (type == 0x6d)
                                            {
                                                SpreadGrass(m, n, 2, type, false);
                                            }
                                            if (type == 0x6d)
                                            {
                                                SpreadGrass(m, n, 0x17, type, false);
                                            }
                                            if (Main.tile[m, n].type == type)
                                            {
                                                SquareTileFrame(m, n, true);
                                                flag2 = true;
                                            }
                                        }
                                    }
                                }
                            }
                            if ((Main.netMode == 2) && flag2)
                            {
                                NetMessage.SendTileSquare(-1, x, y, 3);
                            }
                        }
                        else if (((Main.tile[x, y].type == 20) && (genRand.Next(20) == 0)) && !PlayerLOS(x, y))
                        {
                            GrowTree(x, y);
                        }
                        if (((Main.tile[x, y].type == 3) && (genRand.Next(20) == 0)) && (Main.tile[x, y].frameX < 0x90))
                        {
                            Main.tile[x, y].type = 0x49;
                            if (Main.netMode == 2)
                            {
                                NetMessage.SendTileSquare(-1, x, y, 3);
                            }
                        }
                        if (((Main.tile[x, y].type == 110) && (genRand.Next(20) == 0)) && (Main.tile[x, y].frameX < 0x90))
                        {
                            Main.tile[x, y].type = 0x71;
                            if (Main.netMode == 2)
                            {
                                NetMessage.SendTileSquare(-1, x, y, 3);
                            }
                        }
                        if ((Main.tile[x, y].type == 0x20) && (genRand.Next(3) == 0))
                        {
                            int num14 = x;
                            int num15 = y;
                            int num16 = 0;
                            if (Main.tile[num14 + 1, num15].active && (Main.tile[num14 + 1, num15].type == 0x20))
                            {
                                num16++;
                            }
                            if (Main.tile[num14 - 1, num15].active && (Main.tile[num14 - 1, num15].type == 0x20))
                            {
                                num16++;
                            }
                            if (Main.tile[num14, num15 + 1].active && (Main.tile[num14, num15 + 1].type == 0x20))
                            {
                                num16++;
                            }
                            if (Main.tile[num14, num15 - 1].active && (Main.tile[num14, num15 - 1].type == 0x20))
                            {
                                num16++;
                            }
                            if ((num16 < 3) || (Main.tile[x, y].type == 0x17))
                            {
                                switch (genRand.Next(4))
                                {
                                    case 0:
                                        num15--;
                                        break;

                                    case 1:
                                        num15++;
                                        break;

                                    case 2:
                                        num14--;
                                        break;

                                    case 3:
                                        num14++;
                                        break;
                                }
                                if (!Main.tile[num14, num15].active)
                                {
                                    num16 = 0;
                                    if (Main.tile[num14 + 1, num15].active && (Main.tile[num14 + 1, num15].type == 0x20))
                                    {
                                        num16++;
                                    }
                                    if (Main.tile[num14 - 1, num15].active && (Main.tile[num14 - 1, num15].type == 0x20))
                                    {
                                        num16++;
                                    }
                                    if (Main.tile[num14, num15 + 1].active && (Main.tile[num14, num15 + 1].type == 0x20))
                                    {
                                        num16++;
                                    }
                                    if (Main.tile[num14, num15 - 1].active && (Main.tile[num14, num15 - 1].type == 0x20))
                                    {
                                        num16++;
                                    }
                                    if (num16 < 2)
                                    {
                                        int num18 = 7;
                                        int num19 = num14 - num18;
                                        int num20 = num14 + num18;
                                        int num21 = num15 - num18;
                                        int num22 = num15 + num18;
                                        bool flag3 = false;
                                        for (int num23 = num19; num23 < num20; num23++)
                                        {
                                            for (int num24 = num21; num24 < num22; num24++)
                                            {
                                                if ((((((Math.Abs((int) (num23 - num14)) * 2) + Math.Abs((int) (num24 - num15))) < 9) && Main.tile[num23, num24].active) && ((Main.tile[num23, num24].type == 0x17) && Main.tile[num23, num24 - 1].active)) && ((Main.tile[num23, num24 - 1].type == 0x20) && (Main.tile[num23, num24 - 1].liquid == 0)))
                                                {
                                                    flag3 = true;
                                                    break;
                                                }
                                            }
                                        }
                                        if (flag3)
                                        {
                                            Main.tile[num14, num15].type = 0x20;
                                            Main.tile[num14, num15].active = true;
                                            SquareTileFrame(num14, num15, true);
                                            if (Main.netMode == 2)
                                            {
                                                NetMessage.SendTileSquare(-1, num14, num15, 3);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    else if (flag && (spawnNPC > 0))
                    {
                        SpawnNPC(x, y);
                    }
                    if (Main.tile[x, y].active)
                    {
                        if (((Main.tile[x, y].type == 2) || (Main.tile[x, y].type == 0x34)) && (((genRand.Next(40) == 0) && !Main.tile[x, y + 1].active) && !Main.tile[x, y + 1].lava))
                        {
                            bool flag4 = false;
                            for (int num25 = y; num25 > (y - 10); num25--)
                            {
                                if (Main.tile[x, num25].active && (Main.tile[x, num25].type == 2))
                                {
                                    flag4 = true;
                                    break;
                                }
                            }
                            if (flag4)
                            {
                                int num26 = x;
                                int num27 = y + 1;
                                Main.tile[num26, num27].type = 0x34;
                                Main.tile[num26, num27].active = true;
                                SquareTileFrame(num26, num27, true);
                                if (Main.netMode == 2)
                                {
                                    NetMessage.SendTileSquare(-1, num26, num27, 3);
                                }
                            }
                        }
                        if (Main.tile[x, y].type == 60)
                        {
                            int grass = Main.tile[x, y].type;
                            if (!Main.tile[x, num9].active && (genRand.Next(7) == 0))
                            {
                                PlaceTile(x, num9, 0x3d, true, false, -1, 0);
                                if ((Main.netMode == 2) && Main.tile[x, num9].active)
                                {
                                    NetMessage.SendTileSquare(-1, x, num9, 1);
                                }
                            }
                            else if (((genRand.Next(500) == 0) && ((!Main.tile[x, num9].active || (Main.tile[x, num9].type == 0x3d)) || ((Main.tile[x, num9].type == 0x4a) || (Main.tile[x, num9].type == 0x45)))) && !PlayerLOS(x, y))
                            {
                                GrowTree(x, y);
                            }
                            bool flag5 = false;
                            for (int num29 = num7; num29 < num8; num29++)
                            {
                                for (int num30 = num9; num30 < num10; num30++)
                                {
                                    if (((x != num29) || (y != num30)) && (Main.tile[num29, num30].active && (Main.tile[num29, num30].type == 0x3b)))
                                    {
                                        SpreadGrass(num29, num30, 0x3b, grass, false);
                                        if (Main.tile[num29, num30].type == grass)
                                        {
                                            SquareTileFrame(num29, num30, true);
                                            flag5 = true;
                                        }
                                    }
                                }
                            }
                            if ((Main.netMode == 2) && flag5)
                            {
                                NetMessage.SendTileSquare(-1, x, y, 3);
                            }
                        }
                        if (((Main.tile[x, y].type == 0x3d) && (genRand.Next(3) == 0)) && (Main.tile[x, y].frameX < 0x90))
                        {
                            Main.tile[x, y].type = 0x4a;
                            if (Main.netMode == 2)
                            {
                                NetMessage.SendTileSquare(-1, x, y, 3);
                            }
                        }
                        if (((Main.tile[x, y].type == 60) || (Main.tile[x, y].type == 0x3e)) && (((genRand.Next(15) == 0) && !Main.tile[x, y + 1].active) && !Main.tile[x, y + 1].lava))
                        {
                            bool flag6 = false;
                            for (int num31 = y; num31 > (y - 10); num31--)
                            {
                                if (Main.tile[x, num31].active && (Main.tile[x, num31].type == 60))
                                {
                                    flag6 = true;
                                    break;
                                }
                            }
                            if (flag6)
                            {
                                int num32 = x;
                                int num33 = y + 1;
                                Main.tile[num32, num33].type = 0x3e;
                                Main.tile[num32, num33].active = true;
                                SquareTileFrame(num32, num33, true);
                                if (Main.netMode == 2)
                                {
                                    NetMessage.SendTileSquare(-1, num32, num33, 3);
                                }
                            }
                        }
                        if (((Main.tile[x, y].type == 0x6d) || (Main.tile[x, y].type == 0x73)) && (((genRand.Next(15) == 0) && !Main.tile[x, y + 1].active) && !Main.tile[x, y + 1].lava))
                        {
                            bool flag7 = false;
                            for (int num34 = y; num34 > (y - 10); num34--)
                            {
                                if (Main.tile[x, num34].active && (Main.tile[x, num34].type == 0x6d))
                                {
                                    flag7 = true;
                                    break;
                                }
                            }
                            if (flag7)
                            {
                                int num35 = x;
                                int num36 = y + 1;
                                Main.tile[num35, num36].type = 0x73;
                                Main.tile[num35, num36].active = true;
                                SquareTileFrame(num35, num36, true);
                                if (Main.netMode == 2)
                                {
                                    NetMessage.SendTileSquare(-1, num35, num36, 3);
                                }
                            }
                        }
                    }
                }
            }
            for (int j = 0; j < ((Main.maxTilesX * Main.maxTilesY) * num2); j++)
            {
                int num38 = genRand.Next(10, Main.maxTilesX - 10);
                int num39 = genRand.Next(((int) Main.worldSurface) - 1, Main.maxTilesY - 20);
                int num40 = num38 - 1;
                int num41 = num38 + 2;
                int num42 = num39 - 1;
                int num43 = num39 + 2;
                if (num40 < 10)
                {
                    num40 = 10;
                }
                if (num41 > (Main.maxTilesX - 10))
                {
                    num41 = Main.maxTilesX - 10;
                }
                if (num42 < 10)
                {
                    num42 = 10;
                }
                if (num43 > (Main.maxTilesY - 10))
                {
                    num43 = Main.maxTilesY - 10;
                }
                if (Main.tile[num38, num39] != null)
                {
                    if (Main.tileAlch[Main.tile[num38, num39].type])
                    {
                        GrowAlch(num38, num39);
                    }
                    if (Main.tile[num38, num39].liquid <= 0x20)
                    {
                        if (Main.tile[num38, num39].active)
                        {
                            hardUpdateWorld(num38, num39);
                            if (((Main.tile[num38, num39].type == 0x17) && !Main.tile[num38, num42].active) && (genRand.Next(1) == 0))
                            {
                                PlaceTile(num38, num42, 0x18, true, false, -1, 0);
                                if ((Main.netMode == 2) && Main.tile[num38, num42].active)
                                {
                                    NetMessage.SendTileSquare(-1, num38, num42, 1);
                                }
                            }
                            if ((Main.tile[num38, num39].type == 0x20) && (genRand.Next(3) == 0))
                            {
                                int num44 = num38;
                                int num45 = num39;
                                int num46 = 0;
                                if (Main.tile[num44 + 1, num45].active && (Main.tile[num44 + 1, num45].type == 0x20))
                                {
                                    num46++;
                                }
                                if (Main.tile[num44 - 1, num45].active && (Main.tile[num44 - 1, num45].type == 0x20))
                                {
                                    num46++;
                                }
                                if (Main.tile[num44, num45 + 1].active && (Main.tile[num44, num45 + 1].type == 0x20))
                                {
                                    num46++;
                                }
                                if (Main.tile[num44, num45 - 1].active && (Main.tile[num44, num45 - 1].type == 0x20))
                                {
                                    num46++;
                                }
                                if ((num46 < 3) || (Main.tile[num38, num39].type == 0x17))
                                {
                                    switch (genRand.Next(4))
                                    {
                                        case 0:
                                            num45--;
                                            break;

                                        case 1:
                                            num45++;
                                            break;

                                        case 2:
                                            num44--;
                                            break;

                                        case 3:
                                            num44++;
                                            break;
                                    }
                                    if (!Main.tile[num44, num45].active)
                                    {
                                        num46 = 0;
                                        if (Main.tile[num44 + 1, num45].active && (Main.tile[num44 + 1, num45].type == 0x20))
                                        {
                                            num46++;
                                        }
                                        if (Main.tile[num44 - 1, num45].active && (Main.tile[num44 - 1, num45].type == 0x20))
                                        {
                                            num46++;
                                        }
                                        if (Main.tile[num44, num45 + 1].active && (Main.tile[num44, num45 + 1].type == 0x20))
                                        {
                                            num46++;
                                        }
                                        if (Main.tile[num44, num45 - 1].active && (Main.tile[num44, num45 - 1].type == 0x20))
                                        {
                                            num46++;
                                        }
                                        if (num46 < 2)
                                        {
                                            int num48 = 7;
                                            int num49 = num44 - num48;
                                            int num50 = num44 + num48;
                                            int num51 = num45 - num48;
                                            int num52 = num45 + num48;
                                            bool flag8 = false;
                                            for (int num53 = num49; num53 < num50; num53++)
                                            {
                                                for (int num54 = num51; num54 < num52; num54++)
                                                {
                                                    if ((((((Math.Abs((int) (num53 - num44)) * 2) + Math.Abs((int) (num54 - num45))) < 9) && Main.tile[num53, num54].active) && ((Main.tile[num53, num54].type == 0x17) && Main.tile[num53, num54 - 1].active)) && ((Main.tile[num53, num54 - 1].type == 0x20) && (Main.tile[num53, num54 - 1].liquid == 0)))
                                                    {
                                                        flag8 = true;
                                                        break;
                                                    }
                                                }
                                            }
                                            if (flag8)
                                            {
                                                Main.tile[num44, num45].type = 0x20;
                                                Main.tile[num44, num45].active = true;
                                                SquareTileFrame(num44, num45, true);
                                                if (Main.netMode == 2)
                                                {
                                                    NetMessage.SendTileSquare(-1, num44, num45, 3);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            if (Main.tile[num38, num39].type == 60)
                            {
                                int num55 = Main.tile[num38, num39].type;
                                if (!Main.tile[num38, num42].active && (genRand.Next(10) == 0))
                                {
                                    PlaceTile(num38, num42, 0x3d, true, false, -1, 0);
                                    if ((Main.netMode == 2) && Main.tile[num38, num42].active)
                                    {
                                        NetMessage.SendTileSquare(-1, num38, num42, 1);
                                    }
                                }
                                bool flag9 = false;
                                for (int num56 = num40; num56 < num41; num56++)
                                {
                                    for (int num57 = num42; num57 < num43; num57++)
                                    {
                                        if (((num38 != num56) || (num39 != num57)) && (Main.tile[num56, num57].active && (Main.tile[num56, num57].type == 0x3b)))
                                        {
                                            SpreadGrass(num56, num57, 0x3b, num55, false);
                                            if (Main.tile[num56, num57].type == num55)
                                            {
                                                SquareTileFrame(num56, num57, true);
                                                flag9 = true;
                                            }
                                        }
                                    }
                                }
                                if ((Main.netMode == 2) && flag9)
                                {
                                    NetMessage.SendTileSquare(-1, num38, num39, 3);
                                }
                            }
                            if (((Main.tile[num38, num39].type == 0x3d) && (genRand.Next(3) == 0)) && (Main.tile[num38, num39].frameX < 0x90))
                            {
                                Main.tile[num38, num39].type = 0x4a;
                                if (Main.netMode == 2)
                                {
                                    NetMessage.SendTileSquare(-1, num38, num39, 3);
                                }
                            }
                            if (((Main.tile[num38, num39].type == 60) || (Main.tile[num38, num39].type == 0x3e)) && (((genRand.Next(5) == 0) && !Main.tile[num38, num39 + 1].active) && !Main.tile[num38, num39 + 1].lava))
                            {
                                bool flag10 = false;
                                for (int num58 = num39; num58 > (num39 - 10); num58--)
                                {
                                    if (Main.tile[num38, num58].active && (Main.tile[num38, num58].type == 60))
                                    {
                                        flag10 = true;
                                        break;
                                    }
                                }
                                if (flag10)
                                {
                                    int num59 = num38;
                                    int num60 = num39 + 1;
                                    Main.tile[num59, num60].type = 0x3e;
                                    Main.tile[num59, num60].active = true;
                                    SquareTileFrame(num59, num60, true);
                                    if (Main.netMode == 2)
                                    {
                                        NetMessage.SendTileSquare(-1, num59, num60, 3);
                                    }
                                }
                            }
                            if ((Main.tile[num38, num39].type == 0x45) && (genRand.Next(3) == 0))
                            {
                                int num61 = num38;
                                int num62 = num39;
                                int num63 = 0;
                                if (Main.tile[num61 + 1, num62].active && (Main.tile[num61 + 1, num62].type == 0x45))
                                {
                                    num63++;
                                }
                                if (Main.tile[num61 - 1, num62].active && (Main.tile[num61 - 1, num62].type == 0x45))
                                {
                                    num63++;
                                }
                                if (Main.tile[num61, num62 + 1].active && (Main.tile[num61, num62 + 1].type == 0x45))
                                {
                                    num63++;
                                }
                                if (Main.tile[num61, num62 - 1].active && (Main.tile[num61, num62 - 1].type == 0x45))
                                {
                                    num63++;
                                }
                                if ((num63 < 3) || (Main.tile[num38, num39].type == 60))
                                {
                                    switch (genRand.Next(4))
                                    {
                                        case 0:
                                            num62--;
                                            break;

                                        case 1:
                                            num62++;
                                            break;

                                        case 2:
                                            num61--;
                                            break;

                                        case 3:
                                            num61++;
                                            break;
                                    }
                                    if (!Main.tile[num61, num62].active)
                                    {
                                        num63 = 0;
                                        if (Main.tile[num61 + 1, num62].active && (Main.tile[num61 + 1, num62].type == 0x45))
                                        {
                                            num63++;
                                        }
                                        if (Main.tile[num61 - 1, num62].active && (Main.tile[num61 - 1, num62].type == 0x45))
                                        {
                                            num63++;
                                        }
                                        if (Main.tile[num61, num62 + 1].active && (Main.tile[num61, num62 + 1].type == 0x45))
                                        {
                                            num63++;
                                        }
                                        if (Main.tile[num61, num62 - 1].active && (Main.tile[num61, num62 - 1].type == 0x45))
                                        {
                                            num63++;
                                        }
                                        if (num63 < 2)
                                        {
                                            int num65 = 7;
                                            int num66 = num61 - num65;
                                            int num67 = num61 + num65;
                                            int num68 = num62 - num65;
                                            int num69 = num62 + num65;
                                            bool flag11 = false;
                                            for (int num70 = num66; num70 < num67; num70++)
                                            {
                                                for (int num71 = num68; num71 < num69; num71++)
                                                {
                                                    if ((((((Math.Abs((int) (num70 - num61)) * 2) + Math.Abs((int) (num71 - num62))) < 9) && Main.tile[num70, num71].active) && ((Main.tile[num70, num71].type == 60) && Main.tile[num70, num71 - 1].active)) && ((Main.tile[num70, num71 - 1].type == 0x45) && (Main.tile[num70, num71 - 1].liquid == 0)))
                                                    {
                                                        flag11 = true;
                                                        break;
                                                    }
                                                }
                                            }
                                            if (flag11)
                                            {
                                                Main.tile[num61, num62].type = 0x45;
                                                Main.tile[num61, num62].active = true;
                                                SquareTileFrame(num61, num62, true);
                                                if (Main.netMode == 2)
                                                {
                                                    NetMessage.SendTileSquare(-1, num61, num62, 3);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            if (Main.tile[num38, num39].type == 70)
                            {
                                int num72 = Main.tile[num38, num39].type;
                                if (!Main.tile[num38, num42].active && (genRand.Next(10) == 0))
                                {
                                    PlaceTile(num38, num42, 0x47, true, false, -1, 0);
                                    if ((Main.netMode == 2) && Main.tile[num38, num42].active)
                                    {
                                        NetMessage.SendTileSquare(-1, num38, num42, 1);
                                    }
                                }
                                if ((genRand.Next(200) == 0) && !PlayerLOS(num38, num39))
                                {
                                    GrowShroom(num38, num39);
                                }
                                bool flag12 = false;
                                for (int num73 = num40; num73 < num41; num73++)
                                {
                                    for (int num74 = num42; num74 < num43; num74++)
                                    {
                                        if (((num38 != num73) || (num39 != num74)) && (Main.tile[num73, num74].active && (Main.tile[num73, num74].type == 0x3b)))
                                        {
                                            SpreadGrass(num73, num74, 0x3b, num72, false);
                                            if (Main.tile[num73, num74].type == num72)
                                            {
                                                SquareTileFrame(num73, num74, true);
                                                flag12 = true;
                                            }
                                        }
                                    }
                                }
                                if ((Main.netMode == 2) && flag12)
                                {
                                    NetMessage.SendTileSquare(-1, num38, num39, 3);
                                }
                            }
                            continue;
                        }
                        if (flag && (spawnNPC > 0))
                        {
                            SpawnNPC(num38, num39);
                        }
                    }
                }
            }
            if (Main.rand.Next(100) == 0)
            {
                PlantAlch();
            }
            if (!Main.dayTime)
            {
                float num75 = Main.maxTilesX / 0x1068;
                if (Main.rand.Next(0x1f40) < (10f * num75))
                {
                    int num76 = 12;
                    int num77 = Main.rand.Next(Main.maxTilesX - 50) + 100;
                    num77 *= 0x10;
                    int num78 = Main.rand.Next((int) (Main.maxTilesY * 0.05)) * 0x10;
                    Vector2 vector = new Vector2((float) num77, (float) num78);
                    float speedX = Main.rand.Next(-100, 0x65);
                    float speedY = Main.rand.Next(200) + 100;
                    float num81 = (float) Math.Sqrt((double) ((speedX * speedX) + (speedY * speedY)));
                    num81 = ((float) num76) / num81;
                    speedX *= num81;
                    speedY *= num81;
                    Projectile.NewProjectile(vector.X, vector.Y, speedX, speedY, 12, 0x3e8, 10f, Main.myPlayer);
                }
            }
        }

        public static void WallFrame(int i, int j, bool resetFrame = false)
        {
            if ((((i >= 0) && (j >= 0)) && ((i < Main.maxTilesX) && (j < Main.maxTilesY))) && ((Main.tile[i, j] != null) && (Main.tile[i, j].wall > 0)))
            {
                int num = -1;
                int num2 = -1;
                int num3 = -1;
                int num4 = -1;
                int num5 = -1;
                int num6 = -1;
                int num7 = -1;
                int num8 = -1;
                int wall = Main.tile[i, j].wall;
                if (wall != 0)
                {
                    Rectangle rectangle;
                    byte wallFrameX = Main.tile[i, j].wallFrameX;
                    byte wallFrameY = Main.tile[i, j].wallFrameY;
                    rectangle.X = -1;
                    rectangle.Y = -1;
                    if ((i - 1) < 0)
                    {
                        num = wall;
                        num4 = wall;
                        num6 = wall;
                    }
                    if ((i + 1) >= Main.maxTilesX)
                    {
                        num3 = wall;
                        num5 = wall;
                        num8 = wall;
                    }
                    if ((j - 1) < 0)
                    {
                        num = wall;
                        num2 = wall;
                        num3 = wall;
                    }
                    if ((j + 1) >= Main.maxTilesY)
                    {
                        num6 = wall;
                        num7 = wall;
                        num8 = wall;
                    }
                    if (((i - 1) >= 0) && (Main.tile[i - 1, j] != null))
                    {
                        num4 = Main.tile[i - 1, j].wall;
                    }
                    if (((i + 1) < Main.maxTilesX) && (Main.tile[i + 1, j] != null))
                    {
                        num5 = Main.tile[i + 1, j].wall;
                    }
                    if (((j - 1) >= 0) && (Main.tile[i, j - 1] != null))
                    {
                        num2 = Main.tile[i, j - 1].wall;
                    }
                    if (((j + 1) < Main.maxTilesY) && (Main.tile[i, j + 1] != null))
                    {
                        num7 = Main.tile[i, j + 1].wall;
                    }
                    if ((((i - 1) >= 0) && ((j - 1) >= 0)) && (Main.tile[i - 1, j - 1] != null))
                    {
                        num = Main.tile[i - 1, j - 1].wall;
                    }
                    if ((((i + 1) < Main.maxTilesX) && ((j - 1) >= 0)) && (Main.tile[i + 1, j - 1] != null))
                    {
                        num3 = Main.tile[i + 1, j - 1].wall;
                    }
                    if ((((i - 1) >= 0) && ((j + 1) < Main.maxTilesY)) && (Main.tile[i - 1, j + 1] != null))
                    {
                        num6 = Main.tile[i - 1, j + 1].wall;
                    }
                    if ((((i + 1) < Main.maxTilesX) && ((j + 1) < Main.maxTilesY)) && (Main.tile[i + 1, j + 1] != null))
                    {
                        num8 = Main.tile[i + 1, j + 1].wall;
                    }
                    if (wall == 2)
                    {
                        if (j == ((int) Main.worldSurface))
                        {
                            num7 = wall;
                            num6 = wall;
                            num8 = wall;
                        }
                        else if (j >= ((int) Main.worldSurface))
                        {
                            num7 = wall;
                            num6 = wall;
                            num8 = wall;
                            num2 = wall;
                            num = wall;
                            num3 = wall;
                            num4 = wall;
                            num5 = wall;
                        }
                    }
                    if (num7 > 0)
                    {
                        num7 = wall;
                    }
                    if (num6 > 0)
                    {
                        num6 = wall;
                    }
                    if (num8 > 0)
                    {
                        num8 = wall;
                    }
                    if (num2 > 0)
                    {
                        num2 = wall;
                    }
                    if (num > 0)
                    {
                        num = wall;
                    }
                    if (num3 > 0)
                    {
                        num3 = wall;
                    }
                    if (num4 > 0)
                    {
                        num4 = wall;
                    }
                    if (num5 > 0)
                    {
                        num5 = wall;
                    }
                    int wallFrameNumber = 0;
                    if (resetFrame)
                    {
                        wallFrameNumber = genRand.Next(0, 3);
                        Main.tile[i, j].wallFrameNumber = (byte) wallFrameNumber;
                    }
                    else
                    {
                        wallFrameNumber = Main.tile[i, j].wallFrameNumber;
                    }
                    if ((rectangle.X < 0) || (rectangle.Y < 0))
                    {
                        if (((num2 == wall) && (num7 == wall)) && ((num4 == wall) & (num5 == wall)))
                        {
                            if ((num != wall) && (num3 != wall))
                            {
                                switch (wallFrameNumber)
                                {
                                    case 0:
                                        rectangle.X = 0x6c;
                                        rectangle.Y = 0x12;
                                        break;

                                    case 1:
                                        rectangle.X = 0x7e;
                                        rectangle.Y = 0x12;
                                        break;

                                    case 2:
                                        rectangle.X = 0x90;
                                        rectangle.Y = 0x12;
                                        break;
                                }
                            }
                            else if ((num6 != wall) && (num8 != wall))
                            {
                                switch (wallFrameNumber)
                                {
                                    case 0:
                                        rectangle.X = 0x6c;
                                        rectangle.Y = 0x24;
                                        break;

                                    case 1:
                                        rectangle.X = 0x7e;
                                        rectangle.Y = 0x24;
                                        break;

                                    case 2:
                                        rectangle.X = 0x90;
                                        rectangle.Y = 0x24;
                                        break;
                                }
                            }
                            else if ((num != wall) && (num6 != wall))
                            {
                                switch (wallFrameNumber)
                                {
                                    case 0:
                                        rectangle.X = 180;
                                        rectangle.Y = 0;
                                        break;

                                    case 1:
                                        rectangle.X = 180;
                                        rectangle.Y = 0x12;
                                        break;

                                    case 2:
                                        rectangle.X = 180;
                                        rectangle.Y = 0x24;
                                        break;
                                }
                            }
                            else if ((num3 != wall) && (num8 != wall))
                            {
                                switch (wallFrameNumber)
                                {
                                    case 0:
                                        rectangle.X = 0xc6;
                                        rectangle.Y = 0;
                                        break;

                                    case 1:
                                        rectangle.X = 0xc6;
                                        rectangle.Y = 0x12;
                                        break;

                                    case 2:
                                        rectangle.X = 0xc6;
                                        rectangle.Y = 0x24;
                                        break;
                                }
                            }
                            else
                            {
                                switch (wallFrameNumber)
                                {
                                    case 0:
                                        rectangle.X = 0x12;
                                        rectangle.Y = 0x12;
                                        break;

                                    case 1:
                                        rectangle.X = 0x24;
                                        rectangle.Y = 0x12;
                                        break;

                                    case 2:
                                        rectangle.X = 0x36;
                                        rectangle.Y = 0x12;
                                        break;
                                }
                            }
                        }
                        else if (((num2 != wall) && (num7 == wall)) && ((num4 == wall) & (num5 == wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0x12;
                                    rectangle.Y = 0;
                                    break;

                                case 1:
                                    rectangle.X = 0x24;
                                    rectangle.Y = 0;
                                    break;

                                case 2:
                                    rectangle.X = 0x36;
                                    rectangle.Y = 0;
                                    break;
                            }
                        }
                        else if (((num2 == wall) && (num7 != wall)) && ((num4 == wall) & (num5 == wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0x12;
                                    rectangle.Y = 0x24;
                                    break;

                                case 1:
                                    rectangle.X = 0x24;
                                    rectangle.Y = 0x24;
                                    break;

                                case 2:
                                    rectangle.X = 0x36;
                                    rectangle.Y = 0x24;
                                    break;
                            }
                        }
                        else if (((num2 == wall) && (num7 == wall)) && ((num4 != wall) & (num5 == wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0;
                                    rectangle.Y = 0;
                                    break;

                                case 1:
                                    rectangle.X = 0;
                                    rectangle.Y = 0x12;
                                    break;

                                case 2:
                                    rectangle.X = 0;
                                    rectangle.Y = 0x24;
                                    break;
                            }
                        }
                        else if (((num2 == wall) && (num7 == wall)) && ((num4 == wall) & (num5 != wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0x48;
                                    rectangle.Y = 0;
                                    break;

                                case 1:
                                    rectangle.X = 0x48;
                                    rectangle.Y = 0x12;
                                    break;

                                case 2:
                                    rectangle.X = 0x48;
                                    rectangle.Y = 0x24;
                                    break;
                            }
                        }
                        else if (((num2 != wall) && (num7 == wall)) && ((num4 != wall) & (num5 == wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0;
                                    rectangle.Y = 0x36;
                                    break;

                                case 1:
                                    rectangle.X = 0x24;
                                    rectangle.Y = 0x36;
                                    break;

                                case 2:
                                    rectangle.X = 0x48;
                                    rectangle.Y = 0x36;
                                    break;
                            }
                        }
                        else if (((num2 != wall) && (num7 == wall)) && ((num4 == wall) & (num5 != wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0x12;
                                    rectangle.Y = 0x36;
                                    break;

                                case 1:
                                    rectangle.X = 0x36;
                                    rectangle.Y = 0x36;
                                    break;

                                case 2:
                                    rectangle.X = 90;
                                    rectangle.Y = 0x36;
                                    break;
                            }
                        }
                        else if (((num2 == wall) && (num7 != wall)) && ((num4 != wall) & (num5 == wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0;
                                    rectangle.Y = 0x48;
                                    break;

                                case 1:
                                    rectangle.X = 0x24;
                                    rectangle.Y = 0x48;
                                    break;

                                case 2:
                                    rectangle.X = 0x48;
                                    rectangle.Y = 0x48;
                                    break;
                            }
                        }
                        else if (((num2 == wall) && (num7 != wall)) && ((num4 == wall) & (num5 != wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0x12;
                                    rectangle.Y = 0x48;
                                    break;

                                case 1:
                                    rectangle.X = 0x36;
                                    rectangle.Y = 0x48;
                                    break;

                                case 2:
                                    rectangle.X = 90;
                                    rectangle.Y = 0x48;
                                    break;
                            }
                        }
                        else if (((num2 == wall) && (num7 == wall)) && ((num4 != wall) & (num5 != wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 90;
                                    rectangle.Y = 0;
                                    break;

                                case 1:
                                    rectangle.X = 90;
                                    rectangle.Y = 0x12;
                                    break;

                                case 2:
                                    rectangle.X = 90;
                                    rectangle.Y = 0x24;
                                    break;
                            }
                        }
                        else if (((num2 != wall) && (num7 != wall)) && ((num4 == wall) & (num5 == wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0x6c;
                                    rectangle.Y = 0x48;
                                    break;

                                case 1:
                                    rectangle.X = 0x7e;
                                    rectangle.Y = 0x48;
                                    break;

                                case 2:
                                    rectangle.X = 0x90;
                                    rectangle.Y = 0x48;
                                    break;
                            }
                        }
                        else if (((num2 != wall) && (num7 == wall)) && ((num4 != wall) & (num5 != wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0x6c;
                                    rectangle.Y = 0;
                                    break;

                                case 1:
                                    rectangle.X = 0x7e;
                                    rectangle.Y = 0;
                                    break;

                                case 2:
                                    rectangle.X = 0x90;
                                    rectangle.Y = 0;
                                    break;
                            }
                        }
                        else if (((num2 == wall) && (num7 != wall)) && ((num4 != wall) & (num5 != wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0x6c;
                                    rectangle.Y = 0x36;
                                    break;

                                case 1:
                                    rectangle.X = 0x7e;
                                    rectangle.Y = 0x36;
                                    break;

                                case 2:
                                    rectangle.X = 0x90;
                                    rectangle.Y = 0x36;
                                    break;
                            }
                        }
                        else if (((num2 != wall) && (num7 != wall)) && ((num4 != wall) & (num5 == wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0xa2;
                                    rectangle.Y = 0;
                                    break;

                                case 1:
                                    rectangle.X = 0xa2;
                                    rectangle.Y = 0x12;
                                    break;

                                case 2:
                                    rectangle.X = 0xa2;
                                    rectangle.Y = 0x24;
                                    break;
                            }
                        }
                        else if (((num2 != wall) && (num7 != wall)) && ((num4 == wall) & (num5 != wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0xd8;
                                    rectangle.Y = 0;
                                    break;

                                case 1:
                                    rectangle.X = 0xd8;
                                    rectangle.Y = 0x12;
                                    break;

                                case 2:
                                    rectangle.X = 0xd8;
                                    rectangle.Y = 0x24;
                                    break;
                            }
                        }
                        else if (((num2 != wall) && (num7 != wall)) && ((num4 != wall) & (num5 != wall)))
                        {
                            switch (wallFrameNumber)
                            {
                                case 0:
                                    rectangle.X = 0xa2;
                                    rectangle.Y = 0x36;
                                    break;

                                case 1:
                                    rectangle.X = 180;
                                    rectangle.Y = 0x36;
                                    break;

                                case 2:
                                    rectangle.X = 0xc6;
                                    rectangle.Y = 0x36;
                                    break;
                            }
                        }
                    }
                    if ((rectangle.X <= -1) || (rectangle.Y <= -1))
                    {
                        if (wallFrameNumber <= 0)
                        {
                            rectangle.X = 0x12;
                            rectangle.Y = 0x12;
                        }
                        if (wallFrameNumber == 1)
                        {
                            rectangle.X = 0x24;
                            rectangle.Y = 0x12;
                        }
                        if (wallFrameNumber >= 2)
                        {
                            rectangle.X = 0x36;
                            rectangle.Y = 0x12;
                        }
                    }
                    Main.tile[i, j].wallFrameX = (byte) rectangle.X;
                    Main.tile[i, j].wallFrameY = (byte) rectangle.Y;
                }
            }
        }

        public static void WaterCheck()
        {
            Liquid.numLiquid = 0;
            LiquidBuffer.numLiquidBuffer = 0;
            for (int i = 1; i < (Main.maxTilesX - 1); i++)
            {
                for (int j = Main.maxTilesY - 2; j > 0; j--)
                {
                    Main.tile[i, j].checkingLiquid = false;
                    if (((Main.tile[i, j].liquid > 0) && Main.tile[i, j].active) && (Main.tileSolid[Main.tile[i, j].type] && !Main.tileSolidTop[Main.tile[i, j].type]))
                    {
                        Main.tile[i, j].liquid = 0;
                    }
                    else if (Main.tile[i, j].liquid > 0)
                    {
                        if (Main.tile[i, j].active)
                        {
                            if (Main.tileWaterDeath[Main.tile[i, j].type])
                            {
                                KillTile(i, j, false, false, false);
                            }
                            if (Main.tile[i, j].lava && Main.tileLavaDeath[Main.tile[i, j].type])
                            {
                                KillTile(i, j, false, false, false);
                            }
                        }
                        if (((!Main.tile[i, j + 1].active || !Main.tileSolid[Main.tile[i, j + 1].type]) || Main.tileSolidTop[Main.tile[i, j + 1].type]) && (Main.tile[i, j + 1].liquid < 0xff))
                        {
                            if (Main.tile[i, j + 1].liquid > 250)
                            {
                                Main.tile[i, j + 1].liquid = 0xff;
                            }
                            else
                            {
                                Liquid.AddWater(i, j);
                            }
                        }
                        if (((!Main.tile[i - 1, j].active || !Main.tileSolid[Main.tile[i - 1, j].type]) || Main.tileSolidTop[Main.tile[i - 1, j].type]) && (Main.tile[i - 1, j].liquid != Main.tile[i, j].liquid))
                        {
                            Liquid.AddWater(i, j);
                        }
                        else if (((!Main.tile[i + 1, j].active || !Main.tileSolid[Main.tile[i + 1, j].type]) || Main.tileSolidTop[Main.tile[i + 1, j].type]) && (Main.tile[i + 1, j].liquid != Main.tile[i, j].liquid))
                        {
                            Liquid.AddWater(i, j);
                        }
                        if (Main.tile[i, j].lava)
                        {
                            if ((Main.tile[i - 1, j].liquid > 0) && !Main.tile[i - 1, j].lava)
                            {
                                Liquid.AddWater(i, j);
                            }
                            else if ((Main.tile[i + 1, j].liquid > 0) && !Main.tile[i + 1, j].lava)
                            {
                                Liquid.AddWater(i, j);
                            }
                            else if ((Main.tile[i, j - 1].liquid > 0) && !Main.tile[i, j - 1].lava)
                            {
                                Liquid.AddWater(i, j);
                            }
                            else if ((Main.tile[i, j + 1].liquid > 0) && !Main.tile[i, j + 1].lava)
                            {
                                Liquid.AddWater(i, j);
                            }
                        }
                    }
                }
            }
        }

        public static void worldGenCallBack(object threadContext)
        {
            Main.PlaySound(10, -1, -1, 1);
            clearWorld();
            generateWorld(-1);
            saveWorld(true);
            Main.LoadWorlds();
            if (Main.menuMode == 10)
            {
                Main.menuMode = 6;
            }
            Main.PlaySound(10, -1, -1, 1);
        }

        public static void xferWater()
        {
            for (int i = 0; i < numInPump; i++)
            {
                int num2 = inPumpX[i];
                int j = inPumpY[i];
                int liquid = Main.tile[num2, j].liquid;
                if (liquid > 0)
                {
                    bool lava = Main.tile[num2, j].lava;
                    for (int k = 0; k < numOutPump; k++)
                    {
                        int num6 = outPumpX[k];
                        int num7 = outPumpY[k];
                        int num8 = Main.tile[num6, num7].liquid;
                        if (num8 < 0xff)
                        {
                            bool flag2 = Main.tile[num6, num7].lava;
                            if (num8 == 0)
                            {
                                flag2 = lava;
                            }
                            if (lava == flag2)
                            {
                                int num9 = liquid;
                                if ((num9 + num8) > 0xff)
                                {
                                    num9 = 0xff - num8;
                                }
                                Tile tile1 = Main.tile[num6, num7];
                                tile1.liquid = (byte) (tile1.liquid + ((byte) num9));
                                Tile tile2 = Main.tile[num2, j];
                                tile2.liquid = (byte) (tile2.liquid - ((byte) num9));
                                liquid = Main.tile[num2, j].liquid;
                                Main.tile[num6, num7].lava = lava;
                                SquareTileFrame(num6, num7, true);
                                if (Main.tile[num2, j].liquid == 0)
                                {
                                    Main.tile[num2, j].lava = false;
                                    SquareTileFrame(num2, j, true);
                                    break;
                                }
                            }
                        }
                    }
                    SquareTileFrame(num2, j, true);
                }
            }
        }
    }
}

